console['log']('Helena\x20Paint\x20-\x20draw56.js');const canvas=document['getElementById']('glCanvas'),canvasWrapper=document['getElementById']('canvasWrapper')||canvas['parentElement'];canvas['style']['transformOrigin']='top\x20left';let lastX=null,lastY=null,zoomScale=0x1,panX=0x0,panY=0x0,zoomMin=0x1,zoomMax=0x5,lastTouchDist=null,lastTouchMidpoint=null,isPanning=!0x1,isTwoFingerGesture=!0x1,isUIDragging=!0x1;function isMobile(){return/Mobi|Android|iPhone|iPad|iPod/['test'](navigator['userAgent']);}function getMidpoint(_0x2405bc,_0x5b977c){return{'x':(_0x2405bc['clientX']+_0x5b977c['clientX'])/0x2,'y':(_0x2405bc['clientY']+_0x5b977c['clientY'])/0x2};}function getDistance(_0x2b3445,_0x2c7444){const _0x30b884=_0x2b3445['clientX']-_0x2c7444['clientX'],_0x2ba780=_0x2b3445['clientY']-_0x2c7444['clientY'];return Math['sqrt'](_0x30b884*_0x30b884+_0x2ba780*_0x2ba780);}function canPaint(){return'idle'===transformTool['mode']&&!spacePanning&&!isTwoFingerGesture&&!isUIDragging;}let pinchStart=null;function normAngle(_0x583901){return _0x583901>Math['PI']&&(_0x583901-=0x2*Math['PI']),_0x583901<-Math['PI']&&(_0x583901+=0x2*Math['PI']),_0x583901;}function transformCanvasPoint(_0x14890a,_0x59ef7e,_0x76d24a,_0x8cf04e){const _0x3c869e=_0x14890a*_0x76d24a,_0x284731=_0x59ef7e*_0x76d24a,_0x937dcf=Math['cos'](_0x8cf04e),_0x872d58=Math['sin'](_0x8cf04e);return{'x':_0x3c869e*_0x937dcf-_0x284731*_0x872d58,'y':_0x3c869e*_0x872d58+_0x284731*_0x937dcf};}let viewRotation=0x0,transformOriginX=0x0,transformOriginY=0x0;function updateCanvasTransform(){canvas['style']['transformOrigin']='0\x200',canvas['style']['transform']='translate('+panX+'px,\x20'+panY+'px)\x20rotate('+viewRotation+'rad)\x20scale('+zoomScale+')';}function rotatePoint(_0x575f81,_0x1d4f2b,_0x1aff05,_0x1e2c6e=0x0,_0x557014=0x0){const _0x41f93f=_0x575f81-_0x1e2c6e,_0x365f57=_0x1d4f2b-_0x557014,_0x1f7d11=Math['cos'](_0x1aff05),_0x23a5a1=Math['sin'](_0x1aff05);return{'x':_0x1e2c6e+_0x41f93f*_0x1f7d11-_0x365f57*_0x23a5a1,'y':_0x557014+_0x41f93f*_0x23a5a1+_0x365f57*_0x1f7d11};}function screenToCanvasPx(_0x556735,_0x4ea8fb){const _0x3f7860=canvasWrapper['getBoundingClientRect']();let _0x3ec8c9=_0x556735-_0x3f7860['left'],_0x48ac96=_0x4ea8fb-_0x3f7860['top'];_0x3ec8c9-=panX,_0x48ac96-=panY;const _0x4cc646=rotatePoint(_0x3ec8c9,_0x48ac96,-viewRotation,transformOriginX,transformOriginY);_0x3ec8c9=_0x4cc646['x'],_0x48ac96=_0x4cc646['y'];const _0x3b1999=_0x3ec8c9/zoomScale,_0x3d44b1=_0x48ac96/zoomScale;return{'x':Math['max'](0x0,Math['min'](canvas['width'],_0x3b1999)),'y':Math['max'](0x0,Math['min'](canvas['height'],_0x3d44b1))};}function canvasPxToFBO(_0x4be57a,_0x300de6){return{'fx':_0x4be57a*(fixedFBOWidth/canvas['width']),'fy':_0x300de6*(fixedFBOHeight/canvas['height'])};}function pointerToBoth(_0x143775){const _0x3be663=screenToCanvasPx(_0x143775['clientX'],_0x143775['clientY']),_0x173120=canvasPxToFBO(_0x3be663['x'],_0x3be663['y']);return{'cx':_0x3be663['x'],'cy':_0x3be663['y'],'fx':_0x173120['fx'],'fy':_0x173120['fy']};}let brushHUD={'visible':!0x1,'hideAt':0x0},lastPointer={'cx':0.5*canvas['width'],'cy':0.5*canvas['height']};function showBrushHUD(_0x2145ec=0x4b0){brushHUD['visible']=!0x0,brushHUD['hideAt']=performance['now']()+_0x2145ec,needsRedraw=!0x0,requestDrawIfIdle();}function maybeAutoHideBrushHUD(){brushHUD['visible']&&performance['now']()>=brushHUD['hideAt']&&(brushHUD['visible']=!0x1,needsRedraw=!0x0,requestDrawIfIdle());}let touchViz={'pts':[],'visible':!0x1};function setTouchVizFromTouches(_0x1b201f){const _0x35cd17=[];for(let _0x5590d8=0x0;_0x5590d8<_0x1b201f['length'];_0x5590d8++){const _0xc56796=_0x1b201f[_0x5590d8],_0x1b0711=screenToCanvasPx(_0xc56796['clientX'],_0xc56796['clientY']);_0x35cd17['push']({'x':_0x1b0711['x'],'y':_0x1b0711['y']});}touchViz['pts']=_0x35cd17,touchViz['visible']=_0x35cd17['length']>0x0,void 0x0!==needsRedraw&&(needsRedraw=!0x0),'function'==typeof requestDrawIfIdle&&requestDrawIfIdle();}function clearTouchViz(){touchViz['pts']=[],touchViz['visible']=!0x1,void 0x0!==needsRedraw&&(needsRedraw=!0x0),'function'==typeof requestDrawIfIdle&&requestDrawIfIdle();}const TOUCH_TARGET_OK=_0x552e06=>!(!_0x552e06||_0x552e06!==canvas&&_0x552e06!==canvasWrapper&&!_0x552e06['closest']?.('#canvasWrapper'));function onTouchStartCapture(_0x59bf10){_0x59bf10['touches']&&_0x59bf10['touches']['length']&&TOUCH_TARGET_OK(_0x59bf10['target'])&&setTouchVizFromTouches(_0x59bf10['touches']);}function onTouchMoveCapture(_0x32e4d5){_0x32e4d5['touches']&&_0x32e4d5['touches']['length']&&TOUCH_TARGET_OK(_0x32e4d5['target'])&&setTouchVizFromTouches(_0x32e4d5['touches']);}function onTouchEndCapture(_0x14ff14){_0x14ff14['touches']&&_0x14ff14['touches']['length']?setTouchVizFromTouches(_0x14ff14['touches']):clearTouchViz();}document['addEventListener']('touchstart',onTouchStartCapture,{'capture':!0x0,'passive':!0x0}),document['addEventListener']('touchmove',onTouchMoveCapture,{'capture':!0x0,'passive':!0x0}),document['addEventListener']('touchend',onTouchEndCapture,{'capture':!0x0,'passive':!0x0}),document['addEventListener']('touchcancel',onTouchEndCapture,{'capture':!0x0,'passive':!0x0});let frameTimes=[],memoryWarningShown=!0x1,frameRateMonitoringActive=!0x1;function sampleFrameTime(){const _0x4cc74f=performance['now']();if(frameTimes['push'](_0x4cc74f),frameTimes['length']>0x1e&&frameTimes['shift'](),activeReasons['size']>0x0){const _0x32f291=[];for(let _0x1b81b1=0x1;_0x1b81b1<frameTimes['length'];_0x1b81b1++)_0x32f291['push'](frameTimes[_0x1b81b1]-frameTimes[_0x1b81b1-0x1]);(_0x32f291['length']?_0x32f291['reduce']((_0x2eb85b,_0x5613b4)=>_0x2eb85b+_0x5613b4,0x0)/_0x32f291['length']:0x0)>0x50&&!memoryWarningShown&&(console['warn']('⚠️\x20Low\x20frame\x20rate\x20detected!\x20Possible\x20memory\x20overload.'),showStatusMessage('⚠️\x20App\x20running\x20slow\x20—\x20consider\x20undo\x20or\x20saving','warning'),memoryWarningShown=!0x0);}}let rafId=null;const activeReasons=new Set();function requestDrawIfIdle(){rafId||(rafId=requestAnimationFrame(()=>{rafId=null,needsRedraw&&(drawScene(),needsRedraw=!0x1,sampleFrameTime?.());}));}function startRender(_0x22fc42){_0x22fc42&&activeReasons['add'](_0x22fc42),rafId||(rafId=requestAnimationFrame(tick));}function stopRender(_0x12c8f9){_0x12c8f9&&activeReasons['delete'](_0x12c8f9);}function tick(){rafId=null,activeReasons['size']>0x0?(needsRedraw&&(drawScene(),needsRedraw=!0x1,sampleFrameTime?.()),rafId=requestAnimationFrame(tick)):needsRedraw&&(drawScene(),needsRedraw=!0x1,sampleFrameTime?.());}let RENDER_LOOP_DISABLED=!0x0;function disableRenderLoop(){RENDER_LOOP_DISABLED=!0x0;try{activeReasons?.['clear']?.();}catch{}rafId&&(cancelAnimationFrame(rafId),rafId=null);}function enableRenderLoop(){RENDER_LOOP_DISABLED=!0x1;}const _startRender=startRender;startRender=function(_0x3eea59){RENDER_LOOP_DISABLED||_startRender['call'](this,_0x3eea59);};const _requestDrawIfIdle=requestDrawIfIdle;requestDrawIfIdle=function(){RENDER_LOOP_DISABLED?needsRedraw&&(drawScene(),needsRedraw=!0x1,sampleFrameTime?.()):_requestDrawIfIdle['call'](this);};const _tick=tick;tick=function(){RENDER_LOOP_DISABLED?rafId&&(cancelAnimationFrame(rafId),rafId=null):_tick['call'](this);},disableRenderLoop(),canvasWrapper['addEventListener']('wheel',_0x3498bd=>{_0x3498bd['preventDefault']();const _0x6c3838=0x1===_0x3498bd['deltaMode']?0x10:0x1,_0x44cfa8=_0x3498bd['deltaX']*_0x6c3838,_0xb27f65=_0x3498bd['deltaY']*_0x6c3838,_0x4eb6d1=canvasWrapper['getBoundingClientRect'](),_0xa92e33=_0x3498bd['clientX']-_0x4eb6d1['left'],_0x950cfc=_0x3498bd['clientY']-_0x4eb6d1['top'],_0x2f87ed=(_0xa92e33-panX)/zoomScale,_0x3cc2ad=(_0x950cfc-panY)/zoomScale;if(_0x3498bd['ctrlKey']){const _0x1c45b4=0.0025,_0x17820a=Math['min'](Math['max'](zoomScale-_0xb27f65*_0x1c45b4,zoomMin),zoomMax),_0x25be24=_0x17820a/zoomScale;panX-=_0x2f87ed*(_0x25be24-0x1)*zoomScale,panY-=_0x3cc2ad*(_0x25be24-0x1)*zoomScale,zoomScale=_0x17820a,updateCanvasTransform();}else{const _0x18ff29=0x1;panX-=_0x44cfa8*_0x18ff29,panY-=_0xb27f65*_0x18ff29,updateCanvasTransform();}},{'passive':!0x1}),canvasWrapper['addEventListener']('mousemove',_0x5a564b=>{const _0x412a93=screenToCanvasPx(_0x5a564b['clientX'],_0x5a564b['clientY']);lastPointer['cx']=_0x412a93['x'],lastPointer['cy']=_0x412a93['y'],brushHUD['visible']&&(overlayPosition=[_0x412a93['x']/canvas['width'],_0x412a93['y']/canvas['height']],needsRedraw=!0x0,requestDrawIfIdle());},{'passive':!0x0});let spacePanning=!0x1,panStart=null;document['addEventListener']('keydown',_0x40a274=>{'Space'===_0x40a274['code']&&(spacePanning=!0x0);}),document['addEventListener']('keyup',_0xcb3b3d=>{'Space'===_0xcb3b3d['code']&&(spacePanning=!0x1);}),canvasWrapper['addEventListener']('mousedown',_0x155aa9=>{spacePanning&&(_0x155aa9['preventDefault'](),panStart={'x':_0x155aa9['clientX'],'y':_0x155aa9['clientY'],'panX0':panX,'panY0':panY});}),window['addEventListener']('mousemove',_0x556129=>{panStart&&(panX=panStart['panX0']+(_0x556129['clientX']-panStart['x']),panY=panStart['panY0']+(_0x556129['clientY']-panStart['y']),updateCanvasTransform());}),['mouseup','mouseleave']['forEach'](_0x168f09=>window['addEventListener'](_0x168f09,()=>panStart=null)),canvasWrapper['addEventListener']('mousedown',_0x55c735=>{if(0x1!==_0x55c735['button'])return;_0x55c735['preventDefault']();const _0x3654ae=_0x55c735['clientX'],_0x5bf396=_0x55c735['clientY'],_0x4d3634=panX,_0x3e7bd0=panY,_0x8794c0=_0x35a467=>{panX=_0x4d3634+(_0x35a467['clientX']-_0x3654ae),panY=_0x3e7bd0+(_0x35a467['clientY']-_0x5bf396),updateCanvasTransform();},_0xf81b5e=()=>{window['removeEventListener']('mousemove',_0x8794c0),window['removeEventListener']('mouseup',_0xf81b5e);};window['addEventListener']('mousemove',_0x8794c0),window['addEventListener']('mouseup',_0xf81b5e);}),window['addEventListener']('mousemove',onTransformPointerMove),canvas['addEventListener']('touchmove',_0x11ccd6=>{if('idle'===transformTool['mode'])return;const _0x360507=_0x11ccd6['touches'][0x0];_0x360507&&onTransformPointerMove(_0x360507);},{'passive':!0x1}),['mouseup','mouseleave','touchend','touchcancel']['forEach'](_0x1f213e=>window['addEventListener'](_0x1f213e,()=>{'idle'!==transformTool['mode']&&endTransform(!0x0);},{'passive':!0x0})),canvas['addEventListener']('mousedown',()=>{isDrawing=!0x0,startRender('draw');}),['mouseup','mouseleave']['forEach'](_0x93d895=>canvas['addEventListener'](_0x93d895,()=>{isDrawing=!0x1,stopRender('draw');})),canvas['addEventListener']('touchstart',_0x537d57=>{isTwoFingerGesture||(isDrawing=!0x0,startRender('draw'));},{'passive':!0x1}),['touchend','touchcancel']['forEach'](_0x31a626=>window['addEventListener'](_0x31a626,()=>{isTwoFingerGesture&&(!event['touches']||event['touches']['length']<0x2)&&(isTwoFingerGesture=!0x1,pinchStart=null),'idle'!==transformTool['mode']&&endTransform(!0x0);},{'passive':!0x0}));let lastTouchAngle=null;function getAngle(_0x3a61fd,_0xfec680){return Math['atan2'](_0xfec680['clientY']-_0x3a61fd['clientY'],_0xfec680['clientX']-_0x3a61fd['clientX']);}canvasWrapper['addEventListener']('touchstart',_0x3e1e0c=>{if(0x2===_0x3e1e0c['touches']['length']){_0x3e1e0c['preventDefault'](),isTwoFingerGesture=!0x0;const _0x26984c=_0x3e1e0c['touches'][0x0],_0x188836=_0x3e1e0c['touches'][0x1];lastTouchDist=getDistance(_0x26984c,_0x188836),lastTouchAngle=getAngle(_0x26984c,_0x188836);const _0x26d230=getMidpoint(_0x26984c,_0x188836),_0x49175d=canvasWrapper['getBoundingClientRect'](),_0x1a32a0=_0x26d230['x']-_0x49175d['left'],_0x41fdc7=_0x26d230['y']-_0x49175d['top'],_0x411bf1=screenToCanvasPx(_0x1a32a0+_0x49175d['left'],_0x41fdc7+_0x49175d['top']);pinchStart={'dist':Math['max'](0.000001,lastTouchDist),'angle':lastTouchAngle,'scale0':zoomScale,'rot0':viewRotation,'anchorCanvas':{'x':_0x411bf1['x'],'y':_0x411bf1['y']}};}},{'passive':!0x1}),canvasWrapper['addEventListener']('touchmove',_0x1ca657=>{if(0x2!==_0x1ca657['touches']['length']||!pinchStart)return;_0x1ca657['preventDefault'](),isDrawing=!0x1;const _0xa0a3d8=_0x1ca657['touches'][0x0],_0xb0301e=_0x1ca657['touches'][0x1],_0x40b474=Math['max'](0.000001,getDistance(_0xa0a3d8,_0xb0301e)),_0x31cef1=getAngle(_0xa0a3d8,_0xb0301e),_0x2fd6d3=getMidpoint(_0xa0a3d8,_0xb0301e),_0x14ff1f=canvasWrapper['getBoundingClientRect'](),_0x180e5a=_0x2fd6d3['x']-_0x14ff1f['left'],_0x35a800=_0x2fd6d3['y']-_0x14ff1f['top'],_0x3685d0=pinchStart['scale0']*(_0x40b474/pinchStart['dist']),_0x5df1a9=Math['min'](Math['max'](_0x3685d0,zoomMin),zoomMax),_0x15e1f8=normAngle(_0x31cef1-pinchStart['angle']),_0x2a1be7=pinchStart['rot0']+_0x15e1f8,_0x39b56e=pinchStart['anchorCanvas'],_0x33f1f2=transformCanvasPoint(_0x39b56e['x'],_0x39b56e['y'],_0x5df1a9,_0x2a1be7);panX=_0x180e5a-_0x33f1f2['x'],panY=_0x35a800-_0x33f1f2['y'],zoomScale=_0x5df1a9,viewRotation=_0x2a1be7,updateCanvasTransform(),lastTouchDist=_0x40b474,lastTouchAngle=_0x31cef1;},{'passive':!0x1}),canvas['addEventListener']('touchstart',_0x523e5f=>{isTwoFingerGesture&&(_0x523e5f['preventDefault'](),_0x523e5f['stopPropagation']());},{'passive':!0x1});const gl=canvas['getContext']('webgl2',{'alpha':!0x0,'powerPreference':'high-performance'});let needsRedraw=!0x0;const imageLoader=document['getElementById']('imageLoader'),colorPicker=document['getElementById']('colorPicker'),brushes=[{'name':'Dot','file':'/static/draw/images/brushes/dot.webp','defaultSize':0.02,'selected':!0x1},{'name':'Fine\x20Liner','file':'/static/draw/images/brushes/fine-liner-2.webp','defaultSize':0.03,'selected':!0x1},{'name':'Brush\x2012','file':'/static/draw/images/brushes/12.webp','defaultSize':0.04,'selected':!0x1},{'name':'Brush\x2011','file':'/static/draw/images/brushes/11.webp','defaultSize':0.05,'selected':!0x0},{'name':'Brush\x200','file':'/static/draw/images/brushes/0.png','defaultSize':0.025,'selected':!0x1},{'name':'Brush\x205','file':'/static/draw/images/brushes/5.png','defaultSize':0.03,'selected':!0x1},{'name':'Brush\x201','file':'/static/draw/images/brushes/1.png','defaultSize':0.035,'selected':!0x1},{'name':'Brush\x202','file':'/static/draw/images/brushes/2.png','defaultSize':0.04,'selected':!0x1},{'name':'Brush\x203','file':'/static/draw/images/brushes/3.png','defaultSize':0.045,'selected':!0x1},{'name':'Brush\x204','file':'/static/draw/images/brushes/4.png','defaultSize':0.05,'selected':!0x1},{'name':'Brush\x207','file':'/static/draw/images/brushes/7.webp','defaultSize':0.06,'selected':!0x1},{'name':'Brush\x208','file':'/static/draw/images/brushes/8.webp','defaultSize':0.2,'selected':!0x1}];let paintFBO,paintTexture,quadProgram,paintProgram,overlayProgram,floodFillProgram,brushTextures={},brushAspects={},currentBrush=null,currentArtworkId=null,texture=null,overlayTexture=null,brushAspect=0x1,imageAspect=0x1,currentImage=null,overlayPosition=[0x0,0x0],isDrawing=!0x1,currentTool='draw',fixedFBOWidth=0x0,fixedFBOHeight=0x0,tintColor=[0x0,0x0,0x0,0x1];function hexToHSL(_0x5072fc){0x3===(_0x5072fc=_0x5072fc['replace'](/^#/,''))['length']&&(_0x5072fc=_0x5072fc['split']('')['map'](_0x4023b4=>_0x4023b4+_0x4023b4)['join'](''));let _0x42e01a,_0x22edc8,_0x2b4453=parseInt(_0x5072fc['substr'](0x0,0x2),0x10)/0xff,_0x4494d8=parseInt(_0x5072fc['substr'](0x2,0x2),0x10)/0xff,_0x4ab31f=parseInt(_0x5072fc['substr'](0x4,0x2),0x10)/0xff,_0x2715ae=Math['max'](_0x2b4453,_0x4494d8,_0x4ab31f),_0x86bfcf=Math['min'](_0x2b4453,_0x4494d8,_0x4ab31f),_0xf074a7=(_0x2715ae+_0x86bfcf)/0x2;if(_0x2715ae===_0x86bfcf)_0x42e01a=_0x22edc8=0x0;else{let _0x443da4=_0x2715ae-_0x86bfcf;switch(_0x22edc8=_0xf074a7>0.5?_0x443da4/(0x2-_0x2715ae-_0x86bfcf):_0x443da4/(_0x2715ae+_0x86bfcf),_0x2715ae){case _0x2b4453:_0x42e01a=(_0x4494d8-_0x4ab31f)/_0x443da4+(_0x4494d8<_0x4ab31f?0x6:0x0);break;case _0x4494d8:_0x42e01a=(_0x4ab31f-_0x2b4453)/_0x443da4+0x2;break;case _0x4ab31f:_0x42e01a=(_0x2b4453-_0x4494d8)/_0x443da4+0x4;}_0x42e01a/=0x6;}return{'h':_0x42e01a,'s':_0x22edc8,'l':_0xf074a7};}colorPicker['addEventListener']('input',_0xd4d8b2=>{tintColor=hexToRGBA(_0xd4d8b2['target']['value']);const _0x5f0384=hexToHSL(_0xd4d8b2['target']['value']);baseColor=hexToRGBA(_0xd4d8b2['target']['value'])['slice'](0x0,0x3),lightnessFactor=_0x5f0384['l'],updateLightnessGradient(),updateFinalColor();const _0x5abcfd=colorPalette['querySelector']('.indicator');_0x5abcfd&&(_0x5abcfd['style']['top']=_0x5f0384['h']*(colorPalette['clientHeight']-_0x5abcfd['clientHeight'])+'px');const _0x535528=lightnessPalette['querySelector']('.indicator');_0x535528&&(_0x535528['style']['top']=_0x5f0384['l']*(lightnessPalette['clientHeight']-_0x535528['clientHeight'])+'px');});const colorPalette=document['getElementById']('colorPalette'),lightnessPalette=document['getElementById']('lightnessPalette');let baseColor=[0x0,0x0,0x0],lightnessFactor=0.5;function updateLightnessGradient(){const _0x14a1a9='linear-gradient(to\x20bottom,\x20rgb('+Math['round'](0xff*baseColor[0x0])+',\x20'+Math['round'](0xff*baseColor[0x1])+',\x20'+Math['round'](0xff*baseColor[0x2])+'),\x20white)';document['getElementById']('lightnessPalette')['style']['background']=_0x14a1a9;}function pickBaseColor(_0x2c8716){const _0x10efad=colorPalette['getBoundingClientRect'](),_0x248b24=(_0x2c8716['touches']?_0x2c8716['touches'][0x0]['clientY']:_0x2c8716['clientY'])-_0x10efad['top'],_0x527caf=Math['max'](0x0,Math['min'](0x1,_0x248b24/_0x10efad['height'])),_0x3f067b=[[0xff,0x0,0x0],[0xff,0xff,0x0],[0x0,0xff,0x0],[0x0,0xff,0xff],[0x0,0x0,0xff],[0xff,0x0,0xff],[0xff,0x0,0x0]],_0x51e443=Math['floor'](_0x527caf*(_0x3f067b['length']-0x1)),_0x357495=Math['min'](_0x51e443+0x1,_0x3f067b['length']-0x1),_0x2f8b5f=_0x527caf*(_0x3f067b['length']-0x1)%0x1;baseColor=[(_0x3f067b[_0x51e443][0x0]*(0x1-_0x2f8b5f)+_0x3f067b[_0x357495][0x0]*_0x2f8b5f)/0xff,(_0x3f067b[_0x51e443][0x1]*(0x1-_0x2f8b5f)+_0x3f067b[_0x357495][0x1]*_0x2f8b5f)/0xff,(_0x3f067b[_0x51e443][0x2]*(0x1-_0x2f8b5f)+_0x3f067b[_0x357495][0x2]*_0x2f8b5f)/0xff],updateLightnessGradient(),updateFinalColor();const _0x3485f1=colorPalette['querySelector']('.indicator');_0x3485f1&&(_0x3485f1['style']['top']=_0x527caf*(colorPalette['clientHeight']-_0x3485f1['clientHeight'])+'px');}function pickLightness(_0xd38498){const _0x5749b7=lightnessPalette['getBoundingClientRect'](),_0x1508b8=(_0xd38498['touches']?_0xd38498['touches'][0x0]['clientY']:_0xd38498['clientY'])-_0x5749b7['top'],_0x290a78=Math['max'](0x0,Math['min'](0x1,_0x1508b8/_0x5749b7['height']));lightnessFactor=_0x290a78,updateFinalColor();const _0x156885=lightnessPalette['querySelector']('.indicator');_0x156885&&(_0x156885['style']['top']=_0x290a78*(lightnessPalette['clientHeight']-_0x156885['clientHeight'])+'px');}function updateFinalColor(){const _0x4a7dff=Math['round'](baseColor[0x0]*(0x1-lightnessFactor)*0xff+0xff*lightnessFactor),_0x5b0183=Math['round'](baseColor[0x1]*(0x1-lightnessFactor)*0xff+0xff*lightnessFactor),_0x50d416=Math['round'](baseColor[0x2]*(0x1-lightnessFactor)*0xff+0xff*lightnessFactor);tintColor=[_0x4a7dff/0xff,_0x5b0183/0xff,_0x50d416/0xff,0x1];const _0x31502f=rgbToHex(_0x4a7dff,_0x5b0183,_0x50d416);console['log']('hexColor',_0x31502f),document['getElementById']('colorPicker')['value']=_0x31502f,needsRedraw=!0x0;}function rgbToHex(_0x66ec52,_0x17703e,_0x18d246){return'#'+(0x1<<0x18|_0x66ec52<<0x10|_0x17703e<<0x8|_0x18d246)['toString'](0x10)['slice'](0x1)['toUpperCase']();}function replaceColorPicker(_0x37680b){const _0x337234=document['getElementById']('colorPicker'),_0x33aba1=document['createElement']('input');_0x33aba1['type']='color',_0x33aba1['id']='colorPicker',_0x33aba1['value']=_0x37680b,_0x33aba1['addEventListener']('input',_0xc05c0a=>{tintColor=hexToRGBA(_0xc05c0a['target']['value']),needsRedraw=!0x0;}),_0x337234['parentNode']['replaceChild'](_0x33aba1,_0x337234);}function hexToRGBA(_0x3c464b){'#'===_0x3c464b['charAt'](0x0)&&(_0x3c464b=_0x3c464b['substr'](0x1)),0x3===_0x3c464b['length']&&(_0x3c464b=_0x3c464b['split']('')['map'](_0x40a702=>_0x40a702+_0x40a702)['join'](''));let _0x3e2129=parseInt(_0x3c464b,0x10);return[(_0x3e2129>>0x10&0xff)/0xff,(_0x3e2129>>0x8&0xff)/0xff,(0xff&_0x3e2129)/0xff,0x1];}function makeBrushFromActiveLayer(){var _0x44cc94='function'==typeof getActiveLayer?getActiveLayer():null;if(!(gl&&quadProgram&&_0x44cc94&&_0x44cc94['texture']))return null;var _0xf7fe76=Math['max'](0x1,0x0|_0x44cc94['texW']||fixedFBOWidth||canvas['width']),_0x4fee36=Math['max'](0x1,0x0|_0x44cc94['texH']||fixedFBOHeight||canvas['height']),_0x3107ca=gl['getParameter'](gl['FRAMEBUFFER_BINDING']),_0x178812=gl['getParameter'](gl['CURRENT_PROGRAM']),_0x358958=gl['getParameter'](gl['VIEWPORT']),_0x376046=gl['createTexture']();gl['bindTexture'](gl['TEXTURE_2D'],_0x376046),gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],_0xf7fe76,_0x4fee36,0x0,gl['RGBA'],gl['UNSIGNED_BYTE'],null),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MIN_FILTER'],gl['LINEAR']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MAG_FILTER'],gl['LINEAR']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_S'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_T'],gl['CLAMP_TO_EDGE']);var _0x22fbbe=gl['createFramebuffer']();gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x22fbbe),gl['framebufferTexture2D'](gl['FRAMEBUFFER'],gl['COLOR_ATTACHMENT0'],gl['TEXTURE_2D'],_0x376046,0x0),gl['viewport'](0x0,0x0,_0xf7fe76,_0x4fee36),gl['disable'](gl['BLEND']),gl['clearColor'](0x0,0x0,0x0,0x0),gl['clear'](gl['COLOR_BUFFER_BIT']),gl['useProgram'](quadProgram);var _0x3d0ef4=gl['getUniformLocation'](quadProgram,'u_flipY'),_0x36234a=gl['getUniformLocation'](quadProgram,'u_resolution'),_0x508b18=gl['getUniformLocation'](quadProgram,'u_layerOpacity'),_0x465d54=gl['getUniformLocation'](quadProgram,'u_texture');_0x3d0ef4&&gl['uniform1f'](_0x3d0ef4,0x1),_0x36234a&&gl['uniform2f'](_0x36234a,_0xf7fe76,_0x4fee36),_0x508b18&&gl['uniform1f'](_0x508b18,0x1),_0x465d54&&gl['uniform1i'](_0x465d54,0x0);var _0xedb0ed=new Float32Array([0x0,0x0,0x0,0x0,_0xf7fe76,0x0,0x1,0x0,0x0,_0x4fee36,0x0,0x1,0x0,_0x4fee36,0x0,0x1,_0xf7fe76,0x0,0x1,0x0,_0xf7fe76,_0x4fee36,0x1,0x1]),_0xcb4f30=gl['createBuffer']();gl['bindBuffer'](gl['ARRAY_BUFFER'],_0xcb4f30),gl['bufferData'](gl['ARRAY_BUFFER'],_0xedb0ed,gl['STREAM_DRAW']);var _0x1a36e1=gl['getAttribLocation'](quadProgram,'a_position'),_0x3de8b1=gl['getAttribLocation'](quadProgram,'a_texCoord');_0x1a36e1>=0x0&&(gl['enableVertexAttribArray'](_0x1a36e1),gl['vertexAttribPointer'](_0x1a36e1,0x2,gl['FLOAT'],!0x1,0x10,0x0)),_0x3de8b1>=0x0&&(gl['enableVertexAttribArray'](_0x3de8b1),gl['vertexAttribPointer'](_0x3de8b1,0x2,gl['FLOAT'],!0x1,0x10,0x8)),gl['activeTexture'](gl['TEXTURE0']),gl['bindTexture'](gl['TEXTURE_2D'],_0x44cc94['texture']),gl['drawArrays'](gl['TRIANGLES'],0x0,0x6),_0x1a36e1>=0x0&&gl['disableVertexAttribArray'](_0x1a36e1),_0x3de8b1>=0x0&&gl['disableVertexAttribArray'](_0x3de8b1),gl['bindBuffer'](gl['ARRAY_BUFFER'],null),gl['deleteBuffer'](_0xcb4f30),gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x3107ca);try{gl['deleteFramebuffer'](_0x22fbbe);}catch(_0x3f7e85){}return gl['useProgram'](_0x178812),_0x358958&&gl['viewport'](_0x358958[0x0],_0x358958[0x1],_0x358958[0x2],_0x358958[0x3]),overlayTexture=_0x376046,brushAspect=_0xf7fe76/_0x4fee36,currentBrush={'name':_0x44cc94['name']?_0x44cc94['name']+'\x20→\x20Brush':'Layer\x20Brush','type':'bitmap','texture':_0x376046,'defaultSize':currentBrush&&currentBrush['defaultSize']?currentBrush['defaultSize']:0.05,'aspect':brushAspect,'spacing':0.14,'angleFromDirection':!0x0,'opacity':0x1},currentTool='draw',lastPointer&&'function'==typeof showBrushHUD&&showBrushHUD(0x5dc),needsRedraw=!0x0,'function'==typeof requestDrawIfIdle&&requestDrawIfIdle(),currentBrush;}function deleteBrushById(_0x4ef7b6){const _0x53fe4d=window['brushes']||[],_0x4015b1=_0x53fe4d['findIndex'](_0x41b72f=>_0x41b72f['id']===_0x4ef7b6);if(_0x4015b1>=0x0){const _0x3d8ab7=_0x53fe4d[_0x4015b1];try{'bitmap'===_0x3d8ab7['type']&&_0x3d8ab7['tex']&&gl['deleteTexture'](_0x3d8ab7['tex']);}catch{}_0x53fe4d['splice'](_0x4015b1,0x1);}}['mousedown','touchstart']['forEach'](_0x5df14c=>{colorPalette['addEventListener'](_0x5df14c,_0x42ad87=>{pickBaseColor(_0x42ad87),document['addEventListener']('mousemove',pickBaseColor),document['addEventListener']('touchmove',pickBaseColor);}),lightnessPalette['addEventListener'](_0x5df14c,_0x40096f=>{pickLightness(_0x40096f),document['addEventListener']('mousemove',pickLightness),document['addEventListener']('touchmove',pickLightness);});}),['mouseup','touchend']['forEach'](_0x2a19cd=>{document['addEventListener'](_0x2a19cd,()=>{document['removeEventListener']('mousemove',pickBaseColor),document['removeEventListener']('mousemove',pickLightness),document['removeEventListener']('touchmove',pickBaseColor),document['removeEventListener']('touchmove',pickLightness);});}),document['addEventListener']('touchmove',function(_0x4c6979){_0x4c6979['target']['closest']('#colorPalette,\x20#lightnessPalette')&&_0x4c6979['preventDefault']();},{'passive':!0x1});var layerToBrushBtn=document['getElementById']('layerToBrushBtn');function createShader(_0x4f2376,_0x55f847,_0x36f30f){const _0x1d2e41=_0x4f2376['createShader'](_0x55f847);return _0x4f2376['shaderSource'](_0x1d2e41,_0x36f30f),_0x4f2376['compileShader'](_0x1d2e41),_0x4f2376['getShaderParameter'](_0x1d2e41,_0x4f2376['COMPILE_STATUS'])?_0x1d2e41:(console['error']('Shader\x20compile\x20error:',_0x4f2376['getShaderInfoLog'](_0x1d2e41)),_0x4f2376['deleteShader'](_0x1d2e41),null);}function createProgram(_0x43145e,_0x2dd78f,_0x41e4bd){const _0x124dd7=createShader(_0x43145e,_0x43145e['VERTEX_SHADER'],_0x2dd78f),_0x3d1920=createShader(_0x43145e,_0x43145e['FRAGMENT_SHADER'],_0x41e4bd);if(!_0x124dd7||!_0x3d1920)return null;const _0x30e7a2=_0x43145e['createProgram']();return _0x43145e['attachShader'](_0x30e7a2,_0x124dd7),_0x43145e['attachShader'](_0x30e7a2,_0x3d1920),_0x43145e['linkProgram'](_0x30e7a2),_0x43145e['getProgramParameter'](_0x30e7a2,_0x43145e['LINK_STATUS'])?_0x30e7a2:(console['error']('Program\x20link\x20error:',_0x43145e['getProgramInfoLog'](_0x30e7a2)),null);}layerToBrushBtn&&layerToBrushBtn['addEventListener']('click',function(){makeBrushFromActiveLayer()?('function'==typeof showStatusMessage&&showStatusMessage('Brush\x20created\x20from\x20layer','success'),'function'==typeof requestDrawIfIdle&&requestDrawIfIdle()):'function'==typeof showStatusMessage&&showStatusMessage('No\x20active\x20layer\x20to\x20convert','warning');});const quadVS='\x0a\x20\x20attribute\x20vec2\x20a_position;\x0a\x20\x20attribute\x20vec2\x20a_texCoord;\x0a\x20\x20uniform\x20vec2\x20u_resolution;\x0a\x20\x20uniform\x20float\x20u_flipY;\x20//\x20set\x20to\x201.0\x20for\x20no\x20flip;\x20-1.0\x20for\x20normal\x20flip\x0a\x20\x20varying\x20vec2\x20v_texCoord;\x0a\x20\x20void\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20zeroToOne\x20=\x20a_position\x20/\x20u_resolution;\x0a\x20\x20\x20\x20vec2\x20clipSpace\x20=\x20zeroToOne\x20*\x202.0\x20-\x201.0;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(clipSpace.x,\x20clipSpace.y\x20*\x20u_flipY,\x200,\x201);\x0a\x20\x20\x20\x20v_texCoord\x20=\x20a_texCoord;\x0a\x20\x20}\x0a',quadFS='\x0a\x20\x20\x20\x20precision\x20mediump\x20float;\x0a\x20\x20\x20\x20varying\x20vec2\x20v_texCoord;\x0a\x20\x20\x20\x20uniform\x20sampler2D\x20u_texture;\x0a\x20\x20\x20\x20uniform\x20float\x20u_layerOpacity;\x20//\x20NEW\x0a\x0a\x20\x20\x20\x20void\x20main()\x20{\x0a\x20\x20\x20\x20\x20\x20vec4\x20c\x20=\x20texture2D(u_texture,\x20v_texCoord);\x0a\x20\x20\x20\x20\x20\x20c.a\x20*=\x20u_layerOpacity;\x20\x20\x20\x20\x20\x20//\x20apply\x20per-layer\x20opacity\x20here\x0a\x20\x20\x20\x20\x20\x20gl_FragColor\x20=\x20c;\x0a\x20\x20\x20\x20}\x0a',paintFS='\x0a\x20\x20precision\x20mediump\x20float;\x0a\x20\x20varying\x20vec2\x20v_texCoord;\x0a\x20\x20uniform\x20sampler2D\x20u_brush;\x0a\x20\x20uniform\x20vec4\x20u_tint;\x0a\x20\x20uniform\x20bool\x20u_erase;\x0a\x20\x20uniform\x20float\x20u_eraseStrength;\x20//\x20controls\x20erasing\x20strength\x0a\x20\x20uniform\x20float\x20u_paintStrength;\x20//\x20controls\x20painting\x20strength\x0a\x20\x20void\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20brushColor\x20=\x20texture2D(u_brush,\x20v_texCoord);\x0a\x20\x20\x20\x20if\x20(u_erase)\x20{\x0a\x20\x20\x20\x20\x20\x20gl_FragColor\x20=\x20vec4(0.0,\x200.0,\x200.0,\x20brushColor.a\x20*\x20u_eraseStrength\x20*\x200.05);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20//\x20Multiply\x20the\x20brush\x20alpha\x20by\x20u_paintStrength\x20so\x20that\x20lower\x20values\x20yield\x20lighter\x20strokes.\x0a\x20\x20\x20\x20\x20\x20gl_FragColor\x20=\x20vec4(u_tint.rgb,\x20brushColor.a\x20*\x20u_paintStrength);\x0a\x20\x20\x20\x20}\x0a\x20\x20}\x0a',overlayFS='\x0a\x20\x20precision\x20mediump\x20float;\x0a\x20\x20varying\x20vec2\x20v_texCoord;\x0a\x20\x20uniform\x20sampler2D\x20u_brush;\x0a\x20\x20uniform\x20vec4\x20u_tint;\x0a\x20\x20void\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20brushColor\x20=\x20texture2D(u_brush,\x20v_texCoord);\x0a\x20\x20\x20\x20gl_FragColor\x20=\x20vec4(u_tint.rgb,\x20brushColor.a);\x0a\x20\x20}\x0a';let ringProgram;const ringFS='\x0aprecision\x20mediump\x20float;\x0auniform\x20vec2\x20\x20u_center;\x20\x20\x20\x20\x20//\x20circle\x20center\x20in\x20screen\x20px\x20(top-left\x20origin)\x0auniform\x20float\x20u_radius;\x20\x20\x20\x20\x20//\x20ring\x20radius\x20in\x20px\x0auniform\x20float\x20u_thickness;\x20\x20//\x20ring\x20thickness\x20in\x20px\x0auniform\x20vec4\x20\x20u_color;\x20\x20\x20\x20\x20\x20//\x20RGBA\x0auniform\x20vec2\x20\x20u_viewport;\x20\x20\x20//\x20canvas\x20size\x20(w,h)\x0a\x0avoid\x20main()\x20{\x0a\x20\x20//\x20Convert\x20gl_FragCoord\x20(bottom-left\x20origin)\x20to\x20top-left\x0a\x20\x20vec2\x20p\x20=\x20vec2(gl_FragCoord.x,\x20u_viewport.y\x20-\x20gl_FragCoord.y);\x0a\x20\x20float\x20d\x20=\x20abs(length(p\x20-\x20u_center)\x20-\x20u_radius);\x0a\x20\x20//\x201px\x20anti-aliasing\x20band\x0a\x20\x20float\x20aa\x20=\x201.0;\x0a\x20\x20float\x20alpha\x20=\x20smoothstep(u_thickness\x20+\x20aa,\x20u_thickness\x20-\x20aa,\x20d);\x0a\x20\x20gl_FragColor\x20=\x20vec4(u_color.rgb,\x20u_color.a\x20*\x20alpha);\x0a}\x0a';let dashProgram;const dashFS='\x0aprecision\x20mediump\x20float;\x0a\x0auniform\x20vec2\x20\x20u_a;\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20start\x20of\x20line\x20in\x20screen\x20px\x20(top-left\x20origin)\x0auniform\x20vec2\x20\x20u_b;\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20end\x20of\x20line\x20in\x20screen\x20px\x0auniform\x20float\x20u_thickness;\x20\x20//\x20half-thickness\x20in\x20px\x0auniform\x20float\x20u_dash;\x20\x20\x20\x20\x20\x20\x20//\x20dash\x20length\x20in\x20px\x0auniform\x20float\x20u_gap;\x20\x20\x20\x20\x20\x20\x20\x20//\x20gap\x20length\x20in\x20px\x0auniform\x20vec4\x20\x20u_color;\x20\x20\x20\x20\x20\x20//\x20RGBA\x0auniform\x20vec2\x20\x20u_viewport;\x20\x20\x20//\x20canvas\x20size\x20(w,h)\x0a\x0avoid\x20main()\x20{\x0a\x20\x20//\x20convert\x20gl_FragCoord\x20(bottom-left\x20origin)\x20to\x20top-left\x20origin\x0a\x20\x20vec2\x20p\x20=\x20vec2(gl_FragCoord.x,\x20u_viewport.y\x20-\x20gl_FragCoord.y);\x0a\x20\x20vec2\x20a\x20=\x20u_a,\x20b\x20=\x20u_b;\x0a\x0a\x20\x20vec2\x20ab\x20=\x20b\x20-\x20a;\x0a\x20\x20float\x20len\x20=\x20max(1.0,\x20length(ab));\x0a\x20\x20vec2\x20ap\x20=\x20p\x20-\x20a;\x0a\x0a\x20\x20//\x20project\x20p\x20onto\x20segment\x20a-b\x0a\x20\x20float\x20t\x20=\x20clamp(dot(ap,\x20ab)\x20/\x20(len\x20*\x20len),\x200.0,\x201.0);\x0a\x20\x20float\x20dist\x20=\x20length(ap\x20-\x20ab\x20*\x20t);\x0a\x0a\x20\x20//\x20dashed\x20pattern\x20along\x20the\x20segment\x0a\x20\x20float\x20along\x20=\x20t\x20*\x20len;\x0a\x20\x20float\x20seg\x20\x20\x20=\x20max(1.0,\x20u_dash\x20+\x20u_gap);\x0a\x20\x20float\x20m\x20\x20\x20\x20\x20=\x20mod(along,\x20seg);\x0a\x20\x20float\x20inDash\x20=\x20step(m,\x20u_dash);\x20//\x201\x20inside\x20dash,\x200\x20inside\x20gap\x0a\x0a\x20\x20//\x20soft\x20edges\x20(1px\x20AA\x20band)\x0a\x20\x20float\x20aa\x20=\x201.0;\x0a\x20\x20float\x20alpha\x20=\x20inDash\x20*\x20smoothstep(u_thickness\x20+\x20aa,\x20u_thickness\x20-\x20aa,\x20dist);\x0a\x0a\x20\x20gl_FragColor\x20=\x20vec4(u_color.rgb,\x20u_color.a\x20*\x20alpha);\x0a}\x0a';function getActiveLayer(){return layers[activeLayerIndex];}function syncActiveAliases(){const _0x27f291=getActiveLayer();if(!_0x27f291)return paintFBO=null,void(paintTexture=null);paintFBO=_0x27f291['fbo'],paintTexture=_0x27f291['texture'];}function initGL(){gl?(quadProgram=createProgram(gl,quadVS,quadFS),paintProgram=createProgram(gl,quadVS,paintFS),overlayProgram=createProgram(gl,quadVS,overlayFS),ringProgram=createProgram(gl,quadVS,ringFS),dashProgram=createProgram(gl,quadVS,dashFS)):console['error']('WebGL\x20not\x20supported.');}let __quadVbo=null;function __bindAndDrawTexturedQuad(_0x259584,_0x2e7173,_0x1e0094){const _0x13aec4=new Float32Array([0x0,0x0,0x0,0x0,_0x2e7173,0x0,0x1,0x0,0x0,_0x1e0094,0x0,0x1,0x0,_0x1e0094,0x0,0x1,_0x2e7173,0x0,0x1,0x0,_0x2e7173,_0x1e0094,0x1,0x1]);__quadVbo||(__quadVbo=gl['createBuffer']()),gl['bindBuffer'](gl['ARRAY_BUFFER'],__quadVbo),gl['bufferData'](gl['ARRAY_BUFFER'],_0x13aec4,gl['STREAM_DRAW']);const _0x31b891=gl['getAttribLocation'](_0x259584,'a_position'),_0x2bf5b5=gl['getAttribLocation'](_0x259584,'a_texCoord');gl['enableVertexAttribArray'](_0x31b891),gl['vertexAttribPointer'](_0x31b891,0x2,gl['FLOAT'],!0x1,0x10,0x0),gl['enableVertexAttribArray'](_0x2bf5b5),gl['vertexAttribPointer'](_0x2bf5b5,0x2,gl['FLOAT'],!0x1,0x10,0x8),gl['drawArrays'](gl['TRIANGLES'],0x0,0x6),gl['disableVertexAttribArray'](_0x31b891),gl['disableVertexAttribArray'](_0x2bf5b5),gl['bindBuffer'](gl['ARRAY_BUFFER'],null);}function __getSelectedIndices(){if(void 0x0!==selectedLayerIndices&&selectedLayerIndices&&selectedLayerIndices['size'])return Array['from'](selectedLayerIndices)['sort']((_0x2d4043,_0x5d4a8f)=>_0x2d4043-_0x5d4a8f);try{const _0x3ff216=document['getElementById']('layersList');if(_0x3ff216){const _0xd288c7=[];if(_0x3ff216['querySelectorAll']('.layer-item')['forEach'](_0x5df89e=>{const _0x30da6a=_0x5df89e['getAttribute']('data-index'),_0x816af0=_0x5df89e['querySelector']('.layer-select\x20input[type=\x27checkbox\x27]');_0x816af0&&_0x816af0['checked']&&null!=_0x30da6a&&_0xd288c7['push'](Number(_0x30da6a));}),_0xd288c7['length'])return _0xd288c7['sort']((_0x5ee8f2,_0xbef9b)=>_0x5ee8f2-_0xbef9b);}}catch{}return['number'==typeof activeLayerIndex?activeLayerIndex:0x0];}function __layerQuadInFboSpace(_0x39aba6,_0x59fc2a,_0x506242){const _0x407472=fixedFBOWidth,_0x5d7574=fixedFBOHeight,_0x5474bf=Number['isFinite'](_0x39aba6['ox'])?_0x39aba6['ox']:0x0,_0x4325f3=Number['isFinite'](_0x39aba6['oy'])?_0x39aba6['oy']:0x0,_0x5f2a45=Number['isFinite'](_0x39aba6['texW'])?_0x39aba6['texW']:_0x407472,_0x12b6c4=Number['isFinite'](_0x39aba6['texH'])?_0x39aba6['texH']:_0x5d7574,_0x110fe7=Number['isFinite'](_0x39aba6['px'])?_0x39aba6['px']:0.5*_0x407472,_0x4da3df=Number['isFinite'](_0x39aba6['py'])?_0x39aba6['py']:0.5*_0x5d7574,_0x2f6614=Math['cos'](_0x39aba6['rotation']||0x0),_0x23f6cc=Math['sin'](_0x39aba6['rotation']||0x0);function _0x4bd99e(_0x2ec84c,_0x2beb46){let _0x118650=_0x2ec84c-_0x110fe7,_0x405c6c=_0x2beb46-_0x4da3df;_0x118650*=Number['isFinite'](_0x39aba6['scaleX'])?_0x39aba6['scaleX']:0x1,_0x405c6c*=Number['isFinite'](_0x39aba6['scaleY'])?_0x39aba6['scaleY']:0x1;const _0x419ee0=_0x118650*_0x23f6cc+_0x405c6c*_0x2f6614;return{'x':_0x110fe7+(_0x118650*_0x2f6614-_0x405c6c*_0x23f6cc)+(Number['isFinite'](_0x39aba6['x'])?_0x39aba6['x']:0x0),'y':_0x4da3df+_0x419ee0+(Number['isFinite'](_0x39aba6['y'])?_0x39aba6['y']:0x0)};}const _0xbcd276=_0x4bd99e(_0x5474bf,_0x4325f3),_0x5319bf=_0x4bd99e(_0x5474bf+_0x5f2a45,_0x4325f3),_0x1c9045=_0x4bd99e(_0x5474bf,_0x4325f3+_0x12b6c4),_0x5df7c9=_0x4bd99e(_0x5474bf+_0x5f2a45,_0x4325f3+_0x12b6c4);return new Float32Array([_0xbcd276['x'],_0xbcd276['y'],0x0,0x0,_0x5319bf['x'],_0x5319bf['y'],0x1,0x0,_0x1c9045['x'],_0x1c9045['y'],0x0,0x1,_0x1c9045['x'],_0x1c9045['y'],0x0,0x1,_0x5319bf['x'],_0x5319bf['y'],0x1,0x0,_0x5df7c9['x'],_0x5df7c9['y'],0x1,0x1]);}function createLayerFBO(_0x3f2ed4,_0x2bd3dd){const _0x415229=gl['createTexture']();gl['bindTexture'](gl['TEXTURE_2D'],_0x415229),gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],_0x3f2ed4,_0x2bd3dd,0x0,gl['RGBA'],gl['UNSIGNED_BYTE'],null),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MIN_FILTER'],gl['LINEAR']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MAG_FILTER'],gl['LINEAR']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_S'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_T'],gl['CLAMP_TO_EDGE']);const _0x187009=gl['createFramebuffer']();return gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x187009),gl['framebufferTexture2D'](gl['FRAMEBUFFER'],gl['COLOR_ATTACHMENT0'],gl['TEXTURE_2D'],_0x415229,0x0),gl['clearColor'](0x0,0x0,0x0,0x0),gl['clear'](gl['COLOR_BUFFER_BIT']),gl['bindFramebuffer'](gl['FRAMEBUFFER'],null),{'texture':_0x415229,'fbo':_0x187009};}let layers=[],activeLayerIndex=0x0;function addLayer(_0x5bb56a='Layer\x20'+(layers['length']+0x1),_0x2a4ce5=activeLayerIndex){const _0x45c66f=fixedFBOWidth,_0x543a37=fixedFBOHeight,{texture:_0x565cd3,fbo:_0xdc51c8}=createLayerFBO(_0x45c66f,_0x543a37),_0x118448={'id':Date['now']()+Math['random'](),'name':_0x5bb56a,'fbo':_0xdc51c8,'texture':_0x565cd3,'visible':!0x0,'opacity':0x1,'x':0x0,'y':0x0,'scaleX':0x1,'scaleY':0x1,'rotation':0x0,'px':0.5*_0x45c66f,'py':0.5*_0x543a37,'texW':_0x45c66f,'texH':_0x543a37,'ox':0x0,'oy':0x0,'history':[],'redo':[]},_0x367038=Math['max'](0x0,Math['min'](_0x2a4ce5,layers['length']));layers['splice'](_0x367038,0x0,_0x118448),activeLayerIndex=_0x367038,syncActiveAliases(),'function'==typeof rebuildLayersUI&&rebuildLayersUI(),needsRedraw=!0x0;}function drawRingOverlay(_0x442f3a,_0x279de3,_0x103e83,_0x3f2b46,_0x5310c3=[0x1,0x0,0x0,0.95]){if(!ringProgram)return;gl['enable'](gl['BLEND']),gl['blendFunc'](gl['SRC_ALPHA'],gl['ONE_MINUS_SRC_ALPHA']),gl['useProgram'](ringProgram);const _0x5a623a=gl['getUniformLocation'](ringProgram,'u_flipY');_0x5a623a&&gl['uniform1f'](_0x5a623a,-0x1);const _0x431ac6=gl['getUniformLocation'](ringProgram,'u_resolution');_0x431ac6&&gl['uniform2f'](_0x431ac6,canvas['width'],canvas['height']),gl['uniform2f'](gl['getUniformLocation'](ringProgram,'u_center'),_0x442f3a,_0x279de3),gl['uniform1f'](gl['getUniformLocation'](ringProgram,'u_radius'),Math['max'](0x0,_0x103e83)),gl['uniform1f'](gl['getUniformLocation'](ringProgram,'u_thickness'),Math['max'](0.5,_0x3f2b46)),gl['uniform4fv'](gl['getUniformLocation'](ringProgram,'u_color'),_0x5310c3),gl['uniform2f'](gl['getUniformLocation'](ringProgram,'u_viewport'),canvas['width'],canvas['height']);const _0x5a0305=new Float32Array([0x0,0x0,0x0,0x0,canvas['width'],0x0,0x1,0x0,0x0,canvas['height'],0x0,0x1,0x0,canvas['height'],0x0,0x1,canvas['width'],0x0,0x1,0x0,canvas['width'],canvas['height'],0x1,0x1]),_0x518cbc=gl['createBuffer']();gl['bindBuffer'](gl['ARRAY_BUFFER'],_0x518cbc),gl['bufferData'](gl['ARRAY_BUFFER'],_0x5a0305,gl['STREAM_DRAW']);const _0x30ef5d=gl['getAttribLocation'](ringProgram,'a_position'),_0x1bfbe5=gl['getAttribLocation'](ringProgram,'a_texCoord');gl['enableVertexAttribArray'](_0x30ef5d),gl['vertexAttribPointer'](_0x30ef5d,0x2,gl['FLOAT'],!0x1,0x10,0x0),gl['enableVertexAttribArray'](_0x1bfbe5),gl['vertexAttribPointer'](_0x1bfbe5,0x2,gl['FLOAT'],!0x1,0x10,0x8),gl['drawArrays'](gl['TRIANGLES'],0x0,0x6),gl['disableVertexAttribArray'](_0x30ef5d),gl['disableVertexAttribArray'](_0x1bfbe5),gl['bindBuffer'](gl['ARRAY_BUFFER'],null),gl['deleteBuffer'](_0x518cbc);}function drawDashedLine(_0x1082dc,_0x4c5f1f,_0x5cbc41,_0x194fb5,_0x372837=1.5,_0x37678e=0xa,_0x24bfc5=0x6,_0x45a6ae=[0x1,0x0,0x0,0.95]){if(!dashProgram)return;gl['enable'](gl['BLEND']),gl['blendFunc'](gl['SRC_ALPHA'],gl['ONE_MINUS_SRC_ALPHA']),gl['useProgram'](dashProgram);const _0x36d2cd=gl['getUniformLocation'](dashProgram,'u_flipY');_0x36d2cd&&gl['uniform1f'](_0x36d2cd,-0x1);const _0xb6f759=gl['getUniformLocation'](dashProgram,'u_resolution');_0xb6f759&&gl['uniform2f'](_0xb6f759,canvas['width'],canvas['height']),gl['uniform2f'](gl['getUniformLocation'](dashProgram,'u_a'),_0x1082dc,_0x4c5f1f),gl['uniform2f'](gl['getUniformLocation'](dashProgram,'u_b'),_0x5cbc41,_0x194fb5),gl['uniform1f'](gl['getUniformLocation'](dashProgram,'u_thickness'),Math['max'](0.5,_0x372837)),gl['uniform1f'](gl['getUniformLocation'](dashProgram,'u_dash'),Math['max'](0x1,_0x37678e)),gl['uniform1f'](gl['getUniformLocation'](dashProgram,'u_gap'),Math['max'](0.5,_0x24bfc5)),gl['uniform4fv'](gl['getUniformLocation'](dashProgram,'u_color'),_0x45a6ae),gl['uniform2f'](gl['getUniformLocation'](dashProgram,'u_viewport'),canvas['width'],canvas['height']);const _0x493310=new Float32Array([0x0,0x0,0x0,0x0,canvas['width'],0x0,0x1,0x0,0x0,canvas['height'],0x0,0x1,0x0,canvas['height'],0x0,0x1,canvas['width'],0x0,0x1,0x0,canvas['width'],canvas['height'],0x1,0x1]),_0xf518de=gl['createBuffer']();gl['bindBuffer'](gl['ARRAY_BUFFER'],_0xf518de),gl['bufferData'](gl['ARRAY_BUFFER'],_0x493310,gl['STREAM_DRAW']);const _0x31dabd=gl['getAttribLocation'](dashProgram,'a_position'),_0x2b0da0=gl['getAttribLocation'](dashProgram,'a_texCoord');gl['enableVertexAttribArray'](_0x31dabd),gl['vertexAttribPointer'](_0x31dabd,0x2,gl['FLOAT'],!0x1,0x10,0x0),gl['enableVertexAttribArray'](_0x2b0da0),gl['vertexAttribPointer'](_0x2b0da0,0x2,gl['FLOAT'],!0x1,0x10,0x8),gl['drawArrays'](gl['TRIANGLES'],0x0,0x6),gl['disableVertexAttribArray'](_0x31dabd),gl['disableVertexAttribArray'](_0x2b0da0),gl['bindBuffer'](gl['ARRAY_BUFFER'],null),gl['deleteBuffer'](_0xf518de);}function drawLayerWithTransform(_0x232436,_0x4768dd){const _0x56b3f0=fixedFBOWidth,_0x1a033d=fixedFBOHeight,_0xbd0f96=canvas['width']/_0x56b3f0,_0x6bdb53=canvas['height']/_0x1a033d,_0x3742c2=Number['isFinite'](_0x4768dd['ox'])?_0x4768dd['ox']:0x0,_0x1b33f3=Number['isFinite'](_0x4768dd['oy'])?_0x4768dd['oy']:0x0,_0x10d109=Number['isFinite'](_0x4768dd['texW'])?_0x4768dd['texW']:_0x56b3f0,_0x23c062=Number['isFinite'](_0x4768dd['texH'])?_0x4768dd['texH']:_0x1a033d,_0x5a8b12=Number['isFinite'](_0x4768dd['px'])?_0x4768dd['px']:0.5*_0x56b3f0,_0x52af69=Number['isFinite'](_0x4768dd['py'])?_0x4768dd['py']:0.5*_0x1a033d,_0x5d7601=[{'x':_0x3742c2,'y':_0x1b33f3},{'x':_0x3742c2+_0x10d109,'y':_0x1b33f3},{'x':_0x3742c2,'y':_0x1b33f3+_0x23c062},{'x':_0x3742c2+_0x10d109,'y':_0x1b33f3+_0x23c062}],_0x33926a=Math['cos'](_0x4768dd['rotation']||0x0),_0x2a2370=Math['sin'](_0x4768dd['rotation']||0x0);function _0x149d18(_0x507419){let _0x4fba6d=_0x507419['x']-_0x5a8b12,_0x379b3f=_0x507419['y']-_0x52af69;_0x4fba6d*=Number['isFinite'](_0x4768dd['scaleX'])?_0x4768dd['scaleX']:0x1,_0x379b3f*=Number['isFinite'](_0x4768dd['scaleY'])?_0x4768dd['scaleY']:0x1;const _0x26a7a9=_0x4fba6d*_0x2a2370+_0x379b3f*_0x33926a,_0x30e5f7=_0x5a8b12+(_0x4fba6d*_0x33926a-_0x379b3f*_0x2a2370)+(Number['isFinite'](_0x4768dd['x'])?_0x4768dd['x']:0x0),_0x485b64=_0x52af69+_0x26a7a9+(Number['isFinite'](_0x4768dd['y'])?_0x4768dd['y']:0x0);return{'x':_0x30e5f7*_0xbd0f96,'y':_0x485b64*_0x6bdb53};}const _0x24866f=_0x149d18(_0x5d7601[0x0]),_0x2a1d2a=_0x149d18(_0x5d7601[0x1]),_0x11357a=_0x149d18(_0x5d7601[0x2]),_0x413185=_0x149d18(_0x5d7601[0x3]),_0x2f33c1=new Float32Array([_0x24866f['x'],_0x24866f['y'],0x0,0x0,_0x2a1d2a['x'],_0x2a1d2a['y'],0x1,0x0,_0x11357a['x'],_0x11357a['y'],0x0,0x1,_0x11357a['x'],_0x11357a['y'],0x0,0x1,_0x2a1d2a['x'],_0x2a1d2a['y'],0x1,0x0,_0x413185['x'],_0x413185['y'],0x1,0x1]);gl['useProgram'](_0x232436);const _0x8c4ab9=gl['getUniformLocation'](_0x232436,'u_flipY');_0x8c4ab9&&gl['uniform1f'](_0x8c4ab9,-0x1);const _0x5cd068=gl['getUniformLocation'](_0x232436,'u_resolution');_0x5cd068&&gl['uniform2f'](_0x5cd068,canvas['width'],canvas['height']);const _0x267e46=gl['getUniformLocation'](_0x232436,'u_layerOpacity');_0x267e46&&gl['uniform1f'](_0x267e46,Math['max'](0x0,Math['min'](0x1,_0x4768dd['opacity']||0x1)));const _0x51fdb2=gl['createBuffer']();gl['bindBuffer'](gl['ARRAY_BUFFER'],_0x51fdb2),gl['bufferData'](gl['ARRAY_BUFFER'],_0x2f33c1,gl['STREAM_DRAW']);const _0xfac1af=gl['getAttribLocation'](_0x232436,'a_position'),_0xbacc7b=gl['getAttribLocation'](_0x232436,'a_texCoord');gl['enableVertexAttribArray'](_0xfac1af),gl['vertexAttribPointer'](_0xfac1af,0x2,gl['FLOAT'],!0x1,0x10,0x0),gl['enableVertexAttribArray'](_0xbacc7b),gl['vertexAttribPointer'](_0xbacc7b,0x2,gl['FLOAT'],!0x1,0x10,0x8),gl['activeTexture'](gl['TEXTURE0']),gl['bindTexture'](gl['TEXTURE_2D'],_0x4768dd['texture']);const _0x39fec4=gl['getUniformLocation'](_0x232436,'u_texture');_0x39fec4&&gl['uniform1i'](_0x39fec4,0x0),gl['drawArrays'](gl['TRIANGLES'],0x0,0x6),gl['disableVertexAttribArray'](_0xfac1af),gl['disableVertexAttribArray'](_0xbacc7b),gl['bindBuffer'](gl['ARRAY_BUFFER'],null),gl['deleteBuffer'](_0x51fdb2);}let transformTool={'mode':'idle','start':null,'ref':null,'shiftInvert':!0x1};function setLayerTransformLock(_0x3bc33e,_0x114277){const _0x324b15=layers[_0x3bc33e];if(!_0x324b15)return;_0x324b15['transformLocked']=!!_0x114277;const _0x445c93=document['getElementById']('layersList');_0x445c93&&_0x445c93['querySelectorAll']('.layer-item')['forEach'](_0x5e163f=>{const _0x51f78b=_0x5e163f['getAttribute']('data-index');if((null!==_0x51f78b?Number(_0x51f78b):null)===_0x3bc33e){const _0x575ec8=_0x5e163f['querySelector']('.transform-btn');_0x575ec8&&_0x575ec8['classList']['toggle']('is-active',_0x114277);}});if(_0x114277&&_0x3bc33e===activeLayerIndex)transformTool['mobileCombo']=!0x0,'idle'===transformTool['mode']&&startTransform('grab');else!_0x114277&&(layers['some'](_0x360485=>!!_0x360485['transformLocked'])||(transformTool['mobileCombo']=!0x1,'idle'!==transformTool['mode']&&endTransform(!0x0)));needsRedraw=!0x0;}function clearTransformLockAll(){layers['forEach'](_0x27513e=>{_0x27513e&&(_0x27513e['transformLocked']=!0x1);}),transformTool['mobileCombo']=!0x1;const _0x56d24c=document['getElementById']('layersList');_0x56d24c&&_0x56d24c['querySelectorAll']('.transform-btn.is-active')['forEach'](_0x4ab652=>_0x4ab652['classList']['remove']('is-active')),'idle'!==transformTool['mode']&&endTransform(!0x0),needsRedraw=!0x0;}function onTransformPointerMove(_0x48fb17){if('idle'===transformTool['mode'])return;const _0x358609=pointerToBoth(_0x48fb17),_0x6f11cc=getActiveLayer();if(!_0x6f11cc)return;transformTool['start']||(transformTool['start']={'cx':_0x358609['cx'],'cy':_0x358609['cy']});const _0x45b3a0=_0x358609['cx']-transformTool['start']['cx'],_0x211fa4=_0x358609['cy']-transformTool['start']['cy'],_0x2d080d=fixedFBOWidth/canvas['width'],_0x112310=fixedFBOHeight/canvas['height'];if('grab'===transformTool['mode'])_0x6f11cc['x']=transformTool['ref']['x']+_0x45b3a0*_0x2d080d,_0x6f11cc['y']=transformTool['ref']['y']+_0x211fa4*_0x112310;else{if('scale'===transformTool['mode']){const _0x10ff21=0.004,_0xd0a8df=0x3,_0x15bed0=0x28,_0x1cb3d9=0.05,_0x214ab0=0x14,_0x29bc0b=transformTool['pivotCanvas']||{'cx':0.5*canvas['width'],'cy':0.5*canvas['height']},_0x467ae0=transformTool['start']['cx']-_0x29bc0b['cx'],_0x31106f=transformTool['start']['cy']-_0x29bc0b['cy'],_0x26c631=_0x358609['cx']-_0x29bc0b['cx'],_0x1e24e1=_0x358609['cy']-_0x29bc0b['cy'],_0x3f0ade=Math['hypot'](_0x467ae0,_0x31106f),_0x308886=Math['hypot'](_0x26c631,_0x1e24e1);Math['max'](_0x15bed0,_0x3f0ade);let _0x332719=_0x308886-_0x3f0ade;Math['abs'](_0x332719)<=_0xd0a8df?_0x332719=0x0:_0x332719-=Math['sign'](_0x332719)*_0xd0a8df;let _0x5a0d0b=Math['exp'](_0x332719*_0x10ff21);transformTool['shiftInvert']&&(_0x5a0d0b=0x1/Math['max'](_0x5a0d0b,0.000001));const _0x520b22=transformTool['ref']['scaleX'],_0x2faa32=transformTool['ref']['scaleY'],_0x4714b4=_0x59d287=>Math['min'](_0x214ab0,Math['max'](_0x1cb3d9,_0x59d287*_0x5a0d0b));_0x6f11cc['scaleX']=_0x4714b4(_0x520b22),_0x6f11cc['scaleY']=_0x4714b4(_0x2faa32);}else{if('rotate'===transformTool['mode']){const _0x188f8f=transformTool['pivotCanvas']||{'cx':0.5*canvas['width'],'cy':0.5*canvas['height']},_0x4434a9=Math['atan2'](transformTool['start']['cy']-_0x188f8f['cy'],transformTool['start']['cx']-_0x188f8f['cx']);let _0x5698a0=Math['atan2'](_0x358609['cy']-_0x188f8f['cy'],_0x358609['cx']-_0x188f8f['cx'])-_0x4434a9;transformTool['shiftInvert']&&(_0x5698a0=-_0x5698a0);const _0x57e011=Math['PI']/0x5a;_0x5698a0=Math['round'](_0x5698a0/_0x57e011)*_0x57e011,_0x6f11cc['rotation']=transformTool['ref']['rotation']+_0x5698a0;}}}needsRedraw=!0x0;}function startTransform(_0x2df8b4,_0x42bdeb=!0x1){const _0x1c63ac=getActiveLayer();if(!_0x1c63ac)return void console['warn']('[transform]\x20no\x20active\x20layer');_0x1c63ac['x']=Number['isFinite'](_0x1c63ac['x'])?_0x1c63ac['x']:0x0,_0x1c63ac['y']=Number['isFinite'](_0x1c63ac['y'])?_0x1c63ac['y']:0x0,_0x1c63ac['scaleX']=Number['isFinite'](_0x1c63ac['scaleX'])?_0x1c63ac['scaleX']:0x1,_0x1c63ac['scaleY']=Number['isFinite'](_0x1c63ac['scaleY'])?_0x1c63ac['scaleY']:0x1,_0x1c63ac['rotation']=Number['isFinite'](_0x1c63ac['rotation'])?_0x1c63ac['rotation']:0x0;const _0x542db9=canvasPxToFBO(null!=lastX?lastX:0.5*canvas['width'],null!=lastY?lastY:0.5*canvas['height']);_0x1c63ac['px']=Math['max'](0x0,Math['min'](fixedFBOWidth,_0x542db9['fx'])),_0x1c63ac['py']=Math['max'](0x0,Math['min'](fixedFBOHeight,_0x542db9['fy']));const _0x28b2e2=canvas['width']/fixedFBOWidth,_0x3431a0=canvas['height']/fixedFBOHeight;transformTool['pivotCanvas']={'cx':_0x1c63ac['px']*_0x28b2e2,'cy':_0x1c63ac['py']*_0x3431a0},transformTool['mode']=_0x2df8b4,transformTool['shiftInvert']=_0x42bdeb,transformTool['ref']={'x':_0x1c63ac['x'],'y':_0x1c63ac['y'],'scaleX':_0x1c63ac['scaleX'],'scaleY':_0x1c63ac['scaleY'],'rotation':_0x1c63ac['rotation'],'px':_0x1c63ac['px'],'py':_0x1c63ac['py']},transformTool['start']=null,isDrawing&&(isDrawing=!0x1,stopRender('draw')),startRender('transform'),showStatusMessage('grab'===_0x2df8b4?'Grab\x20(move)\x20layer':'scale'===_0x2df8b4?_0x42bdeb?'Scale\x20(down)':'Scale\x20(up)':'rotate'===_0x2df8b4?_0x42bdeb?'Rotate\x20(counter-clockwise)':'Rotate\x20(clockwise)':'','info'),needsRedraw=!0x0;}function endTransform(_0x3123ce=!0x0){if(!(transformTool&&transformTool['mode']&&'idle'!==transformTool['mode'])){try{isTwoFingerGesture=!0x1,pinchStart=null;}catch{}return transformTool&&(transformTool['mode']='idle'),needsRedraw=!0x0,void requestDrawIfIdle?.();}try{stopRender?.('transform');}catch{}let _0x575a6f=!0x1,_0x2e993e=null,_0x3456b4=null;try{promoteLayerForScale?.(1.25);}catch{}try{_0x3123ce&&activeLayerWouldClip()&&(_0x3123ce=!0x1,showStatusMessage?.('Skipped\x20bake\x20to\x20prevent\x20off-canvas\x20cropping','info'));}catch(_0x5d2f0f){console['warn']('[endTransform]\x20clip-guard\x20error:',_0x5d2f0f);}if(_0x3123ce)try{_0x2e993e=snapshotLayer?.(activeLayerIndex),applyActiveLayerTransform?.(),_0x3456b4=snapshotLayer?.(activeLayerIndex),_0x2e993e&&_0x3456b4&&History?.['push']&&History['push']({'type':'transform_bake','before':_0x2e993e,'after':_0x3456b4}),_0x575a6f=!0x0;}catch(_0x347b55){console['warn']('[endTransform]\x20Bake\x20failed:',_0x347b55),_0x575a6f=!0x1;}try{transformTool['start']=null;}catch{}try{transformTool['ref']=null;}catch{}try{transformTool['shiftInvert']=!0x1;}catch{}try{transformTool['pivotCanvas']=null;}catch{}transformTool&&(transformTool['mode']='idle');try{isTwoFingerGesture=!0x1,pinchStart=null;}catch{}const _0x52bf1a=getActiveLayer?.(),_0x4f7aa8=!(!_0x52bf1a||!_0x52bf1a['transformLocked']);transformTool&&(transformTool['mobileCombo']=_0x4f7aa8),_0x4f7aa8&&queueMicrotask?.(()=>startTransform?.('grab')),showStatusMessage?.(_0x575a6f?'Transform\x20applied':_0x3123ce?'Transform\x20failed':'Transform\x20cancelled',_0x575a6f?'success':_0x3123ce?'warning':'info'),needsRedraw=!0x0,requestDrawIfIdle?.();}function initPaintLayerFixed(){layers['forEach'](_0x3bcd4a=>{gl['deleteTexture'](_0x3bcd4a['texture']),gl['deleteFramebuffer'](_0x3bcd4a['fbo']);}),layers=[],activeLayerIndex=0x0,addLayer('Layer\x201',-0x1),syncActiveAliases();}function mergeSelectedLayers(){if(!gl||!layers||!selectedLayerIndices||selectedLayerIndices['size']<0x2||!quadProgram)return;const _0xd4d35d=0x0|fixedFBOWidth,_0x262c36=0x0|fixedFBOHeight,_0xad5715=Array['from'](selectedLayerIndices)['sort']((_0x943c29,_0x527a0c)=>_0x943c29-_0x527a0c);let _0x1ee6c4=0x1/0x0,_0x551df9=0x1/0x0,_0x32163e=-0x1/0x0,_0x532235=-0x1/0x0;_0xad5715['forEach'](_0x164ac5=>layers[_0x164ac5]&&function(_0x478b8c){const _0x4b7439=Number['isFinite'](_0x478b8c['ox'])?_0x478b8c['ox']:0x0,_0x1e955f=Number['isFinite'](_0x478b8c['oy'])?_0x478b8c['oy']:0x0,_0xe40cc1=Math['max'](0x1,Number['isFinite'](_0x478b8c['texW'])?_0x478b8c['texW']:_0xd4d35d),_0x7a35ff=Math['max'](0x1,Number['isFinite'](_0x478b8c['texH'])?_0x478b8c['texH']:_0x262c36),_0x476f81=Number['isFinite'](_0x478b8c['scaleX'])?_0x478b8c['scaleX']:0x1,_0x5ecb7c=Number['isFinite'](_0x478b8c['scaleY'])?_0x478b8c['scaleY']:0x1,_0x49eaba=Number['isFinite'](_0x478b8c['rotation'])?_0x478b8c['rotation']:0x0,_0x3fb906=Number['isFinite'](_0x478b8c['x'])?_0x478b8c['x']:0x0,_0x314ef2=Number['isFinite'](_0x478b8c['y'])?_0x478b8c['y']:0x0,_0x28ee65=Number['isFinite'](_0x478b8c['px'])?_0x478b8c['px']:0.5*_0xd4d35d,_0x538a4b=Number['isFinite'](_0x478b8c['py'])?_0x478b8c['py']:0.5*_0x262c36,_0x18fb59=Math['cos'](_0x49eaba),_0x30199a=Math['sin'](_0x49eaba);function _0x45e40d(_0x2285c1,_0xb5e300){let _0x4890a2=(_0x2285c1-_0x28ee65)*_0x476f81,_0x2b758c=(_0xb5e300-_0x538a4b)*_0x5ecb7c;return{'x':_0x28ee65+(_0x4890a2*_0x18fb59-_0x2b758c*_0x30199a)+_0x3fb906,'y':_0x538a4b+(_0x4890a2*_0x30199a+_0x2b758c*_0x18fb59)+_0x314ef2};}const _0x4090dc=_0x45e40d(_0x4b7439,_0x1e955f),_0x463116=_0x45e40d(_0x4b7439+_0xe40cc1,_0x1e955f),_0x5d70b4=_0x45e40d(_0x4b7439,_0x1e955f+_0x7a35ff),_0x3c7387=_0x45e40d(_0x4b7439+_0xe40cc1,_0x1e955f+_0x7a35ff);_0x1ee6c4=Math['min'](_0x1ee6c4,_0x4090dc['x'],_0x463116['x'],_0x5d70b4['x'],_0x3c7387['x']),_0x551df9=Math['min'](_0x551df9,_0x4090dc['y'],_0x463116['y'],_0x5d70b4['y'],_0x3c7387['y']),_0x32163e=Math['max'](_0x32163e,_0x4090dc['x'],_0x463116['x'],_0x5d70b4['x'],_0x3c7387['x']),_0x532235=Math['max'](_0x532235,_0x4090dc['y'],_0x463116['y'],_0x5d70b4['y'],_0x3c7387['y']);}(layers[_0x164ac5])),_0x1ee6c4=Math['floor'](_0x1ee6c4),_0x551df9=Math['floor'](_0x551df9),_0x32163e=Math['ceil'](_0x32163e),_0x532235=Math['ceil'](_0x532235);const _0xc48580=Math['max'](0x1,_0x32163e-_0x1ee6c4|0x0),_0x56458d=Math['max'](0x1,_0x532235-_0x551df9|0x0),_0x2e4ac2=gl['getParameter'](gl['FRAMEBUFFER_BINDING']),_0x119f83=gl['getParameter'](gl['CURRENT_PROGRAM']),_0x56115a=gl['getParameter'](gl['VIEWPORT']),_0x34b7b2=gl['isEnabled'](gl['BLEND']),_0x4c1427=gl['createTexture']();gl['bindTexture'](gl['TEXTURE_2D'],_0x4c1427),gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],_0xc48580,_0x56458d,0x0,gl['RGBA'],gl['UNSIGNED_BYTE'],null),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MIN_FILTER'],gl['NEAREST']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MAG_FILTER'],gl['NEAREST']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_S'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_T'],gl['CLAMP_TO_EDGE']);const _0x4ec8c3=gl['createFramebuffer']();gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x4ec8c3),gl['framebufferTexture2D'](gl['FRAMEBUFFER'],gl['COLOR_ATTACHMENT0'],gl['TEXTURE_2D'],_0x4c1427,0x0),gl['viewport'](0x0,0x0,_0xc48580,_0x56458d),gl['enable'](gl['BLEND']),gl['blendFuncSeparate'](gl['SRC_ALPHA'],gl['ONE_MINUS_SRC_ALPHA'],gl['ONE'],gl['ONE_MINUS_SRC_ALPHA']),gl['clearColor'](0x0,0x0,0x0,0x0),gl['clear'](gl['COLOR_BUFFER_BIT']),gl['useProgram'](quadProgram);const _0x32189e=gl['getUniformLocation'](quadProgram,'u_flipY');_0x32189e&&gl['uniform1f'](_0x32189e,0x1);const _0x32702c=gl['getUniformLocation'](quadProgram,'u_resolution');_0x32702c&&gl['uniform2f'](_0x32702c,_0xc48580,_0x56458d);const _0x52ef1d=gl['getUniformLocation'](quadProgram,'u_layerOpacity'),_0x4776a1=gl['getUniformLocation'](quadProgram,'u_texture');for(const _0x171fb2 of _0xad5715){const _0xb3aecc=layers[_0x171fb2];if(!_0xb3aecc||!_0xb3aecc['texture']||!_0xb3aecc['visible']||(_0xb3aecc['opacity']??0x1)<=0x0)continue;const _0x216013=Number['isFinite'](_0xb3aecc['ox'])?_0xb3aecc['ox']:0x0,_0x1d77c2=Number['isFinite'](_0xb3aecc['oy'])?_0xb3aecc['oy']:0x0,_0x3676c3=Math['max'](0x1,Number['isFinite'](_0xb3aecc['texW'])?_0xb3aecc['texW']:_0xd4d35d),_0x2828b2=Math['max'](0x1,Number['isFinite'](_0xb3aecc['texH'])?_0xb3aecc['texH']:_0x262c36),_0x7d4a99=Number['isFinite'](_0xb3aecc['scaleX'])?_0xb3aecc['scaleX']:0x1,_0x214ceb=Number['isFinite'](_0xb3aecc['scaleY'])?_0xb3aecc['scaleY']:0x1,_0x3e081f=Number['isFinite'](_0xb3aecc['rotation'])?_0xb3aecc['rotation']:0x0,_0x148f20=Number['isFinite'](_0xb3aecc['x'])?_0xb3aecc['x']:0x0,_0x543335=Number['isFinite'](_0xb3aecc['y'])?_0xb3aecc['y']:0x0,_0x35d088=Number['isFinite'](_0xb3aecc['px'])?_0xb3aecc['px']:0.5*_0xd4d35d,_0x5addd6=Number['isFinite'](_0xb3aecc['py'])?_0xb3aecc['py']:0.5*_0x262c36,_0xf8b041=Math['cos'](_0x3e081f),_0x3287c8=Math['sin'](_0x3e081f);function _0x320428(_0x652ef6,_0x566fac){let _0x14d95a=(_0x652ef6-_0x35d088)*_0x7d4a99,_0x47c87c=(_0x566fac-_0x5addd6)*_0x214ceb;return{'x':_0x35d088+(_0x14d95a*_0xf8b041-_0x47c87c*_0x3287c8)+_0x148f20,'y':_0x5addd6+(_0x14d95a*_0x3287c8+_0x47c87c*_0xf8b041)+_0x543335};}const _0x4ba8e3=_0x320428(_0x216013,_0x1d77c2),_0x3566be=_0x320428(_0x216013+_0x3676c3,_0x1d77c2),_0x5f2b51=_0x320428(_0x216013,_0x1d77c2+_0x2828b2),_0x66ab70=_0x320428(_0x216013+_0x3676c3,_0x1d77c2+_0x2828b2),_0x4eee3a=new Float32Array([_0x4ba8e3['x']-_0x1ee6c4,_0x4ba8e3['y']-_0x551df9,0x0,0x0,_0x3566be['x']-_0x1ee6c4,_0x3566be['y']-_0x551df9,0x1,0x0,_0x5f2b51['x']-_0x1ee6c4,_0x5f2b51['y']-_0x551df9,0x0,0x1,_0x5f2b51['x']-_0x1ee6c4,_0x5f2b51['y']-_0x551df9,0x0,0x1,_0x3566be['x']-_0x1ee6c4,_0x3566be['y']-_0x551df9,0x1,0x0,_0x66ab70['x']-_0x1ee6c4,_0x66ab70['y']-_0x551df9,0x1,0x1]),_0x537f35=gl['createBuffer']();gl['bindBuffer'](gl['ARRAY_BUFFER'],_0x537f35),gl['bufferData'](gl['ARRAY_BUFFER'],_0x4eee3a,gl['STREAM_DRAW']);const _0x277cba=gl['getAttribLocation'](quadProgram,'a_position'),_0x598444=gl['getAttribLocation'](quadProgram,'a_texCoord');gl['enableVertexAttribArray'](_0x277cba),gl['vertexAttribPointer'](_0x277cba,0x2,gl['FLOAT'],!0x1,0x10,0x0),gl['enableVertexAttribArray'](_0x598444),gl['vertexAttribPointer'](_0x598444,0x2,gl['FLOAT'],!0x1,0x10,0x8),_0x52ef1d&&gl['uniform1f'](_0x52ef1d,Math['max'](0x0,Math['min'](0x1,_0xb3aecc['opacity']??0x1))),gl['activeTexture'](gl['TEXTURE0']),gl['bindTexture'](gl['TEXTURE_2D'],_0xb3aecc['texture']),_0x4776a1&&gl['uniform1i'](_0x4776a1,0x0),gl['drawArrays'](gl['TRIANGLES'],0x0,0x6),gl['disableVertexAttribArray'](_0x277cba),gl['disableVertexAttribArray'](_0x598444),gl['bindBuffer'](gl['ARRAY_BUFFER'],null),gl['deleteBuffer'](_0x537f35);}const _0x22077b=_0xad5715[_0xad5715['length']-0x1];for(let _0x5a6f2e=_0xad5715['length']-0x1;_0x5a6f2e>=0x0;_0x5a6f2e--){const _0xdbf299=layers[_0xad5715[_0x5a6f2e]];if(_0xdbf299){try{_0xdbf299['texture']&&gl['deleteTexture'](_0xdbf299['texture']);}catch{}try{_0xdbf299['fbo']&&gl['deleteFramebuffer'](_0xdbf299['fbo']);}catch{}layers['splice'](_0xad5715[_0x5a6f2e],0x1);}}const _0x5ca517={'name':'Merged\x20('+_0xad5715['length']+')','texture':_0x4c1427,'fbo':_0x4ec8c3,'visible':!0x0,'opacity':0x1,'ox':_0x1ee6c4,'oy':_0x551df9,'texW':_0xc48580,'texH':_0x56458d,'x':0x0,'y':0x0,'scaleX':0x1,'scaleY':0x1,'rotation':0x0,'px':_0x1ee6c4+0.5*_0xc48580,'py':_0x551df9+0.5*_0x56458d},_0x52f57b=Math['min'](_0x22077b-(_0xad5715['length']-0x1),layers['length']);layers['splice'](_0x52f57b,0x0,_0x5ca517),activeLayerIndex=_0x52f57b,selectedLayerIndices=new Set([_0x52f57b]),'function'==typeof syncActiveAliases&&syncActiveAliases(),_0x34b7b2||gl['disable'](gl['BLEND']),gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x2e4ac2),gl['useProgram'](_0x119f83),_0x56115a&&gl['viewport'](_0x56115a[0x0],_0x56115a[0x1],_0x56115a[0x2],_0x56115a[0x3]),needsRedraw=!0x0,requestDrawIfIdle?.();}function mergeAllLayers(){!gl||!layers||layers['length']<0x2||(selectedLayerIndices=new Set(layers['map']((_0x525579,_0x21f86f)=>_0x21f86f)),mergeSelectedLayers());}const BackgroundPicker=((()=>{let _0x28842=['/static/draw/images/backgrounds/WEBP_1920/46.webp','/static/draw/images/backgrounds/WEBP_1920/45.webp','/static/draw/images/backgrounds/WEBP_1920/44.webp','/static/draw/images/backgrounds/WEBP_1920/43.webp','/static/draw/images/backgrounds/WEBP_1920/42.webp','/static/draw/images/backgrounds/WEBP_1920/41.webp','/static/draw/images/backgrounds/WEBP_1920/40.webp'],_0xc31e50={},_0x1a9d26=null,_0x23090b='curated';function _0x424ac7(_0x91f8d7){return document['getElementById'](_0x91f8d7);}function _0x1f4a99(_0x3e74ea,_0x4ed81c){const _0x28dc21=document['createElement'](_0x3e74ea);return _0x4ed81c&&(_0x28dc21['className']=_0x4ed81c),_0x28dc21;}function _0x103b51(_0x38fbf4,_0x43dfcc){const _0x1ed4f3=document['createElement']('canvas');return _0x1ed4f3['width']=_0x38fbf4,_0x1ed4f3['height']=_0x43dfcc,_0x1ed4f3;}function _0x38326f(_0x36818d){return new Promise((_0x3d85e8,_0x34ce12)=>{const _0xe70139=new Image();_0xe70139['crossOrigin']='anonymous',_0xe70139['onload']=()=>_0x3d85e8(_0xe70139),_0xe70139['onerror']=_0x34ce12,_0xe70139['src']=_0x36818d;});}function _0x4b4da0(_0x3741ce,_0x2b1277,_0x5bb93e){const _0x187c47=_0x103b51(_0x2b1277,_0x5bb93e),_0x3721b2=_0x187c47['getContext']('2d'),_0x53a5ca=(_0x3741ce['naturalWidth']||_0x3741ce['width'])/(_0x3741ce['naturalHeight']||_0x3741ce['height']);let _0x54891c,_0x55396c,_0x5dfe44,_0x515e69;return _0x53a5ca>_0x2b1277/_0x5bb93e?(_0x55396c=_0x5bb93e,_0x54891c=Math['ceil'](_0x5bb93e*_0x53a5ca),_0x5dfe44=Math['floor']((_0x2b1277-_0x54891c)/0x2),_0x515e69=0x0):(_0x54891c=_0x2b1277,_0x55396c=Math['ceil'](_0x2b1277/_0x53a5ca),_0x5dfe44=0x0,_0x515e69=Math['floor']((_0x5bb93e-_0x55396c)/0x2)),_0x3721b2['drawImage'](_0x3741ce,_0x5dfe44,_0x515e69,_0x54891c,_0x55396c),_0x187c47;}function _0x109dbb(_0x3eebc8){_0xc31e50['curatedGrid']['querySelectorAll']('.bgp-thumb.selected')['forEach'](_0x39c13e=>_0x39c13e['classList']['remove']('selected')),_0x3eebc8&&_0x3eebc8['classList']['add']('selected');}function _0x2ae1bc(_0x59b231){_0x23090b=_0x59b231,document['querySelectorAll']('.bgp-tab')['forEach'](_0x12d669=>_0x12d669['classList']['toggle']('active',_0x12d669['dataset']['tab']===_0x59b231)),_0x424ac7('bgPickerModal')['querySelectorAll']('.bgp-pane')['forEach'](_0x4b9fa1=>{const _0x28db78=_0x4b9fa1['classList']['contains']('bgp-pane-curated')?'curated':_0x4b9fa1['classList']['contains']('bgp-pane-upload')?'upload':'solid';_0x4b9fa1['classList']['toggle']('active',_0x28db78===_0x59b231);});}function _0x2590f4(){_0xc31e50['colorHex']['value']=_0xc31e50['color']['value']['toUpperCase']();const _0x4bcc00=fixedFBOWidth||canvas['width'],_0x4245a9=fixedFBOHeight||canvas['height'],_0x2c42d9=function(_0x3fb6ba,_0x48e120,_0x6e6457){const _0x6bc64d=_0x103b51(_0x48e120,_0x6e6457),_0xf47fe3=_0x6bc64d['getContext']('2d');return _0xf47fe3['fillStyle']=_0x3fb6ba,_0xf47fe3['fillRect'](0x0,0x0,_0x48e120,_0x6e6457),_0x6bc64d;}(_0xc31e50['color']['value'],_0x4bcc00,_0x4245a9),_0x101bf6=_0x424ac7('bgpSolidPreview')['getContext']('2d');_0x101bf6['clearRect'](0x0,0x0,_0x424ac7('bgpSolidPreview')['width'],_0x424ac7('bgpSolidPreview')['height']),_0x101bf6['drawImage'](_0x4b4da0(_0x2c42d9,_0x424ac7('bgpSolidPreview')['width'],_0x424ac7('bgpSolidPreview')['height']),0x0,0x0),_0x1a9d26=_0x2c42d9;}function _0x3036bf(){_0x1a9d26=null,_0x109dbb(null),_0xc31e50['fileName']['textContent']='No\x20file\x20chosen',_0xc31e50['file']['value']='',_0x2ae1bc('curated'),_0x2590f4(),_0x424ac7('bgPickerModal')['style']['display']='flex';}function _0x2be668(){_0x424ac7('bgPickerModal')['style']['display']='none';}function _0x55a15e(){if(!_0x1a9d26)return void _0x2be668();const _0x46ead8=new Image();_0x46ead8['onload']=()=>{currentImage=_0x46ead8,fixedFBOWidth=_0x46ead8['width'],fixedFBOHeight=_0x46ead8['height'],initPaintLayerFixed(),updateCanvasSize(_0x46ead8),initFloodFBOs(),createTextureFromImage(_0x46ead8),canvas['offsetWidth'],canvasWrapper['offsetWidth'],zoomScale=0x1,panX=(canvasWrapper['clientWidth']-canvas['width'])/0x2,panY=(canvasWrapper['clientHeight']-canvas['height'])/0x2,updateCanvasTransform(),needsRedraw=!0x0,initFloodFillProgram(),addSoundEvents(),_0x2be668();},_0x46ead8['src']=_0x1a9d26['toDataURL']('image/png');}function _0x5480ba(_0x194b29){const _0x265fef=_0x194b29['target']['files']&&_0x194b29['target']['files'][0x0];if(!_0x265fef)return;_0xc31e50['fileName']['textContent']=_0x265fef['name'];const _0x1e1484=new FileReader();_0x1e1484['onload']=async()=>{const _0x105724=_0x1e1484['result'],_0x3157cf=await _0x38326f(_0x105724),_0x4c4e70=fixedFBOWidth||canvas['width'],_0x41d4fa=fixedFBOHeight||canvas['height'];_0x1a9d26=_0x4b4da0(_0x3157cf,_0x4c4e70,_0x41d4fa);const _0x4bfedd=_0x424ac7('bgpUploadPreview'),_0x5f1c2e=_0x4bfedd['getContext']('2d');_0x5f1c2e['clearRect'](0x0,0x0,_0x4bfedd['width'],_0x4bfedd['height']),_0x5f1c2e['drawImage'](_0x4b4da0(_0x3157cf,_0x4bfedd['width'],_0x4bfedd['height']),0x0,0x0);},_0x1e1484['readAsDataURL'](_0x265fef);}function _0x51259c(){_0xc31e50['gridBtn']=_0x424ac7('bgpCuratedGrid'),_0xc31e50['modal']=_0x424ac7('bgPickerModal'),_0xc31e50['curatedGrid']=_0x424ac7('bgpCuratedGrid'),_0xc31e50['file']=_0x424ac7('bgpFile'),_0xc31e50['fileName']=_0x424ac7('bgpFileName'),_0xc31e50['color']=_0x424ac7('bgpColor'),_0xc31e50['colorHex']=_0x424ac7('bgpColorHex'),_0xc31e50['apply']=_0x424ac7('bgpApply'),_0xc31e50['cancel']=_0x424ac7('bgpCancel'),_0xc31e50['closeX']=_0x424ac7('bgpClose'),document['querySelectorAll']('.bgp-tab')['forEach'](_0x387af9=>{_0x387af9['addEventListener']('click',()=>_0x2ae1bc(_0x387af9['dataset']['tab']));}),_0xc31e50['file']['addEventListener']('change',_0x5480ba),_0xc31e50['color']['addEventListener']('input',_0x2590f4),_0xc31e50['colorHex']['addEventListener']('input',()=>{let _0x36f654=_0xc31e50['colorHex']['value']['trim']();/^#([0-9a-f]{3}|[0-9a-f]{6}|[0-9a-f]{8})$/i['test'](_0x36f654)&&(_0xc31e50['color']['value']=_0x36f654,_0x2590f4());}),_0xc31e50['apply']['addEventListener']('click',_0x55a15e),_0xc31e50['cancel']['addEventListener']('click',_0x2be668),_0xc31e50['closeX']['addEventListener']('click',_0x2be668),document['getElementById']('bgPickerBtn')?.['addEventListener']('click',_0x3036bf),_0xc31e50['curatedGrid']['innerHTML']='',_0x28842['forEach'](_0x3a9173=>{const _0x2a78a8=_0x1f4a99('button','bgp-thumb');_0x2a78a8['type']='button';const _0x380e21=_0x1f4a99('img');_0x380e21['loading']='lazy',_0x380e21['src']=_0x3a9173,_0x380e21['alt']='background',_0x2a78a8['appendChild'](_0x380e21),_0x2a78a8['addEventListener']('click',async()=>{const _0x17f4ee=fixedFBOWidth||canvas['width'],_0x3492b0=fixedFBOHeight||canvas['height'],_0x2021ec=await _0x38326f(_0x3a9173);_0x1a9d26=_0x4b4da0(_0x2021ec,_0x17f4ee,_0x3492b0),_0x109dbb(_0x2a78a8);}),_0xc31e50['curatedGrid']['appendChild'](_0x2a78a8);}),_0x2590f4();}return{'install':function(_0x97a3b1){_0x97a3b1?.['curated']&&Array['isArray'](_0x97a3b1['curated'])&&(_0x28842=_0x97a3b1['curated']),_0x51259c();},'open':_0x3036bf};})());function toggleUIVisibilityMode(){if(!document['getElementById']('__uiHideStyle')){const _0x2c644d=document['createElement']('style');_0x2c644d['id']='__uiHideStyle',_0x2c644d['textContent']='\x0a\x20\x20\x20\x20\x20\x20/*\x20hide\x20any\x20element\x20that\x20is\x20neither\x20a\x20canvas\x20nor\x20an\x20ancestor\x20of\x20a\x20canvas,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20and\x20keep\x20the\x20toggle\x20button\x20and\x20its\x20children\x20visible\x20*/\x0a\x20\x20\x20\x20\x20\x20body.__ui_off\x20:not(canvas):not(#hideAllButton):not(#hideAllButton\x20*):not(:has(canvas))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20visibility:\x20hidden\x20!important;\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20/*\x20canvases\x20must\x20remain\x20interactive\x20while\x20UI\x20is\x20hidden\x20*/\x0a\x20\x20\x20\x20\x20\x20body.__ui_off\x20canvas\x20{\x20pointer-events:\x20auto\x20!important;\x20}\x0a\x20\x20\x20\x20\x20\x20/*\x20ensure\x20the\x20toggle\x20stays\x20clickable\x20above\x20everything\x20*/\x0a\x20\x20\x20\x20\x20\x20#hideAllButton\x20{\x20z-index:\x20999999;\x20}\x0a\x20\x20\x20\x20',document['head']['appendChild'](_0x2c644d);}const _0x2043bd=document['body']['classList']['toggle']('__ui_off'),_0x5e0609=document['getElementById']('hideAllButton');_0x5e0609&&(_0x5e0609['title']=_0x2043bd?'Show\x20UI':'Hide\x20UI');}function duplicateLayer(_0xe51a1b=activeLayerIndex){if(!layers['length'])return;_0xe51a1b=Math['max'](0x0,Math['min'](_0xe51a1b,layers['length']-0x1));const _0x51ea7b=layers[_0xe51a1b];if(!_0x51ea7b||!gl['isFramebuffer'](_0x51ea7b['fbo'])||!gl['isTexture'](_0x51ea7b['texture']))return void console['warn']('[duplicateLayer]\x20invalid\x20source\x20layer');const _0x572a18=Number['isFinite'](_0x51ea7b['texW'])?_0x51ea7b['texW']:fixedFBOWidth,_0x46f663=Number['isFinite'](_0x51ea7b['texH'])?_0x51ea7b['texH']:fixedFBOHeight,{texture:_0x2ca7a2,fbo:_0x4e2179}=createLayerFBO(_0x572a18,_0x46f663);gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x4e2179),gl['viewport'](0x0,0x0,_0x572a18,_0x46f663),gl['disable'](gl['DEPTH_TEST']),gl['disable'](gl['CULL_FACE']),gl['disable'](gl['SCISSOR_TEST']),gl['disable'](gl['BLEND']),gl['clearColor'](0x0,0x0,0x0,0x0),gl['clear'](gl['COLOR_BUFFER_BIT']),gl['useProgram'](quadProgram);const _0x10f73e=gl['getUniformLocation'](quadProgram,'u_flipY');_0x10f73e&&gl['uniform1f'](_0x10f73e,0x1);const _0x3b7816=gl['getUniformLocation'](quadProgram,'u_resolution');_0x3b7816&&gl['uniform2f'](_0x3b7816,_0x572a18,_0x46f663);const _0xa684f1=gl['getUniformLocation'](quadProgram,'u_layerOpacity');_0xa684f1&&gl['uniform1f'](_0xa684f1,0x1);const _0x347bfe=gl['getUniformLocation'](quadProgram,'u_texture');_0x347bfe&&gl['uniform1i'](_0x347bfe,0x0);const _0x2b3607=new Float32Array([0x0,0x0,0x0,0x0,_0x572a18,0x0,0x1,0x0,0x0,_0x46f663,0x0,0x1,0x0,_0x46f663,0x0,0x1,_0x572a18,0x0,0x1,0x0,_0x572a18,_0x46f663,0x1,0x1]),_0xec97f4=gl['createBuffer']();gl['bindBuffer'](gl['ARRAY_BUFFER'],_0xec97f4),gl['bufferData'](gl['ARRAY_BUFFER'],_0x2b3607,gl['STREAM_DRAW']);const _0x4d0236=gl['getAttribLocation'](quadProgram,'a_position'),_0x16196f=gl['getAttribLocation'](quadProgram,'a_texCoord');gl['enableVertexAttribArray'](_0x4d0236),gl['vertexAttribPointer'](_0x4d0236,0x2,gl['FLOAT'],!0x1,0x10,0x0),gl['enableVertexAttribArray'](_0x16196f),gl['vertexAttribPointer'](_0x16196f,0x2,gl['FLOAT'],!0x1,0x10,0x8),gl['activeTexture'](gl['TEXTURE0']),gl['bindTexture'](gl['TEXTURE_2D'],_0x51ea7b['texture']),gl['drawArrays'](gl['TRIANGLES'],0x0,0x6),gl['disableVertexAttribArray'](_0x4d0236),gl['disableVertexAttribArray'](_0x16196f),gl['bindBuffer'](gl['ARRAY_BUFFER'],null),gl['deleteBuffer'](_0xec97f4),gl['bindFramebuffer'](gl['FRAMEBUFFER'],null);const _0x49a5bc={'id':Date['now']()+Math['random'](),'name':_0x51ea7b['name']+'\x20copy','fbo':_0x4e2179,'texture':_0x2ca7a2,'visible':_0x51ea7b['visible'],'opacity':_0x51ea7b['opacity'],'x':_0x51ea7b['x'],'y':_0x51ea7b['y'],'scaleX':_0x51ea7b['scaleX'],'scaleY':_0x51ea7b['scaleY'],'rotation':_0x51ea7b['rotation'],'px':_0x51ea7b['px'],'py':_0x51ea7b['py'],'texW':_0x572a18,'texH':_0x46f663,'ox':_0x51ea7b['ox'],'oy':_0x51ea7b['oy'],'history':[],'redo':[]},_0xb07e48=Math['min'](activeLayerIndex+0x1,layers['length']);layers['splice'](_0xb07e48,0x0,_0x49a5bc),activeLayerIndex=_0xb07e48,syncActiveAliases(),rebuildLayersUI?.(),needsRedraw=!0x0,requestDrawIfIdle?.();}function createTextureFromImage(_0x1a274e,_0x45dc82=!0x1){if(!_0x1a274e)return void console['error']('Image\x20is\x20null\x20or\x20undefined.');const _0x17e169=gl['createTexture']();gl['bindTexture'](gl['TEXTURE_2D'],_0x17e169),_0x45dc82?(gl['pixelStorei'](gl['UNPACK_FLIP_Y_WEBGL'],!0x0),gl['pixelStorei'](gl['UNPACK_PREMULTIPLY_ALPHA_WEBGL'],!0x0)):gl['pixelStorei'](gl['UNPACK_FLIP_Y_WEBGL'],!0x1),gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],gl['RGBA'],gl['UNSIGNED_BYTE'],_0x1a274e),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_S'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_T'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MIN_FILTER'],gl['LINEAR']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MAG_FILTER'],gl['LINEAR']),_0x45dc82?(overlayTexture=_0x17e169,brushAspect=_0x1a274e['width']/_0x1a274e['height']):texture=_0x17e169,needsRedraw=!0x0;}function centerAndFitToWrapper(){const _0x4d8552=canvasWrapper['getBoundingClientRect'](),_0x183338=canvas['width'],_0x44cfbf=canvas['height'],_0x500dfb=Math['min'](_0x4d8552['width']/_0x183338,_0x4d8552['height']/_0x44cfbf);zoomScale=Math['min'](zoomMax,Math['max'](zoomMin,_0x500dfb)),panX=Math['round']((_0x4d8552['width']-_0x183338*zoomScale)/0x2),panY=Math['round']((_0x4d8552['height']-_0x44cfbf*zoomScale)/0x2),updateCanvasTransform(),resetStrokeState(),needsRedraw=!0x0;}function centerNextFrame(){requestAnimationFrame(()=>{centerAndFitToWrapper();});}function loadDefaultImage(){const _0xd8af71=document['createElement']('canvas');_0xd8af71['width']=window['innerWidth'],_0xd8af71['height']=window['innerHeight'];const _0x248fc1=_0xd8af71['getContext']('2d');_0x248fc1['fillStyle']='#f2efe4',_0x248fc1['fillRect'](0x0,0x0,_0xd8af71['width'],_0xd8af71['height']);const _0x359d52=document['createElement']('canvas');_0x359d52['width']=_0xd8af71['width'],_0x359d52['height']=_0xd8af71['height'];const _0x3b688c=_0x359d52['getContext']('2d'),_0x19821d=_0x3b688c['createImageData'](_0x359d52['width'],_0x359d52['height']);for(let _0x3e97ae=0x0;_0x3e97ae<_0x19821d['data']['length'];_0x3e97ae+=0x4){const _0x19d49b=0x32*Math['random']()-0x19;_0x19821d['data'][_0x3e97ae]=0xf0+_0x19d49b,_0x19821d['data'][_0x3e97ae+0x1]=0xeb+_0x19d49b,_0x19821d['data'][_0x3e97ae+0x2]=0xe1+_0x19d49b,_0x19821d['data'][_0x3e97ae+0x3]=0xff;}_0x3b688c['putImageData'](_0x19821d,0x0,0x0),_0x248fc1['globalAlpha']=0.2,_0x248fc1['drawImage'](_0x359d52,0x0,0x0),_0x248fc1['globalAlpha']=0x1;const _0x56a66b=document['createElement']('canvas');_0x56a66b['width']=_0xd8af71['width'],_0x56a66b['height']=_0xd8af71['height'];const _0x4be429=_0x56a66b['getContext']('2d'),_0x319eaa=_0x4be429['createImageData'](_0x56a66b['width'],_0x56a66b['height']);for(let _0x55b35d=0x0;_0x55b35d<_0x319eaa['data']['length'];_0x55b35d+=0x4){const _0xc18e36=0xff*Math['random']();_0x319eaa['data'][_0x55b35d]=_0xc18e36,_0x319eaa['data'][_0x55b35d+0x1]=_0xc18e36,_0x319eaa['data'][_0x55b35d+0x2]=_0xc18e36,_0x319eaa['data'][_0x55b35d+0x3]=0x5a*Math['random']();}_0x4be429['putImageData'](_0x319eaa,0x0,0x0),_0x248fc1['globalAlpha']=0.08,_0x248fc1['drawImage'](_0x56a66b,0x0,0x0),_0x248fc1['globalAlpha']=0x1;const _0x220a33=_0x248fc1['createRadialGradient'](_0xd8af71['width']/0x2,_0xd8af71['height']/0x2,0.3*Math['min'](_0xd8af71['width'],_0xd8af71['height']),_0xd8af71['width']/0x2,_0xd8af71['height']/0x2,0.6*Math['max'](_0xd8af71['width'],_0xd8af71['height']));_0x220a33['addColorStop'](0x0,'rgba(0,0,0,0)'),_0x220a33['addColorStop'](0x1,'rgba(0,0,0,0.35)'),_0x248fc1['globalAlpha']=0.3,_0x248fc1['fillStyle']=_0x220a33,_0x248fc1['fillRect'](0x0,0x0,_0xd8af71['width'],_0xd8af71['height']),_0x248fc1['globalAlpha']=0x1;const _0x46a5bf=new Image();_0x46a5bf['crossOrigin']='anonymous',_0x46a5bf['onload']=()=>{currentImage=_0x46a5bf,fixedFBOWidth=_0x46a5bf['width'],fixedFBOHeight=_0x46a5bf['height'],initPaintLayerFixed(),updateCanvasSize(_0x46a5bf),initFloodFBOs(),createTextureFromImage(_0x46a5bf),canvas['offsetWidth'],canvasWrapper['offsetWidth'],zoomScale=0x1,panX=(canvasWrapper['clientWidth']-canvas['width'])/0x2,panY=(canvasWrapper['clientHeight']-canvas['height'])/0x2,updateCanvasTransform(),resetStrokeState(),needsRedraw=!0x0,initFloodFillProgram(),addSoundEvents();},_0x46a5bf['onerror']=()=>console['error']('Failed\x20to\x20load\x20default\x20image.'),_0x46a5bf['src']=_0xd8af71['toDataURL']('image/png');}function createBrushThumbnails(){const _0x2079d3=document['getElementById']('brushContainer');_0x2079d3['innerHTML']='',brushes['forEach'](_0x473981=>{const _0x21d468=document['createElement']('img');_0x21d468['src']=_0x473981['file'],_0x21d468['classList']['add']('brush-thumbnail'),_0x473981['selected']&&(_0x21d468['style']['border']='2px\x20solid\x20red'),_0x21d468['addEventListener']('click',()=>selectBrush(_0x473981['name'])),_0x2079d3['appendChild'](_0x21d468);});const _0x4b169e=document['getElementById']('brushContainerToggle');_0x2079d3['appendChild'](_0x4b169e);}function updateBrushThumbnailStyles(_0x4dd7d0){const _0x3ae28a=document['getElementById']('brushContainer')['querySelectorAll']('img.brush-thumbnail');brushes['forEach']((_0x4187f2,_0x444901)=>{_0x3ae28a[_0x444901]&&(_0x3ae28a[_0x444901]['style']['border']=_0x4187f2['name']===_0x4dd7d0?'2px\x20solid\x20red':'2px\x20solid\x20transparent');});}function selectBrush(_0xc6dbdd){const _0x2261bd=brushes['find'](_0x3f0d52=>_0x3f0d52['name']===_0xc6dbdd);if(!_0x2261bd)return void console['warn']('Brush\x20\x22'+_0xc6dbdd+'\x22\x20not\x20found.');currentBrush=_0x2261bd,overlayTexture=brushTextures[_0x2261bd['name']],brushAspect=brushAspects[_0x2261bd['name']];const _0x4b4769=document['getElementById']('brushSizeSlider'),_0xb44530=document['getElementById']('brushSizeValue');_0x4b4769['value']=brushSize,_0xb44530['textContent']=brushSize['toFixed'](0x2),brushes['forEach'](_0x43c99a=>_0x43c99a['selected']=_0x43c99a['name']===_0xc6dbdd),updateBrushThumbnailStyles(_0x2261bd['name']),needsRedraw=!0x0;}function loadBrushes(){brushes['forEach'](_0x5e43f2=>{const _0x4ff964=new Image();_0x4ff964['crossOrigin']='anonymous',_0x4ff964['onload']=()=>{const _0x37105f=gl['createTexture']();gl['bindTexture'](gl['TEXTURE_2D'],_0x37105f),gl['pixelStorei'](gl['UNPACK_FLIP_Y_WEBGL'],!0x0),gl['pixelStorei'](gl['UNPACK_PREMULTIPLY_ALPHA_WEBGL'],!0x0),gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],gl['RGBA'],gl['UNSIGNED_BYTE'],_0x4ff964),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_S'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_T'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MIN_FILTER'],gl['LINEAR']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MAG_FILTER'],gl['LINEAR']),brushTextures[_0x5e43f2['name']]=_0x37105f,brushAspects[_0x5e43f2['name']]=_0x4ff964['width']/_0x4ff964['height'],_0x5e43f2['selected']&&selectBrush(_0x5e43f2['name']);},_0x4ff964['onerror']=()=>console['error']('Failed\x20to\x20load\x20brush\x20image:',_0x5e43f2['file']),_0x4ff964['src']=_0x5e43f2['file'];});}function centerCanvasInWrapper(){const _0xccaf8=canvasWrapper['getBoundingClientRect'](),_0xfbe3be=canvas['width']*zoomScale,_0x1a4625=canvas['height']*zoomScale;panX=(_0xccaf8['width']-_0xfbe3be)/0x2,panY=(_0xccaf8['height']-_0x1a4625)/0x2,viewRotation=0x0,transformOriginX=0x0,transformOriginY=0x0,updateCanvasTransform();}function ensureCanvasNotLost(){const _0x4b99df=canvasWrapper['getBoundingClientRect'](),_0x4d5792=canvas['getBoundingClientRect'](),_0x4045dd=Math['max'](0x0,Math['min'](_0x4d5792['right'],_0x4b99df['right'])-Math['min'](_0x4d5792['left'],_0x4b99df['left']))*Math['max'](0x0,Math['min'](_0x4d5792['bottom'],_0x4b99df['bottom'])-Math['min'](_0x4d5792['top'],_0x4b99df['top'])),_0x2273ab=_0x4d5792['width']*_0x4d5792['height'];(!isFinite(_0x4045dd)||_0x2273ab<=0x0||_0x4045dd/_0x2273ab<0.05)&&centerCanvasInWrapper();}BackgroundPicker['install']({'curated':['/static/draw/images/backgrounds/WEBP_1920/sl_072622_51930_13.jpg','/static/draw/images/backgrounds/WEBP_1920/02.webp','/static/draw/images/backgrounds/WEBP_1920/44.webp','/static/draw/images/backgrounds/WEBP_1920/43.webp','/static/draw/images/backgrounds/WEBP_1920/42.webp','/static/draw/images/backgrounds/WEBP_1920/41.webp','/static/draw/images/backgrounds/WEBP_1920/40.webp']}),document['getElementById']('hideAllButton')?.['addEventListener']('click',toggleUIVisibilityMode),document['addEventListener']('keydown',_0x2a9eb3=>{if(_0x2a9eb3['altKey']||_0x2a9eb3['ctrlKey']||_0x2a9eb3['metaKey']||_0x2a9eb3['shiftKey'])return;('Escape'===_0x2a9eb3['key']||'Esc'===_0x2a9eb3['key']||0x1b===_0x2a9eb3['keyCode'])&&(_0x2a9eb3['preventDefault'](),toggleUIVisibilityMode());},{'capture':!0x0}),['mouseup','mouseleave','touchend','touchcancel']['forEach'](_0x123e66=>canvasWrapper['addEventListener'](_0x123e66,ensureCanvasNotLost,{'passive':!0x0})),window['addEventListener']('resize',ensureCanvasNotLost),window['visualViewport']&&(visualViewport['addEventListener']('resize',ensureCanvasNotLost),visualViewport['addEventListener']('scroll',ensureCanvasNotLost));let lastMultiTap=0x0;function snapBackIfLost(_0x409231,_0xb9f20c){_0xb9f20c='number'==typeof _0xb9f20c?_0xb9f20c:0x8;var _0x3c48ec=_0x409231['getBoundingClientRect'](),_0x4edde6=window['visualViewport']?window['visualViewport']:null,_0xc3da8a=_0x4edde6&&_0x4edde6['width']?_0x4edde6['width']:window['innerWidth'],_0x1cf855=_0x4edde6&&_0x4edde6['height']?_0x4edde6['height']:window['innerHeight'];if(!(_0x3c48ec['right']>_0xb9f20c&&_0x3c48ec['bottom']>_0xb9f20c&&_0x3c48ec['left']<_0xc3da8a-_0xb9f20c&&_0x3c48ec['top']<_0x1cf855-_0xb9f20c)){var _0x20964c=Math['min'](Math['max'](_0x409231['offsetLeft']||0x0,_0xb9f20c),_0xc3da8a-_0x3c48ec['width']-_0xb9f20c),_0xfcb0c1=Math['min'](Math['max'](_0x409231['offsetTop']||0x0,_0xb9f20c),_0x1cf855-_0x3c48ec['height']-_0xb9f20c);_0x409231['style']['left']=Math['round'](_0x20964c)+'px',_0x409231['style']['top']=Math['round'](_0xfcb0c1)+'px';}}canvasWrapper['addEventListener']('touchend',_0x1f62c9=>{if(_0x1f62c9['changedTouches']['length']>=0x2){const _0x3559b7=performance['now']();_0x3559b7-lastMultiTap<0x15e&&centerCanvasInWrapper(),lastMultiTap=_0x3559b7;}},{'passive':!0x0}),[['brushSizeSliderContainer','brushSizeDragBar'],['brushContainerWrapper','brushContainerDragBar'],['layersPanel','.layers-header']]['forEach'](([_0x521d89,_0x4aa773])=>{const _0x4d1de5=document['getElementById'](_0x521d89),_0x46e1ee=_0x4d1de5&&(_0x4aa773['startsWith']('#')?document['querySelector'](_0x4aa773):_0x4d1de5['querySelector'](_0x4aa773));if(!_0x4d1de5||!_0x46e1ee)return;const _0x2a020d=_0x5b1b8a=>{try{_0x46e1ee['releasePointerCapture'](_0x5b1b8a['pointerId']);}catch{}snapBackIfLost(_0x4d1de5);};_0x46e1ee['addEventListener']('pointerup',_0x2a020d),_0x46e1ee['addEventListener']('pointercancel',_0x2a020d);}),window['addEventListener']('resize',()=>{['brushSizeSliderContainer','brushContainerWrapper','layersPanel']['forEach'](_0x2833c5=>{const _0x24e534=document['getElementById'](_0x2833c5);_0x24e534&&snapBackIfLost(_0x24e534);});});let resizeTimer=null;function updateBrushSize(){const _0x49e98b=canvas['width'];brushSize=Math['min'](brushSize,_0x49e98b/0xa);}function updateCanvasSize(_0x23bd24){if(!_0x23bd24)return;const _0x31432f=window['innerWidth']/window['innerHeight'];let _0x539d50,_0x2dd313;imageAspect=_0x23bd24['width']/_0x23bd24['height'],imageAspect>_0x31432f?(_0x539d50=window['innerWidth'],_0x2dd313=window['innerWidth']/ imageAspect):(_0x2dd313=window['innerHeight'],_0x539d50=window['innerHeight']*imageAspect),canvas['width']=Math['round'](_0x539d50),canvas['height']=Math['round'](_0x2dd313),gl['viewport'](0x0,0x0,canvas['width'],canvas['height']),updateBrushSize(),needsRedraw=!0x0;}function resetStrokeState(){lastX=null,lastY=null,lastFx=null,lastFy=null,void 0x0!==lastDrawTime&&(lastDrawTime=0x0),void 0x0!==soundLastX&&(soundLastX=null),void 0x0!==soundLastY&&(soundLastY=null);}function setDocumentSize(_0x28b9a4,_0x66361f){fixedFBOWidth=_0x28b9a4,fixedFBOHeight=_0x66361f,canvas['width']=_0x28b9a4,canvas['height']=_0x66361f,gl['viewport'](0x0,0x0,_0x28b9a4,_0x66361f),zoomScale=0x1;const _0x4b50ef=canvasWrapper['getBoundingClientRect']();panX=Math['round']((_0x4b50ef['width']-_0x28b9a4)/0x2),panY=Math['round']((_0x4b50ef['height']-_0x66361f)/0x2),updateCanvasTransform(),resetStrokeState(),needsRedraw=!0x0;}window['addEventListener']('resize',()=>{clearTimeout(resizeTimer),resizeTimer=setTimeout(()=>{currentImage&&updateCanvasSize(currentImage),centerCanvasInWrapper?.();},0x78);}),window['addEventListener']('resize',()=>{currentImage&&updateCanvasSize(currentImage);});const audioCtx=new(window['AudioContext']||window['webkitAudioContext'])();let gainNode,noiseNode,filterNode,isDrawingSoundActive=!0x1,soundLastX=null,soundLastY=null,soundIsMoving=!0x1,lastMoveTimestamp=0x0;function unlockAudio(){'suspended'===audioCtx['state']&&audioCtx['resume']();}function createNoiseBuffer(){const _0x4d70c5=audioCtx['sampleRate'],_0x303847=Math['max'](0x1,Math['floor'](0.5*_0x4d70c5)),_0x1a0ea8=audioCtx['createBuffer'](0x1,_0x303847,_0x4d70c5),_0x39c086=_0x1a0ea8['getChannelData'](0x0);for(let _0x396ca0=0x0;_0x396ca0<_0x303847;_0x396ca0++)_0x39c086[_0x396ca0]=Math['random']()>0.9?0.5*(0x2*Math['random']()-0x1):0x0;return _0x1a0ea8;}function startDrawingSound(_0xa70ede=0x1){if(isDrawingSoundActive)return;isDrawingSoundActive=!0x0,unlockAudio(),gainNode=audioCtx['createGain'](),gainNode['gain']['setValueAtTime'](0x0,audioCtx['currentTime']),filterNode=audioCtx['createBiquadFilter'](),filterNode['type']='bandpass';const _0x124210=0.5*audioCtx['sampleRate'],_0x27032b=0x190+0x12c*(Number(_0xa70ede)||0x0),_0x5e33a4=Math['min'](_0x124210-0x14,Math['max'](0xa,_0x27032b));filterNode['frequency']['setValueAtTime'](_0x5e33a4,audioCtx['currentTime']),filterNode['Q']['setValueAtTime'](2.5,audioCtx['currentTime']),noiseNode=audioCtx['createBufferSource'](),noiseNode['buffer']=createNoiseBuffer(),noiseNode['loop']=!0x0,noiseNode['connect'](filterNode),filterNode['connect'](gainNode),gainNode['connect'](audioCtx['destination']),noiseNode['start']();}function updateDrawingSound(_0x4ecc08){if(!isDrawingSoundActive)return;const _0x4c89ac=0.5*audioCtx['sampleRate'],_0x27b453=0x190+0x12c*(Number(_0x4ecc08)||0x0),_0x5a16e2=Math['min'](_0x4c89ac-0x14,Math['max'](0xa,_0x27b453));filterNode['frequency']['linearRampToValueAtTime'](_0x5a16e2,audioCtx['currentTime']+0.05);const _0x2445cb=Math['min'](0.15,0.05*(Number(_0x4ecc08)||0x0)),_0x1a9e34=Math['max'](0x0,Math['min'](0x1,_0x2445cb));gainNode['gain']['linearRampToValueAtTime'](_0x1a9e34,audioCtx['currentTime']+0.05);}function stopDrawingSound(){isDrawingSoundActive&&(isDrawingSoundActive=!0x1,gainNode['gain']['linearRampToValueAtTime'](0x0,audioCtx['currentTime']+0.2),setTimeout(()=>{noiseNode&&(noiseNode['stop'](),noiseNode['disconnect']()),filterNode&&filterNode['disconnect'](),gainNode&&gainNode['disconnect']();},0xc8));}function getTouchPos(_0x726b42){const _0x5bf4e6=_0x726b42['touches']&&_0x726b42['touches'][0x0]?_0x726b42['touches'][0x0]:_0x726b42['changedTouches']&&_0x726b42['changedTouches'][0x0];if(!_0x5bf4e6)return{'x':0x0,'y':0x0};const _0x30cab7=canvasWrapper['getBoundingClientRect'](),_0x1dc522=_0x5bf4e6['clientX']-_0x30cab7['left'],_0x47f836=_0x5bf4e6['clientY']-_0x30cab7['top'],_0xbcf793=screenToCanvasPx(_0x5bf4e6['clientX'],_0x5bf4e6['clientY']);return{'x':_0x1dc522,'y':_0x47f836,'cx':_0xbcf793['x'],'cy':_0xbcf793['y']};}function addSoundEvents(){document['addEventListener']('touchstart',unlockAudio,{'once':!0x0}),document['addEventListener']('click',unlockAudio,{'once':!0x0}),canvas['addEventListener']('mousedown',()=>{soundIsMoving=!0x1;}),canvas['addEventListener']('mousemove',_0x1d91d3=>{if(!isDrawing)return;let _0x54caea=Math['sqrt'](_0x1d91d3['movementX']**0x2+_0x1d91d3['movementY']**0x2);soundIsMoving||(startDrawingSound(_0x54caea),soundIsMoving=!0x0),updateDrawingSound(_0x54caea);}),canvas['addEventListener']('mouseup',()=>{soundIsMoving=!0x1,stopDrawingSound();}),canvas['addEventListener']('mouseleave',()=>{soundIsMoving=!0x1,stopDrawingSound();}),canvas['addEventListener']('touchstart',_0x1c3bf7=>{_0x1c3bf7['preventDefault'](),isDrawing=!0x0,soundLastX=null,soundLastY=null,soundIsMoving=!0x1,lastMoveTimestamp=Date['now']();}),canvas['addEventListener']('touchmove',_0x4865a4=>{if(_0x4865a4['preventDefault'](),!isDrawing)return;const _0x3feb91=getTouchPos(_0x4865a4),_0x343cb5=Date['now']();if(null!==soundLastX&&null!==soundLastY){const _0x480f7b=_0x3feb91['x']-soundLastX,_0x34d389=_0x3feb91['y']-soundLastY,_0x46f56a=Math['sqrt'](_0x480f7b*_0x480f7b+_0x34d389*_0x34d389);if(_0x46f56a>0x1){let _0x487847=_0x46f56a/(_0x343cb5-lastMoveTimestamp+0x1);lastMoveTimestamp=_0x343cb5,soundIsMoving||(startDrawingSound(_0x487847),soundIsMoving=!0x0),updateDrawingSound(_0x487847);}}soundLastX=_0x3feb91['x'],soundLastY=_0x3feb91['y'];}),canvas['addEventListener']('touchend',()=>{soundIsMoving=!0x1,stopDrawingSound();}),canvas['addEventListener']('touchcancel',()=>{soundIsMoving=!0x1,stopDrawingSound();}),setInterval(()=>{isDrawing&&soundIsMoving&&Date['now']()-lastMoveTimestamp>0x64&&(soundIsMoving=!0x1,stopDrawingSound());},0x32);}let lastDrawTime=0x0;function isUserTyping(){const _0x2370d4=document['activeElement'];return _0x2370d4&&('INPUT'===_0x2370d4['tagName']||'TEXTAREA'===_0x2370d4['tagName']||_0x2370d4['isContentEditable']);}canvas['addEventListener']('mousedown',_0x72d9ec=>{if(!canPaint())return;const _0x1107c4=pointerToBoth(_0x72d9ec);if(overlayPosition=[_0x1107c4['cx']/canvas['width'],_0x1107c4['cy']/canvas['height']],'fill'===currentTool)return performFloodFill(_0x1107c4['fx'],_0x1107c4['fy']),needsRedraw=!0x0,void drawScene();isDrawing=!0x0,startRender('draw'),drawBrushStrokeToPaintLayer(_0x1107c4['cx'],_0x1107c4['cy']);}),canvas['addEventListener']('mousemove',_0x2d0901=>{if(!canPaint()&&!isDrawing)return;const _0x470e77=Date['now']();if(_0x470e77-lastDrawTime<0x10)return;lastDrawTime=_0x470e77;const _0x425096=pointerToBoth(_0x2d0901);if(null!==lastX&&null!==lastY){const _0x1da118=_0x425096['cx']-lastX,_0x4b4f41=_0x425096['cy']-lastY;(Math['abs'](_0x1da118)>0.1||Math['abs'](_0x4b4f41)>0.1)&&(currentAngle=Math['atan2'](_0x4b4f41,_0x1da118));}lastX=_0x425096['cx'],lastY=_0x425096['cy'],overlayPosition=[_0x425096['cx']/canvas['width'],_0x425096['cy']/canvas['height']],isDrawing&&canPaint()&&drawBrushStrokeToPaintLayer(_0x425096['cx'],_0x425096['cy']);}),canvas['addEventListener']('mouseup',()=>{isDrawing=!0x1,stopRender('draw'),lastFx=null,lastFy=null;}),canvas['addEventListener']('mouseleave',()=>{isDrawing=!0x1,stopRender('draw'),lastFx=null,lastFy=null;}),canvas['addEventListener']('touchstart',_0x814e36=>{if(_0x814e36['preventDefault'](),!canPaint())return;const _0x31e421=_0x814e36['touches'][0x0];if(!_0x31e421)return;const _0xb3eb55=pointerToBoth(_0x31e421);if(overlayPosition=[_0xb3eb55['cx']/canvas['width'],_0xb3eb55['cy']/canvas['height']],'fill'===currentTool)return performFloodFill(_0xb3eb55['fx'],_0xb3eb55['fy']),needsRedraw=!0x0,void drawScene();isDrawing=!0x0,startRender('draw'),drawBrushStrokeToPaintLayer(_0xb3eb55['cx'],_0xb3eb55['cy']);},{'passive':!0x1}),canvas['addEventListener']('touchmove',_0x2302c6=>{if(_0x2302c6['preventDefault'](),!isDrawing||!canPaint())return;const _0x11fecc=_0x2302c6['touches'][0x0];if(!_0x11fecc)return;const _0xf429ca=Date['now']();if(_0xf429ca-lastDrawTime<0x10)return;lastDrawTime=_0xf429ca;const _0x576a97=pointerToBoth(_0x11fecc);if(null!==lastX&&null!==lastY){const _0x293cdd=_0x576a97['cx']-lastX,_0x39cfbb=_0x576a97['cy']-lastY;(Math['abs'](_0x293cdd)>0.1||Math['abs'](_0x39cfbb)>0.1)&&(currentAngle=Math['atan2'](_0x39cfbb,_0x293cdd));}lastX=_0x576a97['cx'],lastY=_0x576a97['cy'],overlayPosition=[_0x576a97['cx']/canvas['width'],_0x576a97['cy']/canvas['height']],drawBrushStrokeToPaintLayer(_0x576a97['cx'],_0x576a97['cy']);},{'passive':!0x1}),canvas['addEventListener']('touchend',()=>{isDrawing=!0x1,stopRender('draw'),lastFx=null,lastFy=null;},{'passive':!0x0}),canvas['addEventListener']('touchcancel',()=>{isDrawing=!0x1,stopRender('draw'),lastFx=null,lastFy=null;},{'passive':!0x0}),document['addEventListener']('keydown',_0x234e7b=>{if(isUserTyping())return;let _0x5bf8bd=!0x1;if('['===_0x234e7b['key']){brushSize=Math['max'](0.01,brushSize-0.02);const _0xdf8c14=document['getElementById']('brushSizeSlider');_0xdf8c14&&(_0xdf8c14['value']=brushSize),_0x5bf8bd=!0x0,overlayPosition=[lastPointer['cx']/canvas['width'],lastPointer['cy']/canvas['height']],showBrushHUD();}else{if(']'===_0x234e7b['key']){brushSize=Math['min'](0x1,brushSize+0.02);const _0x5d3753=document['getElementById']('brushSizeSlider');_0x5d3753&&(_0x5d3753['value']=brushSize),_0x5bf8bd=!0x0,overlayPosition=[lastPointer['cx']/canvas['width'],lastPointer['cy']/canvas['height']],showBrushHUD();}else{if(_0x234e7b['key']>='0'&&_0x234e7b['key']<='9'){let _0x86ddae='0'===_0x234e7b['key']?0x9:parseInt(_0x234e7b['key'],0xa)-0x1;_0x86ddae>=0x0&&_0x86ddae<brushes['length']&&(selectBrush(brushes[_0x86ddae]['name']),_0x5bf8bd=!0x0,overlayPosition=[lastPointer['cx']/canvas['width'],lastPointer['cy']/canvas['height']],showBrushHUD());}}}_0x5bf8bd&&(needsRedraw=!0x0);});let brushSize=0.02,opacity=0x1,eraseStrength=0.5,paintStrength=0x1;document['addEventListener']('DOMContentLoaded',()=>{const _0x25e6c8=document['getElementById']('brushSizeSlider'),_0x257984=document['getElementById']('brushSizeValue');_0x25e6c8['value']=brushSize,_0x257984['textContent']=brushSize['toFixed'](0x2),_0x25e6c8['addEventListener']('input',_0x178b6b=>{brushSize=parseFloat(_0x178b6b['target']['value']),_0x257984['textContent']=brushSize['toFixed'](0x2),needsRedraw=!0x0,showBrushHUD();});const _0x314b60=document['getElementById']('eraseStrengthSlider'),_0x4c35d6=document['getElementById']('eraseStrengthValue');_0x314b60['value']=eraseStrength,_0x4c35d6['textContent']=eraseStrength['toFixed'](0x2),_0x314b60['addEventListener']('input',_0x5a24d3=>{eraseStrength=parseFloat(_0x5a24d3['target']['value']),_0x4c35d6['textContent']=eraseStrength['toFixed'](0x2),needsRedraw=!0x0,showBrushHUD();});const _0x17bfe0=document['getElementById']('paintStrengthSlider'),_0x25fa7a=document['getElementById']('paintStrengthValue');_0x17bfe0['value']=paintStrength,_0x25fa7a['textContent']=paintStrength['toFixed'](0x2),_0x17bfe0['addEventListener']('input',_0x23af1d=>{paintStrength=parseFloat(_0x23af1d['target']['value']),_0x25fa7a['textContent']=paintStrength['toFixed'](0x2),needsRedraw=!0x0;});});let selectedLayerIndices=new Set();function rebuildLayersUI(){const _0x38f66b=document['getElementById']('layersList');if(!_0x38f66b)return;if(layers?.['length']?0x0===selectedLayerIndices['size']&&Number['isInteger'](activeLayerIndex)&&selectedLayerIndices['add'](activeLayerIndex):selectedLayerIndices['clear'](),!window['__mobileLayerTransformSetup']){const _0x56dd46=canvasWrapper||document['getElementById']('canvasWrapper')||canvas?.['parentElement'];let _0x146da6=null;function _0x4513a3(_0x4170bb){if(isMobile()&&(_0x146da6&&(!_0x4170bb['touches']||_0x4170bb['touches']['length']<0x2)&&(_0x146da6=null),transformTool&&'idle'===transformTool['mode'])){const _0x1eb40e=getActiveLayer();_0x1eb40e&&_0x1eb40e['transformLocked']||(transformTool['mobileCombo']=!0x1);}}_0x56dd46&&(_0x56dd46['addEventListener']('touchstart',function(_0x3eee2a){if(isMobile()&&transformTool&&transformTool['mobileCombo']&&0x2===_0x3eee2a['touches']['length']){_0x3eee2a['preventDefault'](),_0x3eee2a['stopImmediatePropagation']();const _0x4df66e=_0x3eee2a['touches'][0x0],_0xeca177=_0x3eee2a['touches'][0x1],_0x3a48da=_0xeca177['clientX']-_0x4df66e['clientX'],_0x21c518=_0xeca177['clientY']-_0x4df66e['clientY'],_0x25f6f8=Math['hypot'](_0x3a48da,_0x21c518),_0x57d36b=Math['atan2'](_0x21c518,_0x3a48da),_0x2cefd5=getActiveLayer();if(!_0x2cefd5)return;_0x146da6={'dist0':Math['max'](0.000001,_0x25f6f8),'ang0':_0x57d36b,'ref':{'scaleX':Number['isFinite'](_0x2cefd5['scaleX'])?_0x2cefd5['scaleX']:0x1,'scaleY':Number['isFinite'](_0x2cefd5['scaleY'])?_0x2cefd5['scaleY']:0x1,'rotation':Number['isFinite'](_0x2cefd5['rotation'])?_0x2cefd5['rotation']:0x0}};}},{'passive':!0x1,'capture':!0x0}),_0x56dd46['addEventListener']('touchmove',function(_0x56562f){if(isMobile()&&transformTool&&transformTool['mobileCombo']&&0x2===_0x56562f['touches']['length']&&_0x146da6){_0x56562f['preventDefault'](),_0x56562f['stopImmediatePropagation']();const _0x5d7677=_0x56562f['touches'][0x0],_0x226139=_0x56562f['touches'][0x1],_0x5c32b6=_0x226139['clientX']-_0x5d7677['clientX'],_0x571561=_0x226139['clientY']-_0x5d7677['clientY'],_0xc832c8=Math['max'](0.000001,Math['hypot'](_0x5c32b6,_0x571561)),_0x3cad1b=Math['atan2'](_0x571561,_0x5c32b6),_0x287b35=getActiveLayer();if(!_0x287b35)return;const _0x225b14=_0xc832c8/_0x146da6['dist0'];_0x287b35['scaleX']=_0x146da6['ref']['scaleX']*_0x225b14,_0x287b35['scaleY']=_0x146da6['ref']['scaleY']*_0x225b14;let _0x28ca1d=_0x3cad1b-_0x146da6['ang0'];return _0x28ca1d>Math['PI']&&(_0x28ca1d-=0x2*Math['PI']),_0x28ca1d<-Math['PI']&&(_0x28ca1d+=0x2*Math['PI']),_0x287b35['rotation']=_0x146da6['ref']['rotation']+_0x28ca1d,void(needsRedraw=!0x0);}},{'passive':!0x1,'capture':!0x0}),_0x56dd46['addEventListener']('touchend',_0x4513a3,{'passive':!0x0,'capture':!0x0}),_0x56dd46['addEventListener']('touchcancel',_0x4513a3,{'passive':!0x0,'capture':!0x0})),window['__mobileLayerTransformSetup']=!0x0;}_0x38f66b['innerHTML']='';const _0x5a3981=document['createElement']('div');_0x5a3981['className']='layers-header';const _0x319fc1=document['createElement']('button');_0x319fc1['type']='button',_0x319fc1['className']='bs-n',_0x319fc1['textContent']='Merge\x20Selected',_0x319fc1['disabled']=selectedLayerIndices['size']<0x2,_0x319fc1['addEventListener']('click',_0x109983=>{_0x109983['stopPropagation'](),selectedLayerIndices['size']>=0x2&&mergeSelectedLayers();});const _0x23cef7=document['createElement']('button');function _0x140ec1(){_0x319fc1['disabled']=selectedLayerIndices['size']<0x2,_0x319fc1['textContent']=selectedLayerIndices['size']>0x1?'Merge\x20Selected\x20('+selectedLayerIndices['size']+')':'Merge\x20Selected',_0x23cef7['disabled']=!(layers&&layers['length']>=0x2);}function _0x55e4a5(_0xd3ab63,_0x27c2c9){if(!_0x27c2c9)return selectedLayerIndices['clear'](),selectedLayerIndices['add'](_0xd3ab63),void(activeLayerIndex=_0xd3ab63);selectedLayerIndices['has'](_0xd3ab63)?(selectedLayerIndices['delete'](_0xd3ab63),0x0===selectedLayerIndices['size']&&selectedLayerIndices['add'](_0xd3ab63)):(selectedLayerIndices['add'](_0xd3ab63),activeLayerIndex=_0xd3ab63);}_0x23cef7['type']='button',_0x23cef7['className']='bs-n',_0x23cef7['textContent']='Merge\x20All',_0x23cef7['disabled']=!(layers&&layers['length']>=0x2),_0x23cef7['addEventListener']('click',_0x3f6295=>{if(_0x3f6295['stopPropagation'](),layers&&layers['length']>=0x2){selectedLayerIndices['clear']();for(let _0x2cd4ac=0x0;_0x2cd4ac<layers['length'];_0x2cd4ac++)selectedLayerIndices['add'](_0x2cd4ac);mergeSelectedLayers(),selectedLayerIndices['clear'](),Number['isInteger'](activeLayerIndex)&&selectedLayerIndices['add'](activeLayerIndex),rebuildLayersUI();}}),_0x5a3981['appendChild'](_0x319fc1),_0x5a3981['appendChild'](_0x23cef7),_0x38f66b['appendChild'](_0x5a3981),(layers||[])['forEach']((_0x1ada29,_0x5a427d)=>{const _0x1ce9f4=document['createElement']('div'),_0x1b5d2f=_0x5a427d===activeLayerIndex,_0x3b9334=selectedLayerIndices['has'](_0x5a427d);_0x1ce9f4['className']='layer-item'+(_0x1b5d2f?'\x20active':'')+(_0x3b9334?'\x20is-selected':''),_0x1ce9f4['dataset']['index']=String(_0x5a427d);const _0x3c70cb=document['createElement']('div');_0x3c70cb['className']='layer-select';const _0x37f42a=document['createElement']('input');_0x37f42a['type']='checkbox',_0x37f42a['checked']=_0x3b9334,_0x37f42a['title']='Select\x20for\x20merge',_0x37f42a['addEventListener']('click',_0x154e69=>{_0x154e69['stopPropagation'](),_0x55e4a5(_0x5a427d,!0x0),_0x140ec1(),_0x1ce9f4['classList']['toggle']('is-selected',selectedLayerIndices['has'](_0x5a427d));}),_0x3c70cb['appendChild'](_0x37f42a);const _0x67c0c9=document['createElement']('div');_0x67c0c9['className']='layer-vis';const _0x1b1a24=document['createElement']('button');_0x1b1a24['type']='button',_0x1b1a24['className']='bs\x20icon-btn',_0x1b1a24['title']=_0x1ada29['visible']?'Hide\x20layer':'Show\x20layer',_0x1b1a24['setAttribute']('aria-label',(_0x1ada29['visible']?'Hide':'Show')+'\x20'+_0x1ada29['name']);const _0x121f6d='/static/draw/images/icons/show.svg',_0x9a556='/static/draw/images/icons/hide.svg',_0x2bb23c=document['createElement']('img');function _0x3c04bc(){_0x2bb23c['src']=_0x1ada29['visible']?_0x121f6d:_0x9a556,_0x2bb23c['alt']=_0x1ada29['visible']?'Visible':'Hidden',_0x1b1a24['title']=_0x1ada29['visible']?'Hide\x20layer':'Show\x20layer',_0x1b1a24['setAttribute']('aria-label',(_0x1ada29['visible']?'Hide':'Show')+'\x20'+_0x1ada29['name']);}_0x2bb23c['alt']=_0x1ada29['visible']?'Visible':'Hidden',_0x2bb23c['src']=_0x1ada29['visible']?_0x121f6d:_0x9a556,_0x2bb23c['style']['pointerEvents']='none',_0x1b1a24['appendChild'](_0x2bb23c),_0x1b1a24['addEventListener']('click',_0x4b820a=>{_0x4b820a['stopPropagation'](),clearTransformLockAll(),_0x1ada29['visible']=!_0x1ada29['visible'],_0x3c04bc(),needsRedraw=!0x0;}),_0x67c0c9['appendChild'](_0x1b1a24);const _0x369246=document['createElement']('button');_0x369246['type']='button',_0x369246['className']='bs\x20icon-btn\x20transform-btn',_0x369246['title']='Transform\x20layer',_0x369246['setAttribute']('aria-label','Transform\x20'+_0x1ada29['name']),_0x369246['innerHTML']='<img\x20src=\x22/static/draw/images/icons/transform.svg\x22\x20alt=\x22Transform\x22>',isMobile()||(_0x369246['style']['display']='none'),isMobile()&&_0x1ada29['transformLocked']&&_0x1b5d2f?_0x369246['classList']['add']('is-active'):_0x369246['classList']['remove']('is-active'),_0x369246['addEventListener']('click',_0x272e2b=>{_0x272e2b['stopPropagation'](),activeLayerIndex!==_0x5a427d&&(clearTransformLockAll(),activeLayerIndex=_0x5a427d,syncActiveAliases?.(),rebuildLayersUI());const _0x5b7536=!!_0x1ada29['transformLocked'];setLayerTransformLock(_0x5a427d,!_0x5b7536),_0x369246['classList']['toggle']('is-active',!_0x5b7536),showStatusMessage?.(_0x5b7536?'Transform\x20unlocked':'Transform\x20locked:\x20drag\x20to\x20move,\x20pinch\x20to\x20scale/rotate','info'),needsRedraw=!0x0;}),_0x67c0c9['appendChild'](_0x369246);const _0x1d22da=document['createElement']('div');_0x1d22da['className']='layer-name';const _0xa5c6e9=document['createElement']('input');_0xa5c6e9['value']=_0x1ada29['name'],_0xa5c6e9['title']='Rename\x20layer',_0xa5c6e9['setAttribute']('aria-label','Rename\x20'+_0x1ada29['name']),_0xa5c6e9['addEventListener']('click',_0x3dbf31=>_0x3dbf31['stopPropagation']()),_0xa5c6e9['addEventListener']('mousedown',()=>{activeLayerIndex=_0x5a427d;}),_0xa5c6e9['addEventListener']('focus',()=>{activeLayerIndex=_0x5a427d;});const _0x33f028=()=>{const _0x9c1ac9=_0xa5c6e9['value'];_0x9c1ac9!==_0x1ada29['name']&&(_0x1ada29['name']=_0x9c1ac9,_0x3c04bc());};_0xa5c6e9['addEventListener']('change',_0x33f028),_0xa5c6e9['addEventListener']('blur',_0x33f028),_0x1d22da['appendChild'](_0xa5c6e9);const _0x43b744=document['createElement']('div');_0x43b744['className']='layer-ops';const _0x53264f=document['createElement']('button');_0x53264f['type']='button',_0x53264f['className']='bs\x20icon-btn',_0x53264f['title']='Duplicate\x20layer',_0x53264f['setAttribute']('aria-label','Duplicate\x20layer'),_0x53264f['innerHTML']='<img\x20src=\x22/static/draw/images/icons/clone.svg\x22\x20alt=\x22\x22\x20style=\x22pointer-events:none\x22\x20width=\x2218\x22\x20height=\x2218\x22>',_0x53264f['addEventListener']('click',_0xf9c0f7=>{_0xf9c0f7['stopPropagation'](),clearTransformLockAll(),duplicateLayer(_0x5a427d);});const _0x49f007=document['createElement']('button');_0x49f007['type']='button',_0x49f007['className']='bs\x20icon-btn',_0x49f007['title']='Move\x20up',_0x49f007['setAttribute']('aria-label','Move\x20layer\x20up'),_0x49f007['innerHTML']='<img\x20src=\x22/static/draw/images/icons/up-shevron.svg\x22\x20alt=\x22\x22\x20style=\x22pointer-events:none\x22\x20width=\x2218\x22\x20height=\x2218\x22>',_0x49f007['addEventListener']('click',_0x183758=>{_0x183758['stopPropagation'](),clearTransformLockAll(),moveLayerUp(_0x5a427d);});const _0x596e53=document['createElement']('button');_0x596e53['type']='button',_0x596e53['className']='bs\x20icon-btn',_0x596e53['title']='Move\x20down',_0x596e53['setAttribute']('aria-label','Move\x20layer\x20down'),_0x596e53['innerHTML']='<img\x20src=\x22/static/draw/images/icons/down-shevron.svg\x22\x20alt=\x22\x22\x20style=\x22pointer-events:none\x22\x20width=\x2218\x22\x20height=\x2218\x22>',_0x596e53['addEventListener']('click',_0x5e0b7e=>{_0x5e0b7e['stopPropagation'](),clearTransformLockAll(),moveLayerDown(_0x5a427d);}),_0x43b744['appendChild'](_0x53264f),_0x43b744['appendChild'](_0x49f007),_0x43b744['appendChild'](_0x596e53);const _0x43bfb9=document['createElement']('div');_0x43bfb9['className']='layer-opacity';const _0x24d4b5=document['createElement']('span');_0x24d4b5['textContent']='Opacity';const _0x2c7478=document['createElement']('input');_0x2c7478['type']='range',_0x2c7478['min']='0',_0x2c7478['max']='1',_0x2c7478['step']='0.01',_0x2c7478['value']=String(_0x1ada29['opacity']),['click','mousedown','touchstart','keydown']['forEach'](_0x2316c5=>_0x2c7478['addEventListener'](_0x2316c5,_0x54347f=>_0x54347f['stopPropagation']())),_0x2c7478['addEventListener']('input',()=>{clearTransformLockAll();const _0x445dae=parseFloat(_0x2c7478['value']);Number['isNaN'](_0x445dae)||_0x445dae===_0x1ada29['opacity']||(_0x1ada29['opacity']=Math['max'](0x0,Math['min'](0x1,_0x445dae)),needsRedraw=!0x0);}),_0x43bfb9['appendChild'](_0x24d4b5),_0x43bfb9['appendChild'](_0x2c7478),_0x1ce9f4['appendChild'](_0x3c70cb),_0x1ce9f4['appendChild'](_0x67c0c9),_0x1ce9f4['appendChild'](_0x1d22da),_0x1ce9f4['appendChild'](_0x43b744),_0x1ce9f4['appendChild'](_0x43bfb9),_0x1ce9f4['addEventListener']('click',_0x393c97=>{const _0x11f4ee=!(!_0x393c97['ctrlKey']&&!_0x393c97['metaKey']),_0x545375=!!_0x393c97['shiftKey'];if(clearTransformLockAll(),_0x545375)!function(_0x33b01a){if(0x0===selectedLayerIndices['size'])return selectedLayerIndices['add'](_0x33b01a),void(activeLayerIndex=_0x33b01a);const _0x6ae6f4=activeLayerIndex??_0x33b01a,_0x4cd9ac=Math['min'](_0x6ae6f4,_0x33b01a),_0x348349=Math['max'](_0x6ae6f4,_0x33b01a);selectedLayerIndices['clear']();for(let _0xbb15a3=_0x4cd9ac;_0xbb15a3<=_0x348349;_0xbb15a3++)selectedLayerIndices['add'](_0xbb15a3);activeLayerIndex=_0x33b01a;}(_0x5a427d);else{if(!_0x11f4ee)return void function(_0x12be07,_0x14418a){clearTransformLockAll(),activeLayerIndex=_0x12be07,selectedLayerIndices['clear'](),selectedLayerIndices['add'](_0x12be07),syncActiveAliases?.(),rebuildLayersUI(),showStatusMessage?.('Selected:\x20'+_0x14418a['name'],'info'),needsRedraw=!0x0;}(_0x5a427d,_0x1ada29);_0x55e4a5(_0x5a427d,!0x0),activeLayerIndex=_0x5a427d;}document['querySelectorAll']('#layersList\x20.layer-item')['forEach'](_0xcb2352=>{const _0x2ad745=Number(_0xcb2352['dataset']['index']);_0xcb2352['classList']['toggle']('is-selected',selectedLayerIndices['has'](_0x2ad745)),_0xcb2352['classList']['toggle']('active',_0x2ad745===activeLayerIndex);}),_0x140ec1();}),_0x38f66b['insertBefore'](_0x1ce9f4,_0x38f66b['children'][0x1]||null);}),_0x140ec1();}function clearActiveLayer(){const _0x269b72='function'==typeof getActiveLayer?getActiveLayer():layers?.[activeLayerIndex];if(!(gl&&_0x269b72&&_0x269b72['fbo']&&_0x269b72['texture']))return;const _0x619d66=snapshotLayer(activeLayerIndex),_0x1da8cb=0x0|fixedFBOWidth,_0x4dfe2f=0x0|fixedFBOHeight,_0x5c536a=gl['getParameter'](gl['FRAMEBUFFER_BINDING']),_0x288301=gl['getParameter'](gl['VIEWPORT']);gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x269b72['fbo']),gl['viewport'](0x0,0x0,_0x1da8cb,_0x4dfe2f),gl['disable'](gl['BLEND']),gl['clearColor'](0x0,0x0,0x0,0x0),gl['clear'](gl['COLOR_BUFFER_BIT']),gl['bindTexture'](gl['TEXTURE_2D'],_0x269b72['texture']),(0x0|_0x269b72['texW'])===_0x1da8cb&&(0x0|_0x269b72['texH'])===_0x4dfe2f||(gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],_0x1da8cb,_0x4dfe2f,0x0,gl['RGBA'],gl['UNSIGNED_BYTE'],null),_0x269b72['texW']=_0x1da8cb,_0x269b72['texH']=_0x4dfe2f,gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x269b72['fbo']),gl['framebufferTexture2D'](gl['FRAMEBUFFER'],gl['COLOR_ATTACHMENT0'],gl['TEXTURE_2D'],_0x269b72['texture'],0x0)),gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x5c536a),_0x288301&&gl['viewport'](_0x288301[0x0],_0x288301[0x1],_0x288301[0x2],_0x288301[0x3]);const _0x5c6fea=snapshotLayer(activeLayerIndex);_0x619d66&&_0x5c6fea&&History['push']({'type':'clear_layer','index':activeLayerIndex,'before':_0x619d66,'after':_0x5c6fea}),needsRedraw=!0x0,requestDrawIfIdle?.(),showStatusMessage?.('Layer\x20cleared','info');}function removeActiveLayer(){if(layers['length']<=0x1)return void showStatusMessage('Need\x20at\x20least\x20one\x20layer','warning');const [_0x4a06ae]=layers['splice'](activeLayerIndex,0x1);gl['deleteTexture'](_0x4a06ae['texture']),gl['deleteFramebuffer'](_0x4a06ae['fbo']),activeLayerIndex=Math['max'](0x0,activeLayerIndex-0x1),syncActiveAliases(),rebuildLayersUI(),needsRedraw=!0x0;}function moveLayerUp(_0x33502f){_0x33502f>=layers['length']-0x1||([layers[_0x33502f],layers[_0x33502f+0x1]]=[layers[_0x33502f+0x1],layers[_0x33502f]],activeLayerIndex===_0x33502f?activeLayerIndex=_0x33502f+0x1:activeLayerIndex===_0x33502f+0x1&&(activeLayerIndex=_0x33502f),syncActiveAliases(),rebuildLayersUI(),needsRedraw=!0x0);}function moveLayerDown(_0x4e318e){_0x4e318e<=0x0||([layers[_0x4e318e],layers[_0x4e318e-0x1]]=[layers[_0x4e318e-0x1],layers[_0x4e318e]],activeLayerIndex===_0x4e318e?activeLayerIndex=_0x4e318e-0x1:activeLayerIndex===_0x4e318e-0x1&&(activeLayerIndex=_0x4e318e),syncActiveAliases(),rebuildLayersUI(),needsRedraw=!0x0);}function initFloodFillProgram(){floodFillProgram=createProgram(gl,'\x0a\x20\x20\x20\x20\x20\x20\x20\x20attribute\x20vec2\x20aPosition;\x0a\x20\x20\x20\x20\x20\x20\x20\x20varying\x20vec2\x20vTexCoord;\x0a\x20\x20\x20\x20\x20\x20\x20\x20void\x20main()\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20vTexCoord\x20=\x20(aPosition\x20+\x201.0)\x20*\x200.5;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20vec4(aPosition,\x200.0,\x201.0);\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20precision\x20mediump\x20float;\x0a\x20\x20\x20\x20\x20\x20\x20\x20varying\x20vec2\x20vTexCoord;\x0a\x20\x20\x20\x20\x20\x20\x20\x20uniform\x20sampler2D\x20uSource;\x0a\x20\x20\x20\x20\x20\x20\x20\x20uniform\x20vec4\x20uTargetColor;\x0a\x20\x20\x20\x20\x20\x20\x20\x20uniform\x20vec4\x20uFillColor;\x0a\x20\x20\x20\x20\x20\x20\x20\x20uniform\x20vec2\x20uTexelSize;\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20void\x20main()\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20vec4\x20current\x20=\x20texture2D(uSource,\x20vTexCoord);\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20float\x20threshold\x20=\x200.01;\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20bool\x20isTarget\x20=\x20distance(current,\x20uTargetColor)\x20<\x20threshold;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20bool\x20isFilled\x20=\x20distance(current,\x20uFillColor)\x20<\x20threshold;\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(isFilled)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20gl_FragColor\x20=\x20uFillColor;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20Check\x20neighbors:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20vec2\x20offsets[8];\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20offsets[0]\x20=\x20vec2(-uTexelSize.x,\x200.0);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20offsets[1]\x20=\x20vec2(uTexelSize.x,\x200.0);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20offsets[2]\x20=\x20vec2(0.0,\x20-uTexelSize.y);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20offsets[3]\x20=\x20vec2(0.0,\x20uTexelSize.y);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20offsets[4]\x20=\x20vec2(-uTexelSize.x,\x20-uTexelSize.y);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20offsets[5]\x20=\x20vec2(-uTexelSize.x,\x20uTexelSize.y);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20offsets[6]\x20=\x20vec2(uTexelSize.x,\x20-uTexelSize.y);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20offsets[7]\x20=\x20vec2(uTexelSize.x,\x20uTexelSize.y);\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20vec2\x20offsets[4];\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20offsets[0]\x20=\x20vec2(-uTexelSize.x,\x200.0);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20offsets[1]\x20=\x20vec2(uTexelSize.x,\x200.0);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20offsets[2]\x20=\x20vec2(0.0,\x20-uTexelSize.y);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20offsets[3]\x20=\x20vec2(0.0,\x20uTexelSize.y);\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20for\x20(int\x20i\x20=\x200;\x20i\x20<\x208;\x20i++)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20vec4\x20neighbor\x20=\x20texture2D(uSource,\x20vTexCoord\x20+\x20offsets[i]);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20bool\x20neighborFilled\x20=\x20distance(neighbor,\x20uFillColor)\x20<\x20threshold;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(neighborFilled\x20&&\x20isTarget)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20gl_FragColor\x20=\x20uFillColor;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20for\x20(int\x20i\x20=\x200;\x20i\x20<\x204;\x20i++)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20\x20\x20\x20\x20vec4\x20neighbor\x20=\x20texture2D(uSource,\x20vTexCoord\x20+\x20offsets[i]);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20\x20\x20\x20\x20bool\x20neighborFilled\x20=\x20distance(neighbor,\x20uFillColor)\x20<\x20threshold;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20\x20\x20\x20\x20if\x20(neighborFilled\x20&&\x20isTarget)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20\x20\x20\x20\x20\x20\x20\x20\x20gl_FragColor\x20=\x20uFillColor;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20\x20\x20\x20\x20\x20\x20\x20\x20return;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20gl_FragColor\x20=\x20current;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20');}function performFloodFill(_0x49106d,_0x5e86c6){const _0x31310c=getActiveLayer();if(!_0x31310c)return;const _0x35fcc0=snapshotLayer(activeLayerIndex),_0x224a9a=Math['max'](0x0,Math['min'](fixedFBOWidth-0x1,Math['round'](_0x49106d))),_0x1efc45=Math['max'](0x0,Math['min'](fixedFBOHeight-0x1,Math['round'](_0x5e86c6))),_0x1b9ee5=fixedFBOHeight-0x1-_0x1efc45,_0x56613b=new Uint8Array(0x4);gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x31310c['fbo']),gl['readPixels'](_0x224a9a,_0x1b9ee5,0x1,0x1,gl['RGBA'],gl['UNSIGNED_BYTE'],_0x56613b),gl['bindFramebuffer'](gl['FRAMEBUFFER'],null),runFloodFillShader(_0x31310c,[_0x56613b[0x0]/0xff,_0x56613b[0x1]/0xff,_0x56613b[0x2]/0xff,_0x56613b[0x3]/0xff],tintColor);const _0x2185db=snapshotLayer(activeLayerIndex);History['push']({'type':'fill','before':_0x35fcc0,'after':_0x2185db}),needsRedraw=!0x0;}function runFloodFillShader(_0x57daa2,_0x3c27c8,_0x3885fe){let _0x302471=fillFBO1,_0x12fdef=fillFBO2;gl['bindFramebuffer'](gl['READ_FRAMEBUFFER'],_0x57daa2['fbo']),gl['bindFramebuffer'](gl['DRAW_FRAMEBUFFER'],_0x302471['fbo']),gl['viewport'](0x0,0x0,fixedFBOWidth,fixedFBOHeight),gl['blitFramebuffer'](0x0,0x0,fixedFBOWidth,fixedFBOHeight,0x0,0x0,fixedFBOWidth,fixedFBOHeight,gl['COLOR_BUFFER_BIT'],gl['NEAREST']);const _0x14a8c9=new Float32Array([-0x1,-0x1,0x1,-0x1,-0x1,0x1,-0x1,0x1,0x1,-0x1,0x1,0x1]),_0x54cd31=gl['createBuffer']();gl['bindBuffer'](gl['ARRAY_BUFFER'],_0x54cd31),gl['bufferData'](gl['ARRAY_BUFFER'],_0x14a8c9,gl['STATIC_DRAW']);const _0x582430=gl['getAttribLocation'](floodFillProgram,'aPosition');gl['enableVertexAttribArray'](_0x582430),gl['vertexAttribPointer'](_0x582430,0x2,gl['FLOAT'],!0x1,0x0,0x0);for(let _0x3ed69f=0x0;_0x3ed69f<0x32;_0x3ed69f++){gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x12fdef['fbo']),gl['viewport'](0x0,0x0,fixedFBOWidth,fixedFBOHeight),gl['useProgram'](floodFillProgram),gl['activeTexture'](gl['TEXTURE0']),gl['bindTexture'](gl['TEXTURE_2D'],_0x302471['texture']),gl['uniform1i'](gl['getUniformLocation'](floodFillProgram,'uSource'),0x0),gl['uniform4fv'](gl['getUniformLocation'](floodFillProgram,'uTargetColor'),_0x3c27c8),gl['uniform4fv'](gl['getUniformLocation'](floodFillProgram,'uFillColor'),_0x3885fe),gl['uniform2f'](gl['getUniformLocation'](floodFillProgram,'uTexelSize'),0x1/fixedFBOWidth,0x1/fixedFBOHeight),gl['drawArrays'](gl['TRIANGLES'],0x0,0x6);let _0x5a3a57=_0x302471;_0x302471=_0x12fdef,_0x12fdef=_0x5a3a57;}gl['bindFramebuffer'](gl['READ_FRAMEBUFFER'],_0x302471['fbo']),gl['bindFramebuffer'](gl['DRAW_FRAMEBUFFER'],_0x57daa2['fbo']),gl['viewport'](0x0,0x0,fixedFBOWidth,fixedFBOHeight),gl['blitFramebuffer'](0x0,0x0,fixedFBOWidth,fixedFBOHeight,0x0,0x0,fixedFBOWidth,fixedFBOHeight,gl['COLOR_BUFFER_BIT'],gl['NEAREST']),gl['disableVertexAttribArray'](_0x582430),gl['deleteBuffer'](_0x54cd31),gl['bindFramebuffer'](gl['FRAMEBUFFER'],null);}function createFBO(_0x5d0701,_0xe650dd){const _0x541e7c=gl['createTexture']();gl['bindTexture'](gl['TEXTURE_2D'],_0x541e7c),gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],_0x5d0701,_0xe650dd,0x0,gl['RGBA'],gl['UNSIGNED_BYTE'],null),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MIN_FILTER'],gl['NEAREST']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MAG_FILTER'],gl['NEAREST']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_S'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_T'],gl['CLAMP_TO_EDGE']);const _0x4a104f=gl['createFramebuffer']();return gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x4a104f),gl['framebufferTexture2D'](gl['FRAMEBUFFER'],gl['COLOR_ATTACHMENT0'],gl['TEXTURE_2D'],_0x541e7c,0x0),gl['bindFramebuffer'](gl['FRAMEBUFFER'],null),{'fbo':_0x4a104f,'texture':_0x541e7c};}!(function(){function _0x590203(_0x9e175c){if('function'==typeof isUserTyping&&isUserTyping())return;const _0x53eaf4=_0x9e175c['key'];!('Delete'===_0x53eaf4)&&!('Backspace'===_0x53eaf4)||_0x9e175c['metaKey']||_0x9e175c['ctrlKey']||_0x9e175c['altKey']||(_0x9e175c['preventDefault'](),clearActiveLayer());}try{document['removeEventListener']('keydown',_0x590203,!0x0);}catch{}document['addEventListener']('keydown',_0x590203,!0x0);}()),document['getElementById']('addLayerBtn')['addEventListener']('click',()=>{addLayer('Layer\x20'+(layers['length']+0x1),activeLayerIndex);}),document['getElementById']('removeLayerBtn')['addEventListener']('click',()=>{removeActiveLayer();}),(function(){const _0x1af7f3=document['getElementById']('addLayerBtn');if(_0x1af7f3){try{document['removeEventListener']('keydown',_0x38672c,!0x0);}catch{}document['addEventListener']('keydown',_0x38672c,!0x0);}function _0x38672c(_0x50bc5b){if('function'==typeof isUserTyping&&isUserTyping())return;if(_0x50bc5b['metaKey']||_0x50bc5b['ctrlKey']||_0x50bc5b['altKey'])return;const _0x4ca2f1=_0x50bc5b['key']||'';'n'!==_0x4ca2f1&&'N'!==_0x4ca2f1||(_0x50bc5b['preventDefault'](),(function(){try{_0x1af7f3['click'](),console['log']('[Shortcut]\x20New\x20Layer\x20via\x20\x27n\x27\x20→\x20addBtn.click()');}catch(_0x1dcb93){try{const _0x51cb2f='Layer\x20'+(layers['length']+0x1),_0x5e63cc='number'==typeof activeLayerIndex?activeLayerIndex:layers['length']-0x1;addLayer(_0x51cb2f,_0x5e63cc),console['log']('[Shortcut]\x20New\x20Layer\x20fallback\x20→\x20addLayer()',{'name':_0x51cb2f,'insertBelowIndex':_0x5e63cc});}catch(_0xc75ad){console['warn']('[Shortcut]\x20New\x20Layer\x20failed',_0xc75ad);}}}()));}}()),document['addEventListener']('keydown',_0x323c2e=>{if(isUserTyping())return;if(spacePanning||isDrawing)return;if(_0x323c2e['ctrlKey']||_0x323c2e['metaKey']||_0x323c2e['altKey'])return;if('x'===_0x323c2e['key']['toLowerCase']()||'Delete'===_0x323c2e['key']){if(_0x323c2e['preventDefault'](),_0x323c2e['stopImmediatePropagation'](),transformTool?.['mode']&&'idle'!==transformTool['mode']&&endTransform(!0x1),layers['length']<=0x1)return void showStatusMessage('Need\x20at\x20least\x20one\x20layer','warning');const _0x4ff24d=layers[activeLayerIndex]?.['name']||'Layer';removeActiveLayer(),showStatusMessage('Deleted:\x20'+_0x4ff24d,'success');}},{'capture':!0x0});let fillFBO1=null,fillFBO2=null;function initFloodFBOs(){fillFBO1&&(gl['deleteTexture'](fillFBO1['texture']),gl['deleteFramebuffer'](fillFBO1['fbo'])),fillFBO2&&(gl['deleteTexture'](fillFBO2['texture']),gl['deleteFramebuffer'](fillFBO2['fbo'])),fillFBO1=createFBO(fixedFBOWidth,fixedFBOHeight),fillFBO2=createFBO(fixedFBOWidth,fixedFBOHeight);}let strokeCount=0x0;const FLATTEN_THRESHOLD=isMobile()?0x32:0x96;function flattenStrokes(){const _0x267865=getActiveLayer?.();if(!(gl&&_0x267865&&_0x267865['texture']&&quadProgram))return;const _0x2a8326=Math['max'](0x1,0x0|_0x267865['texW']),_0x1035c4=Math['max'](0x1,0x0|_0x267865['texH']),_0x2f9a63=gl['getParameter'](gl['FRAMEBUFFER_BINDING']),_0x4341d4=gl['getParameter'](gl['CURRENT_PROGRAM']),_0x1c0905=gl['getParameter'](gl['VIEWPORT']),_0x39f7e6=gl['createTexture']();gl['bindTexture'](gl['TEXTURE_2D'],_0x39f7e6),gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],_0x2a8326,_0x1035c4,0x0,gl['RGBA'],gl['UNSIGNED_BYTE'],null),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MIN_FILTER'],gl['NEAREST']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MAG_FILTER'],gl['NEAREST']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_S'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_T'],gl['CLAMP_TO_EDGE']);const _0x2a742c=gl['createFramebuffer']();gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x2a742c),gl['framebufferTexture2D'](gl['FRAMEBUFFER'],gl['COLOR_ATTACHMENT0'],gl['TEXTURE_2D'],_0x39f7e6,0x0),gl['viewport'](0x0,0x0,_0x2a8326,_0x1035c4),gl['disable'](gl['BLEND']),gl['clearColor'](0x0,0x0,0x0,0x0),gl['clear'](gl['COLOR_BUFFER_BIT']),gl['useProgram'](quadProgram);const _0x7af895=gl['getUniformLocation'](quadProgram,'u_flipY');_0x7af895&&gl['uniform1f'](_0x7af895,0x1);const _0x4444ad=gl['getUniformLocation'](quadProgram,'u_resolution');_0x4444ad&&gl['uniform2f'](_0x4444ad,_0x2a8326,_0x1035c4);const _0x67be95=gl['getUniformLocation'](quadProgram,'u_layerOpacity');_0x67be95&&gl['uniform1f'](_0x67be95,0x1);const _0x431dcc=gl['getUniformLocation'](quadProgram,'u_texture'),_0x4b7fb1=new Float32Array([0x0,0x0,0x0,0x0,_0x2a8326,0x0,0x1,0x0,0x0,_0x1035c4,0x0,0x1,0x0,_0x1035c4,0x0,0x1,_0x2a8326,0x0,0x1,0x0,_0x2a8326,_0x1035c4,0x1,0x1]),_0x20d0c9=gl['createBuffer']();gl['bindBuffer'](gl['ARRAY_BUFFER'],_0x20d0c9),gl['bufferData'](gl['ARRAY_BUFFER'],_0x4b7fb1,gl['STREAM_DRAW']);const _0x237157=gl['getAttribLocation'](quadProgram,'a_position'),_0x424849=gl['getAttribLocation'](quadProgram,'a_texCoord');gl['enableVertexAttribArray'](_0x237157),gl['vertexAttribPointer'](_0x237157,0x2,gl['FLOAT'],!0x1,0x10,0x0),gl['enableVertexAttribArray'](_0x424849),gl['vertexAttribPointer'](_0x424849,0x2,gl['FLOAT'],!0x1,0x10,0x8),gl['activeTexture'](gl['TEXTURE0']),gl['bindTexture'](gl['TEXTURE_2D'],_0x267865['texture']),_0x431dcc&&gl['uniform1i'](_0x431dcc,0x0),gl['drawArrays'](gl['TRIANGLES'],0x0,0x6),gl['disableVertexAttribArray'](_0x237157),gl['disableVertexAttribArray'](_0x424849),gl['bindBuffer'](gl['ARRAY_BUFFER'],null),gl['deleteBuffer'](_0x20d0c9);const _0x53b5f5=_0x267865['texture'],_0x2d7a28=_0x267865['fbo'];_0x267865['texture']=_0x39f7e6,_0x267865['fbo']=_0x2a742c;try{_0x53b5f5&&gl['deleteTexture'](_0x53b5f5);}catch{}try{_0x2d7a28&&gl['deleteFramebuffer'](_0x2d7a28);}catch{}try{strokeCount=0x0;}catch{}gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x2f9a63),gl['useProgram'](_0x4341d4),_0x1c0905&&gl['viewport'](_0x1c0905[0x0],_0x1c0905[0x1],_0x1c0905[0x2],_0x1c0905[0x3]),needsRedraw=!0x0,requestDrawIfIdle?.();}let currentAngle=0x0,sharedBuffer=null;function createPaperImage(_0x25e203,_0x3460dd){return new Promise((_0x28d04a,_0xd05829)=>{try{const _0x3dac42=document['createElement']('canvas');_0x3dac42['width']=Math['max'](0x1,Math['floor'](_0x25e203)),_0x3dac42['height']=Math['max'](0x1,Math['floor'](_0x3460dd));const _0x3fad1b=_0x3dac42['getContext']('2d');_0x3fad1b['fillStyle']='#f2efe4',_0x3fad1b['fillRect'](0x0,0x0,_0x3dac42['width'],_0x3dac42['height']);const _0x4c1cbb=document['createElement']('canvas');_0x4c1cbb['width']=_0x3dac42['width'],_0x4c1cbb['height']=_0x3dac42['height'];const _0x4af329=_0x4c1cbb['getContext']('2d'),_0x3455e9=_0x4af329['createImageData'](_0x4c1cbb['width'],_0x4c1cbb['height']);for(let _0x30ee01=0x0;_0x30ee01<_0x3455e9['data']['length'];_0x30ee01+=0x4){const _0x51eb4c=0x32*Math['random']()-0x19;_0x3455e9['data'][_0x30ee01]=0xf0+_0x51eb4c,_0x3455e9['data'][_0x30ee01+0x1]=0xeb+_0x51eb4c,_0x3455e9['data'][_0x30ee01+0x2]=0xe1+_0x51eb4c,_0x3455e9['data'][_0x30ee01+0x3]=0xff;}_0x4af329['putImageData'](_0x3455e9,0x0,0x0),_0x3fad1b['globalAlpha']=0.2,_0x3fad1b['drawImage'](_0x4c1cbb,0x0,0x0),_0x3fad1b['globalAlpha']=0x1;const _0x42d369=document['createElement']('canvas');_0x42d369['width']=_0x3dac42['width'],_0x42d369['height']=_0x3dac42['height'];const _0x33e193=_0x42d369['getContext']('2d'),_0x5b0c92=_0x33e193['createImageData'](_0x42d369['width'],_0x42d369['height']);for(let _0x271091=0x0;_0x271091<_0x5b0c92['data']['length'];_0x271091+=0x4){const _0x5d860a=0xff*Math['random']();_0x5b0c92['data'][_0x271091]=_0x5d860a,_0x5b0c92['data'][_0x271091+0x1]=_0x5d860a,_0x5b0c92['data'][_0x271091+0x2]=_0x5d860a,_0x5b0c92['data'][_0x271091+0x3]=0x5a*Math['random']();}_0x33e193['putImageData'](_0x5b0c92,0x0,0x0),_0x3fad1b['globalAlpha']=0.08,_0x3fad1b['drawImage'](_0x42d369,0x0,0x0),_0x3fad1b['globalAlpha']=0x1;const _0x4dcb8e=_0x3fad1b['createRadialGradient'](_0x3dac42['width']/0x2,_0x3dac42['height']/0x2,0.3*Math['min'](_0x3dac42['width'],_0x3dac42['height']),_0x3dac42['width']/0x2,_0x3dac42['height']/0x2,0.6*Math['max'](_0x3dac42['width'],_0x3dac42['height']));_0x4dcb8e['addColorStop'](0x0,'rgba(0,0,0,0)'),_0x4dcb8e['addColorStop'](0x1,'rgba(0,0,0,0.35)'),_0x3fad1b['globalAlpha']=0.3,_0x3fad1b['fillStyle']=_0x4dcb8e,_0x3fad1b['fillRect'](0x0,0x0,_0x3dac42['width'],_0x3dac42['height']),_0x3fad1b['globalAlpha']=0x1;const _0x5dde51=new Image();_0x5dde51['onload']=()=>_0x28d04a(_0x5dde51),_0x5dde51['onerror']=_0xd05829,_0x5dde51['src']=_0x3dac42['toDataURL']('image/png');}catch(_0x1ba0a4){_0xd05829(_0x1ba0a4);}});}async function resetToBasePaper(){const _0x22b0ef=Number(fixedFBOWidth)>0x0?fixedFBOWidth:window['innerWidth'],_0x407b1b=Number(fixedFBOHeight)>0x0?fixedFBOHeight:window['innerHeight'],_0x5d8fed=await createPaperImage(_0x22b0ef,_0x407b1b);currentImage=_0x5d8fed,fixedFBOWidth=_0x5d8fed['width'],fixedFBOHeight=_0x5d8fed['height'],initPaintLayerFixed(),initFloodFBOs?.(),updateCanvasSize(_0x5d8fed),createTextureFromImage(_0x5d8fed),canvas['offsetWidth'],canvasWrapper['offsetWidth'],zoomScale=0x1,panX=(canvasWrapper['clientWidth']-canvas['width'])/0x2,panY=(canvasWrapper['clientHeight']-canvas['height'])/0x2,viewRotation=0x0,updateCanvasTransform(),resetStrokeState?.(),rebuildLayersUI?.(),needsRedraw=!0x0,requestDrawIfIdle?.();}async function clearProject(){try{console['log']('[ClearProject]\x20begin');const _0x53fe46=History['_captureProject']?.();try{Array['isArray'](layers)&&layers['forEach'](_0x2e9f50=>{try{gl['deleteTexture'](_0x2e9f50['texture']);}catch{}try{gl['deleteFramebuffer'](_0x2e9f50['fbo']);}catch{}});}catch(_0x19b6e7){console['warn']('[ClearProject]\x20disposing\x20old\x20layers\x20warning:',_0x19b6e7);}await resetToBasePaper();const _0x248899=History['_captureProject']?.();History['push']({'type':'clear_project','beforeAll':_0x53fe46,'afterAll':_0x248899}),showStatusMessage?.('Project\x20cleared\x20to\x20base\x20paper','success'),console['log']('[ClearProject]\x20done');}catch(_0x589f7f){console['error']('[ClearProject]\x20fatal\x20error:',_0x589f7f),showStatusMessage?.('Clear\x20failed','error');}}((()=>{const _0x45b0e6=document['getElementById']('cleanButton');_0x45b0e6?_0x45b0e6['addEventListener']('click',()=>{console['log']('[ClearProject]\x20click'),clearProject();try{saveAutosaveDebounced?.(0x190);}catch{}}):console['warn']('[ClearProject]\x20\x22#cleanButton\x22\x20not\x20found;\x20binding\x20skipped.');})());const UNDO_LIMIT=isMobile()?0x32:0xc8;function createTextureAndFBO(_0x2c5a7c,_0x217071,_0x364be4=gl['NEAREST']){const _0x2d2986=gl['createTexture']();gl['bindTexture'](gl['TEXTURE_2D'],_0x2d2986),gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],_0x2c5a7c,_0x217071,0x0,gl['RGBA'],gl['UNSIGNED_BYTE'],null),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MIN_FILTER'],_0x364be4),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MAG_FILTER'],_0x364be4),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_S'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_T'],gl['CLAMP_TO_EDGE']);const _0x23bbba=gl['createFramebuffer']();return gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x23bbba),gl['framebufferTexture2D'](gl['FRAMEBUFFER'],gl['COLOR_ATTACHMENT0'],gl['TEXTURE_2D'],_0x2d2986,0x0),gl['bindFramebuffer'](gl['FRAMEBUFFER'],null),gl['bindTexture'](gl['TEXTURE_2D'],null),{'texture':_0x2d2986,'fbo':_0x23bbba};}function blitFBOtoFBO(_0x19914a,_0x556c52,_0x1e4e9d=fixedFBOWidth,_0x3f6bb4=fixedFBOHeight){gl['bindFramebuffer'](gl['READ_FRAMEBUFFER'],_0x19914a),gl['bindFramebuffer'](gl['DRAW_FRAMEBUFFER'],_0x556c52),gl['blitFramebuffer'](0x0,0x0,_0x1e4e9d,_0x3f6bb4,0x0,0x0,_0x1e4e9d,_0x3f6bb4,gl['COLOR_BUFFER_BIT'],gl['NEAREST']),gl['bindFramebuffer'](gl['READ_FRAMEBUFFER'],null),gl['bindFramebuffer'](gl['DRAW_FRAMEBUFFER'],null);}function applySnapshotToLayer(_0x3ef19d,_0x48ba01){if(!_0x48ba01||!gl)return;const _0x230184=0x0|_0x48ba01['w'],_0x13fcd2=0x0|_0x48ba01['h'],_0x2f2a99=layers?.[_0x3ef19d];if(!_0x2f2a99)return;const _0x5b2162=gl['createTexture']();gl['bindTexture'](gl['TEXTURE_2D'],_0x5b2162),gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],_0x230184,_0x13fcd2,0x0,gl['RGBA'],gl['UNSIGNED_BYTE'],_0x48ba01['pixels']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MIN_FILTER'],gl['NEAREST']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MAG_FILTER'],gl['NEAREST']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_S'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_T'],gl['CLAMP_TO_EDGE']);const _0x1fb7b5=gl['createFramebuffer']();gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x1fb7b5),gl['framebufferTexture2D'](gl['FRAMEBUFFER'],gl['COLOR_ATTACHMENT0'],gl['TEXTURE_2D'],_0x5b2162,0x0);try{_0x2f2a99['texture']&&gl['deleteTexture'](_0x2f2a99['texture']);}catch{}try{_0x2f2a99['fbo']&&gl['deleteFramebuffer'](_0x2f2a99['fbo']);}catch{}_0x2f2a99['texture']=_0x5b2162,_0x2f2a99['fbo']=_0x1fb7b5,_0x2f2a99['ox']=0x0,_0x2f2a99['oy']=0x0,_0x2f2a99['texW']=_0x230184,_0x2f2a99['texH']=_0x13fcd2,_0x2f2a99['x']=0x0,_0x2f2a99['y']=0x0,_0x2f2a99['scaleX']=0x1,_0x2f2a99['scaleY']=0x1,_0x2f2a99['rotation']=0x0,_0x2f2a99['px']=0.5*_0x230184,_0x2f2a99['py']=0.5*_0x13fcd2,needsRedraw=!0x0,requestDrawIfIdle?.();}function snapshotLayer(_0x2e4333){const _0x3163e0=0x0|fixedFBOWidth,_0x37e1e0=0x0|fixedFBOHeight,_0x3a6b64=layers&&layers[_0x2e4333];if(!(gl&&_0x3a6b64&&_0x3a6b64['fbo']&&_0x3163e0&&_0x37e1e0))return null;const _0x31eda9=gl['createTexture']();gl['bindTexture'](gl['TEXTURE_2D'],_0x31eda9),gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],_0x3163e0,_0x37e1e0,0x0,gl['RGBA'],gl['UNSIGNED_BYTE'],null),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MIN_FILTER'],gl['NEAREST']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MAG_FILTER'],gl['NEAREST']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_S'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_T'],gl['CLAMP_TO_EDGE']);const _0x48dbce=gl['createFramebuffer']();if(gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x48dbce),gl['framebufferTexture2D'](gl['FRAMEBUFFER'],gl['COLOR_ATTACHMENT0'],gl['TEXTURE_2D'],_0x31eda9,0x0),gl['bindFramebuffer'](gl['FRAMEBUFFER'],null),gl instanceof WebGL2RenderingContext&&gl['blitFramebuffer'])gl['bindFramebuffer'](gl['READ_FRAMEBUFFER'],_0x3a6b64['fbo']),gl['bindFramebuffer'](gl['DRAW_FRAMEBUFFER'],_0x48dbce),gl['blitFramebuffer'](0x0,0x0,_0x3163e0,_0x37e1e0,0x0,0x0,_0x3163e0,_0x37e1e0,gl['COLOR_BUFFER_BIT'],gl['NEAREST']),gl['bindFramebuffer'](gl['READ_FRAMEBUFFER'],null),gl['bindFramebuffer'](gl['DRAW_FRAMEBUFFER'],null);else{const _0x3becdf=gl['getParameter'](gl['FRAMEBUFFER_BINDING']),_0x3422df=gl['getParameter'](gl['CURRENT_PROGRAM']),_0x24c2c4=gl['getParameter'](gl['VIEWPORT']);gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x48dbce),gl['viewport'](0x0,0x0,_0x3163e0,_0x37e1e0),gl['disable'](gl['BLEND']),gl['clearColor'](0x0,0x0,0x0,0x0),gl['clear'](gl['COLOR_BUFFER_BIT']),gl['useProgram'](quadProgram);const _0x753b3b=gl['getUniformLocation'](quadProgram,'u_flipY');_0x753b3b&&gl['uniform1f'](_0x753b3b,0x1);const _0x41c051=gl['getUniformLocation'](quadProgram,'u_resolution');_0x41c051&&gl['uniform2f'](_0x41c051,_0x3163e0,_0x37e1e0);const _0x32bcf2=gl['getUniformLocation'](quadProgram,'u_layerOpacity');_0x32bcf2&&gl['uniform1f'](_0x32bcf2,0x1);const _0x48951=gl['getUniformLocation'](quadProgram,'u_texture');_0x48951&&gl['uniform1i'](_0x48951,0x0);const _0xabf902=new Float32Array([0x0,0x0,0x0,0x0,_0x3163e0,0x0,0x1,0x0,0x0,_0x37e1e0,0x0,0x1,0x0,_0x37e1e0,0x0,0x1,_0x3163e0,0x0,0x1,0x0,_0x3163e0,_0x37e1e0,0x1,0x1]),_0x190e95=gl['createBuffer']();gl['bindBuffer'](gl['ARRAY_BUFFER'],_0x190e95),gl['bufferData'](gl['ARRAY_BUFFER'],_0xabf902,gl['STREAM_DRAW']);const _0x101b58=gl['getAttribLocation'](quadProgram,'a_position'),_0x43c37d=gl['getAttribLocation'](quadProgram,'a_texCoord');_0x101b58>=0x0&&(gl['enableVertexAttribArray'](_0x101b58),gl['vertexAttribPointer'](_0x101b58,0x2,gl['FLOAT'],!0x1,0x10,0x0)),_0x43c37d>=0x0&&(gl['enableVertexAttribArray'](_0x43c37d),gl['vertexAttribPointer'](_0x43c37d,0x2,gl['FLOAT'],!0x1,0x10,0x8)),gl['activeTexture'](gl['TEXTURE0']),gl['bindTexture'](gl['TEXTURE_2D'],_0x3a6b64['texture']),gl['drawArrays'](gl['TRIANGLES'],0x0,0x6),_0x101b58>=0x0&&gl['disableVertexAttribArray'](_0x101b58),_0x43c37d>=0x0&&gl['disableVertexAttribArray'](_0x43c37d),gl['bindBuffer'](gl['ARRAY_BUFFER'],null),gl['deleteBuffer'](_0x190e95),gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x3becdf),gl['useProgram'](_0x3422df),_0x24c2c4&&gl['viewport'](_0x24c2c4[0x0],_0x24c2c4[0x1],_0x24c2c4[0x2],_0x24c2c4[0x3]);}return{'index':_0x2e4333,'w':_0x3163e0,'h':_0x37e1e0,'texture':_0x31eda9,'fbo':_0x48dbce};}function restoreLayerSnapshot(_0xb3e9ec){const _0x2bc9d9=layers[_0xb3e9ec['index']];_0x2bc9d9&&blitFBOtoFBO(_0xb3e9ec['fbo'],_0x2bc9d9['fbo'],_0xb3e9ec['w'],_0xb3e9ec['h']);}function disposeSnapshot(_0x317f03){try{_0x317f03?.['texture']&&gl['deleteTexture'](_0x317f03['texture']),_0x317f03?.['fbo']&&gl['deleteFramebuffer'](_0x317f03['fbo']);}catch(_0x2c66b3){console['warn']('disposeSnapshot',_0x2c66b3);}}const History={'stack':[],'redo':[],'limit':UNDO_LIMIT,'push'(_0x231dbb){this['stack']['push'](_0x231dbb),this['stack']['length']>this['limit']&&this['_dispose'](this['stack']['shift']()),this['redo']['length']=0x0,console['log']('[History]\x20push',_0x231dbb['type']);},'undo'(){const _0xcee9d1=this['stack']['pop']();_0xcee9d1&&(this['_applyInverse'](_0xcee9d1),this['redo']['push'](_0xcee9d1),needsRedraw=!0x0,showStatusMessage('Undo','info'),console['log']('[History]\x20undo',_0xcee9d1['type']));},'redoDo'(){const _0xa11679=this['redo']['pop']();_0xa11679&&(this['_apply'](_0xa11679),this['stack']['push'](_0xa11679),needsRedraw=!0x0,showStatusMessage('Redo','info'),console['log']('[History]\x20redo',_0xa11679['type']));},'_dispose'(_0x312352){if(_0x312352&&(_0x312352['before']&&disposeSnapshot(_0x312352['before']),_0x312352['after']&&disposeSnapshot(_0x312352['after']),_0x312352['removedLayer']&&_0x312352['removedLayer']['snapshot']&&disposeSnapshot(_0x312352['removedLayer']['snapshot']),_0x312352['addedLayer']&&_0x312352['addedLayer']['snapshot']&&disposeSnapshot(_0x312352['addedLayer']['snapshot']),'merge_layers'===_0x312352['type']))try{if(_0x312352['added']&&_0x312352['added']['data']&&_0x312352['added']['data']['snapshot']&&disposeSnapshot(_0x312352['added']['data']['snapshot']),Array['isArray'](_0x312352['removed'])){for(const _0x4f80ea of _0x312352['removed'])_0x4f80ea&&_0x4f80ea['data']&&_0x4f80ea['data']['snapshot']&&disposeSnapshot(_0x4f80ea['data']['snapshot']);}}catch(_0x55a4f8){console['warn']('dispose\x20merge_layers',_0x55a4f8);}},'_apply'(_0x30269c){switch(_0x30269c['type']){case'stroke':case'fill':case'transform_bake':_0x30269c['after']&&restoreLayerSnapshot(_0x30269c['after']);break;case'layer_visibility':layers[_0x30269c['index']]['visible']=_0x30269c['next'];break;case'layer_opacity':layers[_0x30269c['index']]['opacity']=_0x30269c['next'];break;case'layer_rename':layers[_0x30269c['index']]['name']=_0x30269c['next'],rebuildLayersUI?.();break;case'layer_move':this['_moveLayer'](_0x30269c['from'],_0x30269c['to']);break;case'add_layer':this['_insertLayer'](_0x30269c['index'],_0x30269c['addedLayer']);break;case'remove_layer':this['_removeLayerAt'](_0x30269c['index']);break;case'clear_project':this['_restoreProject'](_0x30269c['afterAll']);break;case'merge_layers':{if(!Array['isArray'](_0x30269c['removed'])||!_0x30269c['added'])break;const _0xca388a=_0x30269c['removed']['map'](_0x35887e=>_0x35887e['index'])['sort']((_0x58f9a3,_0x262e1c)=>_0x262e1c-_0x58f9a3);for(const _0x346f52 of _0xca388a)this['_removeLayerAt'](_0x346f52);this['_insertLayer'](_0x30269c['added']['index'],_0x30269c['added']['data']),activeLayerIndex=_0x30269c['added']['index'],syncActiveAliases?.(),rebuildLayersUI?.();break;}}},'_applyInverse'(_0x540cc5){switch(_0x540cc5['type']){case'stroke':case'fill':case'transform_bake':_0x540cc5['before']&&restoreLayerSnapshot(_0x540cc5['before']);break;case'layer_visibility':layers[_0x540cc5['index']]['visible']=_0x540cc5['prev'];break;case'layer_opacity':layers[_0x540cc5['index']]['opacity']=_0x540cc5['prev'];break;case'layer_rename':layers[_0x540cc5['index']]['name']=_0x540cc5['prev'],rebuildLayersUI?.();break;case'layer_move':this['_moveLayer'](_0x540cc5['to'],_0x540cc5['from']);break;case'add_layer':this['_removeLayerAt'](_0x540cc5['index']);break;case'remove_layer':this['_insertLayer'](_0x540cc5['index'],_0x540cc5['removedLayer']);break;case'clear_project':this['_restoreProject'](_0x540cc5['beforeAll']);break;case'merge_layers':if(_0x540cc5['added']&&this['_removeLayerAt'](_0x540cc5['added']['index']),Array['isArray'](_0x540cc5['removed'])){const _0x43fc1e=_0x540cc5['removed']['slice']()['sort']((_0x576ef3,_0x4bab17)=>_0x576ef3['index']-_0x4bab17['index']);for(const _0x372749 of _0x43fc1e)this['_insertLayer'](_0x372749['index'],_0x372749['data']);activeLayerIndex=_0x43fc1e[_0x43fc1e['length']-0x1]?.['index']??0x0,syncActiveAliases?.(),rebuildLayersUI?.();}}},'_moveLayer'(_0x2d65f7,_0x41f434){if(_0x2d65f7===_0x41f434)return;const _0x42a936=layers['splice'](_0x2d65f7,0x1)[0x0];layers['splice'](_0x41f434,0x0,_0x42a936),activeLayerIndex=_0x41f434,syncActiveAliases?.(),rebuildLayersUI?.();},'_removeLayerAt'(_0x2ea1c4){const _0x4c9d5d=layers[_0x2ea1c4];_0x4c9d5d&&(gl['deleteTexture'](_0x4c9d5d['texture']),gl['deleteFramebuffer'](_0x4c9d5d['fbo']),layers['splice'](_0x2ea1c4,0x1),activeLayerIndex=Math['max'](0x0,Math['min'](activeLayerIndex,layers['length']-0x1)),syncActiveAliases?.(),rebuildLayersUI?.());},'_insertLayer'(_0x52d5c9,_0x1a9540){const {name:_0x393fd4,visible:_0x61aff6,opacity:_0x343849,snapshot:_0x17ef7d}=_0x1a9540,{texture:_0x1785cc,fbo:_0x294774}=createLayerFBO(fixedFBOWidth,fixedFBOHeight),_0x2369f8={'id':Date['now']()+Math['random'](),'name':_0x393fd4,'fbo':_0x294774,'texture':_0x1785cc,'visible':_0x61aff6,'opacity':_0x343849,'x':0x0,'y':0x0,'scaleX':0x1,'scaleY':0x1,'rotation':0x0,'px':0.5*fixedFBOWidth,'py':0.5*fixedFBOHeight,'history':[],'redo':[]};layers['splice'](_0x52d5c9,0x0,_0x2369f8),blitFBOtoFBO(_0x17ef7d['fbo'],_0x2369f8['fbo']),activeLayerIndex=_0x52d5c9,syncActiveAliases?.(),rebuildLayersUI?.();},'_captureProject'(){const _0x3cbc45={'w':fixedFBOWidth,'h':fixedFBOHeight,'layers':layers['map']((_0x34d609,_0x4acefa)=>({'index':_0x4acefa,'name':_0x34d609['name'],'visible':_0x34d609['visible'],'opacity':_0x34d609['opacity'],'snapshot':snapshotLayer(_0x4acefa)})),'background':null};if(currentImage)try{const _0x326efc=document['createElement']('canvas');_0x326efc['width']=fixedFBOWidth,_0x326efc['height']=fixedFBOHeight,(_0x326efc['getContext']('2d')['drawImage'](currentImage,0x0,0x0,fixedFBOWidth,fixedFBOHeight),_0x3cbc45['background']=_0x326efc['toDataURL']('image/png'));}catch(_0x3c43ce){console['warn']('captureProject\x20background',_0x3c43ce);}return _0x3cbc45;},'_restoreProject'(_0x305e63){if(_0x305e63)try{if(layers['forEach'](_0x386c9f=>{gl['deleteTexture'](_0x386c9f['texture']),gl['deleteFramebuffer'](_0x386c9f['fbo']);}),layers=[],_0x305e63['background']){const _0x19dabd=new Image();_0x19dabd['onload']=()=>{currentImage=_0x19dabd,updateCanvasSize(_0x19dabd),createTextureFromImage(_0x19dabd),needsRedraw=!0x0;},_0x19dabd['src']=_0x305e63['background'];}else currentImage=null,texture=null;_0x305e63['layers']['forEach'](_0x29acf8=>{const {texture:_0x5df255,fbo:_0x5bf7ab}=createLayerFBO(_0x305e63['w'],_0x305e63['h']),_0x15aff2={'id':Date['now']()+Math['random'](),'name':_0x29acf8['name'],'fbo':_0x5bf7ab,'texture':_0x5df255,'visible':_0x29acf8['visible'],'opacity':_0x29acf8['opacity'],'x':0x0,'y':0x0,'scaleX':0x1,'scaleY':0x1,'rotation':0x0,'px':0.5*fixedFBOWidth,'py':0.5*fixedFBOHeight,'history':[],'redo':[]};layers['push'](_0x15aff2),blitFBOtoFBO(_0x29acf8['snapshot']['fbo'],_0x15aff2['fbo'],_0x305e63['w'],_0x305e63['h']);}),activeLayerIndex=Math['max'](0x0,layers['length']-0x1),syncActiveAliases?.(),rebuildLayersUI?.(),needsRedraw=!0x0;}catch(_0x495119){console['error']('_restoreProject\x20failed',_0x495119);}}};let __strokeBeforeSnap=null;function beginStrokeHistory(){try{if(!getActiveLayer())return;__strokeBeforeSnap=snapshotLayer(activeLayerIndex);}catch(_0x11f16b){console['warn']('beginStrokeHistory',_0x11f16b);}}function endStrokeHistory(_0x83764e='stroke'){try{if(!getActiveLayer()||!__strokeBeforeSnap)return void(__strokeBeforeSnap=null);const _0x1a6273=snapshotLayer(activeLayerIndex);History['push']({'type':_0x83764e,'before':__strokeBeforeSnap,'after':_0x1a6273}),__strokeBeforeSnap=null;}catch(_0x53f79d){console['warn']('endStrokeHistory',_0x53f79d),__strokeBeforeSnap=null;}}function undoStroke(){History['undo']();}function redoStroke(){History['redoDo']();}try{document['getElementById']('undoButton')['removeEventListener']?.('click',undoStroke),document['getElementById']('redoButton')['removeEventListener']?.('click',redoStroke);}catch{}function performFloodFill(_0xfd9396,_0x2d2197){const _0xfad155=getActiveLayer();if(!_0xfad155)return;const _0x392115=snapshotLayer(activeLayerIndex),_0x51e57f=Math['max'](0x0,Math['min'](fixedFBOWidth-0x1,Math['round'](_0xfd9396))),_0x1e3b29=Math['max'](0x0,Math['min'](fixedFBOHeight-0x1,Math['round'](_0x2d2197))),_0x5e49c7=fixedFBOHeight-0x1-_0x1e3b29,_0x1b2384=new Uint8Array(0x4);gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0xfad155['fbo']),gl['readPixels'](_0x51e57f,_0x5e49c7,0x1,0x1,gl['RGBA'],gl['UNSIGNED_BYTE'],_0x1b2384),gl['bindFramebuffer'](gl['FRAMEBUFFER'],null),runFloodFillShader(_0xfad155,[_0x1b2384[0x0]/0xff,_0x1b2384[0x1]/0xff,_0x1b2384[0x2]/0xff,_0x1b2384[0x3]/0xff],tintColor);const _0x5a5d37=snapshotLayer(activeLayerIndex);History['push']({'type':'fill','before':_0x392115,'after':_0x5a5d37}),needsRedraw=!0x0;}function endTransform(_0x106b35=!0x0){if(!(transformTool&&transformTool['mode']&&'idle'!==transformTool['mode'])){try{isTwoFingerGesture=!0x1,pinchStart=null;}catch{}return transformTool&&(transformTool['mode']='idle'),needsRedraw=!0x0,void requestDrawIfIdle?.();}try{stopRender?.('transform');}catch{}let _0xce9c08=!0x1,_0xf577ac=null,_0x2f04f5=null;if(_0x106b35)try{_0xf577ac=snapshotLayer?.(activeLayerIndex),applyActiveLayerTransform(),_0x2f04f5=snapshotLayer?.(activeLayerIndex),_0xf577ac&&_0x2f04f5&&History?.['push']&&History['push']({'type':'transform_bake','before':_0xf577ac,'after':_0x2f04f5}),_0xce9c08=!0x0;}catch(_0x39a346){console['warn']('[endTransform]\x20Bake\x20failed:',_0x39a346),_0xce9c08=!0x1;}try{transformTool['start']=null,transformTool['ref']=null,transformTool['shiftInvert']=!0x1,transformTool['pivotCanvas']=null;}catch{}transformTool&&(transformTool['mode']='idle');try{isTwoFingerGesture=!0x1,pinchStart=null;}catch{}const _0x1aec2d=getActiveLayer?.(),_0x335a9b=!(!_0x1aec2d||!_0x1aec2d['transformLocked']);transformTool&&(transformTool['mobileCombo']=_0x335a9b),_0x335a9b&&queueMicrotask?.(()=>startTransform?.('grab')),showStatusMessage?.(_0xce9c08?'Transform\x20applied':_0x106b35?'Transform\x20failed':'Transform\x20cancelled',_0xce9c08?'success':_0x106b35?'warning':'info'),needsRedraw=!0x0,requestDrawIfIdle?.();}function recordLayerVisibilityChange(_0x2819e1,_0x398ba6,_0x2d3660){History['push']({'type':'layer_visibility','index':_0x2819e1,'prev':_0x398ba6,'next':_0x2d3660});}function recordLayerOpacityChange(_0x55228d,_0x420954,_0x210a58){History['push']({'type':'layer_opacity','index':_0x55228d,'prev':_0x420954,'next':_0x210a58});}function recordLayerRename(_0x2ae96f,_0x3b85bb,_0x3e72f4){History['push']({'type':'layer_rename','index':_0x2ae96f,'prev':_0x3b85bb,'next':_0x3e72f4});}function recordLayerMove(_0x20ce62,_0x3e8784){History['push']({'type':'layer_move','from':_0x20ce62,'to':_0x3e8784});}function recordAddLayer(_0x383c75){const _0x525dcf=snapshotLayer(_0x383c75);History['push']({'type':'add_layer','index':_0x383c75,'addedLayer':{'name':layers[_0x383c75]['name'],'visible':layers[_0x383c75]['visible'],'opacity':layers[_0x383c75]['opacity'],'snapshot':_0x525dcf}});}function recordRemoveLayer(_0xe2c4a6,_0x22f81b){History['push']({'type':'remove_layer','index':_0xe2c4a6,'removedLayer':_0x22f81b});}function captureLayerDataForRemoval(_0x592ba7){const _0x19a1c4=layers[_0x592ba7];return{'name':_0x19a1c4['name'],'visible':_0x19a1c4['visible'],'opacity':_0x19a1c4['opacity'],'snapshot':snapshotLayer(_0x592ba7)};}document['getElementById']('undoButton')['addEventListener']('click',undoStroke),document['getElementById']('redoButton')['addEventListener']('click',redoStroke),document['addEventListener']('keydown',_0x560488=>{isUserTyping()||('z'===_0x560488['key']&&(_0x560488['ctrlKey']||_0x560488['metaKey'])&&(_0x560488['preventDefault'](),undoStroke()),'y'===_0x560488['key']&&(_0x560488['ctrlKey']||_0x560488['metaKey'])&&(_0x560488['preventDefault'](),redoStroke()));},{'capture':!0x0}),canvas['addEventListener']('pointerdown',()=>{beginStrokeHistory();},{'capture':!0x0}),canvas['addEventListener']('pointerup',()=>{endStrokeHistory('stroke');},{'capture':!0x0});const __moveLayerUp=moveLayerUp;moveLayerUp=function(_0x27a780){const _0x43112b=Math['min'](layers['length']-0x1,_0x27a780+0x1);_0x27a780!==_0x43112b&&(__moveLayerUp(_0x27a780),recordLayerMove(_0x27a780,_0x43112b));};const __moveLayerDown=moveLayerDown;moveLayerDown=function(_0x20fe6a){const _0x2a52bc=Math['max'](0x0,_0x20fe6a-0x1);_0x20fe6a!==_0x2a52bc&&(__moveLayerDown(_0x20fe6a),recordLayerMove(_0x20fe6a,_0x2a52bc));};const __removeActiveLayer=removeActiveLayer;removeActiveLayer=function(){if(layers['length']<=0x1)return void __removeActiveLayer();const _0x90622f=activeLayerIndex,_0x364bab=captureLayerDataForRemoval(_0x90622f);__removeActiveLayer(),recordRemoveLayer(_0x90622f,_0x364bab);};const __addLayer=addLayer;addLayer=function(_0x50738c='Layer\x20'+(layers['length']+0x1),_0x4171ae=activeLayerIndex){__addLayer(_0x50738c,_0x4171ae),recordAddLayer(activeLayerIndex);};const __rebuildLayersUI=rebuildLayersUI;function recordClearProject(_0x334e0c,_0x1a40e1){History['push']({'type':'clear_project','beforeAll':_0x334e0c,'afterAll':_0x1a40e1});}rebuildLayersUI=function(){__rebuildLayersUI();try{const _0x439532=document['getElementById']('layersList');if(!_0x439532)return;_0x439532['querySelectorAll']('.layer-item')['forEach'](_0x5f2a6f=>{const _0x5c5905=Number(_0x5f2a6f['getAttribute']('data-index')),_0x5c1d02=_0x5f2a6f['querySelector']('.layer-vis\x20button.bs.icon-btn');if(_0x5c1d02&&!_0x5c1d02['__hp_vis_hist_patched']){_0x5c1d02['__hp_vis_hist_patched']=!0x0;const _0x1c390c=_0x5c1d02['onclick'];_0x5c1d02['onclick']=_0x393bc2=>{const _0x134fa1=layers[_0x5c5905]['visible'];_0x1c390c?.(_0x393bc2);const _0x5bb694=layers[_0x5c5905]['visible'];_0x134fa1!==_0x5bb694&&recordLayerVisibilityChange(_0x5c5905,_0x134fa1,_0x5bb694);};}const _0x365bac=_0x5f2a6f['querySelector']('.layer-opacity\x20input[type=\x27range\x27]');if(_0x365bac&&!_0x365bac['__hp_op_hist_patched']){_0x365bac['__hp_op_hist_patched']=!0x0;let _0x5df3e2=layers[_0x5c5905]['opacity'];_0x365bac['addEventListener']('change',()=>{const _0xf5e346=layers[_0x5c5905]['opacity'];_0x5df3e2!==_0xf5e346&&(recordLayerOpacityChange(_0x5c5905,_0x5df3e2,_0xf5e346),_0x5df3e2=_0xf5e346);});}const _0x3bca9f=_0x5f2a6f['querySelector']('.layer-name\x20input');if(_0x3bca9f&&!_0x3bca9f['__hp_name_hist_patched']){_0x3bca9f['__hp_name_hist_patched']=!0x0;let _0x3d03f7=layers[_0x5c5905]['name'];_0x3bca9f['addEventListener']('blur',()=>{const _0x5ebdbb=layers[_0x5c5905]['name'];_0x3d03f7!==_0x5ebdbb&&(recordLayerRename(_0x5c5905,_0x3d03f7,_0x5ebdbb),_0x3d03f7=_0x5ebdbb);}),_0x3bca9f['addEventListener']('change',()=>{const _0x63f384=layers[_0x5c5905]['name'];_0x3d03f7!==_0x63f384&&(recordLayerRename(_0x5c5905,_0x3d03f7,_0x63f384),_0x3d03f7=_0x63f384);});}});}catch(_0xd15e15){console['warn']('rebuildLayersUI\x20history\x20patch',_0xd15e15);}};let isErasing=!0x1;function updateEraserSliderVisibility(){const _0x514a50=document['getElementById']('eraseStrengthSlider');_0x514a50&&(_0x514a50['style']['display']=isErasing?'block':'none');}function toggleEraser(){isErasing=!isErasing,updateEraserSliderVisibility(),updateEraserButton(),showStatusMessage(isErasing?'Mode:\x20Erase':'Mode:\x20Paint','info');}function updateEraserButton(){document['querySelector']('#eraserToggle')['innerHTML']=isErasing?'<img\x20src=\x22/static/draw/images/icons/eraser.svg\x22\x20alt=\x22Erase\x22>':'<img\x20src=\x22/static/draw/images/icons/brush.svg\x22\x20alt=\x22Brush\x22>',needsRedraw=!0x0;}document['addEventListener']('keydown',_0x2aa3b9=>{isUserTyping()||'e'===_0x2aa3b9['key']['toLowerCase']()&&toggleEraser();}),document['addEventListener']('DOMContentLoaded',()=>{const _0x31651b=document['querySelector']('#eraserToggle');_0x31651b&&(_0x31651b['addEventListener']('click',toggleEraser),updateEraserButton());}),document['addEventListener']('keydown',_0x883f9e=>{isUserTyping()||(','===_0x883f9e['key']?(eraseStrength=Math['max'](0x0,eraseStrength-0.01),updateEraserSliderUI()):'.'===_0x883f9e['key']&&(eraseStrength=Math['min'](0x1,eraseStrength+0.01),updateEraserSliderUI()));});let lineMode=!0x0,lineStepFactor=0.02,lastFx=null,lastFy=null;function drawSingleBrushStamp(_0x5aad8e,_0x25bdee,_0x2000e2=null,_0x20a93f=null){const _0x587abb=getActiveLayer();if(!_0x587abb||!gl)return;const _0x139412=0x0|fixedFBOWidth,_0x33366a=0x0|fixedFBOHeight;let _0xfcb444=Math['max'](0x1,0x0|(Number(_0x587abb['texW'])||_0x139412)),_0x48a616=Math['max'](0x1,0x0|(Number(_0x587abb['texH'])||_0x33366a)),_0x50e11e=Number['isFinite'](_0x587abb['ox'])?_0x587abb['ox']:0x0,_0x22c95c=Number['isFinite'](_0x587abb['oy'])?_0x587abb['oy']:0x0,_0x4000ea=Number['isFinite'](_0x587abb['px'])?_0x587abb['px']:_0x50e11e+0.5*_0xfcb444,_0x5eaa6a=Number['isFinite'](_0x587abb['py'])?_0x587abb['py']:_0x22c95c+0.5*_0x48a616;const _0x4aa0e0=Number['isFinite'](_0x587abb['x'])?_0x587abb['x']:0x0,_0x3e6b23=Number['isFinite'](_0x587abb['y'])?_0x587abb['y']:0x0,_0x286e26=Number['isFinite'](_0x587abb['scaleX'])?_0x587abb['scaleX']:0x1,_0x4779c2=Number['isFinite'](_0x587abb['scaleY'])?_0x587abb['scaleY']:0x1,_0x2a7d23=Number['isFinite'](_0x587abb['rotation'])?_0x587abb['rotation']:0x0,_0x730d2f=!Number['isFinite'](_0x587abb['px'])||!Number['isFinite'](_0x587abb['py']),_0x1f08fc=_0x4000ea,_0x5efa78=_0x5eaa6a;let _0x3cda82=_0x5aad8e-_0x4aa0e0,_0x4549b6=_0x25bdee-_0x3e6b23;_0x3cda82-=_0x4000ea,_0x4549b6-=_0x5eaa6a;const _0x357c6a=Math['cos'](-_0x2a7d23),_0x5c9232=Math['sin'](-_0x2a7d23),_0x323f4e=_0x3cda82*_0x357c6a-_0x4549b6*_0x5c9232,_0x48f9da=_0x3cda82*_0x5c9232+_0x4549b6*_0x357c6a;let _0x135a52=(0x0!==_0x286e26?_0x323f4e/_0x286e26:_0x323f4e)+_0x4000ea-_0x50e11e,_0xb0e05=(0x0!==_0x4779c2?_0x48f9da/_0x4779c2:_0x48f9da)+_0x5eaa6a-_0x22c95c;const _0x24d3ea=(_0x2000e2??brushSize)*_0x139412,_0x303035=0.5*_0x24d3ea,_0x4c23b7=0.5*(_0x24d3ea/brushAspect),_0xe6c853=_0x20a93f??currentAngle,_0x156f7d=Math['cos'](_0xe6c853),_0x174a24=Math['sin'](_0xe6c853),_0x904436=(_0x113c8c,_0x5ea4b3)=>({'x':_0x113c8c*_0x156f7d-_0x5ea4b3*_0x174a24,'y':_0x113c8c*_0x174a24+_0x5ea4b3*_0x156f7d});let _0x2cf495=_0x904436(-_0x303035,-_0x4c23b7),_0x1835f4=_0x904436(_0x303035,-_0x4c23b7),_0x41ffda=_0x904436(-_0x303035,_0x4c23b7),_0x7c70a4=_0x904436(_0x303035,_0x4c23b7),_0x373fc4=_0x135a52+_0x2cf495['x'],_0x512593=_0xb0e05+_0x2cf495['y'],_0x42f8c9=_0x135a52+_0x1835f4['x'],_0x36d9a8=_0xb0e05+_0x1835f4['y'],_0x3bb5de=_0x135a52+_0x41ffda['x'],_0x5a1f1e=_0xb0e05+_0x41ffda['y'],_0x449dbb=_0x135a52+_0x7c70a4['x'],_0x3e7075=_0xb0e05+_0x7c70a4['y'],_0x55dae3=Math['min'](_0x373fc4,_0x42f8c9,_0x3bb5de,_0x449dbb),_0x312354=Math['min'](_0x512593,_0x36d9a8,_0x5a1f1e,_0x3e7075),_0x39721c=Math['max'](_0x373fc4,_0x42f8c9,_0x3bb5de,_0x449dbb),_0x3bb8f9=Math['max'](_0x512593,_0x36d9a8,_0x5a1f1e,_0x3e7075);const _0x58e9fc=1.5,_0x299194=_0x55dae3<0x0,_0x398398=_0x312354<0x0,_0x398cf7=_0x39721c>_0xfcb444,_0x4dc3aa=_0x3bb8f9>_0x48a616;if(_0x299194||_0x398398||_0x398cf7||_0x4dc3aa){const _0x230c52=_0x299194?Math['ceil'](-_0x55dae3):0x0,_0x17be6a=_0x398398?Math['ceil'](-_0x312354):0x0,_0x273746=_0x398cf7?Math['ceil'](_0x39721c-_0xfcb444):0x0,_0x12bcb3=_0x4dc3aa?Math['ceil'](_0x3bb8f9-_0x48a616):0x0,_0x25b952=_0x230c52?Math['ceil']((_0x230c52+0x4)*_0x58e9fc):0x0,_0x438c3b=_0x17be6a?Math['ceil']((_0x17be6a+0x4)*_0x58e9fc):0x0,_0x29b1aa=_0xfcb444+_0x25b952+(_0x273746?Math['ceil']((_0x273746+0x4)*_0x58e9fc):0x0),_0x3652ef=_0x48a616+_0x438c3b+(_0x12bcb3?Math['ceil']((_0x12bcb3+0x4)*_0x58e9fc):0x0),_0x12df2e=gl['createTexture']();gl['bindTexture'](gl['TEXTURE_2D'],_0x12df2e),gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],_0x29b1aa,_0x3652ef,0x0,gl['RGBA'],gl['UNSIGNED_BYTE'],null),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MIN_FILTER'],gl['NEAREST']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MAG_FILTER'],gl['NEAREST']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_S'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_T'],gl['CLAMP_TO_EDGE']);const _0x3ec54d=gl['createFramebuffer']();gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x3ec54d),gl['framebufferTexture2D'](gl['FRAMEBUFFER'],gl['COLOR_ATTACHMENT0'],gl['TEXTURE_2D'],_0x12df2e,0x0),gl['viewport'](0x0,0x0,_0x29b1aa,_0x3652ef),gl['disable'](gl['BLEND']),gl['clearColor'](0x0,0x0,0x0,0x0),gl['clear'](gl['COLOR_BUFFER_BIT']),gl['useProgram'](quadProgram);const _0x2a91e7=gl['getUniformLocation'](quadProgram,'u_texture')||gl['getUniformLocation'](quadProgram,'u_image'),_0x29d60a=gl['getUniformLocation'](quadProgram,'u_flipY'),_0x4ae7b7=gl['getUniformLocation'](quadProgram,'u_resolution'),_0x460c5d=gl['getUniformLocation'](quadProgram,'u_layerOpacity');_0x29d60a&&gl['uniform1f'](_0x29d60a,0x1),_0x4ae7b7&&gl['uniform2f'](_0x4ae7b7,_0x29b1aa,_0x3652ef),_0x460c5d&&gl['uniform1f'](_0x460c5d,0x1);const _0x3833ed=new Float32Array([_0x25b952,_0x438c3b,0x0,0x0,_0x25b952+_0xfcb444,_0x438c3b,0x1,0x0,_0x25b952,_0x438c3b+_0x48a616,0x0,0x1,_0x25b952,_0x438c3b+_0x48a616,0x0,0x1,_0x25b952+_0xfcb444,_0x438c3b,0x1,0x0,_0x25b952+_0xfcb444,_0x438c3b+_0x48a616,0x1,0x1]),_0x5f3605=gl['createBuffer']();gl['bindBuffer'](gl['ARRAY_BUFFER'],_0x5f3605),gl['bufferData'](gl['ARRAY_BUFFER'],_0x3833ed,gl['STREAM_DRAW']);const _0x1a62e8=gl['getAttribLocation'](quadProgram,'a_position'),_0x7ee003=gl['getAttribLocation'](quadProgram,'a_texCoord');gl['enableVertexAttribArray'](_0x1a62e8),gl['vertexAttribPointer'](_0x1a62e8,0x2,gl['FLOAT'],!0x1,0x10,0x0),gl['enableVertexAttribArray'](_0x7ee003),gl['vertexAttribPointer'](_0x7ee003,0x2,gl['FLOAT'],!0x1,0x10,0x8),gl['activeTexture'](gl['TEXTURE0']),gl['bindTexture'](gl['TEXTURE_2D'],_0x587abb['texture']),_0x2a91e7&&gl['uniform1i'](_0x2a91e7,0x0),gl['drawArrays'](gl['TRIANGLES'],0x0,0x6),gl['disableVertexAttribArray'](_0x1a62e8),gl['disableVertexAttribArray'](_0x7ee003),gl['bindBuffer'](gl['ARRAY_BUFFER'],null),gl['deleteBuffer'](_0x5f3605);const _0x5b0dd1=_0x587abb['texture'],_0x47f73f=_0x587abb['fbo'];_0x587abb['texture']=_0x12df2e,_0x587abb['fbo']=_0x3ec54d,_0x587abb['texW']=_0xfcb444=_0x29b1aa,_0x587abb['texH']=_0x48a616=_0x3652ef,_0x587abb['ox']=_0x50e11e-=_0x25b952,_0x587abb['oy']=_0x22c95c-=_0x438c3b,_0x730d2f&&(_0x587abb['px']=_0x1f08fc,_0x587abb['py']=_0x5efa78,_0x4000ea=_0x587abb['px'],_0x5eaa6a=_0x587abb['py']),_0x135a52+=_0x25b952,_0xb0e05+=_0x438c3b,_0x373fc4+=_0x25b952,_0x42f8c9+=_0x25b952,_0x3bb5de+=_0x25b952,_0x449dbb+=_0x25b952,_0x512593+=_0x438c3b,_0x36d9a8+=_0x438c3b,_0x5a1f1e+=_0x438c3b,_0x3e7075+=_0x438c3b,gl['deleteFramebuffer'](_0x47f73f),gl['deleteTexture'](_0x5b0dd1);}gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x587abb['fbo']),gl['viewport'](0x0,0x0,_0xfcb444,_0x48a616),gl['disable'](gl['SCISSOR_TEST']),gl['disable'](gl['DEPTH_TEST']),gl['disable'](gl['CULL_FACE']),gl['useProgram'](paintProgram),gl['enable'](gl['BLEND']),isErasing?gl['blendFuncSeparate'](gl['ZERO'],gl['ONE'],gl['ZERO'],gl['ONE_MINUS_SRC_ALPHA']):gl['blendFunc'](gl['SRC_ALPHA'],gl['ONE_MINUS_SRC_ALPHA']);const _0x59a1c0=gl['getUniformLocation'](paintProgram,'u_flipY');_0x59a1c0&&gl['uniform1f'](_0x59a1c0,0x1);const _0x5488b2=gl['getUniformLocation'](paintProgram,'u_resolution');_0x5488b2&&gl['uniform2f'](_0x5488b2,_0xfcb444,_0x48a616);const _0x370e03=gl['getUniformLocation'](paintProgram,'u_erase');_0x370e03&&gl['uniform1i'](_0x370e03,isErasing?0x1:0x0);const _0x4efc18=gl['getUniformLocation'](paintProgram,'u_eraseStrength');_0x4efc18&&gl['uniform1f'](_0x4efc18,eraseStrength);const _0x4434b9=gl['getUniformLocation'](paintProgram,'u_paintStrength');_0x4434b9&&gl['uniform1f'](_0x4434b9,paintStrength);const _0x5b06a8=gl['getUniformLocation'](paintProgram,'u_tint');_0x5b06a8&&gl['uniform4fv'](_0x5b06a8,tintColor),gl['activeTexture'](gl['TEXTURE0']),gl['bindTexture'](gl['TEXTURE_2D'],overlayTexture);const _0x20568a=gl['getUniformLocation'](paintProgram,'u_brushTex'),_0x3ff541=gl['getUniformLocation'](paintProgram,'u_brush');_0x20568a&&gl['uniform1i'](_0x20568a,0x0),_0x3ff541&&gl['uniform1i'](_0x3ff541,0x0);const _0x39568d=new Float32Array([_0x373fc4,_0x512593,0x0,0x0,_0x42f8c9,_0x36d9a8,0x1,0x0,_0x3bb5de,_0x5a1f1e,0x0,0x1,_0x3bb5de,_0x5a1f1e,0x0,0x1,_0x42f8c9,_0x36d9a8,0x1,0x0,_0x449dbb,_0x3e7075,0x1,0x1]),_0xb320dc=gl['createBuffer']();gl['bindBuffer'](gl['ARRAY_BUFFER'],_0xb320dc),gl['bufferData'](gl['ARRAY_BUFFER'],_0x39568d,gl['STREAM_DRAW']);const _0x369738=gl['getAttribLocation'](paintProgram,'a_position'),_0xd0544b=gl['getAttribLocation'](paintProgram,'a_texCoord');gl['enableVertexAttribArray'](_0x369738),gl['vertexAttribPointer'](_0x369738,0x2,gl['FLOAT'],!0x1,0x10,0x0),gl['enableVertexAttribArray'](_0xd0544b),gl['vertexAttribPointer'](_0xd0544b,0x2,gl['FLOAT'],!0x1,0x10,0x8),gl['drawArrays'](gl['TRIANGLES'],0x0,0x6),gl['disableVertexAttribArray'](_0x369738),gl['disableVertexAttribArray'](_0xd0544b),gl['bindBuffer'](gl['ARRAY_BUFFER'],null),gl['deleteBuffer'](_0xb320dc),gl['bindFramebuffer'](gl['FRAMEBUFFER'],null),needsRedraw=!0x0,requestDrawIfIdle?.();}function drawBrushStrokeToPaintLayer(_0x9a4cce,_0x1448ac){if(!canPaint())return;if(!(gl&&layers['length']&&overlayTexture&&getActiveLayer()))return;if(!Number['isFinite'](_0x9a4cce)||!Number['isFinite'](_0x1448ac))return;if(_0x9a4cce<0x0||_0x1448ac<0x0||_0x9a4cce>canvas['width']||_0x1448ac>canvas['height'])return;const _0x2cc8da=_0x9a4cce*(fixedFBOWidth/canvas['width']),_0x135dd2=_0x1448ac*(fixedFBOHeight/canvas['height']),_0x36368e=getActiveLayer();let _0x2c253b=0x1;if(void 0x0!==dynamicModeEnabled&&dynamicModeEnabled&&(_0x2c253b=void 0x0!==intuitiveMode&&intuitiveMode?0.8+0.8*Math['random']():1.5-Math['random']()),void 0x0===window['__stampCarry']&&(window['__stampCarry']=0x0),void 0x0===window['__angleEMA']&&(window['__angleEMA']=null),_0x36368e['__lastDoc']||(_0x36368e['__lastDoc']=null),!_0x36368e['__lastDoc']){let _0x144e7c=currentAngle;return void 0x0!==reverseModeEnabled&&reverseModeEnabled&&(_0x144e7c+=Math['PI']),drawSingleBrushStamp(_0x2cc8da,_0x135dd2,brushSize*_0x2c253b,_0x144e7c),_0x36368e['__lastDoc']={'x':_0x2cc8da,'y':_0x135dd2},lastFx=_0x2cc8da,lastFy=_0x135dd2,lastX=_0x9a4cce,lastY=_0x1448ac,needsRedraw=!0x0,strokeCount++,void(void 0x0!==FLATTEN_THRESHOLD&&strokeCount>=FLATTEN_THRESHOLD&&flattenStrokes?.());}const _0x48778a=_0x2cc8da-_0x36368e['__lastDoc']['x'],_0x206934=_0x135dd2-_0x36368e['__lastDoc']['y'],_0x5600a1=Math['hypot'](_0x48778a,_0x206934);let _0x587154=Math['atan2'](_0x206934,_0x48778a);if(null==window['__angleEMA'])window['__angleEMA']=_0x587154;else{const _0x4b2867=0.35;let _0x82695=window['__angleEMA'],_0x410fb7=_0x587154;for(;_0x410fb7-_0x82695>Math['PI'];)_0x410fb7-=0x2*Math['PI'];for(;_0x410fb7-_0x82695<-Math['PI'];)_0x410fb7+=0x2*Math['PI'];window['__angleEMA']=_0x82695+(_0x410fb7-_0x82695)*_0x4b2867,_0x587154=window['__angleEMA'];}void 0x0!==reverseModeEnabled&&reverseModeEnabled&&(_0x587154+=Math['PI']);const _0x5e9a04=Math['max'](0x1,brushSize*fixedFBOWidth),_0x11e6da=Math['max'](0.000001,0.3*_0x5e9a04),_0x25b78b=Math['min'](2.5,_0x5600a1/_0x11e6da),_0x103ab7=brushSize*_0x25b78b*_0x2c253b;let _0x2bf1a2=_0x5e9a04*(void 0x0!==lineStepFactor?lineStepFactor:0.3)*_0x25b78b*_0x2c253b;_0x2bf1a2=Math['max'](0.5,_0x2bf1a2);let _0x3e6a21=Math['max'](0x0,_0x2bf1a2-window['__stampCarry']);if(lineMode){for(;_0x3e6a21<=_0x5600a1;){const _0xa6e780=_0x3e6a21/_0x5600a1;drawSingleBrushStamp(_0x36368e['__lastDoc']['x']+_0x48778a*_0xa6e780,_0x36368e['__lastDoc']['y']+_0x206934*_0xa6e780,_0x103ab7,_0x587154),_0x3e6a21+=_0x2bf1a2;}window['__stampCarry']=_0x3e6a21-_0x5600a1;}else drawSingleBrushStamp(_0x2cc8da,_0x135dd2,_0x103ab7,_0x587154),window['__stampCarry']=(_0x2bf1a2-_0x5600a1%_0x2bf1a2)%_0x2bf1a2;_0x36368e['__lastDoc']={'x':_0x2cc8da,'y':_0x135dd2},lastFx=_0x2cc8da,lastFy=_0x135dd2,lastX=_0x9a4cce,lastY=_0x1448ac,strokeCount++,void 0x0!==FLATTEN_THRESHOLD&&strokeCount>=FLATTEN_THRESHOLD&&flattenStrokes?.(),needsRedraw=!0x0;}function drawBrushStrokeToPaintLayer(_0x5258bd,_0x712e82){if(!canPaint())return;if(!(gl&&layers['length']&&overlayTexture&&getActiveLayer()))return;if(!Number['isFinite'](_0x5258bd)||!Number['isFinite'](_0x712e82))return;if(_0x5258bd<0x0||_0x712e82<0x0||_0x5258bd>canvas['width']||_0x712e82>canvas['height'])return;const _0x1ce392=_0x5258bd*(fixedFBOWidth/canvas['width']),_0x93b859=_0x712e82*(fixedFBOHeight/canvas['height']);if(void 0x0===window['__stampCarry']&&(window['__stampCarry']=0x0),void 0x0===window['__angleEMA']&&(window['__angleEMA']=null),null===lastFx||null===lastFy){let _0x247071=0x1;dynamicModeEnabled&&(_0x247071=intuitiveMode?0.8+0.8*Math['random']():1.5-Math['random']());let _0x22561f=currentAngle;return reverseModeEnabled&&(_0x22561f+=Math['PI']),drawSingleBrushStamp(_0x1ce392,_0x93b859,brushSize*_0x247071,_0x22561f),lastFx=_0x1ce392,lastFy=_0x93b859,lastX=_0x5258bd,lastY=_0x712e82,needsRedraw=!0x0,strokeCount++,void(strokeCount>=FLATTEN_THRESHOLD&&flattenStrokes());}const _0x224cc3=_0x1ce392-lastFx,_0x53c337=_0x93b859-lastFy,_0x3bd64d=Math['hypot'](_0x224cc3,_0x53c337);if(_0x3bd64d<=0.000001)return;const _0x2ac07d=Math['atan2'](_0x53c337,_0x224cc3);if(null===window['__angleEMA'])window['__angleEMA']=_0x2ac07d;else{const _0x489db3=window['__angleEMA'],_0x40abc8=Math['cos'](_0x489db3),_0x2e58e0=Math['sin'](_0x489db3),_0x3b7be1=0.25,_0x34c079=(0x1-_0x3b7be1)*_0x40abc8+_0x3b7be1*Math['cos'](_0x2ac07d),_0x3e24ab=(0x1-_0x3b7be1)*_0x2e58e0+_0x3b7be1*Math['sin'](_0x2ac07d);window['__angleEMA']=Math['atan2'](_0x3e24ab,_0x34c079);}let _0x4b5e48=window['__angleEMA'];reverseModeEnabled&&(_0x4b5e48+=Math['PI']);let _0x3756cb=0x1;dynamicModeEnabled&&(_0x3756cb=intuitiveMode?0.8+0.8*Math['random']():1.5-Math['random']());const _0x1053e1=Math['max'](0x1,brushSize*fixedFBOWidth),_0x54d847=Math['max'](0.000001,0.3*_0x1053e1),_0xf44c23=Math['min'](2.5,_0x3bd64d/_0x54d847),_0x5ddd97=brushSize*_0xf44c23*_0x3756cb;let _0x5ee38a=_0x1053e1*lineStepFactor*_0xf44c23*_0x3756cb;_0x5ee38a=Math['max'](0.5,_0x5ee38a);let _0x5d7c5c=Math['max'](0x0,_0x5ee38a-window['__stampCarry']);if(lineMode){for(;_0x5d7c5c<=_0x3bd64d;){const _0x5adb20=_0x5d7c5c/_0x3bd64d;drawSingleBrushStamp(lastFx+_0x224cc3*_0x5adb20,lastFy+_0x53c337*_0x5adb20,_0x5ddd97,_0x4b5e48),_0x5d7c5c+=_0x5ee38a;}window['__stampCarry']=_0x5d7c5c-_0x3bd64d;}else drawSingleBrushStamp(_0x1ce392,_0x93b859,_0x5ddd97,_0x4b5e48),window['__stampCarry']=(_0x5ee38a-_0x3bd64d%_0x5ee38a)%_0x5ee38a;lastFx=_0x1ce392,lastFy=_0x93b859,lastX=_0x5258bd,lastY=_0x712e82,strokeCount++,strokeCount>=FLATTEN_THRESHOLD&&flattenStrokes(),needsRedraw=!0x0;}function drawBrushOverlay(){gl['enable'](gl['BLEND']),gl['blendFunc'](gl['SRC_ALPHA'],gl['ONE_MINUS_SRC_ALPHA']),gl['useProgram'](overlayProgram);let _0x4d7c40=gl['getUniformLocation'](overlayProgram,'u_flipY');gl['uniform1f'](_0x4d7c40,-0x1);let _0x239e17=gl['getUniformLocation'](overlayProgram,'u_resolution');gl['uniform2f'](_0x239e17,canvas['width'],canvas['height']);let _0x279ca3=gl['getUniformLocation'](overlayProgram,'u_tint');gl['uniform4fv'](_0x279ca3,tintColor);const _0x3a7eb8=overlayPosition[0x0]*canvas['width'],_0x2e7c37=overlayPosition[0x1]*canvas['height'],_0x1c157d=brushSize*canvas['width'],_0x40eec5=_0x1c157d/0x2,_0x54c3c0=_0x1c157d/brushAspect/0x2,_0x2baac4=[{'x':-_0x40eec5,'y':-_0x54c3c0},{'x':_0x40eec5,'y':-_0x54c3c0},{'x':-_0x40eec5,'y':_0x54c3c0},{'x':_0x40eec5,'y':_0x54c3c0}],_0xbf40d6=Math['cos'](currentAngle),_0x1052cf=Math['sin'](currentAngle),_0x29128a=_0x2baac4['map'](function(_0x352ee3){return{'x':_0x352ee3['x']*_0xbf40d6-_0x352ee3['y']*_0x1052cf,'y':_0x352ee3['x']*_0x1052cf+_0x352ee3['y']*_0xbf40d6};}),_0x499969={'x':_0x3a7eb8+_0x29128a[0x0]['x'],'y':_0x2e7c37+_0x29128a[0x0]['y']},_0x34dc0c={'x':_0x3a7eb8+_0x29128a[0x1]['x'],'y':_0x2e7c37+_0x29128a[0x1]['y']},_0x104114={'x':_0x3a7eb8+_0x29128a[0x2]['x'],'y':_0x2e7c37+_0x29128a[0x2]['y']},_0x454d24={'x':_0x3a7eb8+_0x29128a[0x3]['x'],'y':_0x2e7c37+_0x29128a[0x3]['y']},_0x107e56=new Float32Array([_0x499969['x'],_0x499969['y'],0x0,0x0,_0x34dc0c['x'],_0x34dc0c['y'],0x1,0x0,_0x104114['x'],_0x104114['y'],0x0,0x1,_0x104114['x'],_0x104114['y'],0x0,0x1,_0x34dc0c['x'],_0x34dc0c['y'],0x1,0x0,_0x454d24['x'],_0x454d24['y'],0x1,0x1]),_0x3cf94f=gl['createBuffer']();gl['bindBuffer'](gl['ARRAY_BUFFER'],_0x3cf94f),gl['bufferData'](gl['ARRAY_BUFFER'],_0x107e56,gl['STREAM_DRAW']);let _0x4ad41c=gl['getAttribLocation'](overlayProgram,'a_position');gl['enableVertexAttribArray'](_0x4ad41c),gl['vertexAttribPointer'](_0x4ad41c,0x2,gl['FLOAT'],!0x1,0x10,0x0);let _0x429e4e=gl['getAttribLocation'](overlayProgram,'a_texCoord');gl['enableVertexAttribArray'](_0x429e4e),gl['vertexAttribPointer'](_0x429e4e,0x2,gl['FLOAT'],!0x1,0x10,0x8),gl['activeTexture'](gl['TEXTURE0']),gl['bindTexture'](gl['TEXTURE_2D'],overlayTexture);const _0x2ba3b9=gl['getUniformLocation'](overlayProgram,'u_brush');gl['uniform1i'](_0x2ba3b9,0x0),gl['drawArrays'](gl['TRIANGLES'],0x0,0x6),gl['deleteBuffer'](_0x3cf94f),gl['disableVertexAttribArray'](_0x4ad41c),gl['disableVertexAttribArray'](_0x429e4e);}function activeLayerWouldClip(){const _0x59911b=getActiveLayer?.();if(!_0x59911b)return!0x1;const _0x5d17db=0x0|fixedFBOWidth,_0xe5ccc6=0x0|fixedFBOHeight,_0x59e04d=Number['isFinite'](_0x59911b['ox'])?_0x59911b['ox']:0x0,_0x2e716b=Number['isFinite'](_0x59911b['oy'])?_0x59911b['oy']:0x0,_0x2949ea=Math['max'](0x1,Number['isFinite'](_0x59911b['texW'])?_0x59911b['texW']:_0x5d17db),_0x51d39b=Math['max'](0x1,Number['isFinite'](_0x59911b['texH'])?_0x59911b['texH']:_0xe5ccc6),_0x586057=Number['isFinite'](_0x59911b['scaleX'])?_0x59911b['scaleX']:0x1,_0x4483bb=Number['isFinite'](_0x59911b['scaleY'])?_0x59911b['scaleY']:0x1,_0x52c2ab=Number['isFinite'](_0x59911b['rotation'])?_0x59911b['rotation']:0x0,_0x2fb621=Number['isFinite'](_0x59911b['x'])?_0x59911b['x']:0x0,_0x4bfa0a=Number['isFinite'](_0x59911b['y'])?_0x59911b['y']:0x0,_0x2f6127=Number['isFinite'](_0x59911b['px'])?_0x59911b['px']:0.5*_0x5d17db,_0x16a1d9=Number['isFinite'](_0x59911b['py'])?_0x59911b['py']:0.5*_0xe5ccc6,_0x4e9114=Math['cos'](_0x52c2ab),_0x163328=Math['sin'](_0x52c2ab);function _0x94a63b(_0x3f94ae,_0x5bd072){let _0x35e909=(_0x3f94ae-_0x2f6127)*_0x586057,_0x27d908=(_0x5bd072-_0x16a1d9)*_0x4483bb;return{'x':_0x2f6127+(_0x35e909*_0x4e9114-_0x27d908*_0x163328)+_0x2fb621,'y':_0x16a1d9+(_0x35e909*_0x163328+_0x27d908*_0x4e9114)+_0x4bfa0a};}const _0x11571c=_0x94a63b(_0x59e04d,_0x2e716b),_0x5e3027=_0x94a63b(_0x59e04d+_0x2949ea,_0x2e716b),_0x47a929=_0x94a63b(_0x59e04d,_0x2e716b+_0x51d39b),_0x2370a8=_0x94a63b(_0x59e04d+_0x2949ea,_0x2e716b+_0x51d39b);return _0x11571c['x']<0x0||_0x11571c['y']<0x0||_0x11571c['x']>_0x5d17db||_0x11571c['y']>_0xe5ccc6||_0x5e3027['x']<0x0||_0x5e3027['y']<0x0||_0x5e3027['x']>_0x5d17db||_0x5e3027['y']>_0xe5ccc6||_0x47a929['x']<0x0||_0x47a929['y']<0x0||_0x47a929['x']>_0x5d17db||_0x47a929['y']>_0xe5ccc6||_0x2370a8['x']<0x0||_0x2370a8['y']<0x0||_0x2370a8['x']>_0x5d17db||_0x2370a8['y']>_0xe5ccc6;}function promoteLayerForScale(_0xca03d9=1.25){const _0x3d07d4=getActiveLayer?.();if(!(gl&&_0x3d07d4&&_0x3d07d4['texture']&&quadProgram))return!0x1;const _0x533648=Math['abs'](Number['isFinite'](_0x3d07d4['scaleX'])?_0x3d07d4['scaleX']:0x1),_0x312eff=Math['abs'](Number['isFinite'](_0x3d07d4['scaleY'])?_0x3d07d4['scaleY']:0x1);if(Math['max'](_0x533648,_0x312eff)<=_0xca03d9)return!0x1;const _0x1cde22=Math['max'](0x1,0x0|_0x3d07d4['texW']),_0x2cd413=Math['max'](0x1,0x0|_0x3d07d4['texH']),_0x3901d4=0x0|gl['getParameter'](gl['MAX_TEXTURE_SIZE']),_0x175565=Math['min'](_0x3901d4,Math['max'](0x1,Math['round'](_0x1cde22*_0x533648))),_0x1d28a0=Math['min'](_0x3901d4,Math['max'](0x1,Math['round'](_0x2cd413*_0x312eff))),_0x14cf16=gl['getParameter'](gl['FRAMEBUFFER_BINDING']),_0x13c15f=gl['getParameter'](gl['CURRENT_PROGRAM']),_0x15531f=gl['getParameter'](gl['VIEWPORT']),_0x2e735b=gl['createTexture']();gl['bindTexture'](gl['TEXTURE_2D'],_0x2e735b),gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],_0x175565,_0x1d28a0,0x0,gl['RGBA'],gl['UNSIGNED_BYTE'],null),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MIN_FILTER'],gl['NEAREST']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MAG_FILTER'],gl['NEAREST']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_S'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_T'],gl['CLAMP_TO_EDGE']);const _0x3e093f=gl['createFramebuffer']();gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x3e093f),gl['framebufferTexture2D'](gl['FRAMEBUFFER'],gl['COLOR_ATTACHMENT0'],gl['TEXTURE_2D'],_0x2e735b,0x0),gl['viewport'](0x0,0x0,_0x175565,_0x1d28a0),gl['disable'](gl['BLEND']),gl['clearColor'](0x0,0x0,0x0,0x0),gl['clear'](gl['COLOR_BUFFER_BIT']),gl['useProgram'](quadProgram);const _0x58fe88=gl['getUniformLocation'](quadProgram,'u_flipY');_0x58fe88&&gl['uniform1f'](_0x58fe88,0x1);const _0x460d24=gl['getUniformLocation'](quadProgram,'u_resolution');_0x460d24&&gl['uniform2f'](_0x460d24,_0x175565,_0x1d28a0);const _0x4a21e3=gl['getUniformLocation'](quadProgram,'u_layerOpacity');_0x4a21e3&&gl['uniform1f'](_0x4a21e3,0x1);const _0x183ced=gl['getUniformLocation'](quadProgram,'u_texture'),_0x330613=new Float32Array([0x0,0x0,0x0,0x0,_0x175565,0x0,0x1,0x0,0x0,_0x1d28a0,0x0,0x1,0x0,_0x1d28a0,0x0,0x1,_0x175565,0x0,0x1,0x0,_0x175565,_0x1d28a0,0x1,0x1]),_0x328adb=gl['createBuffer']();gl['bindBuffer'](gl['ARRAY_BUFFER'],_0x328adb),gl['bufferData'](gl['ARRAY_BUFFER'],_0x330613,gl['STREAM_DRAW']);const _0x4b5402=gl['getAttribLocation'](quadProgram,'a_position'),_0x44be14=gl['getAttribLocation'](quadProgram,'a_texCoord');gl['enableVertexAttribArray'](_0x4b5402),gl['vertexAttribPointer'](_0x4b5402,0x2,gl['FLOAT'],!0x1,0x10,0x0),gl['enableVertexAttribArray'](_0x44be14),gl['vertexAttribPointer'](_0x44be14,0x2,gl['FLOAT'],!0x1,0x10,0x8),gl['activeTexture'](gl['TEXTURE0']),gl['bindTexture'](gl['TEXTURE_2D'],_0x3d07d4['texture']),_0x183ced&&gl['uniform1i'](_0x183ced,0x0),gl['drawArrays'](gl['TRIANGLES'],0x0,0x6),gl['disableVertexAttribArray'](_0x4b5402),gl['disableVertexAttribArray'](_0x44be14),gl['bindBuffer'](gl['ARRAY_BUFFER'],null),gl['deleteBuffer'](_0x328adb);const _0x2e3023=_0x3d07d4['texture'],_0x4224e3=_0x3d07d4['fbo'];_0x3d07d4['texture']=_0x2e735b,_0x3d07d4['fbo']=_0x3e093f,_0x3d07d4['texW']=_0x175565,_0x3d07d4['texH']=_0x1d28a0,_0x533648&&(_0x3d07d4['scaleX']/=_0x533648),_0x312eff&&(_0x3d07d4['scaleY']/=_0x312eff);try{_0x2e3023&&gl['deleteTexture'](_0x2e3023);}catch{}try{_0x4224e3&&gl['deleteFramebuffer'](_0x4224e3);}catch{}return gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x14cf16),gl['useProgram'](_0x13c15f),_0x15531f&&gl['viewport'](_0x15531f[0x0],_0x15531f[0x1],_0x15531f[0x2],_0x15531f[0x3]),!0x0;}function applyActiveLayerTransform(){const _0x26ce6c=getActiveLayer?.();if(!(gl&&_0x26ce6c&&_0x26ce6c['texture']&&quadProgram))return;const _0x45df55=0x0|fixedFBOWidth,_0x292666=0x0|fixedFBOHeight,_0x27252a=Number['isFinite'](_0x26ce6c['ox'])?_0x26ce6c['ox']:0x0,_0x3c6281=Number['isFinite'](_0x26ce6c['oy'])?_0x26ce6c['oy']:0x0,_0x5418db=Math['max'](0x1,Number['isFinite'](_0x26ce6c['texW'])?_0x26ce6c['texW']:_0x45df55),_0x5b3430=Math['max'](0x1,Number['isFinite'](_0x26ce6c['texH'])?_0x26ce6c['texH']:_0x292666),_0x30d156=Number['isFinite'](_0x26ce6c['scaleX'])?_0x26ce6c['scaleX']:0x1,_0x3f1608=Number['isFinite'](_0x26ce6c['scaleY'])?_0x26ce6c['scaleY']:0x1,_0x3f661e=Number['isFinite'](_0x26ce6c['rotation'])?_0x26ce6c['rotation']:0x0,_0x50bdb3=Number['isFinite'](_0x26ce6c['x'])?_0x26ce6c['x']:0x0,_0x402fee=Number['isFinite'](_0x26ce6c['y'])?_0x26ce6c['y']:0x0,_0x308dcb=Number['isFinite'](_0x26ce6c['px'])?_0x26ce6c['px']:0.5*_0x45df55,_0x38bd68=Number['isFinite'](_0x26ce6c['py'])?_0x26ce6c['py']:0.5*_0x292666,_0x49fd7c=Math['cos'](_0x3f661e),_0x5e3e69=Math['sin'](_0x3f661e);function _0x13e0b6(_0x187797,_0x172d62){let _0x1d5939=(_0x187797-_0x308dcb)*_0x30d156,_0x21e606=(_0x172d62-_0x38bd68)*_0x3f1608;return{'x':_0x308dcb+(_0x1d5939*_0x49fd7c-_0x21e606*_0x5e3e69)+_0x50bdb3,'y':_0x38bd68+(_0x1d5939*_0x5e3e69+_0x21e606*_0x49fd7c)+_0x402fee};}const _0x2bb99b=_0x13e0b6(_0x27252a,_0x3c6281),_0x3499d2=_0x13e0b6(_0x27252a+_0x5418db,_0x3c6281),_0x4960cb=_0x13e0b6(_0x27252a,_0x3c6281+_0x5b3430),_0x360424=_0x13e0b6(_0x27252a+_0x5418db,_0x3c6281+_0x5b3430),_0x4ce302=Math['floor'](Math['min'](_0x2bb99b['x'],_0x3499d2['x'],_0x4960cb['x'],_0x360424['x'])),_0x65f675=Math['floor'](Math['min'](_0x2bb99b['y'],_0x3499d2['y'],_0x4960cb['y'],_0x360424['y'])),_0x279ca7=Math['ceil'](Math['max'](_0x2bb99b['x'],_0x3499d2['x'],_0x4960cb['x'],_0x360424['x'])),_0x3e6990=Math['ceil'](Math['max'](_0x2bb99b['y'],_0x3499d2['y'],_0x4960cb['y'],_0x360424['y'])),_0x5c4ddc=Math['max'](0x1,_0x279ca7-_0x4ce302|0x0),_0x32340d=Math['max'](0x1,_0x3e6990-_0x65f675|0x0),_0x5c2b11=gl['getParameter'](gl['FRAMEBUFFER_BINDING']),_0x581342=gl['getParameter'](gl['CURRENT_PROGRAM']),_0x47ad06=gl['getParameter'](gl['VIEWPORT']),_0x43bec4=gl['createTexture']();gl['bindTexture'](gl['TEXTURE_2D'],_0x43bec4),gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],_0x5c4ddc,_0x32340d,0x0,gl['RGBA'],gl['UNSIGNED_BYTE'],null),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MIN_FILTER'],gl['NEAREST']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MAG_FILTER'],gl['NEAREST']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_S'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_T'],gl['CLAMP_TO_EDGE']);const _0x81e76d=gl['createFramebuffer']();gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x81e76d),gl['framebufferTexture2D'](gl['FRAMEBUFFER'],gl['COLOR_ATTACHMENT0'],gl['TEXTURE_2D'],_0x43bec4,0x0),gl['viewport'](0x0,0x0,_0x5c4ddc,_0x32340d),gl['disable'](gl['BLEND']),gl['clearColor'](0x0,0x0,0x0,0x0),gl['clear'](gl['COLOR_BUFFER_BIT']),gl['useProgram'](quadProgram);const _0x112bdc=gl['getUniformLocation'](quadProgram,'u_flipY');_0x112bdc&&gl['uniform1f'](_0x112bdc,0x1);const _0x8b18d8=gl['getUniformLocation'](quadProgram,'u_resolution');_0x8b18d8&&gl['uniform2f'](_0x8b18d8,_0x5c4ddc,_0x32340d);const _0x522b89=gl['getUniformLocation'](quadProgram,'u_layerOpacity');_0x522b89&&gl['uniform1f'](_0x522b89,0x1);const _0x25b2cf=gl['getUniformLocation'](quadProgram,'u_texture'),_0x250733=new Float32Array([_0x2bb99b['x']-_0x4ce302,_0x2bb99b['y']-_0x65f675,0x0,0x0,_0x3499d2['x']-_0x4ce302,_0x3499d2['y']-_0x65f675,0x1,0x0,_0x4960cb['x']-_0x4ce302,_0x4960cb['y']-_0x65f675,0x0,0x1,_0x4960cb['x']-_0x4ce302,_0x4960cb['y']-_0x65f675,0x0,0x1,_0x3499d2['x']-_0x4ce302,_0x3499d2['y']-_0x65f675,0x1,0x0,_0x360424['x']-_0x4ce302,_0x360424['y']-_0x65f675,0x1,0x1]),_0x3f1768=gl['createBuffer']();gl['bindBuffer'](gl['ARRAY_BUFFER'],_0x3f1768),gl['bufferData'](gl['ARRAY_BUFFER'],_0x250733,gl['STREAM_DRAW']);const _0x210aa4=gl['getAttribLocation'](quadProgram,'a_position'),_0xb6e46d=gl['getAttribLocation'](quadProgram,'a_texCoord');gl['enableVertexAttribArray'](_0x210aa4),gl['vertexAttribPointer'](_0x210aa4,0x2,gl['FLOAT'],!0x1,0x10,0x0),gl['enableVertexAttribArray'](_0xb6e46d),gl['vertexAttribPointer'](_0xb6e46d,0x2,gl['FLOAT'],!0x1,0x10,0x8),gl['activeTexture'](gl['TEXTURE0']),gl['bindTexture'](gl['TEXTURE_2D'],_0x26ce6c['texture']),_0x25b2cf&&gl['uniform1i'](_0x25b2cf,0x0),gl['drawArrays'](gl['TRIANGLES'],0x0,0x6),gl['disableVertexAttribArray'](_0x210aa4),gl['disableVertexAttribArray'](_0xb6e46d),gl['bindBuffer'](gl['ARRAY_BUFFER'],null),gl['deleteBuffer'](_0x3f1768);const _0x507c08=_0x26ce6c['texture'],_0x4da89e=_0x26ce6c['fbo'];_0x26ce6c['texture']=_0x43bec4,_0x26ce6c['fbo']=_0x81e76d,_0x26ce6c['ox']=_0x4ce302,_0x26ce6c['oy']=_0x65f675,_0x26ce6c['texW']=_0x5c4ddc,_0x26ce6c['texH']=_0x32340d,_0x26ce6c['x']=0x0,_0x26ce6c['y']=0x0,_0x26ce6c['scaleX']=0x1,_0x26ce6c['scaleY']=0x1,_0x26ce6c['rotation']=0x0,_0x26ce6c['px']=_0x26ce6c['ox']+0.5*_0x26ce6c['texW'],_0x26ce6c['py']=_0x26ce6c['oy']+0.5*_0x26ce6c['texH'];try{_0x507c08&&gl['deleteTexture'](_0x507c08);}catch{}try{_0x4da89e&&gl['deleteFramebuffer'](_0x4da89e);}catch{}gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x5c2b11),gl['useProgram'](_0x581342),_0x47ad06&&gl['viewport'](_0x47ad06[0x0],_0x47ad06[0x1],_0x47ad06[0x2],_0x47ad06[0x3]),needsRedraw=!0x0,requestDrawIfIdle?.();}function drawScene(){if(!gl||!quadProgram||!canvas)return;const _0xf12923='undefined'!=typeof navigator&&navigator['maxTouchPoints']>0x0||'undefined'!=typeof window&&'ontouchstart'in window;if(gl['bindFramebuffer'](gl['FRAMEBUFFER'],null),gl['viewport'](0x0,0x0,canvas['width'],canvas['height']),gl['disable'](gl['DEPTH_TEST']),gl['disable'](gl['CULL_FACE']),gl['disable'](gl['SCISSOR_TEST']),gl['clearColor'](0x0,0x0,0x0,0x0),gl['clear'](gl['COLOR_BUFFER_BIT']),texture&&gl['isTexture'](texture)){const _0x3e0d72=new Float32Array([0x0,0x0,0x0,0x0,canvas['width'],0x0,0x1,0x0,0x0,canvas['height'],0x0,0x1,0x0,canvas['height'],0x0,0x1,canvas['width'],0x0,0x1,0x0,canvas['width'],canvas['height'],0x1,0x1]);gl['disable'](gl['BLEND']),function(_0x140d01,_0x3c452a,_0x466d9d,_0x2826f5){if(!_0x140d01||!_0x3c452a||!gl['isTexture'](_0x3c452a))return;gl['useProgram'](_0x140d01);const _0x5e6353=gl['getUniformLocation'](_0x140d01,'u_flipY');_0x5e6353&&gl['uniform1f'](_0x5e6353,-0x1);const _0x284e0d=gl['getUniformLocation'](_0x140d01,'u_resolution');_0x284e0d&&gl['uniform2f'](_0x284e0d,canvas['width'],canvas['height']);const _0x2ecdee=gl['getUniformLocation'](_0x140d01,'u_layerOpacity');_0x2ecdee&&gl['uniform1f'](_0x2ecdee,null!=_0x2826f5?_0x2826f5:0x1);const _0x29d394=gl['createBuffer']();gl['bindBuffer'](gl['ARRAY_BUFFER'],_0x29d394),gl['bufferData'](gl['ARRAY_BUFFER'],_0x466d9d,gl['STREAM_DRAW']);const _0x53cda0=gl['getAttribLocation'](_0x140d01,'a_position'),_0x313e93=gl['getAttribLocation'](_0x140d01,'a_texCoord');_0x53cda0>=0x0&&(gl['enableVertexAttribArray'](_0x53cda0),gl['vertexAttribPointer'](_0x53cda0,0x2,gl['FLOAT'],!0x1,0x10,0x0)),_0x313e93>=0x0&&(gl['enableVertexAttribArray'](_0x313e93),gl['vertexAttribPointer'](_0x313e93,0x2,gl['FLOAT'],!0x1,0x10,0x8)),gl['activeTexture'](gl['TEXTURE0']),gl['bindTexture'](gl['TEXTURE_2D'],_0x3c452a);const _0x14b437=gl['getUniformLocation'](_0x140d01,'u_texture')??gl['getUniformLocation'](_0x140d01,'u_brush');_0x14b437&&gl['uniform1i'](_0x14b437,0x0),gl['drawArrays'](gl['TRIANGLES'],0x0,0x6),_0x53cda0>=0x0&&gl['disableVertexAttribArray'](_0x53cda0),_0x313e93>=0x0&&gl['disableVertexAttribArray'](_0x313e93),gl['bindBuffer'](gl['ARRAY_BUFFER'],null),gl['deleteBuffer'](_0x29d394);}(quadProgram,texture,_0x3e0d72,0x1);}if(gl['enable'](gl['BLEND']),gl['blendFunc'](gl['SRC_ALPHA'],gl['ONE_MINUS_SRC_ALPHA']),Array['isArray'](layers))for(let _0x2049bf=0x0;_0x2049bf<layers['length'];_0x2049bf++){const _0x47530f=layers[_0x2049bf];!_0x47530f||!_0x47530f['visible']||_0x47530f['opacity']<=0x0||_0x47530f['texture']&&gl['isTexture'](_0x47530f['texture'])&&drawLayerWithTransform(quadProgram,_0x47530f);}gl['disable'](gl['BLEND']);const _0x147552=!(!transformTool||'idle'===transformTool['mode']),_0x36a62d=_0x147552&&!_0xf12923;if((isDrawing||_0x147552||brushHUD['visible'])&&overlayProgram&&overlayTexture&&gl['isTexture'](overlayTexture)&&'function'==typeof drawBrushOverlay){gl['useProgram'](overlayProgram);const _0x361b56=gl['getUniformLocation'](overlayProgram,'u_flipY');_0x361b56&&gl['uniform1f'](_0x361b56,-0x1);const _0x3afb2a=gl['getUniformLocation'](overlayProgram,'u_resolution');if(_0x3afb2a&&gl['uniform2f'](_0x3afb2a,canvas['width'],canvas['height']),drawBrushOverlay(),_0x36a62d){const _0x5065a7=overlayPosition[0x0]*canvas['width'],_0x45760c=overlayPosition[0x1]*canvas['height'],_0x3a00eb=brushSize*canvas['width'],_0x316627=1.5*_0x3a00eb,_0x54dac8=Math['max'](0x1,0.06*_0x3a00eb);'function'==typeof drawRingOverlay&&drawRingOverlay(_0x5065a7,_0x45760c,_0x316627,_0x54dac8,[0x1,0x0,0x0,0.95]),'function'==typeof drawDashedLine&&drawDashedLine(lastPointer?.['cx']??_0x5065a7,lastPointer?.['cy']??_0x45760c,_0x5065a7,_0x45760c,1.5,0xa,0x6,[0x1,0x0,0x0,0.95]);}}if(_0x147552&&'object'==typeof touchViz&&touchViz?.['visible']&&Array['isArray'](touchViz['pts'])&&touchViz['pts']['length']&&'function'==typeof drawRingOverlay){if(overlayProgram){gl['useProgram'](overlayProgram);const _0x20734a=gl['getUniformLocation'](overlayProgram,'u_flipY');_0x20734a&&gl['uniform1f'](_0x20734a,-0x1);const _0x2302a3=gl['getUniformLocation'](overlayProgram,'u_resolution');_0x2302a3&&gl['uniform2f'](_0x2302a3,canvas['width'],canvas['height']);}const _0x1f4391=[0x0,0x1,0x0,0.95],_0x2ad48e=0x14*(window['devicePixelRatio']||0x1),_0x51ef19=0x2*(window['devicePixelRatio']||0x1),_0x443a1f=0x2,_0x3f2009=0xa,_0x415271=0x6;for(const _0x170e03 of touchViz['pts'])drawRingOverlay(_0x170e03['x'],_0x170e03['y'],_0x2ad48e,_0x51ef19,_0x1f4391);if(0x2===touchViz['pts']['length']&&'function'==typeof drawDashedLine){const _0x1b6d8a=touchViz['pts'][0x0],_0x1c2d6e=touchViz['pts'][0x1];drawDashedLine(_0x1b6d8a['x'],_0x1b6d8a['y'],_0x1c2d6e['x'],_0x1c2d6e['y'],_0x443a1f,_0x3f2009,_0x415271,_0x1f4391);}}gl['bindBuffer'](gl['ARRAY_BUFFER'],null),gl['bindTexture'](gl['TEXTURE_2D'],null),gl['useProgram'](null),maybeAutoHideBrushHUD();}document['addEventListener']('keydown',_0x1ad3b9=>{if('function'==typeof isUserTyping&&isUserTyping())return;if(void 0x0!==spacePanning&&spacePanning)return;if(void 0x0!==isDrawing&&isDrawing)return;if(_0x1ad3b9['ctrlKey']||_0x1ad3b9['metaKey']||_0x1ad3b9['altKey'])return;const _0x57ca1f=_0x1ad3b9['key'],_0x2ce027=_0x57ca1f['toLowerCase'](),_0x3a7c6b='ArrowUp'===_0x57ca1f||'ArrowDown'===_0x57ca1f||'ArrowLeft'===_0x57ca1f||'ArrowRight'===_0x57ca1f,_0x458d04=Math['PI']/0xb4;if(_0x1ad3b9['shiftKey']&&'d'===_0x2ce027){_0x1ad3b9['preventDefault'](),_0x1ad3b9['stopImmediatePropagation']();const _0x5f1ae3=Array['isArray'](layers)?layers['length']:0x0;try{'function'==typeof duplicateLayer&&duplicateLayer('number'==typeof activeLayerIndex?activeLayerIndex:void 0x0);}catch{}if((Array['isArray'](layers)?layers['length']:0x0)>_0x5f1ae3){try{const _0x1fff21='function'==typeof getActiveLayer?getActiveLayer():layers&&layers[activeLayerIndex]?layers[activeLayerIndex]:null;_0x1fff21&&(_0x1fff21['x']=(Number['isFinite'](_0x1fff21['x'])?_0x1fff21['x']:0x0)+0xa,_0x1fff21['y']=(Number['isFinite'](_0x1fff21['y'])?_0x1fff21['y']:0x0)+0xa,'function'==typeof startTransform&&startTransform('grab'));}catch{}try{rebuildLayersUI?.();}catch{}try{showStatusMessage?.('Layer\x20duplicated\x20(Shift+D)','success');}catch{}needsRedraw=!0x0,'function'==typeof requestDrawIfIdle&&requestDrawIfIdle();}return;}if('function'==typeof isMobile&&!isMobile()&&'idle'!==transformTool?.['mode']&&_0x3a7c6b){_0x1ad3b9['preventDefault'](),_0x1ad3b9['stopImmediatePropagation']();const _0x40a4e3='function'==typeof getActiveLayer?getActiveLayer():null;if(!_0x40a4e3)return;Number['isFinite'](_0x40a4e3['x'])||(_0x40a4e3['x']=0x0),Number['isFinite'](_0x40a4e3['y'])||(_0x40a4e3['y']=0x0),Number['isFinite'](_0x40a4e3['scaleX'])||(_0x40a4e3['scaleX']=0x1),Number['isFinite'](_0x40a4e3['scaleY'])||(_0x40a4e3['scaleY']=0x1),Number['isFinite'](_0x40a4e3['rotation'])||(_0x40a4e3['rotation']=0x0);const _0x2a05f8=transformTool['mode'];if('grab'===_0x2a05f8){const _0x58fd7b=_0x1ad3b9['shiftKey']?0xa:0x1;'ArrowLeft'===_0x57ca1f&&(_0x40a4e3['x']-=_0x58fd7b),'ArrowRight'===_0x57ca1f&&(_0x40a4e3['x']+=_0x58fd7b),'ArrowUp'===_0x57ca1f&&(_0x40a4e3['y']-=_0x58fd7b),'ArrowDown'===_0x57ca1f&&(_0x40a4e3['y']+=_0x58fd7b);}else{if('scale'===_0x2a05f8){const _0x3eb3ab=_0x1ad3b9['shiftKey']?0.1:0.01,_0x37d42c=_0x1e8c89=>Math['max'](0.001,_0x1e8c89);if(_0x1ad3b9['shiftKey']){const _0x316900='ArrowRight'===_0x57ca1f||'ArrowUp'===_0x57ca1f?0x1:'ArrowLeft'===_0x57ca1f||'ArrowDown'===_0x57ca1f?-0x1:0x0;if(0x0!==_0x316900){const _0x32e842=0x1+_0x316900*_0x3eb3ab;_0x40a4e3['scaleX']=_0x37d42c(_0x40a4e3['scaleX']*_0x32e842),_0x40a4e3['scaleY']=_0x37d42c(_0x40a4e3['scaleY']*_0x32e842);}}else'ArrowLeft'===_0x57ca1f?_0x40a4e3['scaleX']=_0x37d42c(_0x40a4e3['scaleX']*(0x1-_0x3eb3ab)):'ArrowRight'===_0x57ca1f?_0x40a4e3['scaleX']=_0x37d42c(_0x40a4e3['scaleX']*(0x1+_0x3eb3ab)):'ArrowUp'===_0x57ca1f?_0x40a4e3['scaleY']=_0x37d42c(_0x40a4e3['scaleY']*(0x1+_0x3eb3ab)):'ArrowDown'===_0x57ca1f&&(_0x40a4e3['scaleY']=_0x37d42c(_0x40a4e3['scaleY']*(0x1-_0x3eb3ab)));}else{if('rotate'===_0x2a05f8){const _0x2706d3=_0x1ad3b9['shiftKey']?0x5:0x1,_0x44fe83='ArrowRight'===_0x57ca1f||'ArrowDown'===_0x57ca1f?0x1:'ArrowLeft'===_0x57ca1f||'ArrowUp'===_0x57ca1f?-0x1:0x0;_0x40a4e3['rotation']+=_0x44fe83*_0x2706d3*_0x458d04;}else{const _0x444812=_0x1ad3b9['shiftKey']?0xa:0x1;'ArrowLeft'===_0x57ca1f&&(_0x40a4e3['x']-=_0x444812),'ArrowRight'===_0x57ca1f&&(_0x40a4e3['x']+=_0x444812),'ArrowUp'===_0x57ca1f&&(_0x40a4e3['y']-=_0x444812),'ArrowDown'===_0x57ca1f&&(_0x40a4e3['y']+=_0x444812);}}}try{startRender?.('transform');}catch{}return needsRedraw=!0x0,void('function'==typeof requestDrawIfIdle&&requestDrawIfIdle());}if('function'==typeof isMobile&&!isMobile()&&'idle'===transformTool?.['mode']&&_0x1ad3b9['shiftKey']&&('ArrowUp'===_0x57ca1f||'ArrowDown'===_0x57ca1f)){if(_0x1ad3b9['preventDefault'](),_0x1ad3b9['stopImmediatePropagation'](),!layers||!layers['length'])return;const _0x14f345=Number['isInteger'](activeLayerIndex)?activeLayerIndex:0x0,_0x362c8d='ArrowUp'===_0x57ca1f?0x1:-0x1,_0x303669=Math['max'](0x0,Math['min'](layers['length']-0x1,_0x14f345+_0x362c8d));if(_0x303669===_0x14f345)return;const _0x4dc649=layers[_0x14f345]?.['name']??'';!function(_0x37dc22,_0x3eca9d){if(!Array['isArray'](layers)||0x0===layers['length'])return;if((_0x37dc22=Math['max'](0x0,Math['min'](layers['length']-0x1,0x0|_0x37dc22)))===(_0x3eca9d=Math['max'](0x0,Math['min'](layers['length']-0x1,0x0|_0x3eca9d))))return;const _0x1d7fcd=layers['splice'](_0x37dc22,0x1)[0x0];layers['splice'](_0x3eca9d,0x0,_0x1d7fcd);const _0x301bd9=Number['isInteger'](activeLayerIndex)?activeLayerIndex:0x0;_0x301bd9===_0x37dc22?activeLayerIndex=_0x3eca9d:_0x37dc22<_0x301bd9&&_0x301bd9<=_0x3eca9d?activeLayerIndex=_0x301bd9-0x1:_0x3eca9d<=_0x301bd9&&_0x301bd9<_0x37dc22&&(activeLayerIndex=_0x301bd9+0x1);try{recordLayerReorder?.(_0x37dc22,_0x3eca9d);}catch{}try{rebuildLayersUI?.();}catch{}try{syncActiveAliases?.();}catch{}needsRedraw=!0x0,'function'==typeof requestDrawIfIdle&&requestDrawIfIdle();}(_0x14f345,_0x303669);try{showStatusMessage?.('Moved\x20'+(_0x4dc649||'layer')+'\x20'+(_0x362c8d>0x0?'up':'down'),'info');}catch{}return;}if(!('function'!=typeof isMobile||isMobile()||'idle'!==transformTool?.['mode']||_0x1ad3b9['shiftKey']||'ArrowUp'!==_0x57ca1f&&'ArrowDown'!==_0x57ca1f)){if(_0x1ad3b9['preventDefault'](),_0x1ad3b9['stopImmediatePropagation'](),!layers||!layers['length'])return;try{'idle'!==transformTool?.['mode']&&endTransform(!0x1);}catch{}try{clearTransformLockAll?.();}catch{}const _0xb2421e='ArrowUp'===_0x57ca1f?0x1:-0x1,_0x1fd09b=Math['max'](0x0,Math['min'](layers['length']-0x1,activeLayerIndex+_0xb2421e));if(_0x1fd09b!==activeLayerIndex){activeLayerIndex=_0x1fd09b;try{syncActiveAliases?.();}catch{}try{rebuildLayersUI?.();}catch{}try{showStatusMessage?.('Selected:\x20'+layers[activeLayerIndex]['name'],'info');}catch{}needsRedraw=!0x0,'function'==typeof requestDrawIfIdle&&requestDrawIfIdle();}return;}if('h'===_0x2ce027){_0x1ad3b9['preventDefault'](),_0x1ad3b9['stopImmediatePropagation']();const _0x449727=activeLayerIndex,_0x1ef46c=layers?.[_0x449727];if(!_0x1ef46c)return;const _0x105335=!!_0x1ef46c['visible'],_0x1b4fc3=!_0x105335;_0x1ef46c['visible']=_0x1b4fc3;try{recordLayerVisibilityChange?.(_0x449727,_0x105335,_0x1b4fc3);}catch{}try{rebuildLayersUI?.();}catch{}try{showStatusMessage?.(_0x1b4fc3?'Layer\x20visible':'Layer\x20hidden','info');}catch{}return needsRedraw=!0x0,void('function'==typeof requestDrawIfIdle&&requestDrawIfIdle());}if('g'===_0x2ce027)return _0x1ad3b9['preventDefault'](),_0x1ad3b9['stopImmediatePropagation'](),void('function'==typeof startTransform&&startTransform('grab'));if('s'===_0x2ce027)return _0x1ad3b9['preventDefault'](),_0x1ad3b9['stopImmediatePropagation'](),void('function'==typeof startTransform&&startTransform('scale',_0x1ad3b9['shiftKey']));if('r'===_0x2ce027)return _0x1ad3b9['preventDefault'](),_0x1ad3b9['stopImmediatePropagation'](),void('function'==typeof startTransform&&startTransform('rotate',_0x1ad3b9['shiftKey']));if('Escape'===_0x57ca1f&&'idle'!==transformTool?.['mode']){const _0x35b566='function'==typeof getActiveLayer?getActiveLayer():null;return _0x35b566&&transformTool['ref']&&(_0x35b566['x']=transformTool['ref']['x'],_0x35b566['y']=transformTool['ref']['y'],_0x35b566['scaleX']=transformTool['ref']['scaleX'],_0x35b566['scaleY']=transformTool['ref']['scaleY'],_0x35b566['rotation']=transformTool['ref']['rotation']),'function'==typeof endTransform&&endTransform(!0x1),needsRedraw=!0x0,_0x1ad3b9['preventDefault'](),void _0x1ad3b9['stopImmediatePropagation']();}if(('Enter'===_0x57ca1f||'Return'===_0x57ca1f)&&'idle'!==transformTool?.['mode'])return'function'==typeof endTransform&&endTransform(),needsRedraw=!0x0,_0x1ad3b9['preventDefault'](),void _0x1ad3b9['stopImmediatePropagation']();if('t'===_0x2ce027){_0x1ad3b9['preventDefault'](),_0x1ad3b9['stopImmediatePropagation']();const _0x5372e6='function'==typeof getActiveLayer?getActiveLayer():null;if(!_0x5372e6)return;_0x5372e6['x']=0x0,_0x5372e6['y']=0x0,_0x5372e6['scaleX']=0x1,_0x5372e6['scaleY']=0x1,_0x5372e6['rotation']=0x0;try{showStatusMessage?.('Layer\x20transform\x20reset','info');}catch{}return needsRedraw=!0x0,void('function'==typeof requestDrawIfIdle&&requestDrawIfIdle());}},{'capture':!0x0});let dynamicModeEnabled=!0x1,reverseModeEnabled=!0x1,intuitiveMode=!0x0;function showStatusMessage(_0x5cc6a0,_0x2630f0='info'){console['log']('showStatusMessage',_0x5cc6a0);const _0x5af7bf=document['createElement']('div');_0x5af7bf['classList']['add']('status-message',_0x2630f0),_0x5af7bf['innerText']=_0x5cc6a0,document['body']['appendChild'](_0x5af7bf),setTimeout(()=>{_0x5af7bf['classList']['add']('fade-out'),setTimeout(()=>_0x5af7bf['remove'](),0x2bc);},0x2bc);}function downscaleImage(_0x54b8d1,_0x4cea02,_0x5092af){const _0x2ac94f=Math['min'](_0x4cea02/_0x54b8d1['width'],_0x5092af/_0x54b8d1['height'],0x1);if(_0x2ac94f<0x1){const _0x3fc2ba=document['createElement']('canvas');return _0x3fc2ba['width']=Math['floor'](_0x54b8d1['width']*_0x2ac94f),_0x3fc2ba['height']=Math['floor'](_0x54b8d1['height']*_0x2ac94f),(_0x3fc2ba['getContext']('2d')['drawImage'](_0x54b8d1,0x0,0x0,_0x3fc2ba['width'],_0x3fc2ba['height']),_0x3fc2ba['toDataURL']('image/jpeg',0.7));}return null;}function downscaleImageToWindow(_0x1fd279){const _0x423f68=window['innerWidth'],_0x719b30=window['innerHeight'],_0x52bda4=Math['min'](_0x423f68/_0x1fd279['width'],_0x719b30/_0x1fd279['height'],0x1);if(_0x52bda4<0x1){const _0x475b4c=document['createElement']('canvas');return _0x475b4c['width']=Math['floor'](_0x1fd279['width']*_0x52bda4),_0x475b4c['height']=Math['floor'](_0x1fd279['height']*_0x52bda4),(_0x475b4c['getContext']('2d')['drawImage'](_0x1fd279,0x0,0x0,_0x475b4c['width'],_0x475b4c['height']),_0x475b4c['toDataURL']('image/jpeg',0.7));}return null;}document['addEventListener']('keydown',_0x4ca4bf=>{isUserTyping()||(_0x4ca4bf['shiftKey']&&'e'===_0x4ca4bf['key']['toLowerCase']()&&(isErasing=!isErasing,showStatusMessage(isErasing?'Mode:\x20Erase':'Mode:\x20Paint','info'),needsRedraw=!0x0),_0x4ca4bf['shiftKey']&&'g'===_0x4ca4bf['key']['toLowerCase']()&&(lineMode=!lineMode,showStatusMessage('Line\x20Mode:\x20'+(lineMode?'ON':'OFF'),'info'),needsRedraw=!0x0));}),imageLoader['addEventListener']('change',_0x2abd30=>{console['log']('[DEBUG]\x20imageLoader\x20change\x20event\x20fired:',_0x2abd30);const _0x54438a=_0x2abd30['target']['files'][0x0];if(_0x54438a){console['log']('[DEBUG]\x20Selected\x20file:',_0x54438a['name'],_0x54438a['type'],_0x54438a['size']);const _0x5e0789=new FileReader();_0x5e0789['onerror']=_0xab97cd=>{console['error']('[DEBUG]\x20FileReader\x20error:',_0xab97cd);},_0x5e0789['onload']=_0x4b0d73=>{console['log']('[DEBUG]\x20FileReader\x20onload\x20triggered.\x20Data\x20length:',_0x4b0d73['target']['result']['length']);const _0x7e1509=new Image();_0x7e1509['onerror']=_0x21cbe5=>{console['error']('[DEBUG]\x20Image\x20load\x20error:',_0x21cbe5);},_0x7e1509['onload']=()=>{console['log']('[DEBUG]\x20Image\x20loaded\x20successfully.\x20Dimensions:',_0x7e1509['width'],_0x7e1509['height']);const _0x5e5846=downscaleImageToWindow(_0x7e1509);_0x5e5846?(console['log']('[DEBUG]\x20Downscaled\x20image\x20to\x20window\x20dimensions.'),_0x7e1509['src']=_0x5e5846,_0x7e1509['onload']=()=>{console['log']('[DEBUG]\x20Downscaled\x20image\x20loaded.\x20Dimensions:',_0x7e1509['width'],_0x7e1509['height']),currentImage=_0x7e1509,fixedFBOWidth=_0x7e1509['width'],fixedFBOHeight=_0x7e1509['height'],console['log']('[DEBUG]\x20Calling\x20initPaintLayerFixed()'),initPaintLayerFixed(),initFloodFillProgram(),console['log']('[DEBUG]\x20Calling\x20updateCanvasSize(currentImage)'),updateCanvasSize(currentImage),console['log']('[DEBUG]\x20Calling\x20createTextureFromImage(currentImage)'),createTextureFromImage(currentImage),canvas['offsetWidth'],canvasWrapper['offsetWidth'],zoomScale=0x1,panX=(canvasWrapper['clientWidth']-canvas['width'])/0x2,panY=(canvasWrapper['clientHeight']-canvas['height'])/0x2,updateCanvasTransform(),resetStrokeState(),needsRedraw=!0x0;}):(console['log']('[DEBUG]\x20No\x20downscaling\x20needed.'),currentImage=_0x7e1509,fixedFBOWidth=_0x7e1509['width'],fixedFBOHeight=_0x7e1509['height'],console['log']('[DEBUG]\x20Calling\x20initPaintLayerFixed()'),initPaintLayerFixed(),initFloodFillProgram(),console['log']('[DEBUG]\x20Calling\x20updateCanvasSize(currentImage)'),updateCanvasSize(currentImage),console['log']('[DEBUG]\x20Calling\x20createTextureFromImage(currentImage)'),createTextureFromImage(currentImage),canvas['offsetWidth'],canvasWrapper['offsetWidth'],zoomScale=0x1,panX=(canvasWrapper['clientWidth']-canvas['width'])/0x2,panY=(canvasWrapper['clientHeight']-canvas['height'])/0x2,updateCanvasTransform(),resetStrokeState(),needsRedraw=!0x0);},console['log']('[DEBUG]\x20Setting\x20image\x20src\x20to\x20FileReader\x20result'),_0x7e1509['src']=_0x4b0d73['target']['result'];};try{_0x5e0789['readAsDataURL'](_0x54438a),console['log']('[DEBUG]\x20FileReader\x20readAsDataURL\x20called\x20successfully');}catch(_0x1f21a0){console['error']('[DEBUG]\x20Exception\x20while\x20reading\x20file:',_0x1f21a0);}}else console['warn']('[DEBUG]\x20No\x20file\x20selected.');});const imageLoaderButton=document['getElementById']('imageLoaderButton');async function clearCanvas(_0x3f79fc=!0x0){const _0x4c5488=History['_captureProject']?History['_captureProject']():null;try{console['log']('[Clear]\x20start');try{Array['isArray'](layers)&&layers['forEach'](_0x13f5d7=>{try{gl['deleteTexture'](_0x13f5d7['texture']);}catch{}try{gl['deleteFramebuffer'](_0x13f5d7['fbo']);}catch{}});}catch(_0x25ab00){console['warn']('[Clear]\x20warning\x20disposing\x20old\x20layers:',_0x25ab00);}const _0x596893=Math['max'](0x1,0x0|window['visualViewport']?.['width']||0x0|window['innerWidth']),_0x55d53a=Math['max'](0x1,0x0|window['visualViewport']?.['height']||0x0|window['innerHeight']);let _0x39d0c7=null;if('function'==typeof createPaperImage)try{_0x39d0c7=await createPaperImage(_0x596893,_0x55d53a);}catch(_0x56491f){console['warn']('[Clear]\x20createPaperImage\x20failed,\x20falling\x20back\x20to\x20flat\x20paper:',_0x56491f);}if(!_0x39d0c7){const _0x310a43=document['createElement']('canvas');_0x310a43['width']=_0x596893,_0x310a43['height']=_0x55d53a;const _0x336023=_0x310a43['getContext']('2d');_0x336023['fillStyle']='#f2efe4',_0x336023['fillRect'](0x0,0x0,_0x596893,_0x55d53a),_0x39d0c7=await new Promise((_0x4ff6af,_0x3c09f8)=>{const _0x787910=new Image();_0x787910['onload']=()=>_0x4ff6af(_0x787910),_0x787910['onerror']=_0x3c09f8,_0x787910['src']=_0x310a43['toDataURL']('image/png');});}currentImage=_0x39d0c7,fixedFBOWidth=_0x39d0c7['width'],fixedFBOHeight=_0x39d0c7['height'],'function'==typeof setDocumentSize?setDocumentSize(_0x39d0c7['width'],_0x39d0c7['height']):(canvas['width']=_0x39d0c7['width'],canvas['height']=_0x39d0c7['height'],gl['viewport'](0x0,0x0,_0x39d0c7['width'],_0x39d0c7['height']));try{initFloodFBOs?.();}catch{}initPaintLayerFixed();try{if(texture)try{gl['deleteTexture'](texture);}catch{}createTextureFromImage(_0x39d0c7);}catch(_0x443caf){console['error']('[Clear]\x20createTextureFromImage\x20failed:',_0x443caf);}try{updateCanvasSize(_0x39d0c7);}catch{}zoomScale=0x1,panX=panY=0x0;try{centerCanvasInWrapper?.();}catch{}viewRotation=0x0;try{updateCanvasTransform?.();}catch{}try{resetStrokeState?.();}catch{}try{syncActiveAliases?.();}catch{}try{rebuildLayersUI?.();}catch{}try{showStatusMessage?.('New\x20project\x20created\x20to\x20match\x20current\x20window.','success');}catch{}needsRedraw=!0x0;try{requestDrawIfIdle?.();}catch{}console['log']('[Clear]\x20done',{'w':_0x39d0c7['width'],'h':_0x39d0c7['height']});}catch(_0x4b4983){console['error']('[Clear]\x20fatal\x20error:',_0x4b4983);try{showStatusMessage?.('Clear\x20failed.','error');}catch{}}if(_0x3f79fc&&History['_captureProject']){const _0x483738=History['_captureProject']();try{recordClearProject?.(_0x4c5488,_0x483738);}catch(_0x1b1c83){console['warn']('[Clear]\x20recordClearProject\x20failed;\x20pushing\x20generic\x20history\x20entry:',_0x1b1c83);try{History['push']?.({'type':'clear_project','beforeAll':_0x4c5488,'afterAll':_0x483738});}catch{}}}}function resetPageZoomFromInputs(){const _0x33c279=document['querySelector']('meta[name=\x22viewport\x22]');if(!_0x33c279)return;const _0x1a865b=_0x33c279['getAttribute']('content')||'width=device-width,\x20initial-scale=1',_0x50f95f=_0x1a865b['replace'](/,\s*maximum-scale=[^,]+/i,'');_0x33c279['setAttribute']('content',_0x50f95f+',\x20maximum-scale=1'),setTimeout(()=>_0x33c279['setAttribute']('content',_0x1a865b),0x50);}function blurActiveElement(){document['activeElement']&&'function'==typeof document['activeElement']['blur']&&document['activeElement']['blur']();}function resetToCurrentWindow(){const _0x5c104e=0x0|(window['visualViewport']?.['width']||window['innerWidth']),_0x314b7d=0x0|(window['visualViewport']?.['height']||window['innerHeight']),_0x2a2dda=document['createElement']('canvas');_0x2a2dda['width']=_0x5c104e,_0x2a2dda['height']=_0x314b7d;const _0x1b5ce6=_0x2a2dda['getContext']('2d');_0x1b5ce6['fillStyle']='#f2efe4',_0x1b5ce6['fillRect'](0x0,0x0,_0x5c104e,_0x314b7d);const _0x1d7b56=_0x1b5ce6['createImageData'](_0x5c104e,_0x314b7d);for(let _0x53febd=0x0;_0x53febd<_0x1d7b56['data']['length'];_0x53febd+=0x4){const _0x269323=0x28*Math['random']()|0x0;_0x1d7b56['data'][_0x53febd+0x0]=0xe6+_0x269323,_0x1d7b56['data'][_0x53febd+0x1]=0xe2+_0x269323,_0x1d7b56['data'][_0x53febd+0x2]=0xda+_0x269323,_0x1d7b56['data'][_0x53febd+0x3]=0xff;}_0x1b5ce6['globalAlpha']=0.15,_0x1b5ce6['putImageData'](_0x1d7b56,0x0,0x0),_0x1b5ce6['globalAlpha']=0x1;const _0x407723=new Image();_0x407723['onload']=()=>{currentImage=_0x407723,fixedFBOWidth=_0x407723['width'],fixedFBOHeight=_0x407723['height'],initFloodFBOs(),initPaintLayerFixed(),updateCanvasSize(_0x407723),createTextureFromImage(_0x407723),zoomScale=0x1,panX=panY=0x0,centerCanvasInWrapper?.(),resetStrokeState(),needsRedraw=!0x0,showStatusMessage('New\x20document\x20sized\x20to\x20window','success');},_0x407723['src']=_0x2a2dda['toDataURL']('image/png');}imageLoaderButton['addEventListener']('click',()=>{console['log']('[DEBUG]\x20imageLoaderButton\x20clicked.'),document['getElementById']('imageLoader')['click']();}),imageLoaderButton['addEventListener']('touchend',()=>{console['log']('[DEBUG]\x20imageLoaderButton\x20touchend\x20triggered.'),document['getElementById']('imageLoader')['click']();}),/iPad|iPhone|iPod/['test'](navigator['userAgent'])&&!window['MSStream']&&(console['log']('[DEBUG]\x20Detected\x20iOS\x20device\x20–\x20removing\x20capture\x20attribute'),imageLoader['removeAttribute']('capture')),document['addEventListener']('DOMContentLoaded',async()=>{const _0x497b6a='artworks';let _0x119839;async function _0x54c7af(){return _0x119839||new Promise((_0xc55b75,_0x38f04b)=>{const _0x190ed2=indexedDB['open']('DrawingAppDB',0x1);_0x190ed2['onupgradeneeded']=_0x273eb6=>{let _0x20017d=_0x273eb6['target']['result'];_0x20017d['objectStoreNames']['contains'](_0x497b6a)||_0x20017d['createObjectStore'](_0x497b6a,{'keyPath':'id'});},_0x190ed2['onsuccess']=()=>_0xc55b75(_0x119839=_0x190ed2['result']),_0x190ed2['onerror']=()=>_0x38f04b('IndexedDB\x20failed\x20to\x20open');});}async function _0x557041(_0x5b096c,_0x21edb4=!0x1,_0x442656=null,_0x10fa16=!0x1){try{const _0x3e2ab3=await _0x54c7af(),_0x1ea879=_0x136890(!0x0),_0x5294cc=await _0x278728(_0x1ea879,'image/png',0.92),_0x550516=0x140,_0x496634=Math['min'](_0x550516/_0x1ea879['width'],_0x550516/_0x1ea879['height'],0x1),_0x4d7703=document['createElement']('canvas');_0x4d7703['width']=Math['round'](_0x1ea879['width']*_0x496634),_0x4d7703['height']=Math['round'](_0x1ea879['height']*_0x496634),_0x4d7703['getContext']('2d')['drawImage'](_0x1ea879,0x0,0x0,_0x4d7703['width'],_0x4d7703['height']);const _0x4ba6ad=await _0x278728(_0x4d7703,'image/webp',0.7),_0x48eb95=await new Promise(_0x50c5e5=>{const _0x16eca8=new FileReader();_0x16eca8['onloadend']=()=>_0x50c5e5(_0x16eca8['result']),_0x16eca8['readAsDataURL'](_0x4ba6ad);}),_0x3ea74c=fixedFBOWidth,_0x3a6dd0=fixedFBOHeight;let _0xa7cee6=null;if(currentImage){const _0x24d618=document['createElement']('canvas');_0x24d618['width']=_0x3ea74c,_0x24d618['height']=_0x3a6dd0,(_0x24d618['getContext']('2d')['drawImage'](currentImage,0x0,0x0,_0x3ea74c,_0x3a6dd0),_0xa7cee6=await _0x278728(_0x24d618,'image/png',0.92));}async function _0x347d68(_0x2769aa,_0x2994fe,_0x2d2ba1){const _0x358cba=new Uint8Array(_0x2994fe*_0x2d2ba1*0x4);gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x2769aa),gl['readPixels'](0x0,0x0,_0x2994fe,_0x2d2ba1,gl['RGBA'],gl['UNSIGNED_BYTE'],_0x358cba),gl['bindFramebuffer'](gl['FRAMEBUFFER'],null);const _0x43e04c=document['createElement']('canvas');_0x43e04c['width']=_0x2994fe,_0x43e04c['height']=_0x2d2ba1;const _0x394638=_0x43e04c['getContext']('2d'),_0x2ab7e1=new ImageData(new Uint8ClampedArray(_0x358cba),_0x2994fe,_0x2d2ba1);_0x394638['putImageData'](_0x2ab7e1,0x0,0x0);const _0x1468c0=document['createElement']('canvas');_0x1468c0['width']=_0x2994fe,_0x1468c0['height']=_0x2d2ba1;const _0xdc5ff7=_0x1468c0['getContext']('2d');return _0xdc5ff7['save'](),_0xdc5ff7['translate'](_0x2994fe/0x2,_0x2d2ba1/0x2),_0xdc5ff7['scale'](-0x1,-0x1),_0xdc5ff7['rotate'](Math['PI']),_0xdc5ff7['drawImage'](_0x43e04c,-_0x2994fe/0x2,-_0x2d2ba1/0x2),_0xdc5ff7['restore'](),_0x278728(_0x1468c0,'image/png',0.92);}const _0x515760=[];for(let _0x20d027=0x0;_0x20d027<layers['length'];_0x20d027++){const _0x32ae81=layers[_0x20d027],_0x3519ea=Math['max'](0x1,0x0|(Number(_0x32ae81['texW'])||_0x3ea74c)),_0x3aa19c=Math['max'](0x1,0x0|(Number(_0x32ae81['texH'])||_0x3a6dd0)),_0x332d1e=await _0x347d68(_0x32ae81['fbo'],_0x3519ea,_0x3aa19c);_0x515760['push']({'name':_0x32ae81['name'],'visible':!!_0x32ae81['visible'],'opacity':Number(_0x32ae81['opacity'])||0x1,'x':Number(_0x32ae81['x'])||0x0,'y':Number(_0x32ae81['y'])||0x0,'scaleX':Number['isFinite'](_0x32ae81['scaleX'])?_0x32ae81['scaleX']:0x1,'scaleY':Number['isFinite'](_0x32ae81['scaleY'])?_0x32ae81['scaleY']:0x1,'rotation':Number(_0x32ae81['rotation'])||0x0,'px':Number['isFinite'](_0x32ae81['px'])?_0x32ae81['px']:0.5*_0x3ea74c,'py':Number['isFinite'](_0x32ae81['py'])?_0x32ae81['py']:0.5*_0x3a6dd0,'texW':_0x3519ea,'texH':_0x3aa19c,'ox':Number(_0x32ae81['ox'])||0x0,'oy':Number(_0x32ae81['oy'])||0x0,'blob':_0x332d1e});}const _0x44bc3f=document['getElementById']('existingArtworkId'),_0x431aa0=_0x44bc3f?_0x44bc3f['value']:null,_0x26d6bc=_0x21edb4?_0x442656??currentArtworkId??_0x431aa0??Date['now']():Date['now'](),_0x5ae715={'id':_0x26d6bc,'name':_0x5b096c||'Untitled\x20'+_0x26d6bc,'date':new Date()['toISOString'](),'username':'User','appName':'Web\x20Paint','image':_0x5294cc,'thumbnail':_0x48eb95,'project':{'v':0x2,'width':_0x3ea74c,'height':_0x3a6dd0,'backgroundBlob':_0xa7cee6,'layers':_0x515760}},_0x3878db=_0x3e2ab3['transaction'](_0x497b6a,'readwrite');_0x3878db['objectStore'](_0x497b6a)['put'](_0x5ae715),_0x3878db['oncomplete']=()=>{if(_0x10fa16||_0x1d8777(_0x21edb4?'Artwork\x20overwritten!':'Artwork\x20saved!','success'),_0x44bc3f&&(_0x44bc3f['value']=_0x26d6bc),currentArtworkId=_0x26d6bc,!_0x10fa16&&_0x318198&&_0x318198['readyState']===WebSocket['OPEN']){const _0x489834=JSON['parse'](localStorage['getItem']('userProfile'))||{},_0x39cbf0={'type':'image','clientId':_0x10cdc9,'nickname':_0x489834['nickname']?.['trim']()||'','profileImage':_0x489834['image']||'','imageData':_0x5ae715['thumbnail'],'imageName':_0x5ae715['name'],'timestamp':Date['now']()};_0x318198['send'](JSON['stringify'](_0x39cbf0));}},_0x3878db['onerror']=_0x6f3d57=>{console['error']('[saveArtwork]\x20IndexedDB\x20ERROR:',_0x6f3d57),_0x10fa16||_0x1d8777('Error\x20saving\x20artwork.','error');};}catch(_0x1c8581){console['error']('[saveArtwork]\x20ERROR:',_0x1c8581),_0x10fa16||_0x1d8777('Error\x20saving\x20artwork.','error');}}const _0x3383fd='__autosave__';let _0x35523a=null;async function _0x1212da(){await _0x54c7af();const _0x51bf00=document['getElementById']('artworkName'),_0x4baa7a=_0x51bf00?_0x51bf00['value']:'';await _0x557041(_0x4baa7a||'Autosave',!0x0,_0x3383fd,{'quiet':!0x0});}async function _0x53ce2b(_0x188af2){if(_0x188af2){if(currentArtworkId=_0x188af2['id'],_0x188af2['project']&&_0x188af2['project']['layers']&&_0x188af2['project']['layers']['length']){const _0x275cda=0x0|_0x188af2['project']['width'],_0x13666a=0x0|_0x188af2['project']['height'];if(fixedFBOWidth=_0x275cda,fixedFBOHeight=_0x13666a,initFloodFBOs(),initPaintLayerFixed(),_0x188af2['project']['backgroundBlob']){const _0x13f45c=URL['createObjectURL'](_0x188af2['project']['backgroundBlob']),_0x5bca2c=new Image();await new Promise(_0x25a51e=>{_0x5bca2c['onload']=()=>{currentImage=_0x5bca2c,updateCanvasSize(_0x5bca2c),createTextureFromImage(_0x5bca2c),canvas['offsetWidth'],canvasWrapper['offsetWidth'],zoomScale=0x1,panX=(canvasWrapper['clientWidth']-canvas['width'])/0x2,panY=(canvasWrapper['clientHeight']-canvas['height'])/0x2,updateCanvasTransform(),resetStrokeState(),needsRedraw=!0x0,URL['revokeObjectURL'](_0x13f45c),_0x25a51e();},_0x5bca2c['src']=_0x13f45c;});}else currentImage=null,texture=null,updateCanvasSize({'width':_0x275cda,'height':_0x13666a});function _0x4f07f8(_0x4d09f8,_0x5678e4,_0x33a07d,_0x34c513){const _0x5bc3e2=document['createElement']('canvas');_0x5bc3e2['width']=_0x33a07d,_0x5bc3e2['height']=_0x34c513;const _0x100687=_0x5bc3e2['getContext']('2d');_0x100687['clearRect'](0x0,0x0,_0x33a07d,_0x34c513),_0x100687['drawImage'](_0x4d09f8,0x0,0x0,_0x33a07d,_0x34c513);const _0x1df418=gl['createTexture']();gl['bindTexture'](gl['TEXTURE_2D'],_0x1df418),gl['pixelStorei'](gl['UNPACK_FLIP_Y_WEBGL'],!0x1),gl['pixelStorei'](gl['UNPACK_PREMULTIPLY_ALPHA_WEBGL'],!0x1),gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],gl['RGBA'],gl['UNSIGNED_BYTE'],_0x5bc3e2),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MIN_FILTER'],gl['LINEAR']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MAG_FILTER'],gl['LINEAR']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_S'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_T'],gl['CLAMP_TO_EDGE']),gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x5678e4),gl['viewport'](0x0,0x0,_0x33a07d,_0x34c513),gl['disable'](gl['DEPTH_TEST']),gl['disable'](gl['CULL_FACE']),gl['disable'](gl['SCISSOR_TEST']),gl['disable'](gl['BLEND']),gl['clearColor'](0x0,0x0,0x0,0x0),gl['clear'](gl['COLOR_BUFFER_BIT']),gl['useProgram'](quadProgram);const _0x1b149f=gl['getUniformLocation'](quadProgram,'u_flipY'),_0x475168=gl['getUniformLocation'](quadProgram,'u_resolution'),_0x494eb3=gl['getUniformLocation'](quadProgram,'u_layerOpacity'),_0x1b1e88=gl['getUniformLocation'](quadProgram,'u_texture')||gl['getUniformLocation'](quadProgram,'u_image');_0x1b149f&&gl['uniform1f'](_0x1b149f,0x1),_0x475168&&gl['uniform2f'](_0x475168,_0x33a07d,_0x34c513),_0x494eb3&&gl['uniform1f'](_0x494eb3,0x1),gl['activeTexture'](gl['TEXTURE0']),gl['bindTexture'](gl['TEXTURE_2D'],_0x1df418),_0x1b1e88&&gl['uniform1i'](_0x1b1e88,0x0),__bindAndDrawTexturedQuad(quadProgram,_0x33a07d,_0x34c513),gl['bindFramebuffer'](gl['FRAMEBUFFER'],null),gl['deleteTexture'](_0x1df418);}layers['forEach'](_0x82b14e=>{gl['deleteTexture'](_0x82b14e['texture']),gl['deleteFramebuffer'](_0x82b14e['fbo']);}),layers=[];for(const _0x270eed of _0x188af2['project']['layers']){const _0x175756=Math['max'](0x1,0x0|(Number(_0x270eed['texW'])||_0x275cda)),_0x3e7b1d=Math['max'](0x1,0x0|(Number(_0x270eed['texH'])||_0x13666a)),_0x1f97a9=Number(_0x270eed['ox'])||0x0,_0x15d4a6=Number(_0x270eed['oy'])||0x0,{texture:_0x8a5561,fbo:_0x2f96f3}=createLayerFBO(_0x175756,_0x3e7b1d);if(_0x270eed['blob']){const _0xbcd14=URL['createObjectURL'](_0x270eed['blob']),_0x15859c=new Image();await new Promise(_0x46a04a=>{_0x15859c['onload']=()=>{_0x4f07f8(_0x15859c,_0x2f96f3,_0x175756,_0x3e7b1d),URL['revokeObjectURL'](_0xbcd14),_0x46a04a();},_0x15859c['src']=_0xbcd14;});}else gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x2f96f3),gl['clearColor'](0x0,0x0,0x0,0x0),gl['clear'](gl['COLOR_BUFFER_BIT']),gl['bindFramebuffer'](gl['FRAMEBUFFER'],null);const _0x4397de={'id':Date['now']()+Math['random'](),'name':_0x270eed['name']||'Layer\x20'+(layers['length']+0x1),'fbo':_0x2f96f3,'texture':_0x8a5561,'visible':!0x1!==_0x270eed['visible'],'opacity':Number(_0x270eed['opacity'])||0x1,'x':Number(_0x270eed['x'])||0x0,'y':Number(_0x270eed['y'])||0x0,'scaleX':Number['isFinite'](_0x270eed['scaleX'])?_0x270eed['scaleX']:0x1,'scaleY':Number['isFinite'](_0x270eed['scaleY'])?_0x270eed['scaleY']:0x1,'rotation':Number(_0x270eed['rotation'])||0x0,'px':Number['isFinite'](_0x270eed['px'])?_0x270eed['px']:0.5*_0x275cda,'py':Number['isFinite'](_0x270eed['py'])?_0x270eed['py']:0.5*_0x13666a,'texW':_0x175756,'texH':_0x3e7b1d,'ox':_0x1f97a9,'oy':_0x15d4a6,'history':[],'redo':[]};layers['push'](_0x4397de);}return activeLayerIndex=Math['max'](0x0,layers['length']-0x1),syncActiveAliases?.(),rebuildLayersUI?.(),needsRedraw=!0x0,void requestDrawIfIdle?.();}if(_0x188af2['image']){const _0x1f7c31=URL['createObjectURL'](_0x188af2['image']),_0x4d5b96=new Image();_0x4d5b96['onload']=()=>{currentImage=_0x4d5b96,updateCanvasSize(_0x4d5b96),createTextureFromImage(_0x4d5b96),zoomScale=0x1,panX=(canvasWrapper['clientWidth']-canvas['width'])/0x2,panY=(canvasWrapper['clientHeight']-canvas['height'])/0x2,updateCanvasTransform(),resetStrokeState(),needsRedraw=!0x0,URL['revokeObjectURL'](_0x1f7c31);},_0x4d5b96['src']=_0x1f7c31;}}}!(function(){const _0x2c8534=()=>function(_0x37a0d8=0x320){_0x35523a&&clearTimeout(_0x35523a),_0x35523a=setTimeout(()=>{_0x1212da()['catch'](console['error']);},_0x37a0d8);}(0x1f4),_0x2b2135=()=>{try{_0x1212da();}catch(_0x3cc292){}},_0x3e83e9=document['getElementById']('glCanvas');_0x3e83e9&&['pointerup','mouseup','touchend']['forEach'](_0x1cd150=>_0x3e83e9['addEventListener'](_0x1cd150,_0x2c8534,{'passive':!0x0})),document['addEventListener']('keyup',_0x2c8534,{'passive':!0x0}),document['addEventListener']('visibilitychange',()=>{document['hidden']&&_0x2b2135();}),window['addEventListener']('beforeunload',_0x2b2135),setInterval(()=>{try{isDrawing||_0x2c8534();}catch(_0x1f6263){}},0x3a98),window['addEventListener']('load',()=>{requestAnimationFrame(()=>{!(async function(){const _0xf1c367=(await _0x54c7af())['transaction'](_0x497b6a,'readonly')['objectStore'](_0x497b6a)['get'](_0x3383fd);_0xf1c367['onsuccess']=async()=>{const _0x372aca=_0xf1c367['result'];_0x372aca&&(await _0x53ce2b(_0x372aca),_0x1d8777('Autosave\x20restored','success'));},_0xf1c367['onerror']=()=>{console['warn']('Autosave\x20lookup\x20failed.');};}());});});}()),document['addEventListener']('keydown',_0x2ce5d8=>{if(!isUserTyping()){if(_0x2ce5d8['metaKey']&&'s'===_0x2ce5d8['key']['toLowerCase']()){console['log']('kd:\x20s'),_0x2ce5d8['preventDefault'](),_0x2ce5d8['stopPropagation']();const _0x38f49d=document['getElementById']('artworkName')['value'],_0x10585e=document['getElementById']('existingArtworkId');_0x10585e&&_0x10585e['value']?(_0x557041(_0x38f49d,!0x0,_0x10585e['value']),_0x1d8777('Artwork\x20overwritten!','success')):console['warn']('No\x20artwork\x20selected\x20for\x20overwrite.');}else{if(_0x2ce5d8['shiftKey']&&'s'===_0x2ce5d8['key']['toLowerCase']()){_0x2ce5d8['preventDefault'](),_0x2ce5d8['stopPropagation']();const _0x3b8f6d=document['getElementById']('saveModal');_0x402719(_0x3b8f6d);}}}}),document['getElementById']('saveNewButton')['addEventListener']('click',()=>{_0x557041(document['getElementById']('artworkName')['value'],!0x1),_0x34bf0f(_0x181dba);}),document['getElementById']('overwriteButton')['addEventListener']('click',()=>{const _0x585e3b=document['getElementById']('artworkName')['value'],_0x3283bc=document['getElementById']('existingArtworkId'),_0x172b2b=_0x3283bc?_0x3283bc['value']:null;_0x172b2b&&_0x585e3b?_0x557041(_0x585e3b,!0x0,_0x172b2b,{'quiet':!0x0}):console['error']('No\x20existing\x20artwork\x20ID\x20or\x20name\x20found.\x20Cannot\x20overwrite.'),_0x34bf0f(_0x181dba);}),document['getElementById']('exportProjectBtn')['addEventListener']('click',()=>{!async function({includeBackground:_0x23818a=!0x0}={}){if(!window['JSZip'])return console['error']('JSZip\x20not\x20loaded'),void _0x1d8777('Export\x20failed:\x20JSZip\x20not\x20loaded.','error');const _0xabe92e=fixedFBOWidth,_0x23e53a=fixedFBOHeight,_0x10639d=new JSZip(),_0x561a21={'version':0x2,'width':_0xabe92e,'height':_0x23e53a,'app':'Helena\x20Paint','date':new Date()['toISOString'](),'hasBackground':!!currentImage&&_0x23818a,'layers':layers['map']((_0x204b1d,_0x26ae77)=>({'index':_0x26ae77,'name':_0x204b1d['name'],'visible':!!_0x204b1d['visible'],'opacity':Number(_0x204b1d['opacity'])||0x1,'x':Number(_0x204b1d['x'])||0x0,'y':Number(_0x204b1d['y'])||0x0,'scaleX':Number(_0x204b1d['scaleX'])||0x1,'scaleY':Number(_0x204b1d['scaleY'])||0x1,'rotation':Number(_0x204b1d['rotation'])||0x0,'px':Number['isFinite'](_0x204b1d['px'])?_0x204b1d['px']:0.5*_0xabe92e,'py':Number['isFinite'](_0x204b1d['py'])?_0x204b1d['py']:0.5*_0x23e53a,'ox':Number['isFinite'](_0x204b1d['ox'])?_0x204b1d['ox']:0x0,'oy':Number['isFinite'](_0x204b1d['oy'])?_0x204b1d['oy']:0x0,'texW':Number['isFinite'](_0x204b1d['texW'])?_0x204b1d['texW']:_0xabe92e,'texH':Number['isFinite'](_0x204b1d['texH'])?_0x204b1d['texH']:_0x23e53a}))};if(_0x10639d['file']('manifest.json',JSON['stringify'](_0x561a21,null,0x2),{'compression':'DEFLATE'}),_0x561a21['hasBackground']){const _0x203f9=document['createElement']('canvas');_0x203f9['width']=_0xabe92e,_0x203f9['height']=_0x23e53a,_0x203f9['getContext']('2d')['drawImage'](currentImage,0x0,0x0,_0xabe92e,_0x23e53a);const _0x3af305=await new Promise(_0x208af8=>_0x203f9['toBlob'](_0x208af8,'image/png',0.92));_0x10639d['file']('background.png',_0x3af305,{'compression':'DEFLATE'});}for(let _0x476790=0x0;_0x476790<layers['length'];_0x476790++){const _0x37ae55=layers[_0x476790],_0x8a7e2a=Number['isFinite'](_0x37ae55['texW'])?_0x37ae55['texW']:_0xabe92e,_0x30b8d8=Number['isFinite'](_0x37ae55['texH'])?_0x37ae55['texH']:_0x23e53a,_0x2cf3f0=_0x346ccc(_0x37ae55['fbo'],_0x8a7e2a,_0x30b8d8),_0x24338e=await _0x1e1391(_0x2cf3f0),_0x61c5ac=(_0x37ae55['name']||'Layer')['replace'](/[^\w\-]+/g,'_'),_0x2673d4='layers/'+String(_0x476790)['padStart'](0x3,'0')+'_'+_0x61c5ac+'_'+_0x8a7e2a+'x'+_0x30b8d8+'.png';_0x10639d['file'](_0x2673d4,_0x24338e,{'compression':'DEFLATE'});}const _0x9fa9aa=await _0x10639d['generateAsync']({'type':'blob','compression':'DEFLATE','compressionOptions':{'level':0x6}}),_0x363eba='helena_project_'+Date['now']()+'.hpaint',_0x12192c=document['createElement']('a');_0x12192c['href']=URL['createObjectURL'](_0x9fa9aa),_0x12192c['download']=_0x363eba,document['body']['appendChild'](_0x12192c),_0x12192c['click'](),_0x12192c['remove'](),_0x1d8777('Project\x20exported!','success');}({'includeBackground':!0x0});});const _0x401dea=document['getElementById']('importProjectInput');document['getElementById']('importProjectBtn')['addEventListener']('click',()=>_0x401dea['click']()),_0x401dea['addEventListener']('change',_0x5a8c6f=>{const _0x8c2ae4=_0x5a8c6f['target']['files']?.[0x0];_0x8c2ae4&&async function(_0x98928b){if(!window['JSZip'])return console['error']('JSZip\x20not\x20loaded'),void _0x1d8777('Import\x20failed:\x20JSZip\x20not\x20loaded.','error');try{const _0x3f2d8b=await JSZip['loadAsync'](_0x98928b),_0x36ebcf=await _0x3f2d8b['file']('manifest.json')['async']('string'),_0x274fef=JSON['parse'](_0x36ebcf),_0x414bda=Number(_0x274fef['version'])||0x1,_0x1db978=Number(_0x274fef['width'])||fixedFBOWidth,_0x4a820c=Number(_0x274fef['height'])||fixedFBOHeight;if('function'==typeof setFixedFBODimensions?setFixedFBODimensions(_0x1db978,_0x4a820c):(window['fixedFBOWidth']=_0x1db978,window['fixedFBOHeight']=_0x4a820c),initPaintLayerFixed?.(),_0x274fef['hasBackground']&&_0x3f2d8b['file']('background.png')){const _0x51d0a9=await _0x3f2d8b['file']('background.png')['async']('blob'),_0x54ee3c=await createImageBitmap(_0x51d0a9);'function'==typeof setDocumentBackgroundImageBitmap?await setDocumentBackgroundImageBitmap(_0x54ee3c):window['currentImage']=_0x54ee3c;}function _0x20afc5(_0x140a91,_0x51ae12,_0x202e6c,_0xba4d5f){const _0xf61903=Math['max'](0x1,0x0|_0x202e6c['texW']),_0x4e2464=Math['max'](0x1,0x0|_0x202e6c['texH']),_0x2470f2=gl['createTexture']();gl['bindTexture'](gl['TEXTURE_2D'],_0x2470f2),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MIN_FILTER'],gl['LINEAR']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MAG_FILTER'],gl['LINEAR']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_S'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_T'],gl['CLAMP_TO_EDGE']),gl['pixelStorei'](gl['UNPACK_FLIP_Y_WEBGL'],!0x0),gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],_0xf61903,_0x4e2464,0x0,gl['RGBA'],gl['UNSIGNED_BYTE'],null),_0x51ae12&&gl['texSubImage2D'](gl['TEXTURE_2D'],0x0,0x0,0x0,gl['RGBA'],gl['UNSIGNED_BYTE'],_0x51ae12);const _0x27ca6f=gl['createFramebuffer']();gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x27ca6f),gl['framebufferTexture2D'](gl['FRAMEBUFFER'],gl['COLOR_ATTACHMENT0'],gl['TEXTURE_2D'],_0x2470f2,0x0),gl['bindFramebuffer'](gl['FRAMEBUFFER'],null);const _0x392433={'id':Date['now']()+Math['random'](),'name':_0x140a91,'texture':_0x2470f2,'fbo':_0x27ca6f,'visible':!!_0xba4d5f['visible'],'opacity':Number['isFinite'](_0xba4d5f['opacity'])?_0xba4d5f['opacity']:0x1,'ox':0x0|_0x202e6c['ox'],'oy':0x0|_0x202e6c['oy'],'texW':_0xf61903,'texH':_0x4e2464,'x':Number['isFinite'](_0xba4d5f['x'])?_0xba4d5f['x']:0x0,'y':Number['isFinite'](_0xba4d5f['y'])?_0xba4d5f['y']:0x0,'scaleX':Number['isFinite'](_0xba4d5f['scaleX'])?_0xba4d5f['scaleX']:0x1,'scaleY':Number['isFinite'](_0xba4d5f['scaleY'])?_0xba4d5f['scaleY']:0x1,'rotation':Number['isFinite'](_0xba4d5f['rotation'])?_0xba4d5f['rotation']:0x0,'px':Number['isFinite'](_0xba4d5f['px'])?_0xba4d5f['px']:0.5*_0x1db978,'py':Number['isFinite'](_0xba4d5f['py'])?_0xba4d5f['py']:0.5*_0x4a820c,'history':[],'redo':[]};layers['push'](_0x392433);}const _0x420892=(_0x274fef['layers']||[])['slice']()['sort']((_0x25a412,_0x3360d3)=>_0x25a412['index']-_0x3360d3['index']);for(let _0x46f077=0x0;_0x46f077<_0x420892['length'];_0x46f077++){const _0xcf8bfa=_0x420892[_0x46f077],_0x19e64a=String(_0xcf8bfa['index'])['padStart'](0x3,'0')+'_',_0x1c3816=Object['keys'](_0x3f2d8b['files'])['filter'](_0x3dfcd3=>_0x3dfcd3['startsWith']('layers/')),_0x36681f=_0x1c3816['find'](_0x10af56=>_0x10af56['split']('/')['pop']()['startsWith'](_0x19e64a))||_0x1c3816[_0xcf8bfa['index']];let _0x13d41e=null;if(_0x36681f){const _0x51e62a=await _0x3f2d8b['file'](_0x36681f)['async']('blob');_0x13d41e=await createImageBitmap(_0x51e62a);}else console['warn']('Missing\x20layer\x20image\x20in\x20zip\x20for\x20index',_0xcf8bfa['index']);const _0x501fce=_0x414bda>=0x2?{'ox':Number['isFinite'](_0xcf8bfa['ox'])?_0xcf8bfa['ox']:0x0,'oy':Number['isFinite'](_0xcf8bfa['oy'])?_0xcf8bfa['oy']:0x0,'texW':Number['isFinite'](_0xcf8bfa['texW'])?_0xcf8bfa['texW']:_0x1db978,'texH':Number['isFinite'](_0xcf8bfa['texH'])?_0xcf8bfa['texH']:_0x4a820c}:{'ox':0x0,'oy':0x0,'texW':_0x1db978,'texH':_0x4a820c};_0x20afc5(_0xcf8bfa['name']||'Layer\x20'+(_0x46f077+0x1),_0x13d41e,_0x501fce,{'visible':!!_0xcf8bfa['visible'],'opacity':Number(_0xcf8bfa['opacity'])||0x1,'x':_0xcf8bfa['x'],'y':_0xcf8bfa['y'],'scaleX':_0xcf8bfa['scaleX'],'scaleY':_0xcf8bfa['scaleY'],'rotation':_0xcf8bfa['rotation'],'px':_0xcf8bfa['px'],'py':_0xcf8bfa['py']});}activeLayerIndex=Math['max'](0x0,layers['length']-0x1),syncActiveAliases?.(),rebuildLayersUI?.(),needsRedraw=!0x0,requestDrawIfIdle?.(),_0x1d8777?.('Project\x20imported','success');}catch(_0x554ca8){console['error'](_0x554ca8),_0x1d8777('Import\x20failed.','error');}}(_0x8c2ae4);});function _0x346ccc(_0x4af8c9,_0x3900ec,_0x5a4bfb){const _0x20a867=new Uint8Array(_0x3900ec*_0x5a4bfb*0x4);return gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x4af8c9),gl['readPixels'](0x0,0x0,_0x3900ec,_0x5a4bfb,gl['RGBA'],gl['UNSIGNED_BYTE'],_0x20a867),gl['bindFramebuffer'](gl['FRAMEBUFFER'],null),new ImageData(new Uint8ClampedArray(_0x20a867),_0x3900ec,_0x5a4bfb);}function _0x1e1391(_0x471f92){const _0x3ab795=document['createElement']('canvas');return _0x3ab795['width']=_0x471f92['width'],_0x3ab795['height']=_0x471f92['height'],_0x3ab795['getContext']('2d')['putImageData'](_0x471f92,0x0,0x0),new Promise(_0x11246f=>_0x3ab795['toBlob'](_0x11246f,'image/png',0.92));}const _0xaaab8=document['getElementById']('importLayerButton'),_0x1616c6=document['getElementById']('importLayerInput'),_0x5bbb0c=document['getElementById']('exportLayerButton');function _0x149b22(){document['getElementById']('exportOptionsModal')['style']['display']='none';}function _0x399f8a(_0x5340b0){const _0x21c5e3=0x0|fixedFBOWidth,_0x15e2f2=0x0|fixedFBOHeight,_0x32b00e=gl['createTexture']();gl['bindTexture'](gl['TEXTURE_2D'],_0x32b00e),gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],_0x21c5e3,_0x15e2f2,0x0,gl['RGBA'],gl['UNSIGNED_BYTE'],null),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MIN_FILTER'],gl['NEAREST']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MAG_FILTER'],gl['NEAREST']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_S'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_T'],gl['CLAMP_TO_EDGE']);const _0x4213b6=gl['createFramebuffer']();if(gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x4213b6),gl['framebufferTexture2D'](gl['FRAMEBUFFER'],gl['COLOR_ATTACHMENT0'],gl['TEXTURE_2D'],_0x32b00e,0x0),gl['checkFramebufferStatus'](gl['FRAMEBUFFER'])!==gl['FRAMEBUFFER_COMPLETE'])return gl['bindFramebuffer'](gl['FRAMEBUFFER'],null),gl['deleteFramebuffer'](_0x4213b6),gl['deleteTexture'](_0x32b00e),void _0x1d8777?.('Export\x20failed\x20(FBO\x20incomplete).','error');gl['viewport'](0x0,0x0,_0x21c5e3,_0x15e2f2),gl['disable'](gl['DEPTH_TEST']),gl['disable'](gl['CULL_FACE']),gl['disable'](gl['SCISSOR_TEST']),gl['enable'](gl['BLEND']),gl['blendFuncSeparate'](gl['SRC_ALPHA'],gl['ONE_MINUS_SRC_ALPHA'],gl['ONE'],gl['ONE_MINUS_SRC_ALPHA']),gl['clearColor'](0x0,0x0,0x0,0x0),gl['clear'](gl['COLOR_BUFFER_BIT']),gl['useProgram'](quadProgram);const _0x540f99=gl['getUniformLocation'](quadProgram,'u_flipY'),_0xe3d902=gl['getUniformLocation'](quadProgram,'u_resolution'),_0x59023e=gl['getUniformLocation'](quadProgram,'u_layerOpacity'),_0x11e5d4=gl['getUniformLocation'](quadProgram,'u_texture')||gl['getUniformLocation'](quadProgram,'u_image');_0x540f99&&gl['uniform1f'](_0x540f99,-0x1),_0xe3d902&&gl['uniform2f'](_0xe3d902,_0x21c5e3,_0x15e2f2);const _0x318953=gl['createBuffer']();gl['bindBuffer'](gl['ARRAY_BUFFER'],_0x318953);const _0x191b47=gl['getAttribLocation'](quadProgram,'a_position'),_0x3780d7=gl['getAttribLocation'](quadProgram,'a_texCoord');function _0x33a5c5(_0x50be7a,_0x2a9068,_0xf40f61,_0xd5daa7,_0x4f254f,_0x5f59c2){const _0x493b68=new Float32Array([_0x2a9068['x'],_0x2a9068['y'],0x0,0x0,_0xf40f61['x'],_0xf40f61['y'],0x1,0x0,_0xd5daa7['x'],_0xd5daa7['y'],0x0,0x1,_0xd5daa7['x'],_0xd5daa7['y'],0x0,0x1,_0xf40f61['x'],_0xf40f61['y'],0x1,0x0,_0x4f254f['x'],_0x4f254f['y'],0x1,0x1]);gl['bufferData'](gl['ARRAY_BUFFER'],_0x493b68,gl['STREAM_DRAW']),_0x59023e&&gl['uniform1f'](_0x59023e,Math['max'](0x0,Math['min'](0x1,_0x5f59c2))),gl['activeTexture'](gl['TEXTURE0']),gl['bindTexture'](gl['TEXTURE_2D'],_0x50be7a),_0x11e5d4&&gl['uniform1i'](_0x11e5d4,0x0),gl['drawArrays'](gl['TRIANGLES'],0x0,0x6);}gl['enableVertexAttribArray'](_0x191b47),gl['vertexAttribPointer'](_0x191b47,0x2,gl['FLOAT'],!0x1,0x10,0x0),gl['enableVertexAttribArray'](_0x3780d7),gl['vertexAttribPointer'](_0x3780d7,0x2,gl['FLOAT'],!0x1,0x10,0x8);let _0xc4bd9c=null;_0x5340b0&&currentImage&&(_0xc4bd9c=gl['createTexture'](),gl['bindTexture'](gl['TEXTURE_2D'],_0xc4bd9c),gl['pixelStorei'](gl['UNPACK_FLIP_Y_WEBGL'],!0x1),gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],gl['RGBA'],gl['UNSIGNED_BYTE'],currentImage),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MIN_FILTER'],gl['LINEAR']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MAG_FILTER'],gl['LINEAR']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_S'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_T'],gl['CLAMP_TO_EDGE']),_0x33a5c5(_0xc4bd9c,{'x':0x0,'y':0x0},{'x':_0x21c5e3,'y':0x0},{'x':0x0,'y':_0x15e2f2},{'x':_0x21c5e3,'y':_0x15e2f2},0x1));for(let _0x504dce=0x0;_0x504dce<layers['length'];_0x504dce++){const _0x545775=layers[_0x504dce];if(!_0x545775||!0x1===_0x545775['visible'])continue;if(null!=_0x545775['opacity']&&_0x545775['opacity']<=0x0)continue;if(!_0x545775['texture'])continue;const _0x1d0848=Number['isFinite'](_0x545775['ox'])?_0x545775['ox']:0x0,_0x523f14=Number['isFinite'](_0x545775['oy'])?_0x545775['oy']:0x0,_0x3282f8=Math['max'](0x1,0x0|(Number(_0x545775['texW'])||_0x21c5e3)),_0x318f40=Math['max'](0x1,0x0|(Number(_0x545775['texH'])||_0x15e2f2)),_0x9db553=Number['isFinite'](_0x545775['px'])?_0x545775['px']:0.5*_0x21c5e3,_0xa0d04c=Number['isFinite'](_0x545775['py'])?_0x545775['py']:0.5*_0x15e2f2,_0x5aaec4=Number['isFinite'](_0x545775['x'])?_0x545775['x']:0x0,_0x2c5634=Number['isFinite'](_0x545775['y'])?_0x545775['y']:0x0,_0x365eaf=Number['isFinite'](_0x545775['scaleX'])?_0x545775['scaleX']:0x1,_0x41850e=Number['isFinite'](_0x545775['scaleY'])?_0x545775['scaleY']:0x1,_0x3904b3=Number['isFinite'](_0x545775['rotation'])?_0x545775['rotation']:0x0,_0x22952d=Math['cos'](_0x3904b3),_0x3a6b96=Math['sin'](_0x3904b3);function _0x504ff1(_0x23fdaf,_0x2d5e49){let _0x52c147=_0x23fdaf-_0x9db553,_0x5a4829=_0x2d5e49-_0xa0d04c;return _0x52c147*=_0x365eaf,_0x5a4829*=_0x41850e,{'x':_0x9db553+(_0x52c147*_0x22952d-_0x5a4829*_0x3a6b96)+_0x5aaec4,'y':_0xa0d04c+(_0x52c147*_0x3a6b96+_0x5a4829*_0x22952d)+_0x2c5634};}const _0x3752d6=_0x504ff1(_0x1d0848,_0x523f14),_0x317967=_0x504ff1(_0x1d0848+_0x3282f8,_0x523f14),_0x4c344d=_0x504ff1(_0x1d0848,_0x523f14+_0x318f40),_0x4581f6=_0x504ff1(_0x1d0848+_0x3282f8,_0x523f14+_0x318f40);_0x33a5c5(_0x545775['texture'],_0x3752d6,_0x317967,_0x4c344d,_0x4581f6,Number(_0x545775['opacity'])||0x1);}const _0x2b629e=new Uint8Array(_0x21c5e3*_0x15e2f2*0x4);gl['readPixels'](0x0,0x0,_0x21c5e3,_0x15e2f2,gl['RGBA'],gl['UNSIGNED_BYTE'],_0x2b629e);const _0x509c8b=new Uint8ClampedArray(_0x21c5e3*_0x15e2f2*0x4),_0x2e6117=0x4*_0x21c5e3;for(let _0x1b9c65=0x0;_0x1b9c65<_0x15e2f2;_0x1b9c65++){const _0x32304b=_0x1b9c65*_0x2e6117,_0x66c9cb=(_0x15e2f2-0x1-_0x1b9c65)*_0x2e6117;_0x509c8b['set'](_0x2b629e['subarray'](_0x32304b,_0x32304b+_0x2e6117),_0x66c9cb);}const _0x2e6e8b=document['createElement']('canvas');_0x2e6e8b['width']=_0x21c5e3,_0x2e6e8b['height']=_0x15e2f2,_0x2e6e8b['getContext']('2d')['putImageData'](new ImageData(_0x509c8b,_0x21c5e3,_0x15e2f2),0x0,0x0);const _0x1f4d08=_0x5340b0?'_with_background':'_transparent',_0x2de0ef='canvas_'+Date['now']()+_0x1f4d08+'.png';_0x2e6e8b['toBlob'](_0x57757e=>{if(!_0x57757e)return void _0x1d8777?.('Export\x20failed.','error');const _0x14f78b=document['createElement']('a');_0x14f78b['download']=_0x2de0ef,_0x14f78b['href']=URL['createObjectURL'](_0x57757e),document['body']['appendChild'](_0x14f78b),_0x14f78b['click'](),URL['revokeObjectURL'](_0x14f78b['href']),_0x14f78b['remove']();},'image/png',0.92),gl['bindFramebuffer'](gl['FRAMEBUFFER'],null),gl['disableVertexAttribArray'](_0x191b47),gl['disableVertexAttribArray'](_0x3780d7),gl['bindBuffer'](gl['ARRAY_BUFFER'],null),gl['deleteBuffer'](_0x318953),_0xc4bd9c&&gl['deleteTexture'](_0xc4bd9c),gl['deleteFramebuffer'](_0x4213b6),gl['deleteTexture'](_0x32b00e);}function _0x1dd94c(){document['getElementById']('shareOptionsModal')['style']['display']='none';}function _0x1f5b78(_0x261560){_0x136890(_0x261560)['toBlob'](async _0x4aa431=>{if(!_0x4aa431)return void _0x1d8777('Error\x20generating\x20artwork.','error');const _0x346cce=new File([_0x4aa431],'artwork'+(_0x261560?'_with_background':'_transparent')+'.png',{'type':'image/png'});if(navigator['canShare']&&navigator['canShare']({'files':[_0x346cce]}))try{await navigator['share']({'title':'Artwork','text':'Check\x20out\x20my\x20artwork!','files':[_0x346cce]});}catch{_0x1d8777('Error\x20sharing\x20artwork.','error');}else _0x1d8777('Sharing\x20not\x20supported\x20on\x20this\x20device.','error');},'image/png');}/iPad|iPhone|iPod/['test'](navigator['userAgent'])&&_0x1616c6?.['removeAttribute']('capture'),_0xaaab8?.['addEventListener']('click',()=>_0x1616c6?.['click']()),_0x1616c6?.['addEventListener']('change',async _0x271a78=>{const _0x26920c=_0x271a78['target']['files']?.[0x0];if(!_0x26920c)return;const _0x50d72a=new Image();_0x50d72a['onload']=async()=>{fixedFBOWidth&&fixedFBOHeight||(fixedFBOWidth=_0x50d72a['width'],fixedFBOHeight=_0x50d72a['height'],initPaintLayerFixed?.(),updateCanvasSize({'width':_0x50d72a['width'],'height':_0x50d72a['height']}),needsRedraw=!0x0);const {texture:_0x57cc27,fbo:_0x27f419}=createLayerFBO(fixedFBOWidth,fixedFBOHeight),_0x3e9ad7={'id':Date['now']()+Math['random'](),'name':(_0x26920c['name']||'Imported')['replace'](/\.[^.]+$/,''),'fbo':_0x27f419,'texture':_0x57cc27,'visible':!0x0,'opacity':0x1,'x':0x0,'y':0x0,'scaleX':0x1,'scaleY':0x1,'rotation':0x0,'px':0.5*fixedFBOWidth,'py':0.5*fixedFBOHeight,'history':[],'redo':[]},_0x43378d=Math['max'](0x0,Math['min'](activeLayerIndex,layers['length']));layers['splice'](_0x43378d,0x0,_0x3e9ad7),activeLayerIndex=_0x43378d,await async function(_0x1a6582,_0xce4459){const _0x31539c=fixedFBOWidth,_0x2cde48=fixedFBOHeight,_0xc957dc=_0x31539c/_0x1a6582['width'],_0x418809=_0x2cde48/_0x1a6582['height'],_0x2fbac9=Math['min'](_0xc957dc,_0x418809,0x1),_0x1aa443=Math['round'](_0x1a6582['width']*_0x2fbac9),_0xf3bf13=Math['round'](_0x1a6582['height']*_0x2fbac9),_0x172543=Math['floor']((_0x31539c-_0x1aa443)/0x2),_0x184c16=Math['floor']((_0x2cde48-_0xf3bf13)/0x2),_0x273c2d=document['createElement']('canvas');_0x273c2d['width']=_0x31539c,_0x273c2d['height']=_0x2cde48;const _0x139bdd=_0x273c2d['getContext']('2d');_0x139bdd['clearRect'](0x0,0x0,_0x31539c,_0x2cde48),_0x139bdd['imageSmoothingEnabled']=!0x0,_0x139bdd['imageSmoothingQuality']='high',_0x139bdd['drawImage'](_0x1a6582,0x0,0x0,_0x1a6582['width'],_0x1a6582['height'],_0x172543,_0x184c16,_0x1aa443,_0xf3bf13);const _0x1fa6e3=gl['createTexture']();gl['bindTexture'](gl['TEXTURE_2D'],_0x1fa6e3),gl['pixelStorei'](gl['UNPACK_FLIP_Y_WEBGL'],!0x1),gl['pixelStorei'](gl['UNPACK_PREMULTIPLY_ALPHA_WEBGL'],!0x1),gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],gl['RGBA'],gl['UNSIGNED_BYTE'],_0x273c2d),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MIN_FILTER'],gl['LINEAR']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MAG_FILTER'],gl['LINEAR']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_S'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_T'],gl['CLAMP_TO_EDGE']),gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0xce4459),gl['viewport'](0x0,0x0,_0x31539c,_0x2cde48),gl['disable'](gl['BLEND']),gl['clearColor'](0x0,0x0,0x0,0x0),gl['clear'](gl['COLOR_BUFFER_BIT']),gl['useProgram'](quadProgram);const _0x319562=gl['getUniformLocation'](quadProgram,'u_flipY');_0x319562&&gl['uniform1f'](_0x319562,0x1);const _0x2f04ea=gl['getUniformLocation'](quadProgram,'u_resolution');_0x2f04ea&&gl['uniform2f'](_0x2f04ea,_0x31539c,_0x2cde48);const _0x49e9cc=gl['getUniformLocation'](quadProgram,'u_layerOpacity');_0x49e9cc&&gl['uniform1f'](_0x49e9cc,0x1);const _0x1c5da3=new Float32Array([0x0,0x0,0x0,0x0,_0x31539c,0x0,0x1,0x0,0x0,_0x2cde48,0x0,0x1,0x0,_0x2cde48,0x0,0x1,_0x31539c,0x0,0x1,0x0,_0x31539c,_0x2cde48,0x1,0x1]),_0xb74356=gl['createBuffer']();gl['bindBuffer'](gl['ARRAY_BUFFER'],_0xb74356),gl['bufferData'](gl['ARRAY_BUFFER'],_0x1c5da3,gl['STATIC_DRAW']);const _0x369e12=gl['getAttribLocation'](quadProgram,'a_position'),_0x4febd9=gl['getAttribLocation'](quadProgram,'a_texCoord');gl['enableVertexAttribArray'](_0x369e12),gl['vertexAttribPointer'](_0x369e12,0x2,gl['FLOAT'],!0x1,0x10,0x0),gl['enableVertexAttribArray'](_0x4febd9),gl['vertexAttribPointer'](_0x4febd9,0x2,gl['FLOAT'],!0x1,0x10,0x8),gl['activeTexture'](gl['TEXTURE0']),gl['bindTexture'](gl['TEXTURE_2D'],_0x1fa6e3);const _0x24dd7f=gl['getUniformLocation'](quadProgram,'u_texture');_0x24dd7f&&gl['uniform1i'](_0x24dd7f,0x0),gl['drawArrays'](gl['TRIANGLES'],0x0,0x6),gl['disableVertexAttribArray'](_0x369e12),gl['disableVertexAttribArray'](_0x4febd9),gl['bindBuffer'](gl['ARRAY_BUFFER'],null),gl['deleteBuffer'](_0xb74356),gl['bindFramebuffer'](gl['FRAMEBUFFER'],null),gl['bindTexture'](gl['TEXTURE_2D'],null),gl['deleteTexture'](_0x1fa6e3),needsRedraw=!0x0;}(_0x50d72a,_0x27f419),syncActiveAliases?.(),rebuildLayersUI?.(),needsRedraw=!0x0,_0x1d8777?.('Imported\x20image\x20as\x20new\x20layer.','success');},_0x50d72a['src']=URL['createObjectURL'](_0x26920c),_0x271a78['target']['value']='';}),_0x5bbb0c?.['addEventListener']('click',()=>{const _0x4a603f=layers?.[activeLayerIndex];if(!_0x4a603f)return void _0x1d8777?.('No\x20active\x20layer\x20to\x20export.','error');const _0x3a5982=fixedFBOWidth,_0x5e5374=fixedFBOHeight,_0x49dbc1=document['createElement']('canvas');_0x49dbc1['width']=_0x3a5982,_0x49dbc1['height']=_0x5e5374,_0x49dbc1['getContext']('2d')['putImageData'](_0x346ccc(_0x4a603f['fbo'],_0x3a5982,_0x5e5374),0x0,0x0);const _0x156eee=document['createElement']('canvas');_0x156eee['width']=_0x3a5982,_0x156eee['height']=_0x5e5374;const _0x381b64=_0x156eee['getContext']('2d');_0x381b64['save'](),_0x381b64['translate'](_0x3a5982/0x2,_0x5e5374/0x2),_0x381b64['scale'](-0x1,-0x1),_0x381b64['rotate'](Math['PI']),_0x381b64['drawImage'](_0x49dbc1,-_0x3a5982/0x2,-_0x5e5374/0x2),_0x381b64['restore']();const _0x160739=document['createElement']('a');_0x160739['download']=(_0x4a603f['name']||'Layer')['replace'](/\s+/g,'_')+'.png',_0x160739['href']=_0x156eee['toDataURL']('image/png'),document['body']['appendChild'](_0x160739),_0x160739['click'](),_0x160739['remove'](),_0x1d8777?.('Active\x20layer\x20exported.','success');}),document['getElementById']('saveCanvasAsIcoButton')['addEventListener']('click',function(){const _0x25ab5b=_0x136890(!0x0),_0xa29567=document['createElement']('canvas');_0xa29567['width']=0x40,_0xa29567['height']=0x40,_0xa29567['getContext']('2d')['drawImage'](_0x25ab5b,0x0,0x0,0x40,0x40),_0xa29567['toBlob'](_0x4bb9b4=>{if(!_0x4bb9b4)return void _0x1d8777('ICO\x20export\x20failed.','error');const _0x6f704f=new FileReader();_0x6f704f['onloadend']=()=>{const _0x552aff=function(_0x480e21,_0x116ec3){const _0x511793=new Uint8Array([0x0,0x0,0x1,0x0,0x1,0x0]),_0x5e8996=new Uint8Array(0x10);_0x5e8996['set']([_0x116ec3,_0x116ec3,0x0,0x0,0x1,0x0,0x20,0x0]);const _0xabe922=_0x480e21['byteLength'],_0x288c9=_0x511793['length']+_0x5e8996['length'],_0x2b6c0d=new DataView(_0x5e8996['buffer']);_0x2b6c0d['setUint32'](0x8,_0xabe922,!0x0),_0x2b6c0d['setUint32'](0xc,_0x288c9,!0x0);const _0x42ab05=_0x511793['length']+_0x5e8996['length']+_0xabe922,_0x2a9c7c=new Uint8Array(_0x42ab05);return _0x2a9c7c['set'](_0x511793,0x0),_0x2a9c7c['set'](_0x5e8996,_0x511793['length']),_0x2a9c7c['set'](new Uint8Array(_0x480e21),_0x288c9),_0x2a9c7c['buffer'];}(_0x6f704f['result'],0x40),_0x1dbf3c=new Blob([_0x552aff],{'type':'image/x-icon'}),_0x30361d=document['createElement']('a');_0x30361d['href']=URL['createObjectURL'](_0x1dbf3c),_0x30361d['download']='favicon.ico',document['body']['appendChild'](_0x30361d),_0x30361d['click'](),document['body']['removeChild'](_0x30361d);},_0x6f704f['readAsArrayBuffer'](_0x4bb9b4);},'image/png');}),document['getElementById']('exportModalClose')['addEventListener']('click',_0x149b22),document['getElementById']('exportWithBackgroundBtn')['addEventListener']('click',function(){_0x149b22(),_0x399f8a(!0x0);}),document['getElementById']('exportTransparentBtn')['addEventListener']('click',function(){_0x149b22(),_0x399f8a(!0x1);}),document['getElementById']('saveCanvasButton')['addEventListener']('click',function(){document['getElementById']('exportOptionsModal')['style']['display']='flex';}),document['getElementById']('shareButton')['addEventListener']('click',function(){document['getElementById']('shareOptionsModal')['style']['display']='flex';}),document['getElementById']('shareModalClose')['addEventListener']('click',_0x1dd94c),document['getElementById']('shareWithBackgroundBtn')['addEventListener']('click',function(){_0x1dd94c(),_0x1f5b78(!0x0);}),document['getElementById']('shareTransparentBtn')['addEventListener']('click',function(){_0x1dd94c(),_0x1f5b78(!0x1);});let _0x1d2861=!0x1,_0x1250d4=null;function _0x136890(_0x19922f=!0x1){const _0x1f0faf=0x0|fixedFBOWidth,_0x2ef0d9=0x0|fixedFBOHeight,_0x57ddbd=_0x19922f?0x0|canvas['width']:_0x1f0faf,_0x102794=_0x19922f?0x0|canvas['height']:_0x2ef0d9,_0xe8592a=gl['createTexture']();gl['bindTexture'](gl['TEXTURE_2D'],_0xe8592a),gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],_0x57ddbd,_0x102794,0x0,gl['RGBA'],gl['UNSIGNED_BYTE'],null),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MIN_FILTER'],gl['NEAREST']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MAG_FILTER'],gl['NEAREST']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_S'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_T'],gl['CLAMP_TO_EDGE']);const _0x3ebea9=gl['createFramebuffer']();gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x3ebea9),gl['framebufferTexture2D'](gl['FRAMEBUFFER'],gl['COLOR_ATTACHMENT0'],gl['TEXTURE_2D'],_0xe8592a,0x0);if(!(gl['checkFramebufferStatus'](gl['FRAMEBUFFER'])===gl['FRAMEBUFFER_COMPLETE']))return gl['bindFramebuffer'](gl['FRAMEBUFFER'],null),gl['deleteFramebuffer'](_0x3ebea9),gl['deleteTexture'](_0xe8592a),null;gl['viewport'](0x0,0x0,_0x57ddbd,_0x102794),gl['disable'](gl['DEPTH_TEST']),gl['disable'](gl['CULL_FACE']),gl['disable'](gl['SCISSOR_TEST']),gl['enable'](gl['BLEND']),gl['blendFuncSeparate'](gl['SRC_ALPHA'],gl['ONE_MINUS_SRC_ALPHA'],gl['ONE'],gl['ONE_MINUS_SRC_ALPHA']),gl['clearColor'](0x0,0x0,0x0,0x0),gl['clear'](gl['COLOR_BUFFER_BIT']),gl['useProgram'](quadProgram);const _0x591d25=gl['getUniformLocation'](quadProgram,'u_flipY'),_0x50b918=gl['getUniformLocation'](quadProgram,'u_resolution'),_0x17729a=gl['getUniformLocation'](quadProgram,'u_layerOpacity'),_0x4ca08e=gl['getUniformLocation'](quadProgram,'u_texture')||gl['getUniformLocation'](quadProgram,'u_image');_0x591d25&&gl['uniform1f'](_0x591d25,-0x1),_0x50b918&&gl['uniform2f'](_0x50b918,_0x57ddbd,_0x102794);const _0x4f7166=gl['createBuffer']();gl['bindBuffer'](gl['ARRAY_BUFFER'],_0x4f7166);const _0x559996=gl['getAttribLocation'](quadProgram,'a_position'),_0xf530f0=gl['getAttribLocation'](quadProgram,'a_texCoord');function _0x28cc62(_0x39ee79,_0x2884d6,_0x1b2875,_0x438acc,_0x16e023,_0x41c2d5){const _0x3bd78f=new Float32Array([_0x2884d6['x'],_0x2884d6['y'],0x0,0x0,_0x1b2875['x'],_0x1b2875['y'],0x1,0x0,_0x438acc['x'],_0x438acc['y'],0x0,0x1,_0x438acc['x'],_0x438acc['y'],0x0,0x1,_0x1b2875['x'],_0x1b2875['y'],0x1,0x0,_0x16e023['x'],_0x16e023['y'],0x1,0x1]);gl['bufferData'](gl['ARRAY_BUFFER'],_0x3bd78f,gl['STREAM_DRAW']),_0x17729a&&gl['uniform1f'](_0x17729a,Math['max'](0x0,Math['min'](0x1,_0x41c2d5))),gl['activeTexture'](gl['TEXTURE0']),gl['bindTexture'](gl['TEXTURE_2D'],_0x39ee79),_0x4ca08e&&gl['uniform1i'](_0x4ca08e,0x0),gl['drawArrays'](gl['TRIANGLES'],0x0,0x6);}gl['enableVertexAttribArray'](_0x559996),gl['vertexAttribPointer'](_0x559996,0x2,gl['FLOAT'],!0x1,0x10,0x0),gl['enableVertexAttribArray'](_0xf530f0),gl['vertexAttribPointer'](_0xf530f0,0x2,gl['FLOAT'],!0x1,0x10,0x8);const _0x965cc8=0.5*_0x57ddbd,_0x5903d8=0.5*_0x102794,_0x285b38=zoomScale||0x1,_0x28f5ff=viewRotation||0x0,_0x1b1d15=Math['cos'](_0x28f5ff),_0x307492=Math['sin'](_0x28f5ff);function _0x16044f(_0x18ba2f,_0xc27082){if(!_0x19922f)return{'x':_0x18ba2f,'y':_0xc27082};return{'x':panX+_0x965cc8+((_0x18ba2f-=0.5*_0x1f0faf)*_0x285b38*_0x1b1d15-(_0xc27082-=0.5*_0x2ef0d9)*_0x285b38*_0x307492),'y':panY+_0x5903d8+(_0x18ba2f*_0x285b38*_0x307492+_0xc27082*_0x285b38*_0x1b1d15)};}if(currentImage){const _0x247009=gl['createTexture']();gl['bindTexture'](gl['TEXTURE_2D'],_0x247009),gl['pixelStorei'](gl['UNPACK_FLIP_Y_WEBGL'],!0x1),gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],gl['RGBA'],gl['UNSIGNED_BYTE'],currentImage),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MIN_FILTER'],gl['LINEAR']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MAG_FILTER'],gl['LINEAR']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_S'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_T'],gl['CLAMP_TO_EDGE']),(_0x28cc62(_0x247009,_0x16044f(0x0,0x0),_0x16044f(_0x1f0faf,0x0),_0x16044f(0x0,_0x2ef0d9),_0x16044f(_0x1f0faf,_0x2ef0d9),0x1),gl['deleteTexture'](_0x247009));}for(let _0x32d81c=0x0;_0x32d81c<layers['length'];_0x32d81c++){const _0x31e73c=layers[_0x32d81c];if(!_0x31e73c||!0x1===_0x31e73c['visible']||(_0x31e73c['opacity']??0x1)<=0x0||!_0x31e73c['texture'])continue;const _0x34fd2f=Number['isFinite'](_0x31e73c['ox'])?_0x31e73c['ox']:0x0,_0x5853bb=Number['isFinite'](_0x31e73c['oy'])?_0x31e73c['oy']:0x0,_0x1644f7=Math['max'](0x1,0x0|(Number(_0x31e73c['texW'])||_0x1f0faf)),_0x298edd=Math['max'](0x1,0x0|(Number(_0x31e73c['texH'])||_0x2ef0d9)),_0x556b09=Number['isFinite'](_0x31e73c['px'])?_0x31e73c['px']:0.5*_0x1f0faf,_0x253605=Number['isFinite'](_0x31e73c['py'])?_0x31e73c['py']:0.5*_0x2ef0d9,_0x353ba4=Number['isFinite'](_0x31e73c['x'])?_0x31e73c['x']:0x0,_0x12740d=Number['isFinite'](_0x31e73c['y'])?_0x31e73c['y']:0x0,_0xab7f6=Number['isFinite'](_0x31e73c['scaleX'])?_0x31e73c['scaleX']:0x1,_0xc53548=Number['isFinite'](_0x31e73c['scaleY'])?_0x31e73c['scaleY']:0x1,_0x533f6c=Number['isFinite'](_0x31e73c['rotation'])?_0x31e73c['rotation']:0x0,_0x66bbd1=Math['cos'](_0x533f6c),_0x2e7dde=Math['sin'](_0x533f6c);function _0xfb4981(_0x5a39d1,_0x335a20){let _0x5226f5=_0x5a39d1-_0x556b09,_0x4e781f=_0x335a20-_0x253605;_0x5226f5*=_0xab7f6,_0x4e781f*=_0xc53548;const _0x4a7431=_0x556b09+(_0x5226f5*_0x66bbd1-_0x4e781f*_0x2e7dde)+_0x353ba4,_0x523900=_0x253605+(_0x5226f5*_0x2e7dde+_0x4e781f*_0x66bbd1)+_0x12740d;return _0x19922f?_0x16044f(_0x4a7431,_0x523900):{'x':_0x4a7431,'y':_0x523900};}const _0x39fe32=_0xfb4981(_0x34fd2f,_0x5853bb),_0x1ee089=_0xfb4981(_0x34fd2f+_0x1644f7,_0x5853bb),_0x353a40=_0xfb4981(_0x34fd2f,_0x5853bb+_0x298edd),_0x1a4932=_0xfb4981(_0x34fd2f+_0x1644f7,_0x5853bb+_0x298edd);_0x28cc62(_0x31e73c['texture'],_0x39fe32,_0x1ee089,_0x353a40,_0x1a4932,Number(_0x31e73c['opacity'])||0x1);}const _0x383cd4=new Uint8Array(_0x57ddbd*_0x102794*0x4);gl['readPixels'](0x0,0x0,_0x57ddbd,_0x102794,gl['RGBA'],gl['UNSIGNED_BYTE'],_0x383cd4);const _0x35e32c=new Uint8ClampedArray(_0x383cd4['length']),_0xf39518=0x4*_0x57ddbd;for(let _0x553183=0x0;_0x553183<_0x102794;_0x553183++){const _0x25a767=_0x553183*_0xf39518,_0x4f7fb3=(_0x102794-0x1-_0x553183)*_0xf39518;_0x35e32c['set'](_0x383cd4['subarray'](_0x25a767,_0x25a767+_0xf39518),_0x4f7fb3);}const _0x4d7e96=document['createElement']('canvas');return _0x4d7e96['width']=_0x57ddbd,_0x4d7e96['height']=_0x102794,(_0x4d7e96['getContext']('2d')['putImageData'](new ImageData(_0x35e32c,_0x57ddbd,_0x102794),0x0,0x0),gl['bindFramebuffer'](gl['FRAMEBUFFER'],null),gl['disableVertexAttribArray'](_0x559996),gl['disableVertexAttribArray'](_0xf530f0),gl['bindBuffer'](gl['ARRAY_BUFFER'],null),gl['deleteBuffer'](_0x4f7166),gl['deleteFramebuffer'](_0x3ebea9),gl['deleteTexture'](_0xe8592a),_0x4d7e96);}function _0x278728(_0x54e0d3,_0x1622df='image/webp',_0x34cc66=0.75){return new Promise(_0x141205=>{_0x54e0d3['toBlob'](_0x17d465=>_0x141205(_0x17d465),_0x1622df,_0x34cc66);});}async function _0x28ce08(){const _0x29b13f=(await _0x54c7af())['transaction'](_0x497b6a,'readonly')['objectStore'](_0x497b6a)['getAll']();_0x29b13f['onsuccess']=()=>{const _0x1b8457=_0x29b13f['result'];_0x1b8457['sort']((_0x13c405,_0x2f7492)=>new Date(_0x2f7492['date'])-new Date(_0x13c405['date']));const _0x5d8fa8=document['getElementById']('gallery');_0x5d8fa8['innerHTML']=_0x1b8457['length']?'':'<p>No\x20saved\x20artworks</p>',_0x1b8457['forEach'](_0x2ea1e9=>{const _0xe8998d=document['createElement']('div');_0xe8998d['classList']['add']('gallery-item');const _0x1724ce=document['createElement']('img');_0x1724ce['src']=_0x2ea1e9['thumbnail']||'',_0x1724ce['alt']=_0x2ea1e9['name'],_0xe8998d['appendChild'](_0x1724ce);const _0x33ebf6=document['createElement']('p');_0x33ebf6['textContent']=_0x2ea1e9['name'],_0xe8998d['appendChild'](_0x33ebf6);const _0x6b5c4b=document['createElement']('button');_0x6b5c4b['classList']['add']('delete-button'),_0x6b5c4b['style']['display']=_0x1d2861?'block':'none',_0x6b5c4b['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20width=\x22100%\x22\x20height=\x22100%\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20stroke-width=\x221.5\x22\x20fill=\x22none\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20stroke=\x22currentColor\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20d=\x22M19\x2011v9.4a.6.6\x200\x200\x201-.6.6H5.6a.6.6\x200\x200\x201-.6-.6V11M10\x2017v-6M14\x2017v-6M21\x207h-5M3\x207h5m0\x200V3.6a.6.6\x200\x200\x201\x20.6-.6h6.8a.6.6\x200\x200\x201\x20.6.6V7M8\x207h8\x22\x20/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x6b5c4b['addEventListener']('click',_0x1c9a87=>{_0x1c9a87['stopPropagation'](),_0x1250d4=_0x2ea1e9['id'],document['getElementById']('deleteConfirmModal')['style']['display']='flex';}),_0xe8998d['appendChild'](_0x6b5c4b),_0xe8998d['addEventListener']('click',()=>{_0x1d2861||async function(_0x2b0b4a){const _0x1b8cb9=(await _0x54c7af())['transaction'](_0x497b6a,'readonly')['objectStore'](_0x497b6a)['get'](_0x2b0b4a);_0x1b8cb9['onsuccess']=async()=>{const _0x2a3b95=_0x1b8cb9['result'];_0x2a3b95?await _0x53ce2b(_0x2a3b95):_0x1d8777('Artwork\x20not\x20found.','error');},_0x1b8cb9['onerror']=()=>{console['error']('Failed\x20to\x20load\x20artwork\x20from\x20IndexedDB.'),_0x1d8777('Failed\x20to\x20load\x20artwork.','error');};}(_0x2ea1e9['id']);}),_0x5d8fa8['appendChild'](_0xe8998d);});},_0x29b13f['onerror']=()=>console['error']('Failed\x20to\x20load\x20gallery.');}document['getElementById']('galleryEditButton')['addEventListener']('click',()=>{_0x1d2861=!_0x1d2861,document['querySelectorAll']('.gallery-item\x20.delete-button')['forEach'](_0x4ba66b=>{_0x4ba66b['style']['display']=_0x1d2861?'block':'none';}),document['getElementById']('galleryEditButton')['textContent']=_0x1d2861?'Done':'Edit';}),document['getElementById']('confirmDeleteButton')['addEventListener']('click',async()=>{if(null!==_0x1250d4){const _0x2f6e13=(await _0x54c7af())['transaction'](_0x497b6a,'readwrite');_0x2f6e13['objectStore'](_0x497b6a)['delete'](_0x1250d4),_0x2f6e13['oncomplete']=()=>{_0x1d8777('Artwork\x20deleted!','success'),_0x1250d4=null,document['getElementById']('deleteConfirmModal')['style']['display']='none',_0x28ce08();},_0x2f6e13['onerror']=()=>{console['error']('Failed\x20to\x20delete\x20artwork.'),_0x1d8777('Error\x20deleting\x20artwork.','error');};}}),document['getElementById']('cancelDeleteButton')['addEventListener']('click',()=>{_0x1250d4=null,document['getElementById']('deleteConfirmModal')['style']['display']='none';});const _0x1ea50c=document['getElementById']('profileModal'),_0x2823e1=document['getElementById']('profileIconButton'),_0x22f978=document['getElementById']('saveProfileButton'),_0x4acea5=document['getElementById']('profileImageInput'),_0x386473=document['getElementById']('profileImagePreview'),_0x56dccc=document['getElementById']('drawProfileButton');function _0x30019c(){const _0x14f6e1=JSON['parse'](localStorage['getItem']('userProfile'))||{};if(_0x14f6e1['image']){_0x386473['style']['backgroundImage']='url(\x27'+_0x14f6e1['image']+'\x27)';const _0xa82829=document['querySelector']('#profileIconButton\x20img');_0xa82829&&(_0xa82829['src']=_0x14f6e1['image']);}else{_0x386473['style']['backgroundImage']='url(\x27/static/draw/images/icons/cat.svg\x27)';const _0x483e3c=document['querySelector']('#profileIconButton\x20img');_0x483e3c&&(_0x483e3c['src']='/static/draw/images/icons/cat.svg');}document['getElementById']('profileNickname')['value']=_0x14f6e1['nickname']||'',document['getElementById']('profileEmail')['value']=_0x14f6e1['email']||'',document['getElementById']('profileBio')['value']=_0x14f6e1['bio']||'';}function _0x402719(_0x385a90){_0x385a90['style']['display']='flex';const _0x2a4c46=_0x385a90['querySelector']('.close');_0x2a4c46&&!_0x2a4c46['dataset']['listenerAdded']&&(_0x2a4c46['addEventListener']('click',()=>_0x34bf0f(_0x385a90)),_0x2a4c46['dataset']['listenerAdded']='true');}function _0x34bf0f(_0xa61d94){_0xa61d94['style']['display']='none';}_0x30019c(),_0x2823e1['addEventListener']('click',()=>{_0x30019c(),_0x402719(_0x1ea50c);}),_0x22f978['addEventListener']('click',function(){const _0x240585=_0x386473['style']['backgroundImage']['match'](/url\(["']?(.*?)["']?\)/),_0x5ee4ee={'image':_0x240585?_0x240585[0x1]:null,'nickname':document['getElementById']('profileNickname')['value'],'email':document['getElementById']('profileEmail')['value'],'bio':document['getElementById']('profileBio')['value']};localStorage['setItem']('userProfile',JSON['stringify'](_0x5ee4ee)),_0x28ef17=_0x5ee4ee['nickname']?.['trim']()||'',_0xc7fc1b(),_0x1d8777('Profile\x20saved!','success'),_0x34bf0f(_0x1ea50c);}),_0x386473['addEventListener']('click',()=>{_0x4acea5['click']();}),_0x4acea5['addEventListener']('change',_0x14bc00=>{const _0x52f389=_0x14bc00['target']['files'][0x0];if(_0x52f389){const _0x304120=new FileReader();_0x304120['onload']=()=>{const _0x118ce0=_0x304120['result'];_0x386473['style']['backgroundImage']='url(\x27'+_0x118ce0+'\x27)';const _0x29912e={'image':_0x118ce0,'nickname':document['getElementById']('profileNickname')['value'],'email':document['getElementById']('profileEmail')['value'],'bio':document['getElementById']('profileBio')['value']};localStorage['setItem']('userProfile',JSON['stringify'](_0x29912e));const _0x2922e3=document['querySelector']('#profileIconButton\x20img');_0x2922e3&&(_0x2922e3['src']=_0x118ce0),fetch(_0x118ce0)['then'](_0x57992d=>_0x57992d['blob']())['then'](_0x377632=>{const _0x2308fb={'id':Date['now'](),'name':'Profile','date':new Date()['toISOString'](),'username':'User','appName':'Web\x20Paint','image':_0x377632,'thumbnail':_0x118ce0};_0x54c7af()['then'](_0x724707=>{_0x724707['transaction'](_0x497b6a,'readwrite')['objectStore'](_0x497b6a)['put'](_0x2308fb),_0x1d8777('Profile\x20image\x20saved\x20to\x20gallery!','success');});});},_0x304120['readAsDataURL'](_0x52f389);}}),_0x56dccc['addEventListener']('click',()=>{try{const _0x398775=_0x136890(!0x0);if(!_0x398775)return void _0x1d8777?.('Profile\x20export\x20unavailable.','error');const _0x5c507e=_0x398775['width'],_0x2bc69b=_0x398775['height'],_0x601787=Math['min'](_0x5c507e,_0x2bc69b),_0x436ee6=(_0x5c507e-_0x601787)/0x2|0x0,_0x30dc90=(_0x2bc69b-_0x601787)/0x2|0x0,_0x402818=document['createElement']('canvas');_0x402818['width']=_0x601787,_0x402818['height']=_0x601787,_0x402818['getContext']('2d')['drawImage'](_0x398775,_0x436ee6,_0x30dc90,_0x601787,_0x601787,0x0,0x0,_0x601787,_0x601787);const _0x1b6657=_0x402818['toDataURL']('image/png');_0x386473['style']['backgroundImage']='url(\x27'+_0x1b6657+'\x27)';const _0x2abc50=document['querySelector']('#profileIconButton\x20img');_0x2abc50&&(_0x2abc50['src']=_0x1b6657);const _0xa997c8={'image':_0x1b6657,'nickname':document['getElementById']('profileNickname')['value'],'email':document['getElementById']('profileEmail')['value'],'bio':document['getElementById']('profileBio')['value']};try{localStorage['setItem']('userProfile',JSON['stringify'](_0xa997c8));}catch{}_0x402818['toBlob'](_0x5be6f6=>{if(!_0x5be6f6)return void _0x1d8777?.('Profile\x20save\x20failed.','error');const _0x3b5627={'id':Date['now'](),'name':'Profile','date':new Date()['toISOString'](),'username':'User','appName':'Web\x20Paint','image':_0x5be6f6,'thumbnail':_0x1b6657};_0x54c7af()['then'](_0x1abb76=>{_0x1abb76['transaction'](_0x497b6a,'readwrite')['objectStore'](_0x497b6a)['put'](_0x3b5627),_0x1d8777?.('Profile\x20image\x20saved.','success');})['catch'](_0x15e624=>{console['error']('[Profile]\x20gallery\x20save\x20error',_0x15e624),_0x1d8777?.('Saved\x20preview;\x20gallery\x20write\x20failed.','warning');});},'image/png');}catch(_0x242f38){console['error']('[Profile]\x20compose/save\x20failed',_0x242f38),_0x1d8777?.('Profile\x20export\x20failed.','error');}});const _0x5e1aca=document['getElementById']('chatToggleBtn'),_0x475dfa=document['getElementById']('chatOverlay'),_0x5632da=document['getElementById']('chatCloseBtn'),_0x56c02f=document['getElementById']('chatSendBtn'),_0x2d65c3=document['getElementById']('chatInput'),_0x203292=document['getElementById']('chatMessages');_0x5e1aca['addEventListener']('click',()=>{_0x475dfa['classList']['remove']('hidden');}),_0x5632da['addEventListener']('click',()=>{_0x475dfa['classList']['add']('hidden');});let _0x318198=null,_0x10cdc9=null,_0x4774d7=null,_0x43a9e1=JSON['parse'](localStorage['getItem']('userProfile'))||{},_0x28ef17=_0x43a9e1['nickname']?.['trim']()||'',_0x1ebbe7=_0x43a9e1['image']||'';const _0xfbf094=new Map();function _0x481fb1(_0x36d3bd){_0x5e1aca['style']['borderColor']=_0x36d3bd?'limegreen':'red';}let _0x1d4b13=null,_0x93938e=0x0;function _0xc7fc1b(){_0x318198&&_0x318198['readyState']===WebSocket['OPEN']&&(_0x43a9e1=JSON['parse'](localStorage['getItem']('userProfile'))||{},_0x28ef17=_0x43a9e1['nickname']?.['trim']()||'',_0x1ebbe7=_0x43a9e1['image']||'',_0x318198['send'](JSON['stringify']({'type':'set-nickname','nickname':_0x28ef17,'profileImage':_0x1ebbe7})));}function _0x19b2c0(){const _0x5c21f0=document['getElementById']('chatUsers'),_0x2ca08a=document['getElementById']('chatUserBadge');_0x5c21f0['innerHTML']='',_0xfbf094['forEach']((_0x57d693,_0x4c74a6)=>{const _0x44df6b=document['createElement']('div');_0x44df6b['className']='chat-user-item';const _0x4a9bb8=document['createElement']('img');_0x4a9bb8['className']='chat-user-avatar',_0x57d693['profileImage']&&_0x57d693['profileImage']['startsWith']('data:')||_0x57d693['profileImage']&&''!==_0x57d693['profileImage']?_0x4a9bb8['src']=_0x57d693['profileImage']:_0x4a9bb8['src']='/static/draw/images/icons/cat.svg';const _0x2764e1=document['createElement']('span');_0x2764e1['className']='chat-user-name',_0x2764e1['textContent']=_0x57d693['nickname']||'Unknown',_0x44df6b['appendChild'](_0x4a9bb8),_0x44df6b['appendChild'](_0x2764e1),_0x5c21f0['appendChild'](_0x44df6b);});const _0x710f8=_0xfbf094['size'];_0x2ca08a&&(_0x2ca08a['textContent']=_0x710f8,_0x2ca08a['style']['display']=_0x710f8>0x0?'flex':'none');}function _0x4fc053(){const _0xffc840=_0x2d65c3['value']['trim']();if(_0xffc840&&_0x318198&&_0x318198['readyState']===WebSocket['OPEN']){const _0x1b090c={'type':'text','clientId':_0x10cdc9,'message':_0xffc840,'timestamp':Date['now']()};_0x318198['send'](JSON['stringify'](_0x1b090c)),_0x2d65c3['value']='',_0x555b57(_0x1b090c,'sent');}}function _0x555b57(_0x2ebeb5,_0x159872){const _0x23424d=_0xfbf094['get'](_0x2ebeb5['clientId'])||{},_0x4f7297=_0x23424d['nickname']||'Unknown',_0x5d125a=_0x23424d['profileImage']?'<img\x20src=\x22'+_0x23424d['profileImage']+'\x22\x20class=\x22chat-avatar\x22>':'',_0x27dc46=_0x1fca4d(_0x2ebeb5['clientId']),_0xeffdc4=new Date(_0x2ebeb5['timestamp']||Date['now']()),_0x396744=String(_0xeffdc4['getHours']())['padStart'](0x2,'0')+':'+String(_0xeffdc4['getMinutes']())['padStart'](0x2,'0')+':'+String(_0xeffdc4['getSeconds']())['padStart'](0x2,'0'),_0x5932fc=document['createElement']('div');if('system'===_0x159872)_0x5932fc['textContent']='***\x20'+_0x2ebeb5['message']+'\x20***',_0x5932fc['className']='chat-message\x20system';else{_0x5932fc['className']='chat-message\x20'+_0x159872,_0x5932fc['style']['backgroundColor']='received'===_0x159872?_0x27dc46:'';const _0x339452=marked['parse'](_0x2ebeb5['message']),_0xc9ab65=DOMPurify['sanitize'](_0x339452,{'ADD_TAGS':['pre','code'],'ADD_ATTR':['class']});_0x5932fc['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-timestamp\x22>'+_0x396744+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-message-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x5d125a+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22chat-sender-name\x22>'+_0x4f7297+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-message-body\x22>'+_0xc9ab65+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x5932fc['querySelectorAll']('pre\x20code')['forEach'](_0x50c0c9=>{hljs['highlightElement'](_0x50c0c9);});}_0x203292['prepend'](_0x5932fc);}function _0x1fca4d(_0x367cd8){let _0xebc6c=0x0;for(let _0x7c02f2=0x0;_0x7c02f2<_0x367cd8['length'];_0x7c02f2++)_0xebc6c=_0x367cd8['charCodeAt'](_0x7c02f2)+((_0xebc6c<<0x5)-_0xebc6c);return'hsl('+_0xebc6c%0x168+',\x2070%,\x2080%)';}!function _0x2f0044(){_0x318198&&(_0x318198['onopen']=_0x318198['onmessage']=_0x318198['onerror']=_0x318198['onclose']=null,_0x318198=null);let _0x27c9fc='';if('localhost'===location['hostname']||'127.0.0.1'===location['hostname']||location['hostname']['startsWith']('172.')||location['hostname']['startsWith']('192.168.')){const _0x47765e=0xbb9;_0x27c9fc=('https:'===location['protocol']?'wss':'ws')+'://'+location['hostname']+':'+_0x47765e;}else _0x27c9fc=('https:'===location['protocol']?'wss':'ws')+'://'+location['host']+'/chat-ws/';_0x318198=new WebSocket(_0x27c9fc),_0x318198['onopen']=()=>{_0x481fb1(!0x0),_0x4774d7&&(clearTimeout(_0x4774d7),_0x4774d7=null),_0x93938e=Date['now'](),_0x1d4b13&&clearInterval(_0x1d4b13),_0x1d4b13=setInterval(()=>{_0x318198['readyState']===WebSocket['OPEN']&&(_0x318198['send'](JSON['stringify']({'type':'ping','timestamp':Date['now']()})),Date['now']()-_0x93938e>0x2710&&(console['warn']('[WebSocket]\x20Pong\x20timeout\x20—\x20force\x20reconnect'),_0x318198['close']()));},0xbb8),_0xc7fc1b();},_0x318198['onmessage']=_0x4b7413=>{try{let _0x306491=_0x4b7413['data'];_0x306491['startsWith']('[User]\x20')&&(_0x306491=_0x306491['substring'](0x7));const _0x777dac=JSON['parse'](_0x306491);if('welcome'===_0x777dac['type'])return _0x10cdc9=_0x777dac['clientId'],void _0x19b2c0();if('profile-update'===_0x777dac['type'])return _0xfbf094['set'](_0x777dac['clientId'],{'nickname':_0x777dac['nickname'],'profileImage':_0x777dac['profileImage']}),void _0x19b2c0();if('user-list'===_0x777dac['type'])return _0xfbf094['clear'](),_0x777dac['users']['forEach'](_0x49c71e=>{_0xfbf094['set'](_0x49c71e['clientId'],{'nickname':_0x49c71e['nickname'],'profileImage':_0x49c71e['profileImage']});}),void _0x19b2c0();if('pong'===_0x777dac['type'])return void(_0x93938e=Date['now']());if('text'===_0x777dac['type']){const _0x32f5b7=_0x777dac['clientId']===_0x10cdc9;return void _0x555b57(_0x777dac,_0x32f5b7?'sent':'received');}if('image'===_0x777dac['type']){const _0x457597=_0xfbf094['get'](_0x777dac['clientId'])||{},_0x2e7796=_0x457597['nickname']||'Unknown',_0x1f7597=_0x457597['profileImage']?'<img\x20src=\x22'+_0x457597['profileImage']+'\x22\x20class=\x22chat-avatar\x22>':'',_0x46e305=_0x1fca4d(_0x777dac['clientId']),_0x59fcbc=document['createElement']('div');return _0x59fcbc['className']='chat-message\x20received',_0x59fcbc['style']['backgroundColor']=_0x46e305,_0x59fcbc['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x1f7597+'\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-text\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>['+_0x2e7796+']:\x20posted\x20artwork</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22'+_0x777dac['imageData']+'\x22\x20alt=\x22'+_0x777dac['imageName']+'\x22\x20style=\x22max-width:\x20220px;\x20max-height:\x20320px;\x20margin-top:\x205px;\x20border-radius:\x208px;\x20box-shadow:\x200\x202px\x208px\x20rgba(0,0,0,0.2);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',void _0x203292['prepend'](_0x59fcbc);}if('system'===_0x777dac['type'])return void _0x555b57({'clientId':'','message':_0x777dac['message'],'timestamp':_0x777dac['timestamp']},'system');}catch(_0x2e3c43){console['error']('[WebSocket]\x20Invalid\x20message\x20format',_0x4b7413['data']);}},_0x318198['onclose']=()=>{_0x481fb1(!0x1),_0x1d4b13&&(clearInterval(_0x1d4b13),_0x1d4b13=null),_0x4774d7&&clearTimeout(_0x4774d7),_0x4774d7=setTimeout(_0x2f0044,0xbb8);},_0x318198['onerror']=_0xfdf916=>{console['error']('[WebSocket]\x20Error:',_0xfdf916);};}(),_0x56c02f['addEventListener']('click',_0x4fc053),_0x2d65c3['addEventListener']('keypress',_0x587f65=>{'Enter'===_0x587f65['key']&&(_0x587f65['preventDefault'](),_0x4fc053());}),marked['setOptions']({'breaks':!0x0,'gfm':!0x0,'headerIds':!0x1,'mangle':!0x1,'sanitize':!0x1}),document['getElementById']('sendToChatButton')['addEventListener']('click',()=>{!function(_0x18fc7f='Untitled',_0x57c0bb={}){const {size:_0x3fda6d=0x400,quality:_0x355ace=0.75,format:_0x1c58f5='image/webp',includeBackground:_0x5c87fb=!0x0,glFlipY:_0x3d63e0=!0x0}=_0x57c0bb;try{console['log']('[sendCurrentArtworkToChat]\x20start');let _0x25f900=null;_0x25f900=_0x136890(_0x5c87fb),console['log']('[sendCurrentArtworkToChat]\x20Using\x20composeToCanvas()\x20flatten');const _0x392757=0x1===_0x3fda6d?Math['max'](_0x25f900['width'],_0x25f900['height']):Math['max'](0x1,Math['round'](_0x3fda6d)),_0x210429=Math['min'](0x1,_0x392757/Math['max'](_0x25f900['width'],_0x25f900['height'])),_0x21b9ca=Math['max'](0x1,Math['round'](_0x25f900['width']*_0x210429)),_0x59d742=Math['max'](0x1,Math['round'](_0x25f900['height']*_0x210429)),_0x746d9a=document['createElement']('canvas');_0x746d9a['width']=_0x21b9ca,_0x746d9a['height']=_0x59d742,_0x746d9a['getContext']('2d')['drawImage'](_0x25f900,0x0,0x0,_0x21b9ca,_0x59d742);const _0x2fc39e=_0x25f900['width']*_0x25f900['height']*0x4;console['log']('[sendCurrentArtworkToChat]\x20Raw\x20RGBA\x20~'+Math['round'](_0x2fc39e/0x400)+'\x20KB');const _0x46ea28=_0x1c58f5,_0x2333c7=_0x355ace;_0x746d9a['toBlob'](_0x58cc9c=>{if(!_0x58cc9c)return console['error']('[sendCurrentArtworkToChat]\x20ERROR:\x20Failed\x20to\x20generate\x20blob.'),void _0x1d8777('Error\x20sending\x20artwork\x20to\x20chat.','error');console['log']('[sendCurrentArtworkToChat]\x20Blob\x20'+_0x46ea28+',\x20'+Math['round'](_0x58cc9c['size']/0x400)+'\x20KB');const _0xecc5b8=new FileReader();_0xecc5b8['onloadend']=()=>{const _0x4b8ffc=_0xecc5b8['result'];if(_0x318198&&_0x318198['readyState']===WebSocket['OPEN']){const _0x1ad799=JSON['parse'](localStorage['getItem']('userProfile'))||{},_0x23c350=_0x1ad799['nickname']?.['trim']()||'',_0x5cdf9d=_0x1ad799['image']||'',_0x4bfcdf={'type':'image','clientId':_0x10cdc9,'nickname':_0x23c350,'profileImage':_0x5cdf9d,'imageData':_0x4b8ffc,'imageName':_0x18fc7f,'timestamp':Date['now']()};_0x318198['send'](JSON['stringify'](_0x4bfcdf)),console['log']('[sendCurrentArtworkToChat]\x20Artwork\x20sent\x20to\x20chat.'),_0x1d8777('Send\x20to\x20Chat','info');}},_0xecc5b8['readAsDataURL'](_0x58cc9c);},_0x46ea28,_0x2333c7);}catch(_0x31e66d){console['error']('[sendCurrentArtworkToChat]\x20CATCH\x20ERROR:',_0x31e66d),_0x1d8777('Error\x20sending\x20artwork\x20to\x20chat.','error');}}('Quick\x20Share');});const _0x1e3e62=document['getElementById']('brushSizeToggle'),_0x4378e6=document['getElementById']('brushSizeSliderContainer');let _0x5972eb='true'===localStorage['getItem']('brushSizeToggleMinimized');function _0x23009a(){if(_0x4378e6['dataset']['minimized']=_0x5972eb?'true':'false',_0x4378e6['classList']['remove']('brush-panel-visible','brush-panel-hidden'),_0x5972eb){_0x4378e6['classList']['add']('brush-panel-hidden'),_0x1e3e62['innerHTML']='<img\x20class=\x22show-icon\x22\x20src=\x22/static/draw/images/icons/hide.svg\x22\x20alt=\x22Show\x22>';const _0x239a65=_0x4378e6['getBoundingClientRect'](),_0x198e13=window['innerWidth'],_0x416660=window['innerHeight'];(_0x239a65['left']<0x0||_0x239a65['top']<0x0||_0x239a65['left']>_0x198e13-0x28||_0x239a65['top']>_0x416660-0x28)&&(_0x4378e6['style']['left']='10px',_0x4378e6['style']['top']='10px');}else _0x4378e6['classList']['add']('brush-panel-visible'),_0x1e3e62['innerHTML']='<img\x20class=\x22show-icon\x22\x20src=\x22/static/draw/images/icons/show.svg\x22\x20alt=\x22Hide\x22>';}_0x23009a(),_0x1e3e62['addEventListener']('click',()=>{_0x5972eb=!_0x5972eb,localStorage['setItem']('brushSizeToggleMinimized',_0x5972eb),_0x23009a();}),_0x23009a();const _0x27c1cd=document['getElementById']('brushContainerToggle'),_0x9d2fe1=document['getElementById']('brushContainer');let _0x5c7810='true'===localStorage['getItem']('brushContainerMinimized');function _0x4cf1b9(){_0x9d2fe1['querySelectorAll']('.brush-thumbnail')['forEach'](_0x101c87=>{_0x101c87['style']['display']=_0x5c7810?'none':'inline-block';}),_0x27c1cd['innerHTML']=_0x5c7810?'<img\x20class=\x22show-icon\x22\x20src=\x22/static/draw/images/icons/hide.svg\x22\x20alt=\x22Show\x22>':'<img\x20class=\x22show-icon\x22\x20src=\x22/static/draw/images/icons/show.svg\x22\x20alt=\x22Hide\x22>';}_0x27c1cd['addEventListener']('click',()=>{_0x5c7810=!_0x5c7810,localStorage['setItem']('brushContainerMinimized',_0x5c7810),_0x4cf1b9();}),_0x4cf1b9();const _0x46cd41=document['getElementById']('brushSizeSliderContainer'),_0x4ec9b5=document['getElementById']('brushSizeDragBar');let _0x3e67a5=0x0,_0x20f246=0x0,_0x4f3849=!0x1;_0x4ec9b5['addEventListener']('pointerdown',_0x1b72c3=>{_0x4f3849=!0x0,_0x3e67a5=_0x1b72c3['clientX']-_0x46cd41['offsetLeft'],_0x20f246=_0x1b72c3['clientY']-_0x46cd41['offsetTop'];try{_0x4ec9b5['setPointerCapture'](_0x1b72c3['pointerId']);}catch{}_0x4ec9b5['style']['cursor']='grabbing';}),_0x4ec9b5['addEventListener']('pointermove',_0x4e75e5=>{if(!_0x4f3849)return;const _0x2e8a2d=_0x4e75e5['clientX']-_0x3e67a5,_0x4dab56=_0x4e75e5['clientY']-_0x20f246,_0x5f11f4=window['visualViewport']&&window['visualViewport']['width']||window['innerWidth'],_0xeb1f1b=window['visualViewport']&&window['visualViewport']['height']||window['innerHeight'],_0x3465bb=_0x46cd41['getBoundingClientRect'](),_0x4c2086=Math['min'](Math['max'](_0x2e8a2d,0x0),_0x5f11f4-_0x3465bb['width']),_0x4f5f7a=Math['min'](Math['max'](_0x4dab56,0x0),_0xeb1f1b-_0x3465bb['height']);_0x46cd41['style']['left']=_0x4c2086+'px',_0x46cd41['style']['top']=_0x4f5f7a+'px',_0x46cd41['style']['bottom']='auto';}),_0x4ec9b5['addEventListener']('pointerup',_0x404596=>{_0x4f3849=!0x1;try{_0x4ec9b5['releasePointerCapture'](_0x404596['pointerId']);}catch{}_0x4ec9b5['style']['cursor']='grab';const _0x26b349=window['visualViewport']&&window['visualViewport']['width']||window['innerWidth'],_0x1bbb7e=window['visualViewport']&&window['visualViewport']['height']||window['innerHeight'],_0x2483c6=_0x46cd41['getBoundingClientRect'](),_0x326439=Math['min'](Math['max'](_0x46cd41['offsetLeft'],0x0),_0x26b349-_0x2483c6['width']),_0x554293=Math['min'](Math['max'](_0x46cd41['offsetTop'],0x0),_0x1bbb7e-_0x2483c6['height']);_0x46cd41['style']['left']=_0x326439+'px',_0x46cd41['style']['top']=_0x554293+'px';}),_0x4ec9b5['addEventListener']('pointercancel',()=>{_0x4f3849=!0x1,_0x4ec9b5['style']['cursor']='grab';});const _0x4f38fc=document['getElementById']('brushContainerWrapper'),_0x59fbf9=document['getElementById']('brushContainerDragBar');let _0x23f1be=0x0,_0x8faec0=0x0,_0x5b798d=!0x1;_0x59fbf9['addEventListener']('pointerdown',_0x3e3a30=>{_0x5b798d=!0x0,_0x23f1be=_0x3e3a30['clientX']-_0x4f38fc['offsetLeft'],_0x8faec0=_0x3e3a30['clientY']-_0x4f38fc['offsetTop'];try{_0x59fbf9['setPointerCapture'](_0x3e3a30['pointerId']);}catch{}_0x59fbf9['style']['cursor']='grabbing';}),_0x59fbf9['addEventListener']('pointermove',_0x4adda7=>{if(!_0x5b798d)return;const _0x4588f9=_0x4adda7['clientX']-_0x23f1be,_0x20769e=_0x4adda7['clientY']-_0x8faec0,_0x431e5f=window['visualViewport']&&window['visualViewport']['width']||window['innerWidth'],_0x4ab916=window['visualViewport']&&window['visualViewport']['height']||window['innerHeight'],_0x1760ff=_0x4f38fc['getBoundingClientRect'](),_0x3ed429=Math['min'](Math['max'](_0x4588f9,0x0),_0x431e5f-_0x1760ff['width']),_0x271fe9=Math['min'](Math['max'](_0x20769e,0x0),_0x4ab916-_0x1760ff['height']);_0x4f38fc['style']['left']=_0x3ed429+'px',_0x4f38fc['style']['top']=_0x271fe9+'px';}),_0x59fbf9['addEventListener']('pointerup',_0x581cda=>{_0x5b798d=!0x1;try{_0x59fbf9['releasePointerCapture'](_0x581cda['pointerId']);}catch{}_0x59fbf9['style']['cursor']='grab';const _0x2c8d73=window['visualViewport']&&window['visualViewport']['width']||window['innerWidth'],_0x2de226=window['visualViewport']&&window['visualViewport']['height']||window['innerHeight'],_0x54dcae=_0x4f38fc['getBoundingClientRect'](),_0x265ee0=Math['min'](Math['max'](_0x4f38fc['offsetLeft'],0x0),_0x2c8d73-_0x54dcae['width']),_0x434013=Math['min'](Math['max'](_0x4f38fc['offsetTop'],0x0),_0x2de226-_0x54dcae['height']);_0x4f38fc['style']['left']=_0x265ee0+'px',_0x4f38fc['style']['top']=_0x434013+'px';}),_0x59fbf9['addEventListener']('pointercancel',()=>{_0x5b798d=!0x1,_0x59fbf9['style']['cursor']='grab';});const _0x11b1d2=document['getElementById']('menuButton'),_0x3d7eed=document['querySelector']('#saveGalleryButtons\x20.menuButtons');function _0x1d8777(_0x59da47,_0x104a01='info'){console['log']('showStatusMessage',_0x59da47);const _0x39c0ed=document['createElement']('div');_0x39c0ed['classList']['add']('status-message',_0x104a01),_0x39c0ed['innerText']=_0x59da47,document['body']['appendChild'](_0x39c0ed),setTimeout(()=>{_0x39c0ed['classList']['add']('fade-out'),setTimeout(()=>_0x39c0ed['remove'](),0x2bc);},0x2bc);}function _0x402719(_0x58c18b){_0x58c18b['style']['display']='flex',setTimeout(()=>{const _0x53d3ad=_0x58c18b['querySelector']('.close');_0x53d3ad&&!_0x53d3ad['dataset']['listenerAdded']&&(_0x53d3ad['addEventListener']('click',()=>_0x34bf0f(_0x58c18b)),_0x53d3ad['dataset']['listenerAdded']='true');},0x0);}function _0x34bf0f(_0x42b3d1){_0x42b3d1['style']['display']='none';}_0x3d7eed['style']['display']='none',_0x11b1d2['addEventListener']('click',()=>{'none'===_0x3d7eed['style']['display']?_0x3d7eed['style']['display']='flex':_0x3d7eed['style']['display']='none';});const _0x181dba=document['getElementById']('saveModal'),_0x2296a0=document['getElementById']('galleryModal'),_0x4dda2f=document['getElementById']('saveButton'),_0x3c8591=document['getElementById']('galleryButton'),_0xa0cbbd=document['getElementById']('confirmSave');function _0x4ff150({fit:_0x119c1b=!0x0}={}){const _0x4387a0=canvasWrapper['getBoundingClientRect'](),_0x3b970b=canvas['width'],_0x59df4d=canvas['height'],_0x3242cb=Math['min'](_0x4387a0['width']/_0x3b970b,_0x4387a0['height']/_0x59df4d,zoomMax),_0x5f06fd=_0x119c1b?Math['max'](zoomMin,_0x3242cb):0x1,_0x21a5de=canvas['style']['transition'];canvas['style']['transition']='transform\x20140ms\x20ease-out',zoomScale=_0x5f06fd,centerCanvasInWrapper(),setTimeout(()=>{canvas['style']['transition']=_0x21a5de;},0xa0),resetStrokeState(),needsRedraw=!0x0;}_0x4dda2f&&_0x4dda2f['addEventListener']('click',()=>_0x402719(_0x181dba)),_0x3c8591&&_0x3c8591['addEventListener']('click',()=>{_0x402719(_0x2296a0),_0x28ce08();}),_0xa0cbbd&&_0xa0cbbd['addEventListener']('click',()=>{const _0xfa2e5c=document['getElementById']('artworkName');_0x557041(_0xfa2e5c?_0xfa2e5c['value']:''),_0x34bf0f(_0x181dba);}),(document['getElementById']('resetViewBtn')['addEventListener']('click',()=>{_0x4ff150({'fit':!0x0}),document['activeElement']&&'function'==typeof document['activeElement']['blur']&&document['activeElement']['blur']();const _0x49bfd3=document['querySelector']('meta[name=\x22viewport\x22]');if(_0x49bfd3){const _0x4b47b3=_0x49bfd3['getAttribute']('content')||'width=device-width,\x20initial-scale=1',_0x1e55d9=_0x4b47b3['replace'](/,\s*maximum-scale=[^,]+/i,'');_0x49bfd3['setAttribute']('content',_0x1e55d9+',\x20maximum-scale=1'),setTimeout(()=>_0x49bfd3['setAttribute']('content',_0x4b47b3),0x50);}}),document['addEventListener']('keydown',_0x2849b6=>{isUserTyping()||'0'===_0x2849b6['key']&&_0x4ff150({'fit':!0x0});}));}),document['getElementById']('cleanButton')['addEventListener']('click',()=>clearCanvas(!0x0)),document['getElementById']('artworkName')['addEventListener']('keydown',function(_0x316fd8){'Enter'===_0x316fd8['key']&&(_0x316fd8['preventDefault'](),document['getElementById']('saveNewButton')['click']());});const uiElements=[{'id':'brushContainerWrapper','display':'flex'},{'id':'brushSizeSliderContainer','display':'flex'},{'id':'redoUndoButtons','display':'flex'},{'id':'colorsContainer','display':'block'},{'id':'saveGalleryButtons','display':'block'},{'id':'profileSection','display':'block'},{'id':'chatToggleBtn','display':'flex'},{'id':'layersPanel','display':'block'}],fadeOutUI=()=>{uiElements['forEach'](_0x4a5515=>{const _0x299a7e=document['getElementById'](_0x4a5515['id']);_0x299a7e&&(_0x299a7e['style']['opacity']='0',setTimeout(()=>{_0x299a7e['style']['display']='none';},0xfa));});},fadeInUI=()=>{uiElements['forEach'](_0xfb44f2=>{const _0x3728a7=document['getElementById'](_0xfb44f2['id']);_0x3728a7&&(_0x3728a7['style']['display']=_0xfb44f2['display'],setTimeout(()=>{_0x3728a7['style']['opacity']='1';},0xa));});};let uiTimeout=null;const uiTimeoutInterval=0x1f4,resetUITimeout=()=>{uiTimeout&&clearTimeout(uiTimeout),uiTimeout=setTimeout(fadeInUI,0x1f4);};let uiHidden=!0x1,hideStart=null;const HIDE_MOVE_THRESHOLD=0x6;function getCanvasPosFromEvent(_0xdd9e8a){const _0x5399b7=canvas['getBoundingClientRect'](),_0x476c02='touches'in _0xdd9e8a?_0xdd9e8a['touches'][0x0]:_0xdd9e8a;return{'x':(_0x476c02['clientX']-_0x5399b7['left'])*(canvas['width']/_0x5399b7['width']),'y':(_0x476c02['clientY']-_0x5399b7['top'])*(canvas['height']/_0x5399b7['height'])};}function maybeHideUIOnMove(_0x1f208f){if(!isDrawing||uiHidden||!hideStart)return;const _0x4a2a9e=getCanvasPosFromEvent('touches'in _0x1f208f?_0x1f208f['touches'][0x0]:_0x1f208f),_0x2cc4e0=_0x4a2a9e['x']-hideStart['x'],_0x481343=_0x4a2a9e['y']-hideStart['y'];Math['hypot'](_0x2cc4e0,_0x481343)>=0x6&&(fadeOutUI(),uiTimeout&&clearTimeout(uiTimeout),uiHidden=!0x0);}function endStrokeUIReset(){uiHidden&&resetUITimeout(),hideStart=null,uiHidden=!0x1;}canvas['addEventListener']('mousedown',_0xa4c36=>{'fill'!==currentTool&&(hideStart=getCanvasPosFromEvent(_0xa4c36),uiHidden=!0x1);}),canvas['addEventListener']('touchstart',_0x3b4466=>{isTwoFingerGesture||'fill'!==currentTool&&(hideStart=getCanvasPosFromEvent(_0x3b4466),uiHidden=!0x1);},{'passive':!0x1}),canvas['addEventListener']('mousemove',maybeHideUIOnMove,{'passive':!0x0}),canvas['addEventListener']('touchmove',_0x402ca2=>{isTwoFingerGesture||maybeHideUIOnMove(_0x402ca2);},{'passive':!0x1}),canvas['addEventListener']('mouseup',endStrokeUIReset),canvas['addEventListener']('touchend',endStrokeUIReset),canvas['addEventListener']('mouseleave',endStrokeUIReset),window['addEventListener']('blur',resetUITimeout),window['addEventListener']('focus',fadeInUI),document['getElementById']('footer')['innerHTML']=document['title'];const panels=[{'id':'brushSizeSliderContainer','dragBarId':'brushSizeDragBar'},{'id':'brushContainerWrapper','dragBarId':'brushContainerDragBar'}];function exportCanvasToImage(){const _0x552bb8=document['getElementById']('glCanvas');return _0x552bb8?_0x552bb8['toDataURL']('image/png'):(alert('Canvas\x20not\x20found!'),null);}function sendCanvasToFlaskForAI(){const _0x419195=exportCanvasToImage();_0x419195&&fetch('/run_ai_inference',{'method':'POST','headers':{'Content-Type':'application/json'},'body':JSON['stringify']({'image_data':_0x419195})})['then'](_0x34ae32=>_0x34ae32['blob']())['then'](_0x56ae15=>{const _0x687446=URL['createObjectURL'](_0x56ae15),_0x496d78=document['createElement']('img');_0x496d78['src']=_0x687446,_0x496d78['style']['position']='fixed',_0x496d78['style']['bottom']='10px',_0x496d78['style']['right']='10px',_0x496d78['style']['border']='2px\x20solid\x20#ccc',_0x496d78['style']['maxWidth']='200px',_0x496d78['style']['zIndex']=0x270f,document['body']['appendChild'](_0x496d78);})['catch'](_0x5e8a82=>{console['error']('Error\x20during\x20AI\x20request:',_0x5e8a82),alert('AI\x20request\x20failed.');});}async function pasteImageFromClipboard(_0x24b532){console['log']('[Clipboard]\x20pasteImageFromClipboard\x20start');try{let _0x54eab7=null;if(_0x24b532&&_0x24b532['clipboardData']&&_0x24b532['clipboardData']['items']&&_0x24b532['clipboardData']['items']['length'])for(let _0x5ec5fb=0x0;_0x5ec5fb<_0x24b532['clipboardData']['items']['length'];_0x5ec5fb++){const _0x576812=_0x24b532['clipboardData']['items'][_0x5ec5fb];if(_0x576812&&_0x576812['type']&&_0x576812['type']['startsWith']('image/')){_0x54eab7=_0x576812['getAsFile']?_0x576812['getAsFile']():null;break;}}if(!_0x54eab7&&navigator['clipboard']&&navigator['clipboard']['read'])try{const _0x1c5581=await navigator['clipboard']['read']();for(const _0x469534 of _0x1c5581){for(const _0x12926d of _0x469534['types'])if(_0x12926d['startsWith']('image/')){_0x54eab7=await _0x469534['getType'](_0x12926d);break;}if(_0x54eab7)break;}}catch(_0x247f64){console['warn']('[Clipboard]\x20navigator.clipboard.read\x20not\x20permitted',_0x247f64);}if(!_0x54eab7)return void showStatusMessage?.('Clipboard\x20has\x20no\x20image\x20data.','error');const _0x16d607=await new Promise((_0x47e523,_0xfd7b77)=>{const _0x1f93cd=URL['createObjectURL'](_0x54eab7),_0x3fb8e1=new Image();_0x3fb8e1['onload']=()=>{URL['revokeObjectURL'](_0x1f93cd),_0x47e523(_0x3fb8e1);},_0x3fb8e1['onerror']=_0x147d3f=>{URL['revokeObjectURL'](_0x1f93cd),_0xfd7b77(_0x147d3f);},_0x3fb8e1['src']=_0x1f93cd;});fixedFBOWidth&&fixedFBOHeight||(fixedFBOWidth=_0x16d607['width'],fixedFBOHeight=_0x16d607['height'],'function'==typeof initPaintLayerFixed&&initPaintLayerFixed(),'function'==typeof updateCanvasSize&&updateCanvasSize({'width':_0x16d607['width'],'height':_0x16d607['height']}),needsRedraw=!0x0);const _0x4b3205=layers&&Number['isInteger'](activeLayerIndex)?layers[activeLayerIndex]:null;if(!_0x4b3205||!_0x4b3205['fbo'])return void showStatusMessage?.('No\x20active\x20layer\x20to\x20paste\x20into.','error');const _0x552e5d=fixedFBOWidth,_0x2d900c=fixedFBOHeight;!function(_0x34dffe,_0x4a2c79,_0x43e009,_0x24ffd9){const _0x129c8b=_0x43e009/_0x34dffe['width'],_0x5e79ea=_0x24ffd9/_0x34dffe['height'],_0x13e8b8=Math['min'](_0x129c8b,_0x5e79ea,0x1),_0x3d9863=Math['max'](0x1,Math['round'](_0x34dffe['width']*_0x13e8b8)),_0x26ae5d=Math['max'](0x1,Math['round'](_0x34dffe['height']*_0x13e8b8)),_0x1f8d56=Math['floor']((_0x43e009-_0x3d9863)/0x2),_0x4cfae5=Math['floor']((_0x24ffd9-_0x26ae5d)/0x2),_0x4eda2a=document['createElement']('canvas');_0x4eda2a['width']=_0x43e009,_0x4eda2a['height']=_0x24ffd9;const _0x21cf27=_0x4eda2a['getContext']('2d');_0x21cf27['clearRect'](0x0,0x0,_0x43e009,_0x24ffd9),_0x21cf27['imageSmoothingEnabled']=!0x0,_0x21cf27['imageSmoothingQuality']='high',_0x21cf27['drawImage'](_0x34dffe,0x0,0x0,_0x34dffe['width'],_0x34dffe['height'],_0x1f8d56,_0x4cfae5,_0x3d9863,_0x26ae5d);const _0x11ebe7=gl['createTexture']();gl['bindTexture'](gl['TEXTURE_2D'],_0x11ebe7),gl['pixelStorei'](gl['UNPACK_FLIP_Y_WEBGL'],!0x1),gl['pixelStorei'](gl['UNPACK_PREMULTIPLY_ALPHA_WEBGL'],!0x1),gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],gl['RGBA'],gl['UNSIGNED_BYTE'],_0x4eda2a),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MIN_FILTER'],gl['LINEAR']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MAG_FILTER'],gl['LINEAR']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_S'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_T'],gl['CLAMP_TO_EDGE']),gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x4a2c79);const _0x561332=gl['checkFramebufferStatus'](gl['FRAMEBUFFER']);if(_0x561332!==gl['FRAMEBUFFER_COMPLETE'])return console['warn']('[Clipboard]\x20FBO\x20incomplete:',_0x561332),gl['bindFramebuffer'](gl['FRAMEBUFFER'],null),gl['bindTexture'](gl['TEXTURE_2D'],null),void gl['deleteTexture'](_0x11ebe7);gl['viewport'](0x0,0x0,_0x43e009,_0x24ffd9),gl['disable'](gl['BLEND']),gl['clearColor'](0x0,0x0,0x0,0x0),gl['clear'](gl['COLOR_BUFFER_BIT']),gl['useProgram'](quadProgram);const _0x54dca3=gl['getUniformLocation'](quadProgram,'u_flipY');null!==_0x54dca3&&gl['uniform1f'](_0x54dca3,0x1);const _0x211370=gl['getUniformLocation'](quadProgram,'u_resolution');null!==_0x211370&&gl['uniform2f'](_0x211370,_0x43e009,_0x24ffd9);const _0x51a741=gl['getUniformLocation'](quadProgram,'u_layerOpacity');null!==_0x51a741&&gl['uniform1f'](_0x51a741,0x1);const _0x29b6e6=new Float32Array([0x0,0x0,0x0,0x0,_0x43e009,0x0,0x1,0x0,0x0,_0x24ffd9,0x0,0x1,0x0,_0x24ffd9,0x0,0x1,_0x43e009,0x0,0x1,0x0,_0x43e009,_0x24ffd9,0x1,0x1]),_0x53c5a4=gl['createBuffer']();gl['bindBuffer'](gl['ARRAY_BUFFER'],_0x53c5a4),gl['bufferData'](gl['ARRAY_BUFFER'],_0x29b6e6,gl['STATIC_DRAW']);const _0x5dce6b=gl['getAttribLocation'](quadProgram,'a_position'),_0x2a7801=gl['getAttribLocation'](quadProgram,'a_texCoord');gl['enableVertexAttribArray'](_0x5dce6b),gl['vertexAttribPointer'](_0x5dce6b,0x2,gl['FLOAT'],!0x1,0x10,0x0),gl['enableVertexAttribArray'](_0x2a7801),gl['vertexAttribPointer'](_0x2a7801,0x2,gl['FLOAT'],!0x1,0x10,0x8),gl['activeTexture'](gl['TEXTURE0']),gl['bindTexture'](gl['TEXTURE_2D'],_0x11ebe7);const _0x46f8a3=gl['getUniformLocation'](quadProgram,'u_texture');null!==_0x46f8a3&&gl['uniform1i'](_0x46f8a3,0x0),gl['drawArrays'](gl['TRIANGLES'],0x0,0x6),gl['disableVertexAttribArray'](_0x5dce6b),gl['disableVertexAttribArray'](_0x2a7801),gl['bindBuffer'](gl['ARRAY_BUFFER'],null),gl['deleteBuffer'](_0x53c5a4),gl['bindFramebuffer'](gl['FRAMEBUFFER'],null),gl['bindTexture'](gl['TEXTURE_2D'],null),gl['deleteTexture'](_0x11ebe7);}(_0x16d607,_0x4b3205['fbo'],_0x552e5d,_0x2d900c),syncActiveAliases?.(),rebuildLayersUI?.(),needsRedraw=!0x0,showStatusMessage?.('Pasted\x20image\x20into\x20active\x20layer.','success'),console['log']('[Clipboard]\x20Paste\x20complete');}catch(_0x5cb9f0){console['error']('pasteImageFromClipboard\x20error',_0x5cb9f0),showStatusMessage?.('Paste\x20failed.','error');}}async function copyActiveLayerToClipboard(){console['log']('[Clipboard]\x20copyActiveLayerToClipboard\x20start');try{if(!(navigator['clipboard']&&navigator['clipboard']['write']&&window['ClipboardItem']))return void showStatusMessage?.('Clipboard\x20copy\x20not\x20supported.','error');const _0x3e88b1=layers&&Number['isInteger'](activeLayerIndex)?layers[activeLayerIndex]:null;if(!_0x3e88b1||!_0x3e88b1['fbo'])return void showStatusMessage?.('No\x20active\x20layer\x20to\x20copy.','error');const _0x5708f3=fixedFBOWidth,_0x3bad7d=fixedFBOHeight,_0x444b6d=document['createElement']('canvas');_0x444b6d['width']=_0x5708f3,_0x444b6d['height']=_0x3bad7d,_0x444b6d['getContext']('2d')['putImageData'](readFBOToImageData(_0x3e88b1['fbo'],_0x5708f3,_0x3bad7d),0x0,0x0);const _0x48ad72=document['createElement']('canvas');_0x48ad72['width']=_0x5708f3,_0x48ad72['height']=_0x3bad7d;const _0x4a9dae=_0x48ad72['getContext']('2d');_0x4a9dae['save'](),_0x4a9dae['translate'](_0x5708f3/0x2,_0x3bad7d/0x2),_0x4a9dae['scale'](-0x1,-0x1),_0x4a9dae['rotate'](Math['PI']),_0x4a9dae['drawImage'](_0x444b6d,-_0x5708f3/0x2,-_0x3bad7d/0x2),_0x4a9dae['restore']();const _0x18a7e1=await new Promise(_0x47ff35=>_0x48ad72['toBlob'](_0x47ff35,'image/png'));if(!_0x18a7e1)return void showStatusMessage?.('Copy\x20failed\x20(no\x20data).','error');await navigator['clipboard']['write']([new ClipboardItem({[_0x18a7e1['type']]:_0x18a7e1})]),showStatusMessage?.('Active\x20layer\x20copied\x20to\x20clipboard.','success'),console['log']('[Clipboard]\x20Copy\x20complete');}catch(_0x54790d){console['error']('copyActiveLayerToClipboard\x20error',_0x54790d),showStatusMessage?.('Copy\x20to\x20clipboard\x20failed.','error');}}async function _readClipboardImage(_0x490a18){if(_0x490a18&&_0x490a18['clipboardData']&&_0x490a18['clipboardData']['items']&&_0x490a18['clipboardData']['items']['length'])for(let _0x3fb144=0x0;_0x3fb144<_0x490a18['clipboardData']['items']['length'];_0x3fb144++){const _0x3472c0=_0x490a18['clipboardData']['items'][_0x3fb144];if(_0x3472c0&&_0x3472c0['type']&&_0x3472c0['type']['startsWith']('image/')){const _0xe195f8=_0x3472c0['getAsFile']?_0x3472c0['getAsFile']():null;if(_0xe195f8)return _0xe195f8;}}if(navigator['clipboard']&&navigator['clipboard']['read'])try{const _0x171b22=await navigator['clipboard']['read']();for(const _0x3f9063 of _0x171b22)for(const _0x4f1db0 of _0x3f9063['types'])if(_0x4f1db0['startsWith']('image/')){const _0x3495d4=await _0x3f9063['getType'](_0x4f1db0);if(_0x3495d4)return _0x3495d4;}}catch(_0x1f34c7){console['warn']('[Clipboard]\x20navigator.clipboard.read\x20not\x20permitted',_0x1f34c7);}return null;}function _blobToImage(_0x36df75){return new Promise((_0x2e092d,_0x44d9e7)=>{const _0x137a00=URL['createObjectURL'](_0x36df75),_0x1ac551=new Image();_0x1ac551['onload']=()=>{URL['revokeObjectURL'](_0x137a00),_0x2e092d(_0x1ac551);},_0x1ac551['onerror']=_0x4eb7ae=>{URL['revokeObjectURL'](_0x137a00),_0x44d9e7(_0x4eb7ae);},_0x1ac551['src']=_0x137a00;});}function renderLoop(){needsRedraw&&(drawScene(),console['log']('renderLoop'),needsRedraw=!0x1),requestAnimationFrame(renderLoop);}function onKeyDownClear(_0x1ad7de){if('function'==typeof isUserTyping&&isUserTyping())return;const _0x11807e=_0x1ad7de['key'];!('Delete'===_0x11807e)&&!('Backspace'===_0x11807e)||_0x1ad7de['metaKey']||_0x1ad7de['ctrlKey']||_0x1ad7de['altKey']||(_0x1ad7de['preventDefault'](),clearActiveLayer());}function onKeyDownNewLayerN(_0x444d3c){if('function'==typeof isUserTyping&&isUserTyping())return;if(_0x444d3c['metaKey']||_0x444d3c['ctrlKey']||_0x444d3c['altKey'])return;const _0x1c9ce4=_0x444d3c['key']||'';'n'!==_0x1c9ce4&&'N'!==_0x1c9ce4||(_0x444d3c['preventDefault'](),triggerAdd());}function docToCanvasScale(){return{'sx':canvas['width']/fixedFBOWidth,'sy':canvas['height']/fixedFBOHeight};}function bind(){els['gridBtn']=q('bgpCuratedGrid'),els['modal']=q('bgPickerModal'),els['curatedGrid']=q('bgpCuratedGrid'),els['file']=q('bgpFile'),els['fileName']=q('bgpFileName'),els['color']=q('bgpColor'),els['colorHex']=q('bgpColorHex'),els['apply']=q('bgpApply'),els['cancel']=q('bgpCancel'),els['closeX']=q('bgpClose'),document['querySelectorAll']('.bgp-tab')['forEach'](_0x25cff4=>{_0x25cff4['addEventListener']('click',()=>switchTab(_0x25cff4['dataset']['tab']));}),els['file']['addEventListener']('change',onUploadFile),els['color']['addEventListener']('input',syncColorHex),els['colorHex']['addEventListener']('input',()=>{let _0x7fe6d3=els['colorHex']['value']['trim']();/^#([0-9a-f]{3}|[0-9a-f]{6}|[0-9a-f]{8})$/i['test'](_0x7fe6d3)&&(els['color']['value']=_0x7fe6d3,syncColorHex());}),els['apply']['addEventListener']('click',applySelected),els['cancel']['addEventListener']('click',close),els['closeX']['addEventListener']('click',close),document['getElementById']('bgPickerBtn')?.['addEventListener']('click',open),buildCurated(),syncColorHex();}function markSelection(_0x55dc15){els['curatedGrid']['querySelectorAll']('.bgp-thumb.selected')['forEach'](_0x457abb=>_0x457abb['classList']['remove']('selected')),_0x55dc15&&_0x55dc15['classList']['add']('selected');}function open(){selectedCanvas=null,markSelection(null),els['fileName']['textContent']='No\x20file\x20chosen',els['file']['value']='',switchTab('curated'),syncColorHex(),q('bgPickerModal')['style']['display']='flex';}function toggleUIVisibilityMode(){if(!document['getElementById']('__uiHideStyle')){const _0x4f7052=document['createElement']('style');_0x4f7052['id']='__uiHideStyle',_0x4f7052['textContent']='\x0a\x20\x20\x20\x20\x20\x20/*\x20hide\x20any\x20element\x20that\x20is\x20neither\x20a\x20canvas\x20nor\x20an\x20ancestor\x20of\x20a\x20canvas,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20and\x20keep\x20the\x20toggle\x20button\x20and\x20its\x20children\x20visible\x20*/\x0a\x20\x20\x20\x20\x20\x20body.__ui_off\x20:not(canvas):not(#hideAllButton):not(#hideAllButton\x20*):not(:has(canvas))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20visibility:\x20hidden\x20!important;\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20/*\x20canvases\x20must\x20remain\x20interactive\x20while\x20UI\x20is\x20hidden\x20*/\x0a\x20\x20\x20\x20\x20\x20body.__ui_off\x20canvas\x20{\x20pointer-events:\x20auto\x20!important;\x20}\x0a\x20\x20\x20\x20\x20\x20/*\x20ensure\x20the\x20toggle\x20stays\x20clickable\x20above\x20everything\x20*/\x0a\x20\x20\x20\x20\x20\x20#hideAllButton\x20{\x20z-index:\x20999999;\x20}\x0a\x20\x20\x20\x20',document['head']['appendChild'](_0x4f7052);}const _0x16b7c7=document['body']['classList']['toggle']('__ui_off'),_0x317132=document['getElementById']('hideAllButton');_0x317132&&(_0x317132['title']=_0x16b7c7?'Show\x20UI':'Hide\x20UI');}function docToCanvasPt(_0x299c68){const {sx:_0x42d1f9,sy:_0x3a2094}=docToCanvasScale();return{'x':_0x299c68['x']*_0x42d1f9,'y':_0x299c68['y']*_0x3a2094};}function syncColorHex(){els['colorHex']['value']=els['color']['value']['toUpperCase']();const _0x5127d6=fixedFBOWidth||canvas['width'],_0xa32efb=fixedFBOHeight||canvas['height'],_0x1c4bbd=solidToCanvas(els['color']['value'],_0x5127d6,_0xa32efb),_0x250128=q('bgpSolidPreview')['getContext']('2d');_0x250128['clearRect'](0x0,0x0,q('bgpSolidPreview')['width'],q('bgpSolidPreview')['height']),_0x250128['drawImage'](imageToCanvasCover(_0x1c4bbd,q('bgpSolidPreview')['width'],q('bgpSolidPreview')['height']),0x0,0x0),selectedCanvas=_0x1c4bbd;}function setupClearLayerShortcut(){function _0x31a0e9(_0x6b5ab8){if('function'==typeof isUserTyping&&isUserTyping())return;const _0xf3fb67=_0x6b5ab8['key'];!('Delete'===_0xf3fb67)&&!('Backspace'===_0xf3fb67)||_0x6b5ab8['metaKey']||_0x6b5ab8['ctrlKey']||_0x6b5ab8['altKey']||(_0x6b5ab8['preventDefault'](),clearActiveLayer());}try{document['removeEventListener']('keydown',_0x31a0e9,!0x0);}catch{}document['addEventListener']('keydown',_0x31a0e9,!0x0);}function loadImage(_0x2306ec){return new Promise((_0x467dc0,_0x4edd9d)=>{const _0x220e45=new Image();_0x220e45['crossOrigin']='anonymous',_0x220e45['onload']=()=>_0x467dc0(_0x220e45),_0x220e45['onerror']=_0x4edd9d,_0x220e45['src']=_0x2306ec;});}function snapshotsEqual(_0x25872a,_0x2aa332){if(!_0x25872a||!_0x2aa332)return!0x1;if(_0x25872a['w']!==_0x2aa332['w']||_0x25872a['h']!==_0x2aa332['h'])return!0x1;const _0x5ebee2=_0x25872a['pixels'],_0x13b578=_0x2aa332['pixels'];if(!_0x5ebee2||!_0x13b578||_0x5ebee2['length']!==_0x13b578['length'])return!0x1;const _0x434376=_0x5ebee2['length'];for(let _0xdddf71=0x0;_0xdddf71<_0x434376;_0xdddf71+=0x80)if(_0x5ebee2[_0xdddf71]!==_0x13b578[_0xdddf71]||_0x5ebee2[_0xdddf71+0x1]!==_0x13b578[_0xdddf71+0x1]||_0x5ebee2[_0xdddf71+0x2]!==_0x13b578[_0xdddf71+0x2]||_0x5ebee2[_0xdddf71+0x3]!==_0x13b578[_0xdddf71+0x3])return!0x1;const _0x2899d1=_0x434376-0x4;return _0x5ebee2[_0x2899d1]===_0x13b578[_0x2899d1]&&_0x5ebee2[_0x2899d1+0x1]===_0x13b578[_0x2899d1+0x1]&&_0x5ebee2[_0x2899d1+0x2]===_0x13b578[_0x2899d1+0x2]&&_0x5ebee2[_0x2899d1+0x3]===_0x13b578[_0x2899d1+0x3];}function imageToCanvasCover(_0x5f3670,_0xed87a,_0x9634d0){const _0x46244e=createCanvas(_0xed87a,_0x9634d0),_0x30ea63=_0x46244e['getContext']('2d'),_0x1a5671=(_0x5f3670['naturalWidth']||_0x5f3670['width'])/(_0x5f3670['naturalHeight']||_0x5f3670['height']);let _0x3a67f9,_0x1b25bb,_0x571bd2,_0x2977db;return _0x1a5671>_0xed87a/_0x9634d0?(_0x1b25bb=_0x9634d0,_0x3a67f9=Math['ceil'](_0x9634d0*_0x1a5671),_0x571bd2=Math['floor']((_0xed87a-_0x3a67f9)/0x2),_0x2977db=0x0):(_0x3a67f9=_0xed87a,_0x1b25bb=Math['ceil'](_0xed87a/_0x1a5671),_0x571bd2=0x0,_0x2977db=Math['floor']((_0x9634d0-_0x1b25bb)/0x2)),_0x30ea63['drawImage'](_0x5f3670,_0x571bd2,_0x2977db,_0x3a67f9,_0x1b25bb),_0x46244e;}function clearActiveLayer(){const _0x2143cb='function'==typeof getActiveLayer?getActiveLayer():layers?.[activeLayerIndex];if(!(gl&&_0x2143cb&&_0x2143cb['fbo']&&_0x2143cb['texture']))return;const _0x1ff797=snapshotLayer(activeLayerIndex),_0x541a48=0x0|fixedFBOWidth,_0x1eb618=0x0|fixedFBOHeight,_0x91a7bc=gl['getParameter'](gl['FRAMEBUFFER_BINDING']),_0x5a69c7=gl['getParameter'](gl['VIEWPORT']);gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x2143cb['fbo']),gl['viewport'](0x0,0x0,_0x541a48,_0x1eb618),gl['disable'](gl['BLEND']),gl['clearColor'](0x0,0x0,0x0,0x0),gl['clear'](gl['COLOR_BUFFER_BIT']),gl['bindTexture'](gl['TEXTURE_2D'],_0x2143cb['texture']),(0x0|_0x2143cb['texW'])===_0x541a48&&(0x0|_0x2143cb['texH'])===_0x1eb618||(gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],_0x541a48,_0x1eb618,0x0,gl['RGBA'],gl['UNSIGNED_BYTE'],null),_0x2143cb['texW']=_0x541a48,_0x2143cb['texH']=_0x1eb618,gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x2143cb['fbo']),gl['framebufferTexture2D'](gl['FRAMEBUFFER'],gl['COLOR_ATTACHMENT0'],gl['TEXTURE_2D'],_0x2143cb['texture'],0x0)),gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x91a7bc),_0x5a69c7&&gl['viewport'](_0x5a69c7[0x0],_0x5a69c7[0x1],_0x5a69c7[0x2],_0x5a69c7[0x3]);const _0x4a1371=snapshotLayer(activeLayerIndex);_0x1ff797&&_0x4a1371&&History['push']({'type':'clear_layer','index':activeLayerIndex,'before':_0x1ff797,'after':_0x4a1371}),needsRedraw=!0x0,requestDrawIfIdle?.(),showStatusMessage?.('Layer\x20cleared','info');}function setupNewLayerShortcutN(){const _0x4c2833=document['getElementById']('addLayerBtn');if(_0x4c2833){try{document['removeEventListener']('keydown',_0x19007f,!0x0);}catch{}document['addEventListener']('keydown',_0x19007f,!0x0);}function _0x19007f(_0x45d14d){if('function'==typeof isUserTyping&&isUserTyping())return;if(_0x45d14d['metaKey']||_0x45d14d['ctrlKey']||_0x45d14d['altKey'])return;const _0x20680d=_0x45d14d['key']||'';'n'!==_0x20680d&&'N'!==_0x20680d||(_0x45d14d['preventDefault'](),(function(){try{_0x4c2833['click'](),console['log']('[Shortcut]\x20New\x20Layer\x20via\x20\x27n\x27\x20→\x20addBtn.click()');}catch(_0x5c4afd){try{const _0x2ebca4='Layer\x20'+(layers['length']+0x1),_0x5a7599='number'==typeof activeLayerIndex?activeLayerIndex:layers['length']-0x1;addLayer(_0x2ebca4,_0x5a7599),console['log']('[Shortcut]\x20New\x20Layer\x20fallback\x20→\x20addLayer()',{'name':_0x2ebca4,'insertBelowIndex':_0x5a7599});}catch(_0x3631de){console['warn']('[Shortcut]\x20New\x20Layer\x20failed',_0x3631de);}}}()));}}function buildCurated(){els['curatedGrid']['innerHTML']='',curated['forEach'](_0x4dc475=>{const _0x592fb3=el('button','bgp-thumb');_0x592fb3['type']='button';const _0x3aa596=el('img');_0x3aa596['loading']='lazy',_0x3aa596['src']=_0x4dc475,_0x3aa596['alt']='background',_0x592fb3['appendChild'](_0x3aa596),_0x592fb3['addEventListener']('click',async()=>{const _0x1b248e=fixedFBOWidth||canvas['width'],_0x7470b6=fixedFBOHeight||canvas['height'],_0x581319=await loadImage(_0x4dc475);selectedCanvas=imageToCanvasCover(_0x581319,_0x1b248e,_0x7470b6),markSelection(_0x592fb3);}),els['curatedGrid']['appendChild'](_0x592fb3);});}function solidToCanvas(_0x751aed,_0x56ea81,_0x291f56){const _0x358328=createCanvas(_0x56ea81,_0x291f56),_0x20ac38=_0x358328['getContext']('2d');return _0x20ac38['fillStyle']=_0x751aed,_0x20ac38['fillRect'](0x0,0x0,_0x56ea81,_0x291f56),_0x358328;}function install(_0x493e75){_0x493e75?.['curated']&&Array['isArray'](_0x493e75['curated'])&&(curated=_0x493e75['curated']),bind();}function q(_0x52eeae){return document['getElementById'](_0x52eeae);}function switchTab(_0x14116f){currentTab=_0x14116f,document['querySelectorAll']('.bgp-tab')['forEach'](_0x3b160b=>_0x3b160b['classList']['toggle']('active',_0x3b160b['dataset']['tab']===_0x14116f)),q('bgPickerModal')['querySelectorAll']('.bgp-pane')['forEach'](_0x5db4e5=>{const _0x35cbd5=_0x5db4e5['classList']['contains']('bgp-pane-curated')?'curated':_0x5db4e5['classList']['contains']('bgp-pane-upload')?'upload':'solid';_0x5db4e5['classList']['toggle']('active',_0x35cbd5===_0x14116f);});}function onUploadFile(_0x188a2f){const _0xdbe7c7=_0x188a2f['target']['files']&&_0x188a2f['target']['files'][0x0];if(!_0xdbe7c7)return;els['fileName']['textContent']=_0xdbe7c7['name'];const _0x35ca63=new FileReader();_0x35ca63['onload']=async()=>{const _0x49bbc7=_0x35ca63['result'],_0x129f64=await loadImage(_0x49bbc7),_0x2b7f12=fixedFBOWidth||canvas['width'],_0x5ba3e7=fixedFBOHeight||canvas['height'];selectedCanvas=imageToCanvasCover(_0x129f64,_0x2b7f12,_0x5ba3e7);const _0x1af365=q('bgpUploadPreview'),_0x1fd11c=_0x1af365['getContext']('2d');_0x1fd11c['clearRect'](0x0,0x0,_0x1af365['width'],_0x1af365['height']),_0x1fd11c['drawImage'](imageToCanvasCover(_0x129f64,_0x1af365['width'],_0x1af365['height']),0x0,0x0);},_0x35ca63['readAsDataURL'](_0xdbe7c7);}function docToCanvasPx(_0x207991,_0x2a7189){return{'x':_0x207991*(canvas['width']/fixedFBOWidth),'y':_0x2a7189*(canvas['height']/fixedFBOHeight)};}function close(){q('bgPickerModal')['style']['display']='none';}function createCanvas(_0x29e416,_0x2d3c41){const _0x208381=document['createElement']('canvas');return _0x208381['width']=_0x29e416,_0x208381['height']=_0x2d3c41,_0x208381;}function applySelected(){if(!selectedCanvas)return void close();const _0x401974=new Image();_0x401974['onload']=()=>{currentImage=_0x401974,fixedFBOWidth=_0x401974['width'],fixedFBOHeight=_0x401974['height'],initPaintLayerFixed(),updateCanvasSize(_0x401974),initFloodFBOs(),createTextureFromImage(_0x401974),canvas['offsetWidth'],canvasWrapper['offsetWidth'],zoomScale=0x1,panX=(canvasWrapper['clientWidth']-canvas['width'])/0x2,panY=(canvasWrapper['clientHeight']-canvas['height'])/0x2,updateCanvasTransform(),needsRedraw=!0x0,initFloodFillProgram(),addSoundEvents(),close();},_0x401974['src']=selectedCanvas['toDataURL']('image/png');}function el(_0x4d5112,_0x1f4bfd){const _0x5dac02=document['createElement'](_0x4d5112);return _0x1f4bfd&&(_0x5dac02['className']=_0x1f4bfd),_0x5dac02;}function layerLocalToDoc(_0x3bf99a,_0x55064d,_0x5aa139){const _0x504e46=Number['isFinite'](_0x3bf99a['scaleX'])?_0x3bf99a['scaleX']:0x1,_0x458ed4=Number['isFinite'](_0x3bf99a['scaleY'])?_0x3bf99a['scaleY']:0x1,_0x419594=Number['isFinite'](_0x3bf99a['rotation'])?_0x3bf99a['rotation']:0x0,_0x48a882=Math['cos'](_0x419594),_0x5a9b45=Math['sin'](_0x419594),_0xfc7534=_0x55064d*_0x504e46,_0x4f84a3=_0x5aa139*_0x458ed4;return{'x':_0x3bf99a['x']+(_0xfc7534*_0x48a882-_0x4f84a3*_0x5a9b45),'y':_0x3bf99a['y']+(_0xfc7534*_0x5a9b45+_0x4f84a3*_0x48a882)};}function docToLayerLocal(_0x1cc870,_0x371528,_0x1992b0){const _0x23c3aa=_0x371528-_0x1cc870['x'],_0x524cd8=_0x1992b0-_0x1cc870['y'],_0x361431=Number['isFinite'](_0x1cc870['rotation'])?_0x1cc870['rotation']:0x0,_0x228d08=Math['cos'](_0x361431),_0x56e26a=Math['sin'](_0x361431),_0xc5e0df=-_0x23c3aa*_0x56e26a+_0x524cd8*_0x228d08;return{'px':(_0x23c3aa*_0x228d08+_0x524cd8*_0x56e26a)/(Number['isFinite'](_0x1cc870['scaleX'])?_0x1cc870['scaleX']:0x1),'py':_0xc5e0df/(Number['isFinite'](_0x1cc870['scaleY'])?_0x1cc870['scaleY']:0x1)};}function triggerAdd(){try{addBtn['click'](),console['log']('[Shortcut]\x20New\x20Layer\x20via\x20\x27n\x27\x20→\x20addBtn.click()');}catch(_0x10a308){try{const _0x51fbb7='Layer\x20'+(layers['length']+0x1),_0x4f9c89='number'==typeof activeLayerIndex?activeLayerIndex:layers['length']-0x1;addLayer(_0x51fbb7,_0x4f9c89),console['log']('[Shortcut]\x20New\x20Layer\x20fallback\x20→\x20addLayer()',{'name':_0x51fbb7,'insertBelowIndex':_0x4f9c89});}catch(_0x232e23){console['warn']('[Shortcut]\x20New\x20Layer\x20failed',_0x232e23);}}}panels['forEach'](({id:_0x21d852,dragBarId:_0x49199c})=>{const _0x5464fe=document['getElementById'](_0x21d852),_0x3bded4=document['getElementById'](_0x49199c);if(!_0x5464fe||!_0x3bded4)return;let _0x656755=0x0,_0x1f06b7=0x0,_0xe8d811=!0x1;const _0x524aee=localStorage['getItem'](_0x21d852+'-x'),_0x737ed=localStorage['getItem'](_0x21d852+'-y');null!==_0x524aee&&null!==_0x737ed&&(_0x5464fe['style']['left']=_0x524aee+'px',_0x5464fe['style']['top']=_0x737ed+'px',_0x5464fe['style']['bottom']='auto'),_0x3bded4['addEventListener']('pointerdown',_0x38c1ca=>{_0xe8d811=!0x0,_0x656755=_0x38c1ca['clientX']-_0x5464fe['offsetLeft'],_0x1f06b7=_0x38c1ca['clientY']-_0x5464fe['offsetTop'],_0x3bded4['setPointerCapture'](_0x38c1ca['pointerId']),_0x3bded4['style']['cursor']='grabbing';}),_0x3bded4['addEventListener']('pointermove',_0x35ad40=>{if(!_0xe8d811)return;const _0x29d86d=_0x35ad40['clientX']-_0x656755,_0x225334=_0x35ad40['clientY']-_0x1f06b7;_0x5464fe['style']['left']=_0x29d86d+'px',_0x5464fe['style']['top']=_0x225334+'px',_0x5464fe['style']['bottom']='auto';}),_0x3bded4['addEventListener']('pointerup',_0x4d79e2=>{_0xe8d811=!0x1,_0x3bded4['releasePointerCapture'](_0x4d79e2['pointerId']),_0x3bded4['style']['cursor']='grab',localStorage['setItem'](_0x21d852+'-x',_0x5464fe['offsetLeft']),localStorage['setItem'](_0x21d852+'-y',_0x5464fe['offsetTop']);}),_0x3bded4['addEventListener']('pointercancel',()=>{_0xe8d811=!0x1,_0x3bded4['style']['cursor']='grab';});}),document['addEventListener']('paste',_0x1ffa1a=>{!!(_0x1ffa1a&&_0x1ffa1a['clipboardData']&&[..._0x1ffa1a['clipboardData']['items']]['some'](_0x4dfaa6=>_0x4dfaa6['type']['startsWith']('image/')))&&(_0x1ffa1a['preventDefault'](),pasteImageFromClipboard(_0x1ffa1a));}),document['addEventListener']('copy',_0x37ba79=>{(navigator['platform']['toUpperCase']()['includes']('MAC')?_0x37ba79['metaKey']:_0x37ba79['ctrlKey'])&&!0x0===_0x37ba79['shiftKey']&&(_0x37ba79['preventDefault'](),copyActiveLayerToClipboard());}),document['addEventListener']('keydown',_0x9d649f=>{(navigator['platform']['toUpperCase']()['includes']('MAC')?_0x9d649f['metaKey']:_0x9d649f['ctrlKey'])&&'v'===_0x9d649f['key']['toLowerCase']()&&setTimeout(async()=>{if(navigator['clipboard']&&navigator['clipboard']['read'])try{const _0xe9c6b2=await navigator['clipboard']['read']();_0xe9c6b2['some'](_0x4318f0=>_0x4318f0['types']['some'](_0x56cd35=>_0x56cd35['startsWith']('image/')))&&pasteImageFromClipboard(null);}catch(_0x10f88f){}},0x0);}),(function(){const _0x451a91=document['getElementById']('layersPanel'),_0x198721=document['getElementById']('layersPanelDragBar'),_0x53b894=document['getElementById']('layersList'),_0x13c802=document['getElementById']('layersActions'),_0x3e6841=document['getElementById']('layersPanelToggle');if(!_0x451a91||!_0x198721)return;const _0xab8d39='layersPanel:minimized',_0x584da0='layersPanel:x',_0xf5bf5='layersPanel:y',_0x130e06=localStorage['getItem'](_0x584da0),_0x107465=localStorage['getItem'](_0xf5bf5);null!==_0x130e06&&null!==_0x107465&&(_0x451a91['style']['left']=+_0x130e06+'px',_0x451a91['style']['top']=+_0x107465+'px',_0x451a91['style']['bottom']='auto');let _0x40e15a='true'===localStorage['getItem'](_0xab8d39);function _0x5667d5(){_0x53b894&&(_0x53b894['style']['display']=_0x40e15a?'none':'flex'),_0x13c802&&(_0x13c802['style']['display']=_0x40e15a?'none':'flex'),_0x3e6841&&(_0x3e6841['innerHTML']=_0x40e15a?'<img\x20class=\x22show-icon-invert\x22\x20src=\x22/static/draw/images/icons/hide.svg\x22\x20alt=\x22Show\x22>':'<img\x20class=\x22show-icon-invert\x22\x20src=\x22/static/draw/images/icons/show.svg\x22\x20alt=\x22Hide\x22>');}_0x5667d5(),_0x3e6841&&_0x3e6841['addEventListener']('click',_0x3ef852=>{_0x3ef852['stopPropagation'](),_0x40e15a=!_0x40e15a,localStorage['setItem'](_0xab8d39,_0x40e15a),_0x5667d5();});let _0x554295=!0x1,_0x63cc65=0x0,_0x4e1f66=0x0;function _0x366d95(_0x4e5535,_0x33d7ca,_0x410f16){return Math['max'](_0x33d7ca,Math['min'](_0x410f16,_0x4e5535));}function _0x12444b(_0x35958e){if(_0x554295){_0x554295=!0x1;try{_0x198721['releasePointerCapture'](_0x35958e['pointerId']);}catch{}_0x198721['style']['cursor']='grab',localStorage['setItem'](_0x584da0,_0x451a91['offsetLeft']),localStorage['setItem'](_0xf5bf5,_0x451a91['offsetTop']);}}_0x198721['style']['cursor']='grab',_0x198721['addEventListener']('pointerdown',function(_0x408503){const _0x5fff15=_0x408503['target'];if(!_0x5fff15['closest']||!_0x5fff15['closest']('.icon-btn')){_0x554295=!0x0,_0x63cc65=_0x408503['clientX']-_0x451a91['offsetLeft'],_0x4e1f66=_0x408503['clientY']-_0x451a91['offsetTop'];try{_0x198721['setPointerCapture'](_0x408503['pointerId']);}catch{}_0x198721['style']['cursor']='grabbing',_0x408503['preventDefault']();}}),_0x198721['addEventListener']('pointermove',function(_0xcb82f8){if(!_0x554295)return;const _0x1ae7b0=window['innerWidth'],_0x5a7d30=window['innerHeight'],_0x448c0e=_0x366d95(_0xcb82f8['clientX']-_0x63cc65,0x0,_0x1ae7b0-_0x451a91['offsetWidth']),_0x1671d8=_0x366d95(_0xcb82f8['clientY']-_0x4e1f66,0x0,_0x5a7d30-_0x451a91['offsetHeight']);_0x451a91['style']['left']=_0x448c0e+'px',_0x451a91['style']['top']=_0x1671d8+'px',_0x451a91['style']['bottom']='auto';}),_0x198721['addEventListener']('pointerup',_0x12444b),_0x198721['addEventListener']('pointercancel',_0x12444b);try{_0x53b894&&'block'===getComputedStyle(_0x53b894)['display']&&(_0x53b894['style']['display']='flex');}catch{}try{rebuildLayersUI?.();}catch{}}()),initGL(),loadDefaultImage(),loadBrushes(),createBrushThumbnails(),renderLoop(),window['addEventListener']('keydown',_0x4f04af=>{const _0x175e90=/Mac|iPhone|iPad/['test'](navigator['platform']);'F1'===_0x4f04af['key']&&(_0x4f04af['preventDefault'](),openHelpModal()),('?'===_0x4f04af['key']||'/'===_0x4f04af['key']&&_0x4f04af['shiftKey'])&&(_0x4f04af['preventDefault'](),openQuickHelpOverlay()),(_0x175e90?_0x4f04af['metaKey']:_0x4f04af['ctrlKey'])&&'/'===_0x4f04af['key']&&(_0x4f04af['preventDefault'](),openQuickHelpOverlay());});