console['log']('Helena\x20Paint\x20-\x20draw67.js');const canvas=document['getElementById']('glCanvas'),canvasWrapper=document['getElementById']('canvasWrapper')||canvas['parentElement'];canvas['style']['transformOrigin']='top\x20left';let lastX=null,lastY=null,zoomScale=0x1,panX=0x0,panY=0x0,zoomMin=0x1,zoomMax=0x5,lastTouchDist=null,lastTouchMidpoint=null,isPanning=!0x1,isTwoFingerGesture=!0x1,isUIDragging=!0x1;const PIVOT_DEBUG=!0x0,log=(..._0x48bb57)=>{console['log']('[pivot]',..._0x48bb57);};function isMobile(){return/Mobi|Android|iPhone|iPad|iPod/['test'](navigator['userAgent']);}function getMidpoint(_0xdbb278,_0x1ca4f1){return{'x':(_0xdbb278['clientX']+_0x1ca4f1['clientX'])/0x2,'y':(_0xdbb278['clientY']+_0x1ca4f1['clientY'])/0x2};}function getDistance(_0x3e5736,_0x12904b){const _0x35347a=_0x3e5736['clientX']-_0x12904b['clientX'],_0x50e490=_0x3e5736['clientY']-_0x12904b['clientY'];return Math['sqrt'](_0x35347a*_0x35347a+_0x50e490*_0x50e490);}function canPaint(){return'idle'===transformTool['mode']&&!spacePanning&&!isTwoFingerGesture&&!isUIDragging;}let pinchStart=null;function normAngle(_0x10bb0e){return _0x10bb0e>Math['PI']&&(_0x10bb0e-=0x2*Math['PI']),_0x10bb0e<-Math['PI']&&(_0x10bb0e+=0x2*Math['PI']),_0x10bb0e;}function transformCanvasPoint(_0x4b4eb5,_0x13cfb5,_0x22e2f3,_0x3b7f03){const _0x22a335=_0x4b4eb5*_0x22e2f3,_0x4d09cc=_0x13cfb5*_0x22e2f3,_0x41f465=Math['cos'](_0x3b7f03),_0x24e325=Math['sin'](_0x3b7f03);return{'x':_0x22a335*_0x41f465-_0x4d09cc*_0x24e325,'y':_0x22a335*_0x24e325+_0x4d09cc*_0x41f465};}let viewRotation=0x0,transformOriginX=0x0,transformOriginY=0x0;function updateCanvasTransform(){canvas['style']['transformOrigin']='0\x200',canvas['style']['transform']='translate('+panX+'px,\x20'+panY+'px)\x20rotate('+viewRotation+'rad)\x20scale('+zoomScale+')';}function rotatePoint(_0x378eae,_0x263a50,_0x58788f,_0x338c41=0x0,_0x2ac050=0x0){const _0x14424c=_0x378eae-_0x338c41,_0x3d5992=_0x263a50-_0x2ac050,_0x841440=Math['cos'](_0x58788f),_0x211f37=Math['sin'](_0x58788f);return{'x':_0x338c41+_0x14424c*_0x841440-_0x3d5992*_0x211f37,'y':_0x2ac050+_0x14424c*_0x211f37+_0x3d5992*_0x841440};}function docToCanvasPx(_0x375f4e,_0x3bbf8d){return{'x':_0x375f4e*(canvas['width']/fixedFBOWidth),'y':_0x3bbf8d*(canvas['height']/fixedFBOHeight)};}function tracePivot(_0x2fcb43){const _0xba2709=getActiveLayer();if(!_0xba2709)return void console['warn']('[pivot]',_0x2fcb43,'no\x20active\x20layer');const _0x42405f=transformTool['pivotCanvas'],_0x4f7c99={'x':_0xba2709['px'],'y':_0xba2709['py']},_0x15d959=docToCanvasPx(_0x4f7c99['x'],_0x4f7c99['y']),_0x1cb72b={...lastPointer};console['log']('[pivot]',_0x2fcb43,{'mode':transformTool['mode'],'lastPointer':_0x1cb72b,'pivotCanvas_UI':_0x42405f,'pivotDoc_math':_0x4f7c99,'pivotDoc_asCanvas':_0x15d959});}function screenToCanvasPx(_0x29d287,_0x5f349a,_0x105134=!0x0){const _0x6cd6fe=canvasWrapper['getBoundingClientRect']();let _0x42285b=_0x29d287-_0x6cd6fe['left'],_0x597f8b=_0x5f349a-_0x6cd6fe['top'];const _0x5e4dc1={'clientX':_0x29d287,'clientY':_0x5f349a,'panX':panX,'panY':panY,'zoomScale':zoomScale,'viewRotation':viewRotation,'clamp':_0x105134};_0x42285b-=panX,_0x597f8b-=panY;const _0x4febcd=rotatePoint(_0x42285b,_0x597f8b,-viewRotation,transformOriginX,transformOriginY);_0x42285b=_0x4febcd['x'],_0x597f8b=_0x4febcd['y'];const _0x3ae35a=_0x42285b/zoomScale,_0x4c34b4=_0x597f8b/zoomScale;if(!_0x105134)return log('screenToCanvasPx(unclamped)',_0x5e4dc1,'→',{'x':_0x3ae35a,'y':_0x4c34b4}),{'x':_0x3ae35a,'y':_0x4c34b4};const _0x25ec70={'x':Math['max'](0x0,Math['min'](canvas['width'],_0x3ae35a)),'y':Math['max'](0x0,Math['min'](canvas['height'],_0x4c34b4))};return log('screenToCanvasPx(clamped)',_0x5e4dc1,'→',_0x25ec70),_0x25ec70;}function canvasPxToFBO(_0x1306ba,_0x170646){return{'fx':_0x1306ba*(fixedFBOWidth/canvas['width']),'fy':_0x170646*(fixedFBOHeight/canvas['height'])};}function pointerToBoth(_0x4e9fc4){const _0x24df89=!(transformTool&&transformTool['mode']&&'idle'!==transformTool['mode']),_0x1b54fb=screenToCanvasPx(_0x4e9fc4['clientX'],_0x4e9fc4['clientY'],_0x24df89),_0x649b5c=canvasPxToFBO(_0x1b54fb['x'],_0x1b54fb['y']),_0x581f99={'cx':_0x1b54fb['x'],'cy':_0x1b54fb['y'],'fx':_0x649b5c['fx'],'fy':_0x649b5c['fy']};return log('pointerToBoth',{'mode':transformTool?.['mode'],'clamp':_0x24df89},'→',_0x581f99),_0x581f99;}let brushHUD={'visible':!0x1,'hideAt':0x0},lastPointer={'cx':0.5*canvas['width'],'cy':0.5*canvas['height']};function showBrushHUD(_0x236d86=0x4b0){brushHUD['visible']=!0x0,brushHUD['hideAt']=performance['now']()+_0x236d86,needsRedraw=!0x0,requestDrawIfIdle();}function maybeAutoHideBrushHUD(){brushHUD['visible']&&performance['now']()>=brushHUD['hideAt']&&(brushHUD['visible']=!0x1,needsRedraw=!0x0,requestDrawIfIdle());}let touchViz={'pts':[],'visible':!0x1};function setTouchVizFromTouches(_0x5c495e){const _0xd4df80=[];for(let _0x1729ac=0x0;_0x1729ac<_0x5c495e['length'];_0x1729ac++){const _0x38a3d8=_0x5c495e[_0x1729ac],_0x3d8eb7=screenToCanvasPx(_0x38a3d8['clientX'],_0x38a3d8['clientY']);_0xd4df80['push']({'x':_0x3d8eb7['x'],'y':_0x3d8eb7['y']});}touchViz['pts']=_0xd4df80,touchViz['visible']=_0xd4df80['length']>0x0,void 0x0!==needsRedraw&&(needsRedraw=!0x0),'function'==typeof requestDrawIfIdle&&requestDrawIfIdle();}function clearTouchViz(){touchViz['pts']=[],touchViz['visible']=!0x1,void 0x0!==needsRedraw&&(needsRedraw=!0x0),'function'==typeof requestDrawIfIdle&&requestDrawIfIdle();}const TOUCH_TARGET_OK=_0x3b9581=>!(!_0x3b9581||_0x3b9581!==canvas&&_0x3b9581!==canvasWrapper&&!_0x3b9581['closest']?.('#canvasWrapper'));function onTouchStartCapture(_0x2dd183){_0x2dd183['touches']&&_0x2dd183['touches']['length']&&TOUCH_TARGET_OK(_0x2dd183['target'])&&setTouchVizFromTouches(_0x2dd183['touches']);}function onTouchMoveCapture(_0x197635){_0x197635['touches']&&_0x197635['touches']['length']&&TOUCH_TARGET_OK(_0x197635['target'])&&setTouchVizFromTouches(_0x197635['touches']);}function onTouchEndCapture(_0x1f9b03){_0x1f9b03['touches']&&_0x1f9b03['touches']['length']?setTouchVizFromTouches(_0x1f9b03['touches']):clearTouchViz();}document['addEventListener']('touchstart',onTouchStartCapture,{'capture':!0x0,'passive':!0x0}),document['addEventListener']('touchmove',onTouchMoveCapture,{'capture':!0x0,'passive':!0x0}),document['addEventListener']('touchend',onTouchEndCapture,{'capture':!0x0,'passive':!0x0}),document['addEventListener']('touchcancel',onTouchEndCapture,{'capture':!0x0,'passive':!0x0});let frameTimes=[],memoryWarningShown=!0x1,frameRateMonitoringActive=!0x1;function sampleFrameTime(){const _0x2458db=performance['now']();if(frameTimes['push'](_0x2458db),frameTimes['length']>0x1e&&frameTimes['shift'](),activeReasons['size']>0x0){const _0x1c5c80=[];for(let _0x4bda28=0x1;_0x4bda28<frameTimes['length'];_0x4bda28++)_0x1c5c80['push'](frameTimes[_0x4bda28]-frameTimes[_0x4bda28-0x1]);(_0x1c5c80['length']?_0x1c5c80['reduce']((_0x28fd2a,_0x5ecc5b)=>_0x28fd2a+_0x5ecc5b,0x0)/_0x1c5c80['length']:0x0)>0x50&&!memoryWarningShown&&(console['warn']('⚠️\x20Low\x20frame\x20rate\x20detected!\x20Possible\x20memory\x20overload.'),showStatusMessage('⚠️\x20App\x20running\x20slow\x20—\x20consider\x20undo\x20or\x20saving','warning'),memoryWarningShown=!0x0);}}let rafId=null;const activeReasons=new Set();function requestDrawIfIdle(){rafId||(rafId=requestAnimationFrame(()=>{rafId=null,needsRedraw&&(drawScene(),needsRedraw=!0x1,sampleFrameTime?.());}));}function startRender(_0x37658a){_0x37658a&&activeReasons['add'](_0x37658a),rafId||(rafId=requestAnimationFrame(tick));}function stopRender(_0x4f164f){_0x4f164f&&activeReasons['delete'](_0x4f164f);}function tick(){rafId=null,activeReasons['size']>0x0?(needsRedraw&&(drawScene(),needsRedraw=!0x1,sampleFrameTime?.()),rafId=requestAnimationFrame(tick)):needsRedraw&&(drawScene(),needsRedraw=!0x1,sampleFrameTime?.());}let RENDER_LOOP_DISABLED=!0x0;function disableRenderLoop(){RENDER_LOOP_DISABLED=!0x0;try{activeReasons?.['clear']?.();}catch{}rafId&&(cancelAnimationFrame(rafId),rafId=null);}function enableRenderLoop(){RENDER_LOOP_DISABLED=!0x1;}const _startRender=startRender;startRender=function(_0x2fd4be){RENDER_LOOP_DISABLED||_startRender['call'](this,_0x2fd4be);};const _requestDrawIfIdle=requestDrawIfIdle;requestDrawIfIdle=function(){RENDER_LOOP_DISABLED?needsRedraw&&(drawScene(),needsRedraw=!0x1,sampleFrameTime?.()):_requestDrawIfIdle['call'](this);};const _tick=tick;tick=function(){RENDER_LOOP_DISABLED?rafId&&(cancelAnimationFrame(rafId),rafId=null):_tick['call'](this);},disableRenderLoop(),canvasWrapper['addEventListener']('wheel',_0x49fcc9=>{_0x49fcc9['preventDefault']();const _0x59af41=0x1===_0x49fcc9['deltaMode']?0x10:0x1,_0x4fa9c9=_0x49fcc9['deltaX']*_0x59af41,_0x192ace=_0x49fcc9['deltaY']*_0x59af41,_0x252216=canvasWrapper['getBoundingClientRect'](),_0x36af43=_0x49fcc9['clientX']-_0x252216['left'],_0x44c286=_0x49fcc9['clientY']-_0x252216['top'],_0x509e74=(_0x36af43-panX)/zoomScale,_0x381c1e=(_0x44c286-panY)/zoomScale;if(_0x49fcc9['ctrlKey']){const _0xef9916=0.0025,_0x2f2201=Math['min'](Math['max'](zoomScale-_0x192ace*_0xef9916,zoomMin),zoomMax),_0x47c14c=_0x2f2201/zoomScale;panX-=_0x509e74*(_0x47c14c-0x1)*zoomScale,panY-=_0x381c1e*(_0x47c14c-0x1)*zoomScale,zoomScale=_0x2f2201,updateCanvasTransform();}else{const _0x219e45=0x1;panX-=_0x4fa9c9*_0x219e45,panY-=_0x192ace*_0x219e45,updateCanvasTransform();}},{'passive':!0x1}),canvasWrapper['addEventListener']('mousemove',_0x489de1=>{const _0x33522c=screenToCanvasPx(_0x489de1['clientX'],_0x489de1['clientY'],!0x0);lastPointer['cx']=_0x33522c['x'],lastPointer['cy']=_0x33522c['y'],brushHUD['visible']&&(overlayPosition=[_0x33522c['x']/canvas['width'],_0x33522c['y']/canvas['height']],needsRedraw=!0x0,requestDrawIfIdle());},{'passive':!0x0}),canvasWrapper['addEventListener']('mousedown',_0x174291=>{const _0x1d6a35=screenToCanvasPx(_0x174291['clientX'],_0x174291['clientY'],!0x1);lastPointer['cx']=_0x1d6a35['x'],lastPointer['cy']=_0x1d6a35['y'],log('mousedown\x20→\x20seed\x20pivot',{'clientX':_0x174291['clientX'],'clientY':_0x174291['clientY'],'canvas':_0x1d6a35});},{'passive':!0x0}),canvasWrapper['addEventListener']('touchstart',_0x54a40f=>{if(!_0x54a40f['touches']||0x1!==_0x54a40f['touches']['length'])return;const _0x5b4661=_0x54a40f['touches'][0x0],_0x3b4580=screenToCanvasPx(_0x5b4661['clientX'],_0x5b4661['clientY'],!0x1);lastPointer['cx']=_0x3b4580['x'],lastPointer['cy']=_0x3b4580['y'],log('touchstart\x20→\x20seed\x20pivot',{'clientX':_0x5b4661['clientX'],'clientY':_0x5b4661['clientY'],'canvas':_0x3b4580});},{'passive':!0x0});let spacePanning=!0x1,panStart=null;document['addEventListener']('keydown',_0x2b916a=>{'Space'===_0x2b916a['code']&&(spacePanning=!0x0);}),document['addEventListener']('keyup',_0x206249=>{'Space'===_0x206249['code']&&(spacePanning=!0x1);}),canvasWrapper['addEventListener']('mousedown',_0x430a6f=>{spacePanning&&(_0x430a6f['preventDefault'](),panStart={'x':_0x430a6f['clientX'],'y':_0x430a6f['clientY'],'panX0':panX,'panY0':panY});}),window['addEventListener']('mousemove',_0x2af4fb=>{panStart&&(panX=panStart['panX0']+(_0x2af4fb['clientX']-panStart['x']),panY=panStart['panY0']+(_0x2af4fb['clientY']-panStart['y']),updateCanvasTransform());}),['mouseup','mouseleave']['forEach'](_0x1f1847=>window['addEventListener'](_0x1f1847,()=>panStart=null)),canvasWrapper['addEventListener']('mousedown',_0x104eb6=>{if(0x1!==_0x104eb6['button'])return;_0x104eb6['preventDefault']();const _0x51e991=_0x104eb6['clientX'],_0x54b02c=_0x104eb6['clientY'],_0x1f6c59=panX,_0x292f40=panY,_0x1cb82e=_0xd57662=>{panX=_0x1f6c59+(_0xd57662['clientX']-_0x51e991),panY=_0x292f40+(_0xd57662['clientY']-_0x54b02c),updateCanvasTransform();},_0x38e775=()=>{window['removeEventListener']('mousemove',_0x1cb82e),window['removeEventListener']('mouseup',_0x38e775);};window['addEventListener']('mousemove',_0x1cb82e),window['addEventListener']('mouseup',_0x38e775);}),window['addEventListener']('mousemove',onTransformPointerMove),window['addEventListener']('mousemove',onTransformPointerMove),canvas['addEventListener']('touchmove',_0x94a8e2=>{if('idle'===transformTool['mode'])return;const _0x1eec85=_0x94a8e2['touches'][0x0];_0x1eec85&&onTransformPointerMove(_0x1eec85);},{'passive':!0x1}),['mouseup','mouseleave','touchend','touchcancel']['forEach'](_0x51ee7d=>window['addEventListener'](_0x51ee7d,()=>{'idle'!==transformTool['mode']&&endTransform(!0x0);},{'passive':!0x0})),canvas['addEventListener']('mousedown',()=>{isDrawing=!0x0,startRender('draw');}),['mouseup','mouseleave']['forEach'](_0x571faa=>canvas['addEventListener'](_0x571faa,()=>{isDrawing=!0x1,stopRender('draw');})),canvas['addEventListener']('touchstart',_0x3872bc=>{isTwoFingerGesture||(isDrawing=!0x0,startRender('draw'));},{'passive':!0x1}),['touchend','touchcancel']['forEach'](_0x424907=>window['addEventListener'](_0x424907,()=>{isTwoFingerGesture&&(!event['touches']||event['touches']['length']<0x2)&&(isTwoFingerGesture=!0x1,pinchStart=null),'idle'!==transformTool['mode']&&endTransform(!0x0);},{'passive':!0x0}));let lastTouchAngle=null;function getAngle(_0x330f51,_0x365170){return Math['atan2'](_0x365170['clientY']-_0x330f51['clientY'],_0x365170['clientX']-_0x330f51['clientX']);}canvasWrapper['addEventListener']('touchstart',_0x238b98=>{if(0x2===_0x238b98['touches']['length']){_0x238b98['preventDefault'](),isTwoFingerGesture=!0x0;const _0x25ede0=_0x238b98['touches'][0x0],_0x37ff7d=_0x238b98['touches'][0x1];lastTouchDist=getDistance(_0x25ede0,_0x37ff7d),lastTouchAngle=getAngle(_0x25ede0,_0x37ff7d);const _0x310f03=getMidpoint(_0x25ede0,_0x37ff7d),_0x4b3531=canvasWrapper['getBoundingClientRect'](),_0xba6773=_0x310f03['x']-_0x4b3531['left'],_0x33cb61=_0x310f03['y']-_0x4b3531['top'],_0x20973f=screenToCanvasPx(_0xba6773+_0x4b3531['left'],_0x33cb61+_0x4b3531['top']);pinchStart={'dist':Math['max'](0.000001,lastTouchDist),'angle':lastTouchAngle,'scale0':zoomScale,'rot0':viewRotation,'anchorCanvas':{'x':_0x20973f['x'],'y':_0x20973f['y']}};}},{'passive':!0x1}),canvasWrapper['addEventListener']('touchmove',_0x2b4a06=>{if(0x2!==_0x2b4a06['touches']['length']||!pinchStart)return;_0x2b4a06['preventDefault'](),isDrawing=!0x1;const _0xd2e3b9=_0x2b4a06['touches'][0x0],_0x33fb14=_0x2b4a06['touches'][0x1],_0x2867ed=Math['max'](0.000001,getDistance(_0xd2e3b9,_0x33fb14)),_0x56b6e7=getAngle(_0xd2e3b9,_0x33fb14),_0x4bb4b9=getMidpoint(_0xd2e3b9,_0x33fb14),_0x34ae45=canvasWrapper['getBoundingClientRect'](),_0x1f6a38=_0x4bb4b9['x']-_0x34ae45['left'],_0x110280=_0x4bb4b9['y']-_0x34ae45['top'],_0x38fabc=pinchStart['scale0']*(_0x2867ed/pinchStart['dist']),_0x529406=Math['min'](Math['max'](_0x38fabc,zoomMin),zoomMax),_0x574d31=normAngle(_0x56b6e7-pinchStart['angle']),_0x55f1e2=pinchStart['rot0']+_0x574d31,_0x360c18=pinchStart['anchorCanvas'],_0x5d44e2=transformCanvasPoint(_0x360c18['x'],_0x360c18['y'],_0x529406,_0x55f1e2);panX=_0x1f6a38-_0x5d44e2['x'],panY=_0x110280-_0x5d44e2['y'],zoomScale=_0x529406,viewRotation=_0x55f1e2,updateCanvasTransform(),lastTouchDist=_0x2867ed,lastTouchAngle=_0x56b6e7;},{'passive':!0x1}),canvas['addEventListener']('touchstart',_0x1f969e=>{isTwoFingerGesture&&(_0x1f969e['preventDefault'](),_0x1f969e['stopPropagation']());},{'passive':!0x1});const gl=canvas['getContext']('webgl2',{'alpha':!0x0,'powerPreference':'high-performance'});let needsRedraw=!0x0;const imageLoader=document['getElementById']('imageLoader'),colorPicker=document['getElementById']('colorPicker'),brushes=[{'name':'Dot','file':'/static/draw/images/brushes/dot.webp','defaultSize':0.02,'selected':!0x1},{'name':'Fine\x20Liner','file':'/static/draw/images/brushes/fine-liner-2.webp','defaultSize':0.03,'selected':!0x1},{'name':'Brush\x2012','file':'/static/draw/images/brushes/12.webp','defaultSize':0.04,'selected':!0x1},{'name':'Brush\x2011','file':'/static/draw/images/brushes/11.webp','defaultSize':0.05,'selected':!0x0},{'name':'Brush\x200','file':'/static/draw/images/brushes/0.png','defaultSize':0.025,'selected':!0x1},{'name':'Brush\x205','file':'/static/draw/images/brushes/5.png','defaultSize':0.03,'selected':!0x1},{'name':'Brush\x201','file':'/static/draw/images/brushes/1.png','defaultSize':0.035,'selected':!0x1},{'name':'Brush\x202','file':'/static/draw/images/brushes/2.png','defaultSize':0.04,'selected':!0x1},{'name':'Brush\x203','file':'/static/draw/images/brushes/3.png','defaultSize':0.045,'selected':!0x1},{'name':'Brush\x204','file':'/static/draw/images/brushes/4.png','defaultSize':0.05,'selected':!0x1},{'name':'Brush\x207','file':'/static/draw/images/brushes/7.webp','defaultSize':0.06,'selected':!0x1},{'name':'Brush\x208','file':'/static/draw/images/brushes/8.webp','defaultSize':0.2,'selected':!0x1}];let paintFBO,paintTexture,quadProgram,paintProgram,overlayProgram,floodFillProgram,brushTextures={},brushAspects={},currentBrush=null,currentArtworkId=null,texture=null,overlayTexture=null,brushAspect=0x1,imageAspect=0x1,currentImage=null,overlayPosition=[0x0,0x0],isDrawing=!0x1,currentTool='draw',fixedFBOWidth=0x0,fixedFBOHeight=0x0,tintColor=[0x0,0x0,0x0,0x1];function hexToHSL(_0x54375e){0x3===(_0x54375e=_0x54375e['replace'](/^#/,''))['length']&&(_0x54375e=_0x54375e['split']('')['map'](_0x138b28=>_0x138b28+_0x138b28)['join'](''));let _0x27b3e3,_0x103217,_0x575f01=parseInt(_0x54375e['substr'](0x0,0x2),0x10)/0xff,_0x19e01b=parseInt(_0x54375e['substr'](0x2,0x2),0x10)/0xff,_0x4b9b07=parseInt(_0x54375e['substr'](0x4,0x2),0x10)/0xff,_0x2c6d6b=Math['max'](_0x575f01,_0x19e01b,_0x4b9b07),_0x187e9d=Math['min'](_0x575f01,_0x19e01b,_0x4b9b07),_0x30e59d=(_0x2c6d6b+_0x187e9d)/0x2;if(_0x2c6d6b===_0x187e9d)_0x27b3e3=_0x103217=0x0;else{let _0x1d29bc=_0x2c6d6b-_0x187e9d;switch(_0x103217=_0x30e59d>0.5?_0x1d29bc/(0x2-_0x2c6d6b-_0x187e9d):_0x1d29bc/(_0x2c6d6b+_0x187e9d),_0x2c6d6b){case _0x575f01:_0x27b3e3=(_0x19e01b-_0x4b9b07)/_0x1d29bc+(_0x19e01b<_0x4b9b07?0x6:0x0);break;case _0x19e01b:_0x27b3e3=(_0x4b9b07-_0x575f01)/_0x1d29bc+0x2;break;case _0x4b9b07:_0x27b3e3=(_0x575f01-_0x19e01b)/_0x1d29bc+0x4;}_0x27b3e3/=0x6;}return{'h':_0x27b3e3,'s':_0x103217,'l':_0x30e59d};}colorPicker['addEventListener']('input',_0x17b2fb=>{tintColor=hexToRGBA(_0x17b2fb['target']['value']);const _0x1d7956=hexToHSL(_0x17b2fb['target']['value']);baseColor=hexToRGBA(_0x17b2fb['target']['value'])['slice'](0x0,0x3),lightnessFactor=_0x1d7956['l'],updateLightnessGradient(),updateFinalColor();const _0x3410b9=colorPalette['querySelector']('.indicator');_0x3410b9&&(_0x3410b9['style']['top']=_0x1d7956['h']*(colorPalette['clientHeight']-_0x3410b9['clientHeight'])+'px');const _0x1d3f3f=lightnessPalette['querySelector']('.indicator');_0x1d3f3f&&(_0x1d3f3f['style']['top']=_0x1d7956['l']*(lightnessPalette['clientHeight']-_0x1d3f3f['clientHeight'])+'px');});const colorPalette=document['getElementById']('colorPalette'),lightnessPalette=document['getElementById']('lightnessPalette');let baseColor=[0x0,0x0,0x0],lightnessFactor=0.5;function updateLightnessGradient(){const _0x2b5817='linear-gradient(to\x20bottom,\x20rgb('+Math['round'](0xff*baseColor[0x0])+',\x20'+Math['round'](0xff*baseColor[0x1])+',\x20'+Math['round'](0xff*baseColor[0x2])+'),\x20white)';document['getElementById']('lightnessPalette')['style']['background']=_0x2b5817;}function pickBaseColor(_0x4c6e85){const _0x5d4b7f=colorPalette['getBoundingClientRect'](),_0x1b08e3=(_0x4c6e85['touches']?_0x4c6e85['touches'][0x0]['clientY']:_0x4c6e85['clientY'])-_0x5d4b7f['top'],_0x38714f=Math['max'](0x0,Math['min'](0x1,_0x1b08e3/_0x5d4b7f['height'])),_0x5459f=[[0xff,0x0,0x0],[0xff,0xff,0x0],[0x0,0xff,0x0],[0x0,0xff,0xff],[0x0,0x0,0xff],[0xff,0x0,0xff],[0xff,0x0,0x0]],_0x390071=Math['floor'](_0x38714f*(_0x5459f['length']-0x1)),_0x5b88da=Math['min'](_0x390071+0x1,_0x5459f['length']-0x1),_0x44e5fd=_0x38714f*(_0x5459f['length']-0x1)%0x1;baseColor=[(_0x5459f[_0x390071][0x0]*(0x1-_0x44e5fd)+_0x5459f[_0x5b88da][0x0]*_0x44e5fd)/0xff,(_0x5459f[_0x390071][0x1]*(0x1-_0x44e5fd)+_0x5459f[_0x5b88da][0x1]*_0x44e5fd)/0xff,(_0x5459f[_0x390071][0x2]*(0x1-_0x44e5fd)+_0x5459f[_0x5b88da][0x2]*_0x44e5fd)/0xff],updateLightnessGradient(),updateFinalColor();const _0x45e962=colorPalette['querySelector']('.indicator');_0x45e962&&(_0x45e962['style']['top']=_0x38714f*(colorPalette['clientHeight']-_0x45e962['clientHeight'])+'px');}function pickLightness(_0x59507a){const _0x938345=lightnessPalette['getBoundingClientRect'](),_0x2d27af=(_0x59507a['touches']?_0x59507a['touches'][0x0]['clientY']:_0x59507a['clientY'])-_0x938345['top'],_0x384c57=Math['max'](0x0,Math['min'](0x1,_0x2d27af/_0x938345['height']));lightnessFactor=_0x384c57,updateFinalColor();const _0x248552=lightnessPalette['querySelector']('.indicator');_0x248552&&(_0x248552['style']['top']=_0x384c57*(lightnessPalette['clientHeight']-_0x248552['clientHeight'])+'px');}function updateFinalColor(){const _0x351c50=Math['round'](baseColor[0x0]*(0x1-lightnessFactor)*0xff+0xff*lightnessFactor),_0x28f695=Math['round'](baseColor[0x1]*(0x1-lightnessFactor)*0xff+0xff*lightnessFactor),_0x3f9fa3=Math['round'](baseColor[0x2]*(0x1-lightnessFactor)*0xff+0xff*lightnessFactor);tintColor=[_0x351c50/0xff,_0x28f695/0xff,_0x3f9fa3/0xff,0x1];const _0x5258a2=rgbToHex(_0x351c50,_0x28f695,_0x3f9fa3);console['log']('hexColor',_0x5258a2),document['getElementById']('colorPicker')['value']=_0x5258a2,needsRedraw=!0x0;}function rgbToHex(_0x4ff35f,_0x4ac3a9,_0x8d344f){return'#'+(0x1<<0x18|_0x4ff35f<<0x10|_0x4ac3a9<<0x8|_0x8d344f)['toString'](0x10)['slice'](0x1)['toUpperCase']();}function replaceColorPicker(_0xcac675){const _0x3ee609=document['getElementById']('colorPicker'),_0x183e8b=document['createElement']('input');_0x183e8b['type']='color',_0x183e8b['id']='colorPicker',_0x183e8b['value']=_0xcac675,_0x183e8b['addEventListener']('input',_0x54925e=>{tintColor=hexToRGBA(_0x54925e['target']['value']),needsRedraw=!0x0;}),_0x3ee609['parentNode']['replaceChild'](_0x183e8b,_0x3ee609);}function hexToRGBA(_0x437ebc){'#'===_0x437ebc['charAt'](0x0)&&(_0x437ebc=_0x437ebc['substr'](0x1)),0x3===_0x437ebc['length']&&(_0x437ebc=_0x437ebc['split']('')['map'](_0x241f5c=>_0x241f5c+_0x241f5c)['join'](''));let _0x35bed3=parseInt(_0x437ebc,0x10);return[(_0x35bed3>>0x10&0xff)/0xff,(_0x35bed3>>0x8&0xff)/0xff,(0xff&_0x35bed3)/0xff,0x1];}function createShader(_0x2664c5,_0x544b31,_0x5769f3){const _0x1239dd=_0x2664c5['createShader'](_0x544b31);return _0x2664c5['shaderSource'](_0x1239dd,_0x5769f3),_0x2664c5['compileShader'](_0x1239dd),_0x2664c5['getShaderParameter'](_0x1239dd,_0x2664c5['COMPILE_STATUS'])?_0x1239dd:(console['error']('Shader\x20compile\x20error:',_0x2664c5['getShaderInfoLog'](_0x1239dd)),_0x2664c5['deleteShader'](_0x1239dd),null);}function createProgram(_0x47c4da,_0x55fdad,_0x3dfcc1){const _0x48189d=createShader(_0x47c4da,_0x47c4da['VERTEX_SHADER'],_0x55fdad),_0x8fd9c4=createShader(_0x47c4da,_0x47c4da['FRAGMENT_SHADER'],_0x3dfcc1);if(!_0x48189d||!_0x8fd9c4)return null;const _0x3bacaf=_0x47c4da['createProgram']();return _0x47c4da['attachShader'](_0x3bacaf,_0x48189d),_0x47c4da['attachShader'](_0x3bacaf,_0x8fd9c4),_0x47c4da['linkProgram'](_0x3bacaf),_0x47c4da['getProgramParameter'](_0x3bacaf,_0x47c4da['LINK_STATUS'])?_0x3bacaf:(console['error']('Program\x20link\x20error:',_0x47c4da['getProgramInfoLog'](_0x3bacaf)),null);}['mousedown','touchstart']['forEach'](_0x312958=>{colorPalette['addEventListener'](_0x312958,_0x533d61=>{pickBaseColor(_0x533d61),document['addEventListener']('mousemove',pickBaseColor),document['addEventListener']('touchmove',pickBaseColor);}),lightnessPalette['addEventListener'](_0x312958,_0x3dd8e0=>{pickLightness(_0x3dd8e0),document['addEventListener']('mousemove',pickLightness),document['addEventListener']('touchmove',pickLightness);});}),['mouseup','touchend']['forEach'](_0x3acb7d=>{document['addEventListener'](_0x3acb7d,()=>{document['removeEventListener']('mousemove',pickBaseColor),document['removeEventListener']('mousemove',pickLightness),document['removeEventListener']('touchmove',pickBaseColor),document['removeEventListener']('touchmove',pickLightness);});}),document['addEventListener']('touchmove',function(_0x3ff52f){_0x3ff52f['target']['closest']('#colorPalette,\x20#lightnessPalette')&&_0x3ff52f['preventDefault']();},{'passive':!0x1});const quadVS='\x0a\x20\x20attribute\x20vec2\x20a_position;\x0a\x20\x20attribute\x20vec2\x20a_texCoord;\x0a\x20\x20uniform\x20vec2\x20u_resolution;\x0a\x20\x20uniform\x20float\x20u_flipY;\x20//\x20set\x20to\x201.0\x20for\x20no\x20flip;\x20-1.0\x20for\x20normal\x20flip\x0a\x20\x20varying\x20vec2\x20v_texCoord;\x0a\x20\x20void\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20zeroToOne\x20=\x20a_position\x20/\x20u_resolution;\x0a\x20\x20\x20\x20vec2\x20clipSpace\x20=\x20zeroToOne\x20*\x202.0\x20-\x201.0;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(clipSpace.x,\x20clipSpace.y\x20*\x20u_flipY,\x200,\x201);\x0a\x20\x20\x20\x20v_texCoord\x20=\x20a_texCoord;\x0a\x20\x20}\x0a',quadFS='\x0a\x20\x20\x20\x20precision\x20mediump\x20float;\x0a\x20\x20\x20\x20varying\x20vec2\x20v_texCoord;\x0a\x20\x20\x20\x20uniform\x20sampler2D\x20u_texture;\x0a\x20\x20\x20\x20uniform\x20float\x20u_layerOpacity;\x20//\x20NEW\x0a\x0a\x20\x20\x20\x20void\x20main()\x20{\x0a\x20\x20\x20\x20\x20\x20vec4\x20c\x20=\x20texture2D(u_texture,\x20v_texCoord);\x0a\x20\x20\x20\x20\x20\x20c.a\x20*=\x20u_layerOpacity;\x20\x20\x20\x20\x20\x20//\x20apply\x20per-layer\x20opacity\x20here\x0a\x20\x20\x20\x20\x20\x20gl_FragColor\x20=\x20c;\x0a\x20\x20\x20\x20}\x0a',paintFS='\x0a\x20\x20precision\x20mediump\x20float;\x0a\x20\x20varying\x20vec2\x20v_texCoord;\x0a\x20\x20uniform\x20sampler2D\x20u_brush;\x0a\x20\x20uniform\x20vec4\x20u_tint;\x0a\x20\x20uniform\x20bool\x20u_erase;\x0a\x20\x20uniform\x20float\x20u_eraseStrength;\x20//\x20controls\x20erasing\x20strength\x0a\x20\x20uniform\x20float\x20u_paintStrength;\x20//\x20controls\x20painting\x20strength\x0a\x20\x20void\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20brushColor\x20=\x20texture2D(u_brush,\x20v_texCoord);\x0a\x20\x20\x20\x20if\x20(u_erase)\x20{\x0a\x20\x20\x20\x20\x20\x20gl_FragColor\x20=\x20vec4(0.0,\x200.0,\x200.0,\x20brushColor.a\x20*\x20u_eraseStrength\x20*\x200.05);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20//\x20Multiply\x20the\x20brush\x20alpha\x20by\x20u_paintStrength\x20so\x20that\x20lower\x20values\x20yield\x20lighter\x20strokes.\x0a\x20\x20\x20\x20\x20\x20gl_FragColor\x20=\x20vec4(u_tint.rgb,\x20brushColor.a\x20*\x20u_paintStrength);\x0a\x20\x20\x20\x20}\x0a\x20\x20}\x0a',overlayFS='\x0a\x20\x20precision\x20mediump\x20float;\x0a\x20\x20varying\x20vec2\x20v_texCoord;\x0a\x20\x20uniform\x20sampler2D\x20u_brush;\x0a\x20\x20uniform\x20vec4\x20u_tint;\x0a\x20\x20void\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20brushColor\x20=\x20texture2D(u_brush,\x20v_texCoord);\x0a\x20\x20\x20\x20gl_FragColor\x20=\x20vec4(u_tint.rgb,\x20brushColor.a);\x0a\x20\x20}\x0a';let ringProgram;const ringFS='\x0aprecision\x20mediump\x20float;\x0auniform\x20vec2\x20\x20u_center;\x20\x20\x20\x20\x20//\x20circle\x20center\x20in\x20screen\x20px\x20(top-left\x20origin)\x0auniform\x20float\x20u_radius;\x20\x20\x20\x20\x20//\x20ring\x20radius\x20in\x20px\x0auniform\x20float\x20u_thickness;\x20\x20//\x20ring\x20thickness\x20in\x20px\x0auniform\x20vec4\x20\x20u_color;\x20\x20\x20\x20\x20\x20//\x20RGBA\x0auniform\x20vec2\x20\x20u_viewport;\x20\x20\x20//\x20canvas\x20size\x20(w,h)\x0a\x0avoid\x20main()\x20{\x0a\x20\x20//\x20Convert\x20gl_FragCoord\x20(bottom-left\x20origin)\x20to\x20top-left\x0a\x20\x20vec2\x20p\x20=\x20vec2(gl_FragCoord.x,\x20u_viewport.y\x20-\x20gl_FragCoord.y);\x0a\x20\x20float\x20d\x20=\x20abs(length(p\x20-\x20u_center)\x20-\x20u_radius);\x0a\x20\x20//\x201px\x20anti-aliasing\x20band\x0a\x20\x20float\x20aa\x20=\x201.0;\x0a\x20\x20float\x20alpha\x20=\x20smoothstep(u_thickness\x20+\x20aa,\x20u_thickness\x20-\x20aa,\x20d);\x0a\x20\x20gl_FragColor\x20=\x20vec4(u_color.rgb,\x20u_color.a\x20*\x20alpha);\x0a}\x0a';let dashProgram;const dashFS='\x0aprecision\x20mediump\x20float;\x0a\x0auniform\x20vec2\x20\x20u_a;\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20start\x20of\x20line\x20in\x20screen\x20px\x20(top-left\x20origin)\x0auniform\x20vec2\x20\x20u_b;\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20end\x20of\x20line\x20in\x20screen\x20px\x0auniform\x20float\x20u_thickness;\x20\x20//\x20half-thickness\x20in\x20px\x0auniform\x20float\x20u_dash;\x20\x20\x20\x20\x20\x20\x20//\x20dash\x20length\x20in\x20px\x0auniform\x20float\x20u_gap;\x20\x20\x20\x20\x20\x20\x20\x20//\x20gap\x20length\x20in\x20px\x0auniform\x20vec4\x20\x20u_color;\x20\x20\x20\x20\x20\x20//\x20RGBA\x0auniform\x20vec2\x20\x20u_viewport;\x20\x20\x20//\x20canvas\x20size\x20(w,h)\x0a\x0avoid\x20main()\x20{\x0a\x20\x20//\x20convert\x20gl_FragCoord\x20(bottom-left\x20origin)\x20to\x20top-left\x20origin\x0a\x20\x20vec2\x20p\x20=\x20vec2(gl_FragCoord.x,\x20u_viewport.y\x20-\x20gl_FragCoord.y);\x0a\x20\x20vec2\x20a\x20=\x20u_a,\x20b\x20=\x20u_b;\x0a\x0a\x20\x20vec2\x20ab\x20=\x20b\x20-\x20a;\x0a\x20\x20float\x20len\x20=\x20max(1.0,\x20length(ab));\x0a\x20\x20vec2\x20ap\x20=\x20p\x20-\x20a;\x0a\x0a\x20\x20//\x20project\x20p\x20onto\x20segment\x20a-b\x0a\x20\x20float\x20t\x20=\x20clamp(dot(ap,\x20ab)\x20/\x20(len\x20*\x20len),\x200.0,\x201.0);\x0a\x20\x20float\x20dist\x20=\x20length(ap\x20-\x20ab\x20*\x20t);\x0a\x0a\x20\x20//\x20dashed\x20pattern\x20along\x20the\x20segment\x0a\x20\x20float\x20along\x20=\x20t\x20*\x20len;\x0a\x20\x20float\x20seg\x20\x20\x20=\x20max(1.0,\x20u_dash\x20+\x20u_gap);\x0a\x20\x20float\x20m\x20\x20\x20\x20\x20=\x20mod(along,\x20seg);\x0a\x20\x20float\x20inDash\x20=\x20step(m,\x20u_dash);\x20//\x201\x20inside\x20dash,\x200\x20inside\x20gap\x0a\x0a\x20\x20//\x20soft\x20edges\x20(1px\x20AA\x20band)\x0a\x20\x20float\x20aa\x20=\x201.0;\x0a\x20\x20float\x20alpha\x20=\x20inDash\x20*\x20smoothstep(u_thickness\x20+\x20aa,\x20u_thickness\x20-\x20aa,\x20dist);\x0a\x0a\x20\x20gl_FragColor\x20=\x20vec4(u_color.rgb,\x20u_color.a\x20*\x20alpha);\x0a}\x0a';function getActiveLayer(){return layers[activeLayerIndex];}function syncActiveAliases(){const _0x363ed4=getActiveLayer();if(!_0x363ed4)return paintFBO=null,void(paintTexture=null);paintFBO=_0x363ed4['fbo'],paintTexture=_0x363ed4['texture'];}function initGL(){gl?(quadProgram=createProgram(gl,quadVS,quadFS),paintProgram=createProgram(gl,quadVS,paintFS),overlayProgram=createProgram(gl,quadVS,overlayFS),ringProgram=createProgram(gl,quadVS,ringFS),dashProgram=createProgram(gl,quadVS,dashFS)):console['error']('WebGL\x20not\x20supported.');}let __quadVbo=null;function __bindAndDrawTexturedQuad(_0x265573,_0x1d1b62,_0x1e98ba){const _0x53defa=new Float32Array([0x0,0x0,0x0,0x0,_0x1d1b62,0x0,0x1,0x0,0x0,_0x1e98ba,0x0,0x1,0x0,_0x1e98ba,0x0,0x1,_0x1d1b62,0x0,0x1,0x0,_0x1d1b62,_0x1e98ba,0x1,0x1]);__quadVbo||(__quadVbo=gl['createBuffer']()),gl['bindBuffer'](gl['ARRAY_BUFFER'],__quadVbo),gl['bufferData'](gl['ARRAY_BUFFER'],_0x53defa,gl['STREAM_DRAW']);const _0x4b9d55=gl['getAttribLocation'](_0x265573,'a_position'),_0x5a097d=gl['getAttribLocation'](_0x265573,'a_texCoord');gl['enableVertexAttribArray'](_0x4b9d55),gl['vertexAttribPointer'](_0x4b9d55,0x2,gl['FLOAT'],!0x1,0x10,0x0),gl['enableVertexAttribArray'](_0x5a097d),gl['vertexAttribPointer'](_0x5a097d,0x2,gl['FLOAT'],!0x1,0x10,0x8),gl['drawArrays'](gl['TRIANGLES'],0x0,0x6),gl['disableVertexAttribArray'](_0x4b9d55),gl['disableVertexAttribArray'](_0x5a097d),gl['bindBuffer'](gl['ARRAY_BUFFER'],null);}function __getSelectedIndices(){if(void 0x0!==selectedLayerIndices&&selectedLayerIndices&&selectedLayerIndices['size'])return Array['from'](selectedLayerIndices)['sort']((_0x46e63b,_0xd26889)=>_0x46e63b-_0xd26889);try{const _0x5a9b8a=document['getElementById']('layersList');if(_0x5a9b8a){const _0x455e8e=[];if(_0x5a9b8a['querySelectorAll']('.layer-item')['forEach'](_0x426fd6=>{const _0xe6f891=_0x426fd6['getAttribute']('data-index'),_0x4123a3=_0x426fd6['querySelector']('.layer-select\x20input[type=\x27checkbox\x27]');_0x4123a3&&_0x4123a3['checked']&&null!=_0xe6f891&&_0x455e8e['push'](Number(_0xe6f891));}),_0x455e8e['length'])return _0x455e8e['sort']((_0x5baa1f,_0x1ea834)=>_0x5baa1f-_0x1ea834);}}catch{}return['number'==typeof activeLayerIndex?activeLayerIndex:0x0];}function __layerQuadInFboSpace(_0x2c4162,_0x30bc15,_0x412a30){const _0x3e287f=fixedFBOWidth,_0x7adf=fixedFBOHeight,_0x106c56=Number['isFinite'](_0x2c4162['ox'])?_0x2c4162['ox']:0x0,_0x1afbd5=Number['isFinite'](_0x2c4162['oy'])?_0x2c4162['oy']:0x0,_0x263bc9=Number['isFinite'](_0x2c4162['texW'])?_0x2c4162['texW']:_0x3e287f,_0x22a380=Number['isFinite'](_0x2c4162['texH'])?_0x2c4162['texH']:_0x7adf,_0x109cee=Number['isFinite'](_0x2c4162['px'])?_0x2c4162['px']:0.5*_0x3e287f,_0x2632f3=Number['isFinite'](_0x2c4162['py'])?_0x2c4162['py']:0.5*_0x7adf,_0x30ee95=Math['cos'](_0x2c4162['rotation']||0x0),_0xd8f616=Math['sin'](_0x2c4162['rotation']||0x0);function _0x31f5a2(_0x32a8f0,_0x4616af){let _0xb0c76f=_0x32a8f0-_0x109cee,_0x55dbe7=_0x4616af-_0x2632f3;_0xb0c76f*=Number['isFinite'](_0x2c4162['scaleX'])?_0x2c4162['scaleX']:0x1,_0x55dbe7*=Number['isFinite'](_0x2c4162['scaleY'])?_0x2c4162['scaleY']:0x1;const _0xdaecf1=_0xb0c76f*_0xd8f616+_0x55dbe7*_0x30ee95;return{'x':_0x109cee+(_0xb0c76f*_0x30ee95-_0x55dbe7*_0xd8f616)+(Number['isFinite'](_0x2c4162['x'])?_0x2c4162['x']:0x0),'y':_0x2632f3+_0xdaecf1+(Number['isFinite'](_0x2c4162['y'])?_0x2c4162['y']:0x0)};}const _0x5070f6=_0x31f5a2(_0x106c56,_0x1afbd5),_0x2427a5=_0x31f5a2(_0x106c56+_0x263bc9,_0x1afbd5),_0x593075=_0x31f5a2(_0x106c56,_0x1afbd5+_0x22a380),_0x2cd45e=_0x31f5a2(_0x106c56+_0x263bc9,_0x1afbd5+_0x22a380);return new Float32Array([_0x5070f6['x'],_0x5070f6['y'],0x0,0x0,_0x2427a5['x'],_0x2427a5['y'],0x1,0x0,_0x593075['x'],_0x593075['y'],0x0,0x1,_0x593075['x'],_0x593075['y'],0x0,0x1,_0x2427a5['x'],_0x2427a5['y'],0x1,0x0,_0x2cd45e['x'],_0x2cd45e['y'],0x1,0x1]);}function createLayerFBO(_0x5d14c7,_0x5c3dd1){const _0x306198=gl['createTexture']();gl['bindTexture'](gl['TEXTURE_2D'],_0x306198),gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],_0x5d14c7,_0x5c3dd1,0x0,gl['RGBA'],gl['UNSIGNED_BYTE'],null),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MIN_FILTER'],gl['LINEAR']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MAG_FILTER'],gl['LINEAR']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_S'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_T'],gl['CLAMP_TO_EDGE']);const _0x4d6add=gl['createFramebuffer']();return gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x4d6add),gl['framebufferTexture2D'](gl['FRAMEBUFFER'],gl['COLOR_ATTACHMENT0'],gl['TEXTURE_2D'],_0x306198,0x0),gl['clearColor'](0x0,0x0,0x0,0x0),gl['clear'](gl['COLOR_BUFFER_BIT']),gl['bindFramebuffer'](gl['FRAMEBUFFER'],null),{'texture':_0x306198,'fbo':_0x4d6add};}let layers=[],activeLayerIndex=0x0;function addLayer(_0x37835c='Layer\x20'+(layers['length']+0x1),_0x3f4620=activeLayerIndex){const _0x4a7a5a=fixedFBOWidth,_0x156135=fixedFBOHeight,{texture:_0x557e00,fbo:_0x5f430b}=createLayerFBO(_0x4a7a5a,_0x156135),_0x552ed9={'id':Date['now']()+Math['random'](),'name':_0x37835c,'fbo':_0x5f430b,'texture':_0x557e00,'visible':!0x0,'opacity':0x1,'x':0x0,'y':0x0,'scaleX':0x1,'scaleY':0x1,'rotation':0x0,'px':0.5*_0x4a7a5a,'py':0.5*_0x156135,'texW':_0x4a7a5a,'texH':_0x156135,'ox':0x0,'oy':0x0,'history':[],'redo':[]},_0x705720=Math['max'](0x0,Math['min'](_0x3f4620,layers['length']));layers['splice'](_0x705720,0x0,_0x552ed9),activeLayerIndex=_0x705720,syncActiveAliases(),'function'==typeof rebuildLayersUI&&rebuildLayersUI(),needsRedraw=!0x0;}function drawRingOverlay(_0xcc167f,_0x3c4d34,_0x47f956,_0x5b067a,_0x83908b=[0x1,0x0,0x0,0.95]){if(!ringProgram)return;gl['enable'](gl['BLEND']),gl['blendFunc'](gl['SRC_ALPHA'],gl['ONE_MINUS_SRC_ALPHA']),gl['useProgram'](ringProgram);const _0x3a0926=gl['getUniformLocation'](ringProgram,'u_flipY');_0x3a0926&&gl['uniform1f'](_0x3a0926,-0x1);const _0x55c210=gl['getUniformLocation'](ringProgram,'u_resolution');_0x55c210&&gl['uniform2f'](_0x55c210,canvas['width'],canvas['height']),gl['uniform2f'](gl['getUniformLocation'](ringProgram,'u_center'),_0xcc167f,_0x3c4d34),gl['uniform1f'](gl['getUniformLocation'](ringProgram,'u_radius'),Math['max'](0x0,_0x47f956)),gl['uniform1f'](gl['getUniformLocation'](ringProgram,'u_thickness'),Math['max'](0.5,_0x5b067a)),gl['uniform4fv'](gl['getUniformLocation'](ringProgram,'u_color'),_0x83908b),gl['uniform2f'](gl['getUniformLocation'](ringProgram,'u_viewport'),canvas['width'],canvas['height']);const _0x37301f=new Float32Array([0x0,0x0,0x0,0x0,canvas['width'],0x0,0x1,0x0,0x0,canvas['height'],0x0,0x1,0x0,canvas['height'],0x0,0x1,canvas['width'],0x0,0x1,0x0,canvas['width'],canvas['height'],0x1,0x1]),_0x5abd36=gl['createBuffer']();gl['bindBuffer'](gl['ARRAY_BUFFER'],_0x5abd36),gl['bufferData'](gl['ARRAY_BUFFER'],_0x37301f,gl['STREAM_DRAW']);const _0x4e1f51=gl['getAttribLocation'](ringProgram,'a_position'),_0xc7ae7b=gl['getAttribLocation'](ringProgram,'a_texCoord');gl['enableVertexAttribArray'](_0x4e1f51),gl['vertexAttribPointer'](_0x4e1f51,0x2,gl['FLOAT'],!0x1,0x10,0x0),gl['enableVertexAttribArray'](_0xc7ae7b),gl['vertexAttribPointer'](_0xc7ae7b,0x2,gl['FLOAT'],!0x1,0x10,0x8),gl['drawArrays'](gl['TRIANGLES'],0x0,0x6),gl['disableVertexAttribArray'](_0x4e1f51),gl['disableVertexAttribArray'](_0xc7ae7b),gl['bindBuffer'](gl['ARRAY_BUFFER'],null),gl['deleteBuffer'](_0x5abd36);}function drawDashedLine(_0x301207,_0x4fa213,_0x30b09f,_0x55aadf,_0x44663c=1.5,_0x55121e=0xa,_0x58fbf7=0x6,_0x301549=[0x1,0x0,0x0,0.95]){if(!dashProgram)return;gl['enable'](gl['BLEND']),gl['blendFunc'](gl['SRC_ALPHA'],gl['ONE_MINUS_SRC_ALPHA']),gl['useProgram'](dashProgram);const _0x403ec4=gl['getUniformLocation'](dashProgram,'u_flipY');_0x403ec4&&gl['uniform1f'](_0x403ec4,-0x1);const _0x4d0316=gl['getUniformLocation'](dashProgram,'u_resolution');_0x4d0316&&gl['uniform2f'](_0x4d0316,canvas['width'],canvas['height']),gl['uniform2f'](gl['getUniformLocation'](dashProgram,'u_a'),_0x301207,_0x4fa213),gl['uniform2f'](gl['getUniformLocation'](dashProgram,'u_b'),_0x30b09f,_0x55aadf),gl['uniform1f'](gl['getUniformLocation'](dashProgram,'u_thickness'),Math['max'](0.5,_0x44663c)),gl['uniform1f'](gl['getUniformLocation'](dashProgram,'u_dash'),Math['max'](0x1,_0x55121e)),gl['uniform1f'](gl['getUniformLocation'](dashProgram,'u_gap'),Math['max'](0.5,_0x58fbf7)),gl['uniform4fv'](gl['getUniformLocation'](dashProgram,'u_color'),_0x301549),gl['uniform2f'](gl['getUniformLocation'](dashProgram,'u_viewport'),canvas['width'],canvas['height']);const _0x7a3130=new Float32Array([0x0,0x0,0x0,0x0,canvas['width'],0x0,0x1,0x0,0x0,canvas['height'],0x0,0x1,0x0,canvas['height'],0x0,0x1,canvas['width'],0x0,0x1,0x0,canvas['width'],canvas['height'],0x1,0x1]),_0x5a9a98=gl['createBuffer']();gl['bindBuffer'](gl['ARRAY_BUFFER'],_0x5a9a98),gl['bufferData'](gl['ARRAY_BUFFER'],_0x7a3130,gl['STREAM_DRAW']);const _0x476539=gl['getAttribLocation'](dashProgram,'a_position'),_0x2f1937=gl['getAttribLocation'](dashProgram,'a_texCoord');gl['enableVertexAttribArray'](_0x476539),gl['vertexAttribPointer'](_0x476539,0x2,gl['FLOAT'],!0x1,0x10,0x0),gl['enableVertexAttribArray'](_0x2f1937),gl['vertexAttribPointer'](_0x2f1937,0x2,gl['FLOAT'],!0x1,0x10,0x8),gl['drawArrays'](gl['TRIANGLES'],0x0,0x6),gl['disableVertexAttribArray'](_0x476539),gl['disableVertexAttribArray'](_0x2f1937),gl['bindBuffer'](gl['ARRAY_BUFFER'],null),gl['deleteBuffer'](_0x5a9a98);}function drawLayerWithTransform(_0x34b64f,_0x3e3efa){const _0x2a5524=fixedFBOWidth,_0x2c7a4b=fixedFBOHeight,_0x3506f6=canvas['width']/_0x2a5524,_0x30959c=canvas['height']/_0x2c7a4b,_0x325e9b=Number['isFinite'](_0x3e3efa['ox'])?_0x3e3efa['ox']:0x0,_0xa78c7c=Number['isFinite'](_0x3e3efa['oy'])?_0x3e3efa['oy']:0x0,_0x19c588=Number['isFinite'](_0x3e3efa['texW'])?_0x3e3efa['texW']:_0x2a5524,_0x4857e2=Number['isFinite'](_0x3e3efa['texH'])?_0x3e3efa['texH']:_0x2c7a4b,_0x28c8d5=Number['isFinite'](_0x3e3efa['px'])?_0x3e3efa['px']:0.5*_0x2a5524,_0x4264f1=Number['isFinite'](_0x3e3efa['py'])?_0x3e3efa['py']:0.5*_0x2c7a4b,_0x39f229=[{'x':_0x325e9b,'y':_0xa78c7c},{'x':_0x325e9b+_0x19c588,'y':_0xa78c7c},{'x':_0x325e9b,'y':_0xa78c7c+_0x4857e2},{'x':_0x325e9b+_0x19c588,'y':_0xa78c7c+_0x4857e2}],_0x1ed1d8=Math['cos'](_0x3e3efa['rotation']||0x0),_0x322fee=Math['sin'](_0x3e3efa['rotation']||0x0);function _0x13049e(_0xcc64ad){let _0x2c0d00=_0xcc64ad['x']-_0x28c8d5,_0x2a7ed0=_0xcc64ad['y']-_0x4264f1;_0x2c0d00*=Number['isFinite'](_0x3e3efa['scaleX'])?_0x3e3efa['scaleX']:0x1,_0x2a7ed0*=Number['isFinite'](_0x3e3efa['scaleY'])?_0x3e3efa['scaleY']:0x1;const _0x4d7d1b=_0x2c0d00*_0x322fee+_0x2a7ed0*_0x1ed1d8,_0x32a1c2=_0x28c8d5+(_0x2c0d00*_0x1ed1d8-_0x2a7ed0*_0x322fee)+(Number['isFinite'](_0x3e3efa['x'])?_0x3e3efa['x']:0x0),_0x22c148=_0x4264f1+_0x4d7d1b+(Number['isFinite'](_0x3e3efa['y'])?_0x3e3efa['y']:0x0);return{'x':_0x32a1c2*_0x3506f6,'y':_0x22c148*_0x30959c};}const _0x5e1287=_0x13049e(_0x39f229[0x0]),_0x6c5024=_0x13049e(_0x39f229[0x1]),_0x2a59f4=_0x13049e(_0x39f229[0x2]),_0x5474ab=_0x13049e(_0x39f229[0x3]),_0x13cbfe=new Float32Array([_0x5e1287['x'],_0x5e1287['y'],0x0,0x0,_0x6c5024['x'],_0x6c5024['y'],0x1,0x0,_0x2a59f4['x'],_0x2a59f4['y'],0x0,0x1,_0x2a59f4['x'],_0x2a59f4['y'],0x0,0x1,_0x6c5024['x'],_0x6c5024['y'],0x1,0x0,_0x5474ab['x'],_0x5474ab['y'],0x1,0x1]);gl['useProgram'](_0x34b64f);const _0x4c3eba=gl['getUniformLocation'](_0x34b64f,'u_flipY');_0x4c3eba&&gl['uniform1f'](_0x4c3eba,-0x1);const _0x590fd6=gl['getUniformLocation'](_0x34b64f,'u_resolution');_0x590fd6&&gl['uniform2f'](_0x590fd6,canvas['width'],canvas['height']);const _0x3742a2=gl['getUniformLocation'](_0x34b64f,'u_layerOpacity');_0x3742a2&&gl['uniform1f'](_0x3742a2,Math['max'](0x0,Math['min'](0x1,_0x3e3efa['opacity']||0x1)));const _0x5598bd=gl['createBuffer']();gl['bindBuffer'](gl['ARRAY_BUFFER'],_0x5598bd),gl['bufferData'](gl['ARRAY_BUFFER'],_0x13cbfe,gl['STREAM_DRAW']);const _0x3bbb64=gl['getAttribLocation'](_0x34b64f,'a_position'),_0x5c4714=gl['getAttribLocation'](_0x34b64f,'a_texCoord');gl['enableVertexAttribArray'](_0x3bbb64),gl['vertexAttribPointer'](_0x3bbb64,0x2,gl['FLOAT'],!0x1,0x10,0x0),gl['enableVertexAttribArray'](_0x5c4714),gl['vertexAttribPointer'](_0x5c4714,0x2,gl['FLOAT'],!0x1,0x10,0x8),gl['activeTexture'](gl['TEXTURE0']),gl['bindTexture'](gl['TEXTURE_2D'],_0x3e3efa['texture']);const _0x7b0655=gl['getUniformLocation'](_0x34b64f,'u_texture');_0x7b0655&&gl['uniform1i'](_0x7b0655,0x0),gl['drawArrays'](gl['TRIANGLES'],0x0,0x6),gl['disableVertexAttribArray'](_0x3bbb64),gl['disableVertexAttribArray'](_0x5c4714),gl['bindBuffer'](gl['ARRAY_BUFFER'],null),gl['deleteBuffer'](_0x5598bd);}let transformTool={'mode':'idle','start':null,'ref':null,'shiftInvert':!0x1};function setLayerTransformLock(_0x559b56,_0x31f1bd){const _0x185c8c=layers[_0x559b56];if(!_0x185c8c)return;_0x185c8c['transformLocked']=!!_0x31f1bd;const _0x22b071=document['getElementById']('layersList');_0x22b071&&_0x22b071['querySelectorAll']('.layer-item')['forEach'](_0x17fdc3=>{const _0x525ba6=_0x17fdc3['getAttribute']('data-index');if((null!==_0x525ba6?Number(_0x525ba6):null)===_0x559b56){const _0x3b419e=_0x17fdc3['querySelector']('.transform-btn');_0x3b419e&&_0x3b419e['classList']['toggle']('is-active',_0x31f1bd);}});if(_0x31f1bd&&_0x559b56===activeLayerIndex)transformTool['mobileCombo']=!0x0,'idle'===transformTool['mode']&&startTransform('grab');else!_0x31f1bd&&(layers['some'](_0x4646cb=>!!_0x4646cb['transformLocked'])||(transformTool['mobileCombo']=!0x1,'idle'!==transformTool['mode']&&endTransform(!0x0)));needsRedraw=!0x0;}function clearTransformLockAll(){layers['forEach'](_0x2206ad=>{_0x2206ad&&(_0x2206ad['transformLocked']=!0x1);}),transformTool['mobileCombo']=!0x1;const _0x28951c=document['getElementById']('layersList');_0x28951c&&_0x28951c['querySelectorAll']('.transform-btn.is-active')['forEach'](_0x41223c=>_0x41223c['classList']['remove']('is-active')),'idle'!==transformTool['mode']&&endTransform(!0x0),needsRedraw=!0x0;}function worldToLayer(_0x4a449a,_0x130d69,_0xe2d3b4){const _0x3c4175=_0x130d69-_0x4a449a['x'],_0x38d757=_0xe2d3b4-_0x4a449a['y'],_0x40cf15=Math['cos'](_0x4a449a['rotation']),_0x142348=Math['sin'](_0x4a449a['rotation']);return{'lx':(_0x40cf15*_0x3c4175+_0x142348*_0x38d757)/(_0x4a449a['scaleX']||0x1),'ly':(-_0x142348*_0x3c4175+_0x40cf15*_0x38d757)/(_0x4a449a['scaleY']||0x1)};}function layerLocalToWorld(_0xb0f207,_0x49c81c,_0x592435){const _0x3b573e=_0x49c81c*(_0xb0f207['scaleX']||0x1),_0x431212=_0x592435*(_0xb0f207['scaleY']||0x1),_0x4051c4=Math['cos'](_0xb0f207['rotation']),_0x57bc5a=Math['sin'](_0xb0f207['rotation']),_0x114922=_0x4051c4*_0x3b573e-_0x57bc5a*_0x431212,_0x58b477=_0x57bc5a*_0x3b573e+_0x4051c4*_0x431212;return{'fx':_0xb0f207['x']+_0x114922,'fy':_0xb0f207['y']+_0x58b477};}function startTransform(_0x3c8526,_0x5de0d5=!0x1){const _0xfd39ff=getActiveLayer();if(!_0xfd39ff)return;_0xfd39ff['x']=Number['isFinite'](_0xfd39ff['x'])?_0xfd39ff['x']:0x0,_0xfd39ff['y']=Number['isFinite'](_0xfd39ff['y'])?_0xfd39ff['y']:0x0,_0xfd39ff['scaleX']=Number['isFinite'](_0xfd39ff['scaleX'])?_0xfd39ff['scaleX']:0x1,_0xfd39ff['scaleY']=Number['isFinite'](_0xfd39ff['scaleY'])?_0xfd39ff['scaleY']:0x1,_0xfd39ff['rotation']=Number['isFinite'](_0xfd39ff['rotation'])?_0xfd39ff['rotation']:0x0,_0xfd39ff['px']=Number['isFinite'](_0xfd39ff['px'])?_0xfd39ff['px']:0.5*fixedFBOWidth,_0xfd39ff['py']=Number['isFinite'](_0xfd39ff['py'])?_0xfd39ff['py']:0.5*fixedFBOHeight;const _0x3fcc60=lastPointer&&Number['isFinite'](lastPointer['cx'])?lastPointer['cx']:0.5*canvas['width'],_0x389165=lastPointer&&Number['isFinite'](lastPointer['cy'])?lastPointer['cy']:0.5*canvas['height'],_0x58ee87=canvasPxToFBO(_0x3fcc60,_0x389165);let _0x9fbf7c=_0xfd39ff['px'],_0xd3a5d0=_0xfd39ff['py'];if('scale'===_0x3c8526||'rotate'===_0x3c8526){const _0x209fde=0x0|fixedFBOWidth,_0x368bbf=0x0|fixedFBOHeight;_0x9fbf7c=Math['max'](0x0,Math['min'](_0x209fde,_0x58ee87['fx'])),_0xd3a5d0=Math['max'](0x0,Math['min'](_0x368bbf,_0x58ee87['fy']));const _0x1fb4f3=Math['cos'](_0xfd39ff['rotation']),_0x33f104=Math['sin'](_0xfd39ff['rotation']),_0x56c164=(_0xfd39ff['px']-_0x9fbf7c)*_0xfd39ff['scaleX'],_0x2a6c03=(_0xfd39ff['py']-_0xd3a5d0)*_0xfd39ff['scaleY'],_0x2bd652=_0x56c164*_0x1fb4f3-_0x2a6c03*_0x33f104,_0x27064f=_0x56c164*_0x33f104+_0x2a6c03*_0x1fb4f3;_0xfd39ff['x']+=_0x2bd652,_0xfd39ff['y']+=_0x27064f,_0xfd39ff['px']=_0x9fbf7c,_0xfd39ff['py']=_0xd3a5d0;}transformTool['pivotWorld']={'fx':_0x9fbf7c,'fy':_0xd3a5d0},transformTool['pivotCanvas']={'cx':_0x3fcc60,'cy':_0x389165},transformTool['mode']=_0x3c8526,transformTool['shiftInvert']=!!_0x5de0d5,transformTool['ref']={'x':_0xfd39ff['x'],'y':_0xfd39ff['y'],'scaleX':_0xfd39ff['scaleX'],'scaleY':_0xfd39ff['scaleY'],'rotation':_0xfd39ff['rotation'],'px':_0xfd39ff['px'],'py':_0xfd39ff['py']},transformTool['start']=null,isDrawing&&(isDrawing=!0x1,stopRender('draw')),startRender('transform'),needsRedraw=!0x0,requestDrawIfIdle();}function onTransformPointerMove(_0x3368ed){const _0x5a8ff0=getActiveLayer();if(!_0x5a8ff0||!transformTool||'idle'===transformTool['mode'])return;const _0x57b02f=transformTool['ref'];if(!_0x57b02f)return;const _0x65fa6e=(_0x3aa0f6,_0xbe4b03)=>canvasPxToFBO(_0x3aa0f6,_0xbe4b03),_0x2c3728=_0x3368ed['clientX'],_0x2ede25=_0x3368ed['clientY'];transformTool['start']||(transformTool['start']={'cx':_0x2c3728,'cy':_0x2ede25});const _0x50c35a=transformTool['pivotWorld']||{'fx':_0x57b02f['px'],'fy':_0x57b02f['py']},_0x4692dc=transformTool['mode'];function _0x156128(_0x4e986b,_0x4bc9d0){const _0x155178=_0x4e986b-_0x57b02f['x'],_0x308e6f=_0x4bc9d0-_0x57b02f['y'],_0x2cd5c8=Math['cos'](_0x57b02f['rotation']),_0x4d23ca=Math['sin'](_0x57b02f['rotation']),_0x198b89=-_0x155178*_0x4d23ca+_0x308e6f*_0x2cd5c8;return{'lx':(_0x155178*_0x2cd5c8+_0x308e6f*_0x4d23ca)/(_0x57b02f['scaleX']||0x1),'ly':_0x198b89/(_0x57b02f['scaleY']||0x1)};}function _0x5f1a8e(_0x29540e,_0x4cc5fb){const _0x1ef36c=_0x29540e*(_0x5a8ff0['scaleX']||0x1),_0x1376e0=_0x4cc5fb*(_0x5a8ff0['scaleY']||0x1),_0x47bfd1=Math['cos'](_0x5a8ff0['rotation']),_0x2e7b87=Math['sin'](_0x5a8ff0['rotation']);return{'fx':_0x5a8ff0['x']+(_0x1ef36c*_0x47bfd1-_0x1376e0*_0x2e7b87),'fy':_0x5a8ff0['y']+(_0x1ef36c*_0x2e7b87+_0x1376e0*_0x47bfd1)};}if('grab'===_0x4692dc){const _0x4423e1=transformTool['start'],_0x645387=_0x65fa6e(_0x4423e1['cx'],_0x4423e1['cy']),_0x28700e=_0x65fa6e(_0x2c3728,_0x2ede25);_0x5a8ff0['x']=_0x57b02f['x']+(_0x28700e['fx']-_0x645387['fx']),_0x5a8ff0['y']=_0x57b02f['y']+(_0x28700e['fy']-_0x645387['fy']);}else{if('scale'===_0x4692dc){const _0x515b80=transformTool['start'],_0x1dfa96=_0x65fa6e(_0x515b80['cx'],_0x515b80['cy']),_0x308d01=_0x65fa6e(_0x2c3728,_0x2ede25),_0x42937f=_0x1dfa96['fx']-_0x50c35a['fx'],_0xd731c2=_0x1dfa96['fy']-_0x50c35a['fy'],_0x3a7cfc=_0x308d01['fx']-_0x50c35a['fx'],_0x54ae5e=_0x308d01['fy']-_0x50c35a['fy'],_0x20e1bb=Math['hypot'](_0x42937f,_0xd731c2)||0x1;let _0x428090=(Math['hypot'](_0x3a7cfc,_0x54ae5e)||0x1)/_0x20e1bb;transformTool['shiftInvert']&&(_0x428090=0x1/_0x428090);const _0x401414=0.05,_0x2e1dc1=0x40,_0x3f598f=Math['max'](_0x401414,Math['min'](_0x2e1dc1,_0x57b02f['scaleX']*_0x428090)),_0x457cb3=Math['max'](_0x401414,Math['min'](_0x2e1dc1,_0x57b02f['scaleY']*_0x428090)),_0x253806=_0x156128(_0x50c35a['fx'],_0x50c35a['fy']);_0x5a8ff0['scaleX']=_0x3f598f,_0x5a8ff0['scaleY']=_0x457cb3,_0x5a8ff0['rotation']=_0x57b02f['rotation'];const _0x41e895=_0x5f1a8e(_0x253806['lx'],_0x253806['ly']);_0x5a8ff0['x']+=_0x50c35a['fx']-_0x41e895['fx'],_0x5a8ff0['y']+=_0x50c35a['fy']-_0x41e895['fy'];}else{if('rotate'===_0x4692dc){const _0x1a5b91=transformTool['start'],_0x185c1d=_0x65fa6e(_0x1a5b91['cx'],_0x1a5b91['cy']),_0x51eeb3=_0x65fa6e(_0x2c3728,_0x2ede25),_0xe94e55=Math['atan2'](_0x185c1d['fy']-_0x50c35a['fy'],_0x185c1d['fx']-_0x50c35a['fx']);let _0x1a3249=Math['atan2'](_0x51eeb3['fy']-_0x50c35a['fy'],_0x51eeb3['fx']-_0x50c35a['fx'])-_0xe94e55;_0x1a3249>Math['PI']&&(_0x1a3249-=0x2*Math['PI']),_0x1a3249<-Math['PI']&&(_0x1a3249+=0x2*Math['PI']),transformTool['shiftInvert']&&(_0x1a3249=-_0x1a3249);const _0x55b6ee=_0x156128(_0x50c35a['fx'],_0x50c35a['fy']);_0x5a8ff0['rotation']=_0x57b02f['rotation']+_0x1a3249,_0x5a8ff0['scaleX']=_0x57b02f['scaleX'],_0x5a8ff0['scaleY']=_0x57b02f['scaleY'];const _0x380dbd=_0x5f1a8e(_0x55b6ee['lx'],_0x55b6ee['ly']);_0x5a8ff0['x']+=_0x50c35a['fx']-_0x380dbd['fx'],_0x5a8ff0['y']+=_0x50c35a['fy']-_0x380dbd['fy'];}}}needsRedraw=!0x0,requestDrawIfIdle?.();}function startTransform(_0x4e968b,_0x11f2a6=!0x1){const _0x16575f=getActiveLayer();if(!_0x16575f)return;_0x16575f['x']=Number['isFinite'](_0x16575f['x'])?_0x16575f['x']:0x0,_0x16575f['y']=Number['isFinite'](_0x16575f['y'])?_0x16575f['y']:0x0,_0x16575f['scaleX']=Number['isFinite'](_0x16575f['scaleX'])?_0x16575f['scaleX']:0x1,_0x16575f['scaleY']=Number['isFinite'](_0x16575f['scaleY'])?_0x16575f['scaleY']:0x1,_0x16575f['rotation']=Number['isFinite'](_0x16575f['rotation'])?_0x16575f['rotation']:0x0,_0x16575f['px']=Number['isFinite'](_0x16575f['px'])?_0x16575f['px']:0.5*fixedFBOWidth,_0x16575f['py']=Number['isFinite'](_0x16575f['py'])?_0x16575f['py']:0.5*fixedFBOHeight;const _0x4c6c3e=lastPointer&&Number['isFinite'](lastPointer['cx'])?lastPointer['cx']:0.5*canvas['width'],_0x445b52=lastPointer&&Number['isFinite'](lastPointer['cy'])?lastPointer['cy']:0.5*canvas['height'],_0x135807=canvasPxToFBO(_0x4c6c3e,_0x445b52);let _0x3fe7d3=_0x16575f['px'],_0x362c09=_0x16575f['py'];if('scale'===_0x4e968b||'rotate'===_0x4e968b){const _0x5390a6=0x0|fixedFBOWidth,_0x37b001=0x0|fixedFBOHeight;_0x3fe7d3=Math['max'](0x0,Math['min'](_0x5390a6,_0x135807['fx'])),_0x362c09=Math['max'](0x0,Math['min'](_0x37b001,_0x135807['fy']));const _0xf13ed=Math['cos'](_0x16575f['rotation']),_0x63e632=Math['sin'](_0x16575f['rotation']),_0x29b723=(_0x16575f['px']-_0x3fe7d3)*_0x16575f['scaleX'],_0x3ee6fc=(_0x16575f['py']-_0x362c09)*_0x16575f['scaleY'],_0x572cb7=_0x29b723*_0xf13ed-_0x3ee6fc*_0x63e632,_0x21e6e2=_0x29b723*_0x63e632+_0x3ee6fc*_0xf13ed;_0x16575f['x']+=_0x572cb7,_0x16575f['y']+=_0x21e6e2,_0x16575f['px']=_0x3fe7d3,_0x16575f['py']=_0x362c09;}transformTool['pivotWorld']={'fx':_0x3fe7d3,'fy':_0x362c09},transformTool['pivotCanvas']={'cx':_0x4c6c3e,'cy':_0x445b52},transformTool['mode']=_0x4e968b,transformTool['shiftInvert']=!!_0x11f2a6,transformTool['ref']={'x':_0x16575f['x'],'y':_0x16575f['y'],'scaleX':_0x16575f['scaleX'],'scaleY':_0x16575f['scaleY'],'rotation':_0x16575f['rotation'],'px':_0x16575f['px'],'py':_0x16575f['py']},transformTool['start']=null,isDrawing&&(isDrawing=!0x1,stopRender('draw')),startRender('transform'),showStatusMessage('grab'===_0x4e968b?'Grab\x20(move)\x20layer':'scale'===_0x4e968b?_0x11f2a6?'Scale\x20(down)':'Scale\x20(up)':'rotate'===_0x4e968b?'Rotate\x20layer':''),needsRedraw=!0x0,requestDrawIfIdle();}function initPaintLayerFixed(){layers['forEach'](_0x399d9c=>{gl['deleteTexture'](_0x399d9c['texture']),gl['deleteFramebuffer'](_0x399d9c['fbo']);}),layers=[],activeLayerIndex=0x0,addLayer('Layer\x201',-0x1),syncActiveAliases();}function mergeSelectedLayers(){try{if(!gl||!quadProgram||!Array['isArray'](layers)||0x0===layers['length'])return void console['warn']('[mergeSelectedLayers]\x20GL\x20or\x20layers\x20not\x20ready');let _0x20fac1=[];if('function'==typeof selectedLayerIndices?.['forEach']&&selectedLayerIndices['forEach'](_0x3d1fa0=>{Number['isFinite'](_0x3d1fa0)&&_0x20fac1['push'](0x0|_0x3d1fa0);}),_0x20fac1=_0x20fac1['filter'](_0x4d8628=>_0x4d8628>=0x0&&_0x4d8628<layers['length']),_0x20fac1['length']<0x2)return showStatusMessage?.('Select\x20at\x20least\x20two\x20layers\x20to\x20merge','warning'),void console['warn']('[mergeSelectedLayers]\x20not\x20enough\x20selected\x20layers',_0x20fac1);_0x20fac1['sort']((_0x5951bc,_0xc8147a)=>_0x5951bc-_0xc8147a);const _0x25d2bc=0x0|fixedFBOWidth,_0x4694a3=0x0|fixedFBOHeight,_0x52111c=gl['getParameter'](gl['FRAMEBUFFER_BINDING']),_0x535d87=gl['getParameter'](gl['CURRENT_PROGRAM']),_0x1986b3=gl['getParameter'](gl['VIEWPORT']),_0x179364=gl['isEnabled'](gl['BLEND']),_0x55ff64=gl['createTexture']();gl['bindTexture'](gl['TEXTURE_2D'],_0x55ff64),gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],_0x25d2bc,_0x4694a3,0x0,gl['RGBA'],gl['UNSIGNED_BYTE'],null),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MIN_FILTER'],gl['NEAREST']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MAG_FILTER'],gl['NEAREST']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_S'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_T'],gl['CLAMP_TO_EDGE']);const _0x10a8e4=gl['createFramebuffer']();gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x10a8e4),gl['framebufferTexture2D'](gl['FRAMEBUFFER'],gl['COLOR_ATTACHMENT0'],gl['TEXTURE_2D'],_0x55ff64,0x0),gl['viewport'](0x0,0x0,_0x25d2bc,_0x4694a3),gl['disable'](gl['DEPTH_TEST']),gl['enable'](gl['BLEND']),gl['blendFuncSeparate'](gl['SRC_ALPHA'],gl['ONE_MINUS_SRC_ALPHA'],gl['ONE'],gl['ONE_MINUS_SRC_ALPHA']),gl['clearColor'](0x0,0x0,0x0,0x0),gl['clear'](gl['COLOR_BUFFER_BIT']),gl['useProgram'](quadProgram);const _0x1844ec=gl['getUniformLocation'](quadProgram,'u_texture'),_0x3e886b=gl['getUniformLocation'](quadProgram,'u_resolution'),_0x35d05d=gl['getUniformLocation'](quadProgram,'u_flipY'),_0x1f02e3=gl['getUniformLocation'](quadProgram,'u_layerOpacity');_0x3e886b&&gl['uniform2f'](_0x3e886b,_0x25d2bc,_0x4694a3),_0x35d05d&&gl['uniform1f'](_0x35d05d,0x1);const _0x23eadb=gl['createBuffer']();gl['bindBuffer'](gl['ARRAY_BUFFER'],_0x23eadb);const _0x1317f1=gl['getAttribLocation'](quadProgram,'a_position'),_0x1dbae8=gl['getAttribLocation'](quadProgram,'a_texCoord');gl['enableVertexAttribArray'](_0x1317f1),gl['enableVertexAttribArray'](_0x1dbae8);let _0x16ebf4=0x0;for(const _0x230582 of _0x20fac1){const _0x2b6419=layers[_0x230582];if(!_0x2b6419||!0x1===_0x2b6419['visible']||!_0x2b6419['texture'])continue;const _0x4e3b6b=Number['isFinite'](_0x2b6419['ox'])?_0x2b6419['ox']:0x0,_0x3eb154=Number['isFinite'](_0x2b6419['oy'])?_0x2b6419['oy']:0x0,_0x5e9846=Math['max'](0x1,Number['isFinite'](_0x2b6419['texW'])?_0x2b6419['texW']:_0x25d2bc),_0x40aae1=Math['max'](0x1,Number['isFinite'](_0x2b6419['texH'])?_0x2b6419['texH']:_0x4694a3),_0x31f59c=Number['isFinite'](_0x2b6419['scaleX'])?_0x2b6419['scaleX']:0x1,_0xb632ba=Number['isFinite'](_0x2b6419['scaleY'])?_0x2b6419['scaleY']:0x1,_0x10d1cf=Number['isFinite'](_0x2b6419['rotation'])?_0x2b6419['rotation']:0x0,_0x313591=Number['isFinite'](_0x2b6419['x'])?_0x2b6419['x']:0x0,_0x305be0=Number['isFinite'](_0x2b6419['y'])?_0x2b6419['y']:0x0,_0x5ca680=Number['isFinite'](_0x2b6419['px'])?_0x2b6419['px']:0.5*_0x25d2bc,_0x3b052a=Number['isFinite'](_0x2b6419['py'])?_0x2b6419['py']:0.5*_0x4694a3,_0x21600b=Math['cos'](_0x10d1cf),_0xaa91ae=Math['sin'](_0x10d1cf);function _0x58fc7e(_0x1a05f7,_0x56d748){let _0x127767=(_0x1a05f7-_0x5ca680)*_0x31f59c,_0x41f649=(_0x56d748-_0x3b052a)*_0xb632ba;return{'x':_0x5ca680+(_0x127767*_0x21600b-_0x41f649*_0xaa91ae)+_0x313591,'y':_0x3b052a+(_0x127767*_0xaa91ae+_0x41f649*_0x21600b)+_0x305be0};}const _0x251d13=_0x58fc7e(_0x4e3b6b,_0x3eb154),_0xb0d21e=_0x58fc7e(_0x4e3b6b+_0x5e9846,_0x3eb154),_0x4ddb4d=_0x58fc7e(_0x4e3b6b,_0x3eb154+_0x40aae1),_0x4b3131=_0x58fc7e(_0x4e3b6b+_0x5e9846,_0x3eb154+_0x40aae1),_0x39dfe2=new Float32Array([_0x251d13['x'],_0x251d13['y'],0x0,0x0,_0xb0d21e['x'],_0xb0d21e['y'],0x1,0x0,_0x4ddb4d['x'],_0x4ddb4d['y'],0x0,0x1,_0x4ddb4d['x'],_0x4ddb4d['y'],0x0,0x1,_0xb0d21e['x'],_0xb0d21e['y'],0x1,0x0,_0x4b3131['x'],_0x4b3131['y'],0x1,0x1]);gl['bufferData'](gl['ARRAY_BUFFER'],_0x39dfe2,gl['STREAM_DRAW']),gl['vertexAttribPointer'](_0x1317f1,0x2,gl['FLOAT'],!0x1,0x10,0x0),gl['vertexAttribPointer'](_0x1dbae8,0x2,gl['FLOAT'],!0x1,0x10,0x8),_0x1f02e3&&gl['uniform1f'](_0x1f02e3,Math['max'](0x0,Math['min'](0x1,_0x2b6419['opacity']??0x1))),gl['activeTexture'](gl['TEXTURE0']),gl['bindTexture'](gl['TEXTURE_2D'],_0x2b6419['texture']),_0x1844ec&&gl['uniform1i'](_0x1844ec,0x0),gl['drawArrays'](gl['TRIANGLES'],0x0,0x6),_0x16ebf4++;}const _0x6bc3ee=new Uint8Array(_0x25d2bc*_0x4694a3*0x4);gl['readPixels'](0x0,0x0,_0x25d2bc,_0x4694a3,gl['RGBA'],gl['UNSIGNED_BYTE'],_0x6bc3ee),gl['disableVertexAttribArray'](_0x1317f1),gl['disableVertexAttribArray'](_0x1dbae8),gl['bindBuffer'](gl['ARRAY_BUFFER'],null),gl['deleteBuffer'](_0x23eadb),_0x179364||gl['disable'](gl['BLEND']),gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x52111c),gl['useProgram'](_0x535d87),_0x1986b3&&gl['viewport'](_0x1986b3[0x0],_0x1986b3[0x1],_0x1986b3[0x2],_0x1986b3[0x3]);const _0x12f3e0=_0x20fac1['map'](_0x1bded1=>({'index':_0x1bded1,'data':{'name':layers[_0x1bded1]['name'],'visible':!0x1!==layers[_0x1bded1]['visible'],'opacity':'number'==typeof layers[_0x1bded1]['opacity']?layers[_0x1bded1]['opacity']:0x1,'snapshot':snapshotLayer(_0x1bded1)}}));for(let _0x561b05=_0x20fac1['length']-0x1;_0x561b05>=0x0;_0x561b05--){const _0x1f7608=_0x20fac1[_0x561b05],_0x146fce=layers[_0x1f7608];if(_0x146fce){try{_0x146fce['texture']&&gl['deleteTexture'](_0x146fce['texture']);}catch{}try{_0x146fce['fbo']&&gl['deleteFramebuffer'](_0x146fce['fbo']);}catch{}layers['splice'](_0x1f7608,0x1);}}const _0x520c87=Math['min'](_0x20fac1[_0x20fac1['length']-0x1]-(_0x20fac1['length']-0x1),layers['length']),_0x2b04c6={'name':'Merged\x20('+_0x20fac1['length']+')','visible':!0x0,'opacity':0x1,'snapshot':{'index':_0x520c87,'w':_0x25d2bc,'h':_0x4694a3,'pixels':_0x6bc3ee}};History['_insertLayer'](_0x520c87,_0x2b04c6),activeLayerIndex=_0x520c87,'function'==typeof selectedLayerIndices?.['clear']&&(selectedLayerIndices['clear'](),selectedLayerIndices['add'](_0x520c87)),syncActiveAliases?.(),rebuildLayersUI?.(),needsRedraw=!0x0,requestDrawIfIdle?.();const _0x38dbdd={'index':_0x520c87,'data':{'name':_0x2b04c6['name'],'visible':!0x0,'opacity':0x1,'snapshot':snapshotLayer(_0x520c87)}};History['push']({'type':'merge_layers','removed':_0x12f3e0,'added':_0x38dbdd}),showStatusMessage?.('Merged\x20'+_0x16ebf4+'/'+_0x20fac1['length']+'\x20selected\x20layer(s)\x20→\x20index\x20'+_0x520c87,'success'),console['log']('[mergeSelectedLayers]\x20done',{'selected':_0x20fac1,'drawnCount':_0x16ebf4,'insertIndex':_0x520c87,'doc':{'Wdoc':_0x25d2bc,'Hdoc':_0x4694a3}});}catch(_0x456163){console['error']('[mergeSelectedLayers]\x20failed',_0x456163),showStatusMessage?.('Merge\x20failed\x20–\x20see\x20console\x20for\x20details','error'),needsRedraw=!0x0,requestDrawIfIdle?.();}}let TRANSFORM_DEBUG=!0x0;function docToCanvasScale(){return{'sx':canvas['width']/fixedFBOWidth,'sy':canvas['height']/fixedFBOHeight};}function docToCanvasPt(_0x2aa6d1){const {sx:_0x557a84,sy:_0x27b535}=docToCanvasScale();return{'x':_0x2aa6d1['x']*_0x557a84,'y':_0x2aa6d1['y']*_0x27b535};}function layerLocalToDoc(_0x26cb36,_0xc0eb47,_0x364467){const _0x18e9b7=Number['isFinite'](_0x26cb36['scaleX'])?_0x26cb36['scaleX']:0x1,_0x47fa15=Number['isFinite'](_0x26cb36['scaleY'])?_0x26cb36['scaleY']:0x1,_0xa9f078=Number['isFinite'](_0x26cb36['rotation'])?_0x26cb36['rotation']:0x0,_0x1f953d=Math['cos'](_0xa9f078),_0x50ec6c=Math['sin'](_0xa9f078),_0x35a91c=_0xc0eb47*_0x18e9b7,_0x2dc073=_0x364467*_0x47fa15;return{'x':_0x26cb36['x']+(_0x35a91c*_0x1f953d-_0x2dc073*_0x50ec6c),'y':_0x26cb36['y']+(_0x35a91c*_0x50ec6c+_0x2dc073*_0x1f953d)};}function docToLayerLocal(_0x1a02cf,_0x59111e,_0x12920f){const _0x4ca3c7=_0x59111e-_0x1a02cf['x'],_0x54d3fc=_0x12920f-_0x1a02cf['y'],_0x23f083=Number['isFinite'](_0x1a02cf['rotation'])?_0x1a02cf['rotation']:0x0,_0x3568ff=Math['cos'](_0x23f083),_0x6c63b9=Math['sin'](_0x23f083),_0x257034=-_0x4ca3c7*_0x6c63b9+_0x54d3fc*_0x3568ff;return{'px':(_0x4ca3c7*_0x3568ff+_0x54d3fc*_0x6c63b9)/(Number['isFinite'](_0x1a02cf['scaleX'])?_0x1a02cf['scaleX']:0x1),'py':_0x257034/(Number['isFinite'](_0x1a02cf['scaleY'])?_0x1a02cf['scaleY']:0x1)};}function drawCrosshair(_0x565266,_0x56727b,_0x41ea3c,_0x1f39ae,_0x32cb3d){drawDashedLine(_0x565266-_0x41ea3c,_0x56727b,_0x565266+_0x41ea3c,_0x56727b,_0x1f39ae,0xf4240,0x0,_0x32cb3d),drawDashedLine(_0x565266,_0x56727b-_0x41ea3c,_0x565266,_0x56727b+_0x41ea3c,_0x1f39ae,0xf4240,0x0,_0x32cb3d);}function drawAxisFromPivot(_0x119cbe,_0x581ead,_0x1ed662){const _0x5b853f=Number['isFinite'](_0x119cbe['scaleX'])?_0x119cbe['scaleX']:0x1,_0x4fc69a=Number['isFinite'](_0x119cbe['scaleY'])?_0x119cbe['scaleY']:0x1,_0x3145c3=Number['isFinite'](_0x119cbe['rotation'])?_0x119cbe['rotation']:0x0,_0x4d901f=Math['cos'](_0x3145c3),_0x5e164c=Math['sin'](_0x3145c3),_0x5a4212=_0x4d901f*_0x5b853f,_0x7af7b6=_0x5e164c*_0x5b853f,_0x1cf33c=-_0x5e164c*_0x4fc69a,_0x2ed828=_0x4d901f*_0x4fc69a,{sx:_0x5bb4aa,sy:_0x33856f}=docToCanvasScale(),_0x5273fe=_0x3e8d5f=>docToCanvasPt({'x':_0x3e8d5f['x'],'y':_0x3e8d5f['y']}),_0x54b12b={'x':_0x581ead['x']+_0x5a4212*(_0x1ed662/Math['max'](_0x5bb4aa,0.000001)),'y':_0x581ead['y']+_0x7af7b6*(_0x1ed662/Math['max'](_0x33856f,0.000001))},_0x571826={'x':_0x581ead['x']+_0x1cf33c*(_0x1ed662/Math['max'](_0x5bb4aa,0.000001)),'y':_0x581ead['y']+_0x2ed828*(_0x1ed662/Math['max'](_0x33856f,0.000001))},_0xdf1712=_0x5273fe(_0x581ead),_0xdc4c81=_0x5273fe(_0x54b12b),_0x3889b0=_0x5273fe(_0x571826);drawDashedLine(_0xdf1712['x'],_0xdf1712['y'],_0xdc4c81['x'],_0xdc4c81['y'],0x2,0xa,0x0,[0x1,0x0,0x1,0.9]),drawDashedLine(_0xdf1712['x'],_0xdf1712['y'],_0x3889b0['x'],_0x3889b0['y'],0x2,0xa,0x0,[0x0,0.4,0x1,0.9]);}function drawTransformDebugForActiveLayer(){if(!window['TRANSFORM_DEBUG'])return;const _0x289fdf=getActiveLayer&&getActiveLayer();if(!_0x289fdf||!_0x289fdf['visible'])return;if(!overlayProgram||'function'!=typeof drawRingOverlay||'function'!=typeof drawDashedLine)return;gl['useProgram'](overlayProgram);const _0x2dd282=gl['getUniformLocation'](overlayProgram,'u_flipY');_0x2dd282&&gl['uniform1f'](_0x2dd282,-0x1);const _0x2e18f6=gl['getUniformLocation'](overlayProgram,'u_resolution');_0x2e18f6&&gl['uniform2f'](_0x2e18f6,canvas['width'],canvas['height']);const _0x3b6394=({x:_0x409483,y:_0x136318})=>({'x':_0x409483*(canvas['width']/fixedFBOWidth),'y':_0x136318*(canvas['height']/fixedFBOHeight)}),_0x2f8d71=(_0x347534,_0x2dc309)=>{const _0xe27bcc=Number['isFinite'](_0x289fdf['scaleX'])?_0x289fdf['scaleX']:0x1,_0x69f34c=Number['isFinite'](_0x289fdf['scaleY'])?_0x289fdf['scaleY']:0x1,_0x31300b=Number['isFinite'](_0x289fdf['rotation'])?_0x289fdf['rotation']:0x0,_0x2f7343=Math['cos'](_0x31300b),_0xf5f92d=Math['sin'](_0x31300b),_0x170ea4=_0x347534*_0xe27bcc,_0x257695=_0x2dc309*_0x69f34c;return{'x':_0x289fdf['x']+(_0x170ea4*_0x2f7343-_0x257695*_0xf5f92d),'y':_0x289fdf['y']+(_0x170ea4*_0xf5f92d+_0x257695*_0x2f7343)};},_0x3ec703=transformTool&&transformTool['pivotDoc']?{'x':transformTool['pivotDoc']['fx'],'y':transformTool['pivotDoc']['fy']}:{'x':_0x289fdf['x'],'y':_0x289fdf['y']};let _0x27c4c0=transformTool&&transformTool['localPivot']?{'px':transformTool['localPivot']['px'],'py':transformTool['localPivot']['py']}:(function(){const _0x563b56=_0x3ec703['x']-_0x289fdf['x'],_0x3de97d=_0x3ec703['y']-_0x289fdf['y'],_0x2b16f5=Math['cos'](_0x289fdf['rotation']),_0x47773b=Math['sin'](_0x289fdf['rotation']),_0x131f75=-_0x563b56*_0x47773b+_0x3de97d*_0x2b16f5;return{'px':(_0x563b56*_0x2b16f5+_0x3de97d*_0x47773b)/(_0x289fdf['scaleX']||0x1),'py':_0x131f75/(_0x289fdf['scaleY']||0x1)};}());const _0x45c0a5=_0x2f8d71(_0x27c4c0['px'],_0x27c4c0['py']),_0x512bd5={'x':_0x289fdf['x'],'y':_0x289fdf['y']},_0xb6547={'x':(Number['isFinite'](_0x289fdf['ox'])?_0x289fdf['ox']:0x0)+0.5*(Number['isFinite'](_0x289fdf['texW'])?_0x289fdf['texW']:fixedFBOWidth),'y':(Number['isFinite'](_0x289fdf['oy'])?_0x289fdf['oy']:0x0)+0.5*(Number['isFinite'](_0x289fdf['texH'])?_0x289fdf['texH']:fixedFBOHeight)},_0x55cb47=_0x2f8d71(_0xb6547['x'],_0xb6547['y']),_0xda3d19=_0x3b6394(_0x3ec703),_0x4753ce=_0x3b6394(_0x45c0a5),_0x182031=_0x3b6394(_0x55cb47),_0x452482=_0x3b6394(_0x512bd5);drawRingOverlay(_0xda3d19['x'],_0xda3d19['y'],0xc,0x2,[0x1,0x0,0x0,0.95]),drawRingOverlay(_0x4753ce['x'],_0x4753ce['y'],0x8,0x2,[0x1,0.5,0x0,0.95]),drawDashedLine(_0xda3d19['x'],_0xda3d19['y'],_0x4753ce['x'],_0x4753ce['y'],0x2,0x8,0x6,[0x1,0x1,0x0,0.9]),drawDashedLine(_0xda3d19['x'],_0xda3d19['y'],_0x182031['x'],_0x182031['y'],0x2,0x8,0x6,[0x1,0x0,0x0,0.8]),drawDashedLine(_0x452482['x'],_0x452482['y'],_0x182031['x'],_0x182031['y'],1.5,0x6,0x4,[0x0,0x1,0x1,0.75]),function(_0x534841=0x50){const _0x15be9d=Number['isFinite'](_0x289fdf['scaleX'])?_0x289fdf['scaleX']:0x1,_0x70db4e=Number['isFinite'](_0x289fdf['scaleY'])?_0x289fdf['scaleY']:0x1,_0x2401e9=Number['isFinite'](_0x289fdf['rotation'])?_0x289fdf['rotation']:0x0,_0x4d9a5b=Math['cos'](_0x2401e9),_0x218633=Math['sin'](_0x2401e9),_0x3f302e=_0x4d9a5b*_0x15be9d,_0x24ec22=_0x218633*_0x15be9d,_0x57f5c5=-_0x218633*_0x70db4e,_0x293eb2=_0x4d9a5b*_0x70db4e,_0x314ac0=canvas['width']/fixedFBOWidth,_0x5dbc1f=canvas['height']/fixedFBOHeight,_0x238bfa=_0x3b6394({'x':_0x3ec703['x']+_0x3f302e*(_0x534841/Math['max'](_0x314ac0,0.000001)),'y':_0x3ec703['y']+_0x24ec22*(_0x534841/Math['max'](_0x5dbc1f,0.000001))}),_0x261c2a=_0x3b6394({'x':_0x3ec703['x']+_0x57f5c5*(_0x534841/Math['max'](_0x314ac0,0.000001)),'y':_0x3ec703['y']+_0x293eb2*(_0x534841/Math['max'](_0x5dbc1f,0.000001))});drawDashedLine(_0xda3d19['x'],_0xda3d19['y'],_0x238bfa['x'],_0x238bfa['y'],0x2,0xa,0x0,[0x1,0x0,0x1,0.9]),drawDashedLine(_0xda3d19['x'],_0xda3d19['y'],_0x261c2a['x'],_0x261c2a['y'],0x2,0xa,0x0,[0x0,0.4,0x1,0.9]);}(),console['log']('[pivot-debug]',{'pose':{'x':_0x289fdf['x'],'y':_0x289fdf['y'],'sx':_0x289fdf['scaleX'],'sy':_0x289fdf['scaleY'],'rot':_0x289fdf['rotation']},'pivotDoc':_0x3ec703,'localPivot':_0x27c4c0,'localPivotWorld':_0x45c0a5,'originWorld':_0x512bd5,'centerWorld':_0x55cb47});}function mergeAllLayers(){!gl||!layers||layers['length']<0x2||(selectedLayerIndices=new Set(layers['map']((_0x5e1b90,_0x1a3eec)=>_0x1a3eec)),mergeSelectedLayers());}const BackgroundPicker=((()=>{let _0x1b1885=['/static/draw/images/backgrounds/WEBP_1920/46.webp','/static/draw/images/backgrounds/WEBP_1920/45.webp','/static/draw/images/backgrounds/WEBP_1920/44.webp','/static/draw/images/backgrounds/WEBP_1920/43.webp','/static/draw/images/backgrounds/WEBP_1920/42.webp','/static/draw/images/backgrounds/WEBP_1920/41.webp','/static/draw/images/backgrounds/WEBP_1920/40.webp'],_0x20eddb={},_0x42e526=null,_0x473e6a='curated';function _0x258ae3(_0x4f7731){return document['getElementById'](_0x4f7731);}function _0x382ea7(_0xe1b5bf,_0x3a66b1){const _0x38b7=document['createElement'](_0xe1b5bf);return _0x3a66b1&&(_0x38b7['className']=_0x3a66b1),_0x38b7;}function _0x7a7a32(_0x40ac72,_0x35d6db){const _0x49a6ac=document['createElement']('canvas');return _0x49a6ac['width']=_0x40ac72,_0x49a6ac['height']=_0x35d6db,_0x49a6ac;}function _0x2445e1(_0xc13d69){return new Promise((_0x4ef75d,_0x69ee1f)=>{const _0x4cc045=new Image();_0x4cc045['crossOrigin']='anonymous',_0x4cc045['onload']=()=>_0x4ef75d(_0x4cc045),_0x4cc045['onerror']=_0x69ee1f,_0x4cc045['src']=_0xc13d69;});}function _0x573691(_0xa2f35b,_0x411199,_0x38669d){const _0x30c8cd=_0x7a7a32(_0x411199,_0x38669d),_0x122f05=_0x30c8cd['getContext']('2d'),_0x5ae98c=(_0xa2f35b['naturalWidth']||_0xa2f35b['width'])/(_0xa2f35b['naturalHeight']||_0xa2f35b['height']);let _0x10fac4,_0xac3a4c,_0x31d9f6,_0x245de2;return _0x5ae98c>_0x411199/_0x38669d?(_0xac3a4c=_0x38669d,_0x10fac4=Math['ceil'](_0x38669d*_0x5ae98c),_0x31d9f6=Math['floor']((_0x411199-_0x10fac4)/0x2),_0x245de2=0x0):(_0x10fac4=_0x411199,_0xac3a4c=Math['ceil'](_0x411199/_0x5ae98c),_0x31d9f6=0x0,_0x245de2=Math['floor']((_0x38669d-_0xac3a4c)/0x2)),_0x122f05['drawImage'](_0xa2f35b,_0x31d9f6,_0x245de2,_0x10fac4,_0xac3a4c),_0x30c8cd;}function _0x458845(_0x172eae){_0x20eddb['curatedGrid']['querySelectorAll']('.bgp-thumb.selected')['forEach'](_0x4178d9=>_0x4178d9['classList']['remove']('selected')),_0x172eae&&_0x172eae['classList']['add']('selected');}function _0x561bf9(_0x71d788){_0x473e6a=_0x71d788,document['querySelectorAll']('.bgp-tab')['forEach'](_0xae684a=>_0xae684a['classList']['toggle']('active',_0xae684a['dataset']['tab']===_0x71d788)),_0x258ae3('bgPickerModal')['querySelectorAll']('.bgp-pane')['forEach'](_0x560d73=>{const _0x37ee1b=_0x560d73['classList']['contains']('bgp-pane-curated')?'curated':_0x560d73['classList']['contains']('bgp-pane-upload')?'upload':'solid';_0x560d73['classList']['toggle']('active',_0x37ee1b===_0x71d788);});}function _0x18a2c5(){_0x20eddb['colorHex']['value']=_0x20eddb['color']['value']['toUpperCase']();const _0x1f3ef4=fixedFBOWidth||canvas['width'],_0x2c8016=fixedFBOHeight||canvas['height'],_0x1226d7=function(_0x39bef6,_0xa2cf8,_0x3d4b93){const _0x350d1b=_0x7a7a32(_0xa2cf8,_0x3d4b93),_0x41fb0f=_0x350d1b['getContext']('2d');return _0x41fb0f['fillStyle']=_0x39bef6,_0x41fb0f['fillRect'](0x0,0x0,_0xa2cf8,_0x3d4b93),_0x350d1b;}(_0x20eddb['color']['value'],_0x1f3ef4,_0x2c8016),_0x282596=_0x258ae3('bgpSolidPreview')['getContext']('2d');_0x282596['clearRect'](0x0,0x0,_0x258ae3('bgpSolidPreview')['width'],_0x258ae3('bgpSolidPreview')['height']),_0x282596['drawImage'](_0x573691(_0x1226d7,_0x258ae3('bgpSolidPreview')['width'],_0x258ae3('bgpSolidPreview')['height']),0x0,0x0),_0x42e526=_0x1226d7;}function _0x323b9(){_0x42e526=null,_0x458845(null),_0x20eddb['fileName']['textContent']='No\x20file\x20chosen',_0x20eddb['file']['value']='',_0x561bf9('curated'),_0x18a2c5(),_0x258ae3('bgPickerModal')['style']['display']='flex';}function _0x35fff1(){_0x258ae3('bgPickerModal')['style']['display']='none';}function _0x37073f(){if(!_0x42e526)return void _0x35fff1();const _0x30c680=new Image();_0x30c680['onload']=()=>{currentImage=_0x30c680,fixedFBOWidth=_0x30c680['width'],fixedFBOHeight=_0x30c680['height'],initPaintLayerFixed(),updateCanvasSize(_0x30c680),initFloodFBOs(),createTextureFromImage(_0x30c680),canvas['offsetWidth'],canvasWrapper['offsetWidth'],zoomScale=0x1,panX=(canvasWrapper['clientWidth']-canvas['width'])/0x2,panY=(canvasWrapper['clientHeight']-canvas['height'])/0x2,updateCanvasTransform(),needsRedraw=!0x0,initFloodFillProgram(),addSoundEvents(),_0x35fff1();},_0x30c680['src']=_0x42e526['toDataURL']('image/png');}function _0x44efcf(_0x4cc0e8){const _0x30f36a=_0x4cc0e8['target']['files']&&_0x4cc0e8['target']['files'][0x0];if(!_0x30f36a)return;_0x20eddb['fileName']['textContent']=_0x30f36a['name'];const _0x41391b=new FileReader();_0x41391b['onload']=async()=>{const _0x3114d2=_0x41391b['result'],_0x2bf1b1=await _0x2445e1(_0x3114d2),_0x3bd9d0=fixedFBOWidth||canvas['width'],_0x1e4b5b=fixedFBOHeight||canvas['height'];_0x42e526=_0x573691(_0x2bf1b1,_0x3bd9d0,_0x1e4b5b);const _0x42533e=_0x258ae3('bgpUploadPreview'),_0x53e066=_0x42533e['getContext']('2d');_0x53e066['clearRect'](0x0,0x0,_0x42533e['width'],_0x42533e['height']),_0x53e066['drawImage'](_0x573691(_0x2bf1b1,_0x42533e['width'],_0x42533e['height']),0x0,0x0);},_0x41391b['readAsDataURL'](_0x30f36a);}function _0x1036e0(){_0x20eddb['gridBtn']=_0x258ae3('bgpCuratedGrid'),_0x20eddb['modal']=_0x258ae3('bgPickerModal'),_0x20eddb['curatedGrid']=_0x258ae3('bgpCuratedGrid'),_0x20eddb['file']=_0x258ae3('bgpFile'),_0x20eddb['fileName']=_0x258ae3('bgpFileName'),_0x20eddb['color']=_0x258ae3('bgpColor'),_0x20eddb['colorHex']=_0x258ae3('bgpColorHex'),_0x20eddb['apply']=_0x258ae3('bgpApply'),_0x20eddb['cancel']=_0x258ae3('bgpCancel'),_0x20eddb['closeX']=_0x258ae3('bgpClose'),document['querySelectorAll']('.bgp-tab')['forEach'](_0x988f93=>{_0x988f93['addEventListener']('click',()=>_0x561bf9(_0x988f93['dataset']['tab']));}),_0x20eddb['file']['addEventListener']('change',_0x44efcf),_0x20eddb['color']['addEventListener']('input',_0x18a2c5),_0x20eddb['colorHex']['addEventListener']('input',()=>{let _0x2abcfb=_0x20eddb['colorHex']['value']['trim']();/^#([0-9a-f]{3}|[0-9a-f]{6}|[0-9a-f]{8})$/i['test'](_0x2abcfb)&&(_0x20eddb['color']['value']=_0x2abcfb,_0x18a2c5());}),_0x20eddb['apply']['addEventListener']('click',_0x37073f),_0x20eddb['cancel']['addEventListener']('click',_0x35fff1),_0x20eddb['closeX']['addEventListener']('click',_0x35fff1),document['getElementById']('bgPickerBtn')?.['addEventListener']('click',_0x323b9),_0x20eddb['curatedGrid']['innerHTML']='',_0x1b1885['forEach'](_0x8c316f=>{const _0x3eb27e=_0x382ea7('button','bgp-thumb');_0x3eb27e['type']='button';const _0x2861a1=_0x382ea7('img');_0x2861a1['loading']='lazy',_0x2861a1['src']=_0x8c316f,_0x2861a1['alt']='background',_0x3eb27e['appendChild'](_0x2861a1),_0x3eb27e['addEventListener']('click',async()=>{const _0x1f9cf2=fixedFBOWidth||canvas['width'],_0x30c17c=fixedFBOHeight||canvas['height'],_0x470565=await _0x2445e1(_0x8c316f);_0x42e526=_0x573691(_0x470565,_0x1f9cf2,_0x30c17c),_0x458845(_0x3eb27e);}),_0x20eddb['curatedGrid']['appendChild'](_0x3eb27e);}),_0x18a2c5();}return{'install':function(_0x1332ff){_0x1332ff?.['curated']&&Array['isArray'](_0x1332ff['curated'])&&(_0x1b1885=_0x1332ff['curated']),_0x1036e0();},'open':_0x323b9};})());function duplicateLayer(_0x5c3ee2=activeLayerIndex){if(!(Array['isArray'](layers)&&layers['length']&&gl&&quadProgram))return;_0x5c3ee2=Math['max'](0x0,Math['min'](0x0|_0x5c3ee2,layers['length']-0x1));const _0x20bfcd=layers[_0x5c3ee2];if(!_0x20bfcd||!gl['isFramebuffer'](_0x20bfcd['fbo'])||!gl['isTexture'](_0x20bfcd['texture']))return void console['warn']('[duplicateLayer]\x20invalid\x20source\x20layer');const _0x28fb7b=Number['isFinite'](_0x20bfcd['texW'])?_0x20bfcd['texW']:0x0|fixedFBOWidth,_0x205282=Number['isFinite'](_0x20bfcd['texH'])?_0x20bfcd['texH']:0x0|fixedFBOHeight,{texture:_0x53cd65,fbo:_0x1f1915}=createLayerFBO(_0x28fb7b,_0x205282);gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x1f1915),gl['viewport'](0x0,0x0,_0x28fb7b,_0x205282),gl['disable'](gl['BLEND']),gl['clearColor'](0x0,0x0,0x0,0x0),gl['clear'](gl['COLOR_BUFFER_BIT']),gl['useProgram'](quadProgram);const _0x558057=gl['getUniformLocation'](quadProgram,'u_flipY'),_0x1c5835=gl['getUniformLocation'](quadProgram,'u_resolution'),_0x87f95e=gl['getUniformLocation'](quadProgram,'u_layerOpacity'),_0x5a740a=gl['getUniformLocation'](quadProgram,'u_texture');_0x558057&&gl['uniform1f'](_0x558057,0x1),_0x1c5835&&gl['uniform2f'](_0x1c5835,_0x28fb7b,_0x205282),_0x87f95e&&gl['uniform1f'](_0x87f95e,0x1);const _0x20fa05=new Float32Array([0x0,0x0,0x0,0x0,_0x28fb7b,0x0,0x1,0x0,0x0,_0x205282,0x0,0x1,0x0,_0x205282,0x0,0x1,_0x28fb7b,0x0,0x1,0x0,_0x28fb7b,_0x205282,0x1,0x1]),_0x9f292f=gl['createBuffer']();gl['bindBuffer'](gl['ARRAY_BUFFER'],_0x9f292f),gl['bufferData'](gl['ARRAY_BUFFER'],_0x20fa05,gl['STREAM_DRAW']);const _0x5272a4=gl['getAttribLocation'](quadProgram,'a_position'),_0x139162=gl['getAttribLocation'](quadProgram,'a_texCoord');gl['enableVertexAttribArray'](_0x5272a4),gl['vertexAttribPointer'](_0x5272a4,0x2,gl['FLOAT'],!0x1,0x10,0x0),gl['enableVertexAttribArray'](_0x139162),gl['vertexAttribPointer'](_0x139162,0x2,gl['FLOAT'],!0x1,0x10,0x8),gl['activeTexture'](gl['TEXTURE0']),gl['bindTexture'](gl['TEXTURE_2D'],_0x20bfcd['texture']),_0x5a740a&&gl['uniform1i'](_0x5a740a,0x0),gl['drawArrays'](gl['TRIANGLES'],0x0,0x6),gl['disableVertexAttribArray'](_0x5272a4),gl['disableVertexAttribArray'](_0x139162),gl['bindBuffer'](gl['ARRAY_BUFFER'],null),gl['deleteBuffer'](_0x9f292f),gl['bindFramebuffer'](gl['FRAMEBUFFER'],null);const _0x552feb={'id':Date['now']()+Math['random'](),'name':('string'==typeof _0x20bfcd['name']?_0x20bfcd['name']:'Layer')+'\x20copy','fbo':_0x1f1915,'texture':_0x53cd65,'visible':'boolean'!=typeof _0x20bfcd['visible']||_0x20bfcd['visible'],'opacity':'number'==typeof _0x20bfcd['opacity']?_0x20bfcd['opacity']:0x1,'ox':Number['isFinite'](_0x20bfcd['ox'])?_0x20bfcd['ox']:0x0,'oy':Number['isFinite'](_0x20bfcd['oy'])?_0x20bfcd['oy']:0x0,'texW':Number['isFinite'](_0x20bfcd['texW'])?_0x20bfcd['texW']:_0x28fb7b,'texH':Number['isFinite'](_0x20bfcd['texH'])?_0x20bfcd['texH']:_0x205282,'x':Number['isFinite'](_0x20bfcd['x'])?_0x20bfcd['x']:0x0,'y':Number['isFinite'](_0x20bfcd['y'])?_0x20bfcd['y']:0x0,'scaleX':Number['isFinite'](_0x20bfcd['scaleX'])?_0x20bfcd['scaleX']:0x1,'scaleY':Number['isFinite'](_0x20bfcd['scaleY'])?_0x20bfcd['scaleY']:0x1,'rotation':Number['isFinite'](_0x20bfcd['rotation'])?_0x20bfcd['rotation']:0x0,'px':Number['isFinite'](_0x20bfcd['px'])?_0x20bfcd['px']:0.5*fixedFBOWidth,'py':Number['isFinite'](_0x20bfcd['py'])?_0x20bfcd['py']:0.5*fixedFBOHeight},_0x3aa277=Math['min'](_0x5c3ee2+0x1,layers['length']);layers['splice'](_0x3aa277,0x0,_0x552feb),activeLayerIndex=_0x3aa277,selectedLayerIndices?.['clear']?.(),selectedLayerIndices?.['add']?.(activeLayerIndex),syncActiveAliases?.(),rebuildLayersUI?.();try{const _0x7b1d56=snapshotLayer(_0x3aa277);History['push']({'type':'add_layer','index':_0x3aa277,'addedLayer':{'name':_0x552feb['name'],'visible':_0x552feb['visible'],'opacity':_0x552feb['opacity'],'snapshot':_0x7b1d56}});}catch(_0x5d319b){console['warn']('[duplicateLayer]\x20history\x20snapshot\x20failed:',_0x5d319b);}needsRedraw=!0x0,requestDrawIfIdle?.(),showStatusMessage?.('Layer\x20duplicated','success'),console['log']('[duplicateLayer]\x20cloned\x20at\x20index',_0x3aa277,'from',_0x5c3ee2,{'px':_0x552feb['px'],'py':_0x552feb['py'],'x':_0x552feb['x'],'y':_0x552feb['y'],'scaleX':_0x552feb['scaleX'],'scaleY':_0x552feb['scaleY'],'rot':_0x552feb['rotation'],'ox':_0x552feb['ox'],'oy':_0x552feb['oy'],'texW':_0x552feb['texW'],'texH':_0x552feb['texH']});}function createTextureFromImage(_0x18f52b,_0x2c8bde=!0x1){if(!_0x18f52b)return void console['error']('Image\x20is\x20null\x20or\x20undefined.');const _0x2c316f=gl['createTexture']();gl['bindTexture'](gl['TEXTURE_2D'],_0x2c316f),_0x2c8bde?(gl['pixelStorei'](gl['UNPACK_FLIP_Y_WEBGL'],!0x0),gl['pixelStorei'](gl['UNPACK_PREMULTIPLY_ALPHA_WEBGL'],!0x0)):gl['pixelStorei'](gl['UNPACK_FLIP_Y_WEBGL'],!0x1),gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],gl['RGBA'],gl['UNSIGNED_BYTE'],_0x18f52b),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_S'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_T'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MIN_FILTER'],gl['LINEAR']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MAG_FILTER'],gl['LINEAR']),_0x2c8bde?(overlayTexture=_0x2c316f,brushAspect=_0x18f52b['width']/_0x18f52b['height']):texture=_0x2c316f,needsRedraw=!0x0;}function centerAndFitToWrapper(){const _0x2a0c7d=canvasWrapper['getBoundingClientRect'](),_0x4f1b98=canvas['width'],_0x4a524b=canvas['height'],_0x1c5047=Math['min'](_0x2a0c7d['width']/_0x4f1b98,_0x2a0c7d['height']/_0x4a524b);zoomScale=Math['min'](zoomMax,Math['max'](zoomMin,_0x1c5047)),panX=Math['round']((_0x2a0c7d['width']-_0x4f1b98*zoomScale)/0x2),panY=Math['round']((_0x2a0c7d['height']-_0x4a524b*zoomScale)/0x2),updateCanvasTransform(),resetStrokeState(),needsRedraw=!0x0;}function centerNextFrame(){requestAnimationFrame(()=>{centerAndFitToWrapper();});}function loadDefaultImage(){const _0x3e2ae7=document['createElement']('canvas');_0x3e2ae7['width']=window['innerWidth'],_0x3e2ae7['height']=window['innerHeight'];const _0x7aa73=_0x3e2ae7['getContext']('2d');_0x7aa73['fillStyle']='#f2efe4',_0x7aa73['fillRect'](0x0,0x0,_0x3e2ae7['width'],_0x3e2ae7['height']);const _0x2f28cf=document['createElement']('canvas');_0x2f28cf['width']=_0x3e2ae7['width'],_0x2f28cf['height']=_0x3e2ae7['height'];const _0x2cac6d=_0x2f28cf['getContext']('2d'),_0xed03b1=_0x2cac6d['createImageData'](_0x2f28cf['width'],_0x2f28cf['height']);for(let _0x3f87f3=0x0;_0x3f87f3<_0xed03b1['data']['length'];_0x3f87f3+=0x4){const _0xc98bdf=0x32*Math['random']()-0x19;_0xed03b1['data'][_0x3f87f3]=0xf0+_0xc98bdf,_0xed03b1['data'][_0x3f87f3+0x1]=0xeb+_0xc98bdf,_0xed03b1['data'][_0x3f87f3+0x2]=0xe1+_0xc98bdf,_0xed03b1['data'][_0x3f87f3+0x3]=0xff;}_0x2cac6d['putImageData'](_0xed03b1,0x0,0x0),_0x7aa73['globalAlpha']=0.2,_0x7aa73['drawImage'](_0x2f28cf,0x0,0x0),_0x7aa73['globalAlpha']=0x1;const _0x2e1192=document['createElement']('canvas');_0x2e1192['width']=_0x3e2ae7['width'],_0x2e1192['height']=_0x3e2ae7['height'];const _0x270873=_0x2e1192['getContext']('2d'),_0x55132e=_0x270873['createImageData'](_0x2e1192['width'],_0x2e1192['height']);for(let _0x182f27=0x0;_0x182f27<_0x55132e['data']['length'];_0x182f27+=0x4){const _0x20aa90=0xff*Math['random']();_0x55132e['data'][_0x182f27]=_0x20aa90,_0x55132e['data'][_0x182f27+0x1]=_0x20aa90,_0x55132e['data'][_0x182f27+0x2]=_0x20aa90,_0x55132e['data'][_0x182f27+0x3]=0x5a*Math['random']();}_0x270873['putImageData'](_0x55132e,0x0,0x0),_0x7aa73['globalAlpha']=0.08,_0x7aa73['drawImage'](_0x2e1192,0x0,0x0),_0x7aa73['globalAlpha']=0x1;const _0x581d82=_0x7aa73['createRadialGradient'](_0x3e2ae7['width']/0x2,_0x3e2ae7['height']/0x2,0.3*Math['min'](_0x3e2ae7['width'],_0x3e2ae7['height']),_0x3e2ae7['width']/0x2,_0x3e2ae7['height']/0x2,0.6*Math['max'](_0x3e2ae7['width'],_0x3e2ae7['height']));_0x581d82['addColorStop'](0x0,'rgba(0,0,0,0)'),_0x581d82['addColorStop'](0x1,'rgba(0,0,0,0.35)'),_0x7aa73['globalAlpha']=0.3,_0x7aa73['fillStyle']=_0x581d82,_0x7aa73['fillRect'](0x0,0x0,_0x3e2ae7['width'],_0x3e2ae7['height']),_0x7aa73['globalAlpha']=0x1;const _0x22c3fa=new Image();_0x22c3fa['crossOrigin']='anonymous',_0x22c3fa['onload']=()=>{currentImage=_0x22c3fa,fixedFBOWidth=_0x22c3fa['width'],fixedFBOHeight=_0x22c3fa['height'],initPaintLayerFixed(),updateCanvasSize(_0x22c3fa),initFloodFBOs(),createTextureFromImage(_0x22c3fa),canvas['offsetWidth'],canvasWrapper['offsetWidth'],zoomScale=0x1,panX=(canvasWrapper['clientWidth']-canvas['width'])/0x2,panY=(canvasWrapper['clientHeight']-canvas['height'])/0x2,updateCanvasTransform(),resetStrokeState(),needsRedraw=!0x0,initFloodFillProgram(),addSoundEvents();},_0x22c3fa['onerror']=()=>console['error']('Failed\x20to\x20load\x20default\x20image.'),_0x22c3fa['src']=_0x3e2ae7['toDataURL']('image/png');}function createBrushThumbnails(){const _0x5c713=document['getElementById']('brushContainer');_0x5c713['innerHTML']='',brushes['forEach'](_0x191bb6=>{const _0x3b4dc5=document['createElement']('img');_0x3b4dc5['src']=_0x191bb6['file'],_0x3b4dc5['classList']['add']('brush-thumbnail'),_0x191bb6['selected']&&(_0x3b4dc5['style']['border']='2px\x20solid\x20red'),_0x3b4dc5['addEventListener']('click',()=>selectBrush(_0x191bb6['name'])),_0x5c713['appendChild'](_0x3b4dc5);});const _0x17107d=document['getElementById']('brushContainerToggle');_0x5c713['appendChild'](_0x17107d);}function updateBrushThumbnailStyles(_0xbefb19){const _0x173b23=document['getElementById']('brushContainer')['querySelectorAll']('img.brush-thumbnail');brushes['forEach']((_0x416da9,_0x52228e)=>{_0x173b23[_0x52228e]&&(_0x173b23[_0x52228e]['style']['border']=_0x416da9['name']===_0xbefb19?'2px\x20solid\x20red':'2px\x20solid\x20transparent');});}function selectBrush(_0x2d982f){const _0x1395ad=brushes['find'](_0x5e0794=>_0x5e0794['name']===_0x2d982f);if(!_0x1395ad)return void console['warn']('Brush\x20\x22'+_0x2d982f+'\x22\x20not\x20found.');currentBrush=_0x1395ad,overlayTexture=brushTextures[_0x1395ad['name']],brushAspect=brushAspects[_0x1395ad['name']];const _0x6f6c92=document['getElementById']('brushSizeSlider'),_0x48ef8f=document['getElementById']('brushSizeValue');_0x6f6c92['value']=brushSize,_0x48ef8f['textContent']=brushSize['toFixed'](0x2),brushes['forEach'](_0x462a2e=>_0x462a2e['selected']=_0x462a2e['name']===_0x2d982f),updateBrushThumbnailStyles(_0x1395ad['name']),needsRedraw=!0x0;}function loadBrushes(){brushes['forEach'](_0x50cd7b=>{const _0x1272bc=new Image();_0x1272bc['crossOrigin']='anonymous',_0x1272bc['onload']=()=>{const _0x52d6e5=gl['createTexture']();gl['bindTexture'](gl['TEXTURE_2D'],_0x52d6e5),gl['pixelStorei'](gl['UNPACK_FLIP_Y_WEBGL'],!0x0),gl['pixelStorei'](gl['UNPACK_PREMULTIPLY_ALPHA_WEBGL'],!0x0),gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],gl['RGBA'],gl['UNSIGNED_BYTE'],_0x1272bc),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_S'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_T'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MIN_FILTER'],gl['LINEAR']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MAG_FILTER'],gl['LINEAR']),brushTextures[_0x50cd7b['name']]=_0x52d6e5,brushAspects[_0x50cd7b['name']]=_0x1272bc['width']/_0x1272bc['height'],_0x50cd7b['selected']&&selectBrush(_0x50cd7b['name']);},_0x1272bc['onerror']=()=>console['error']('Failed\x20to\x20load\x20brush\x20image:',_0x50cd7b['file']),_0x1272bc['src']=_0x50cd7b['file'];});}function centerCanvasInWrapper(){const _0x3d465f=canvasWrapper['getBoundingClientRect'](),_0x31dfc5=canvas['width']*zoomScale,_0x1ed8c6=canvas['height']*zoomScale;panX=(_0x3d465f['width']-_0x31dfc5)/0x2,panY=(_0x3d465f['height']-_0x1ed8c6)/0x2,viewRotation=0x0,transformOriginX=0x0,transformOriginY=0x0,updateCanvasTransform();}function ensureCanvasNotLost(){const _0x345837=canvasWrapper['getBoundingClientRect'](),_0x3923aa=canvas['getBoundingClientRect'](),_0x347e43=Math['max'](0x0,Math['min'](_0x3923aa['right'],_0x345837['right'])-Math['min'](_0x3923aa['left'],_0x345837['left']))*Math['max'](0x0,Math['min'](_0x3923aa['bottom'],_0x345837['bottom'])-Math['min'](_0x3923aa['top'],_0x345837['top'])),_0x1abff3=_0x3923aa['width']*_0x3923aa['height'];(!isFinite(_0x347e43)||_0x1abff3<=0x0||_0x347e43/_0x1abff3<0.05)&&centerCanvasInWrapper();}BackgroundPicker['install']({'curated':['/static/draw/images/backgrounds/WEBP_1920/sl_072622_51930_13.jpg','/static/draw/images/backgrounds/WEBP_1920/02.webp','/static/draw/images/backgrounds/WEBP_1920/44.webp','/static/draw/images/backgrounds/WEBP_1920/43.webp','/static/draw/images/backgrounds/WEBP_1920/42.webp','/static/draw/images/backgrounds/WEBP_1920/41.webp','/static/draw/images/backgrounds/WEBP_1920/40.webp']}),['mouseup','mouseleave','touchend','touchcancel']['forEach'](_0x329ec3=>canvasWrapper['addEventListener'](_0x329ec3,ensureCanvasNotLost,{'passive':!0x0})),window['addEventListener']('resize',ensureCanvasNotLost),window['visualViewport']&&(visualViewport['addEventListener']('resize',ensureCanvasNotLost),visualViewport['addEventListener']('scroll',ensureCanvasNotLost));let lastMultiTap=0x0;function snapBackIfLost(_0x484508,_0x4597a0){_0x4597a0='number'==typeof _0x4597a0?_0x4597a0:0x8;var _0x55c63c=_0x484508['getBoundingClientRect'](),_0x10fe2d=window['visualViewport']?window['visualViewport']:null,_0x5e2470=_0x10fe2d&&_0x10fe2d['width']?_0x10fe2d['width']:window['innerWidth'],_0x3b94a4=_0x10fe2d&&_0x10fe2d['height']?_0x10fe2d['height']:window['innerHeight'];if(!(_0x55c63c['right']>_0x4597a0&&_0x55c63c['bottom']>_0x4597a0&&_0x55c63c['left']<_0x5e2470-_0x4597a0&&_0x55c63c['top']<_0x3b94a4-_0x4597a0)){var _0x3fb677=Math['min'](Math['max'](_0x484508['offsetLeft']||0x0,_0x4597a0),_0x5e2470-_0x55c63c['width']-_0x4597a0),_0x1f1f90=Math['min'](Math['max'](_0x484508['offsetTop']||0x0,_0x4597a0),_0x3b94a4-_0x55c63c['height']-_0x4597a0);_0x484508['style']['left']=Math['round'](_0x3fb677)+'px',_0x484508['style']['top']=Math['round'](_0x1f1f90)+'px';}}canvasWrapper['addEventListener']('touchend',_0x24c399=>{if(_0x24c399['changedTouches']['length']>=0x2){const _0x153e91=performance['now']();_0x153e91-lastMultiTap<0x15e&&centerCanvasInWrapper(),lastMultiTap=_0x153e91;}},{'passive':!0x0}),[['brushSizeSliderContainer','brushSizeDragBar'],['brushContainerWrapper','brushContainerDragBar'],['layersPanel','.layers-header']]['forEach'](([_0x2405e2,_0x54d32d])=>{const _0x49e84f=document['getElementById'](_0x2405e2),_0x4d4e76=_0x49e84f&&(_0x54d32d['startsWith']('#')?document['querySelector'](_0x54d32d):_0x49e84f['querySelector'](_0x54d32d));if(!_0x49e84f||!_0x4d4e76)return;const _0x199036=_0x2bcd7e=>{try{_0x4d4e76['releasePointerCapture'](_0x2bcd7e['pointerId']);}catch{}snapBackIfLost(_0x49e84f);};_0x4d4e76['addEventListener']('pointerup',_0x199036),_0x4d4e76['addEventListener']('pointercancel',_0x199036);}),window['addEventListener']('resize',()=>{['brushSizeSliderContainer','brushContainerWrapper','layersPanel']['forEach'](_0x35cf31=>{const _0x2c525e=document['getElementById'](_0x35cf31);_0x2c525e&&snapBackIfLost(_0x2c525e);});});let resizeTimer=null;function updateBrushSize(){const _0xa08b93=canvas['width'];brushSize=Math['min'](brushSize,_0xa08b93/0xa);}function updateCanvasSize(_0xf5f1fb){if(!_0xf5f1fb)return;const _0x2525c9=window['innerWidth']/window['innerHeight'];let _0x21bac4,_0x887daa;imageAspect=_0xf5f1fb['width']/_0xf5f1fb['height'],imageAspect>_0x2525c9?(_0x21bac4=window['innerWidth'],_0x887daa=window['innerWidth']/ imageAspect):(_0x887daa=window['innerHeight'],_0x21bac4=window['innerHeight']*imageAspect),canvas['width']=Math['round'](_0x21bac4),canvas['height']=Math['round'](_0x887daa),gl['viewport'](0x0,0x0,canvas['width'],canvas['height']),updateBrushSize(),needsRedraw=!0x0;}function resetStrokeState(){lastX=null,lastY=null,lastFx=null,lastFy=null,void 0x0!==lastDrawTime&&(lastDrawTime=0x0),void 0x0!==soundLastX&&(soundLastX=null),void 0x0!==soundLastY&&(soundLastY=null);}function setDocumentSize(_0x3864e9,_0x507101){fixedFBOWidth=_0x3864e9,fixedFBOHeight=_0x507101,canvas['width']=_0x3864e9,canvas['height']=_0x507101,gl['viewport'](0x0,0x0,_0x3864e9,_0x507101),zoomScale=0x1;const _0x53137d=canvasWrapper['getBoundingClientRect']();panX=Math['round']((_0x53137d['width']-_0x3864e9)/0x2),panY=Math['round']((_0x53137d['height']-_0x507101)/0x2),updateCanvasTransform(),resetStrokeState(),needsRedraw=!0x0;}window['addEventListener']('resize',()=>{clearTimeout(resizeTimer),resizeTimer=setTimeout(()=>{currentImage&&updateCanvasSize(currentImage),centerCanvasInWrapper?.();},0x78);}),window['addEventListener']('resize',()=>{currentImage&&updateCanvasSize(currentImage);});const audioCtx=new(window['AudioContext']||window['webkitAudioContext'])();let gainNode,noiseNode,filterNode,isDrawingSoundActive=!0x1,soundLastX=null,soundLastY=null,soundIsMoving=!0x1,lastMoveTimestamp=0x0;function unlockAudio(){'suspended'===audioCtx['state']&&audioCtx['resume']();}function createNoiseBuffer(){const _0x2650a6=audioCtx['sampleRate'],_0x3cd935=Math['max'](0x1,Math['floor'](0.5*_0x2650a6)),_0x16c172=audioCtx['createBuffer'](0x1,_0x3cd935,_0x2650a6),_0x47acd9=_0x16c172['getChannelData'](0x0);for(let _0x541494=0x0;_0x541494<_0x3cd935;_0x541494++)_0x47acd9[_0x541494]=Math['random']()>0.9?0.5*(0x2*Math['random']()-0x1):0x0;return _0x16c172;}function startDrawingSound(_0x112875=0x1){if(isDrawingSoundActive)return;isDrawingSoundActive=!0x0,unlockAudio(),gainNode=audioCtx['createGain'](),gainNode['gain']['setValueAtTime'](0x0,audioCtx['currentTime']),filterNode=audioCtx['createBiquadFilter'](),filterNode['type']='bandpass';const _0x534341=0.5*audioCtx['sampleRate'],_0x187199=0x190+0x12c*(Number(_0x112875)||0x0),_0x49796f=Math['min'](_0x534341-0x14,Math['max'](0xa,_0x187199));filterNode['frequency']['setValueAtTime'](_0x49796f,audioCtx['currentTime']),filterNode['Q']['setValueAtTime'](2.5,audioCtx['currentTime']),noiseNode=audioCtx['createBufferSource'](),noiseNode['buffer']=createNoiseBuffer(),noiseNode['loop']=!0x0,noiseNode['connect'](filterNode),filterNode['connect'](gainNode),gainNode['connect'](audioCtx['destination']),noiseNode['start']();}function updateDrawingSound(_0x5fb20b){if(!isDrawingSoundActive)return;const _0x1c483c=0.5*audioCtx['sampleRate'],_0x2e09d8=0x190+0x12c*(Number(_0x5fb20b)||0x0),_0x5ac986=Math['min'](_0x1c483c-0x14,Math['max'](0xa,_0x2e09d8));filterNode['frequency']['linearRampToValueAtTime'](_0x5ac986,audioCtx['currentTime']+0.05);const _0x279f86=Math['min'](0.15,0.05*(Number(_0x5fb20b)||0x0)),_0x4bd52c=Math['max'](0x0,Math['min'](0x1,_0x279f86));gainNode['gain']['linearRampToValueAtTime'](_0x4bd52c,audioCtx['currentTime']+0.05);}function stopDrawingSound(){isDrawingSoundActive&&(isDrawingSoundActive=!0x1,gainNode['gain']['linearRampToValueAtTime'](0x0,audioCtx['currentTime']+0.2),setTimeout(()=>{noiseNode&&(noiseNode['stop'](),noiseNode['disconnect']()),filterNode&&filterNode['disconnect'](),gainNode&&gainNode['disconnect']();},0xc8));}function getTouchPos(_0x386cff){const _0x56d75c=_0x386cff['touches']&&_0x386cff['touches'][0x0]?_0x386cff['touches'][0x0]:_0x386cff['changedTouches']&&_0x386cff['changedTouches'][0x0];if(!_0x56d75c)return{'x':0x0,'y':0x0};const _0x276db2=canvasWrapper['getBoundingClientRect'](),_0x52c8b9=_0x56d75c['clientX']-_0x276db2['left'],_0x5c58c7=_0x56d75c['clientY']-_0x276db2['top'],_0x55a8e8=screenToCanvasPx(_0x56d75c['clientX'],_0x56d75c['clientY']);return{'x':_0x52c8b9,'y':_0x5c58c7,'cx':_0x55a8e8['x'],'cy':_0x55a8e8['y']};}function addSoundEvents(){document['addEventListener']('touchstart',unlockAudio,{'once':!0x0}),document['addEventListener']('click',unlockAudio,{'once':!0x0}),canvas['addEventListener']('mousedown',()=>{soundIsMoving=!0x1;}),canvas['addEventListener']('mousemove',_0x5525a5=>{if(!isDrawing)return;let _0x53ea3f=Math['sqrt'](_0x5525a5['movementX']**0x2+_0x5525a5['movementY']**0x2);soundIsMoving||(startDrawingSound(_0x53ea3f),soundIsMoving=!0x0),updateDrawingSound(_0x53ea3f);}),canvas['addEventListener']('mouseup',()=>{soundIsMoving=!0x1,stopDrawingSound();}),canvas['addEventListener']('mouseleave',()=>{soundIsMoving=!0x1,stopDrawingSound();}),canvas['addEventListener']('touchstart',_0x555f83=>{_0x555f83['preventDefault'](),isDrawing=!0x0,soundLastX=null,soundLastY=null,soundIsMoving=!0x1,lastMoveTimestamp=Date['now']();}),canvas['addEventListener']('touchmove',_0x13ce7=>{if(_0x13ce7['preventDefault'](),!isDrawing)return;const _0x31c742=getTouchPos(_0x13ce7),_0x3c4cae=Date['now']();if(null!==soundLastX&&null!==soundLastY){const _0x212ad8=_0x31c742['x']-soundLastX,_0x35c676=_0x31c742['y']-soundLastY,_0x40750c=Math['sqrt'](_0x212ad8*_0x212ad8+_0x35c676*_0x35c676);if(_0x40750c>0x1){let _0x539863=_0x40750c/(_0x3c4cae-lastMoveTimestamp+0x1);lastMoveTimestamp=_0x3c4cae,soundIsMoving||(startDrawingSound(_0x539863),soundIsMoving=!0x0),updateDrawingSound(_0x539863);}}soundLastX=_0x31c742['x'],soundLastY=_0x31c742['y'];}),canvas['addEventListener']('touchend',()=>{soundIsMoving=!0x1,stopDrawingSound();}),canvas['addEventListener']('touchcancel',()=>{soundIsMoving=!0x1,stopDrawingSound();}),setInterval(()=>{isDrawing&&soundIsMoving&&Date['now']()-lastMoveTimestamp>0x64&&(soundIsMoving=!0x1,stopDrawingSound());},0x32);}let lastDrawTime=0x0;function isUserTyping(){const _0x2ed4e7=document['activeElement'];return _0x2ed4e7&&('INPUT'===_0x2ed4e7['tagName']||'TEXTAREA'===_0x2ed4e7['tagName']||_0x2ed4e7['isContentEditable']);}canvas['addEventListener']('mousedown',_0x135aed=>{if(!canPaint())return;const _0x1b2b2e=pointerToBoth(_0x135aed);if(overlayPosition=[_0x1b2b2e['cx']/canvas['width'],_0x1b2b2e['cy']/canvas['height']],'fill'===currentTool)return performFloodFill(_0x1b2b2e['fx'],_0x1b2b2e['fy']),needsRedraw=!0x0,void drawScene();isDrawing=!0x0,startRender('draw'),drawBrushStrokeToPaintLayer(_0x1b2b2e['cx'],_0x1b2b2e['cy']);}),canvas['addEventListener']('mousemove',_0x4ea28f=>{if(!canPaint()&&!isDrawing)return;const _0x274c6f=Date['now']();if(_0x274c6f-lastDrawTime<0x10)return;lastDrawTime=_0x274c6f;const _0x12dd3d=pointerToBoth(_0x4ea28f);if(null!==lastX&&null!==lastY){const _0x33ffcd=_0x12dd3d['cx']-lastX,_0x165ddd=_0x12dd3d['cy']-lastY;(Math['abs'](_0x33ffcd)>0.1||Math['abs'](_0x165ddd)>0.1)&&(currentAngle=Math['atan2'](_0x165ddd,_0x33ffcd));}lastX=_0x12dd3d['cx'],lastY=_0x12dd3d['cy'],overlayPosition=[_0x12dd3d['cx']/canvas['width'],_0x12dd3d['cy']/canvas['height']],isDrawing&&canPaint()&&drawBrushStrokeToPaintLayer(_0x12dd3d['cx'],_0x12dd3d['cy']);}),canvas['addEventListener']('mouseup',()=>{isDrawing=!0x1,stopRender('draw'),lastFx=null,lastFy=null;}),canvas['addEventListener']('mouseleave',()=>{isDrawing=!0x1,stopRender('draw'),lastFx=null,lastFy=null;}),canvas['addEventListener']('touchstart',_0x20676a=>{if(_0x20676a['preventDefault'](),!canPaint())return;const _0xc53f40=_0x20676a['touches'][0x0];if(!_0xc53f40)return;const _0x15b89b=pointerToBoth(_0xc53f40);if(overlayPosition=[_0x15b89b['cx']/canvas['width'],_0x15b89b['cy']/canvas['height']],'fill'===currentTool)return performFloodFill(_0x15b89b['fx'],_0x15b89b['fy']),needsRedraw=!0x0,void drawScene();isDrawing=!0x0,startRender('draw'),drawBrushStrokeToPaintLayer(_0x15b89b['cx'],_0x15b89b['cy']);},{'passive':!0x1}),canvas['addEventListener']('touchmove',_0x5a11c9=>{if(_0x5a11c9['preventDefault'](),!isDrawing||!canPaint())return;const _0xb0af8e=_0x5a11c9['touches'][0x0];if(!_0xb0af8e)return;const _0x16717d=Date['now']();if(_0x16717d-lastDrawTime<0x10)return;lastDrawTime=_0x16717d;const _0xeb6d59=pointerToBoth(_0xb0af8e);if(null!==lastX&&null!==lastY){const _0x222155=_0xeb6d59['cx']-lastX,_0x3197b5=_0xeb6d59['cy']-lastY;(Math['abs'](_0x222155)>0.1||Math['abs'](_0x3197b5)>0.1)&&(currentAngle=Math['atan2'](_0x3197b5,_0x222155));}lastX=_0xeb6d59['cx'],lastY=_0xeb6d59['cy'],overlayPosition=[_0xeb6d59['cx']/canvas['width'],_0xeb6d59['cy']/canvas['height']],drawBrushStrokeToPaintLayer(_0xeb6d59['cx'],_0xeb6d59['cy']);},{'passive':!0x1}),canvas['addEventListener']('touchend',()=>{isDrawing=!0x1,stopRender('draw'),lastFx=null,lastFy=null;},{'passive':!0x0}),canvas['addEventListener']('touchcancel',()=>{isDrawing=!0x1,stopRender('draw'),lastFx=null,lastFy=null;},{'passive':!0x0}),document['addEventListener']('keydown',_0x155064=>{if(isUserTyping())return;let _0x2ed3b4=!0x1;if('['===_0x155064['key']){brushSize=Math['max'](0.01,brushSize-0.02);const _0x5e42a2=document['getElementById']('brushSizeSlider');_0x5e42a2&&(_0x5e42a2['value']=brushSize),_0x2ed3b4=!0x0,overlayPosition=[lastPointer['cx']/canvas['width'],lastPointer['cy']/canvas['height']],showBrushHUD();}else{if(']'===_0x155064['key']){brushSize=Math['min'](0x1,brushSize+0.02);const _0x3efb04=document['getElementById']('brushSizeSlider');_0x3efb04&&(_0x3efb04['value']=brushSize),_0x2ed3b4=!0x0,overlayPosition=[lastPointer['cx']/canvas['width'],lastPointer['cy']/canvas['height']],showBrushHUD();}else{if(_0x155064['key']>='0'&&_0x155064['key']<='9'){let _0x1bcf81='0'===_0x155064['key']?0x9:parseInt(_0x155064['key'],0xa)-0x1;_0x1bcf81>=0x0&&_0x1bcf81<brushes['length']&&(selectBrush(brushes[_0x1bcf81]['name']),_0x2ed3b4=!0x0,overlayPosition=[lastPointer['cx']/canvas['width'],lastPointer['cy']/canvas['height']],showBrushHUD());}}}_0x2ed3b4&&(needsRedraw=!0x0);});let brushSize=0.02,opacity=0x1,eraseStrength=0.5,paintStrength=0x1;document['addEventListener']('DOMContentLoaded',()=>{const _0x456a6e=document['getElementById']('brushSizeSlider'),_0x2f8596=document['getElementById']('brushSizeValue');_0x456a6e['value']=brushSize,_0x2f8596['textContent']=brushSize['toFixed'](0x2),_0x456a6e['addEventListener']('input',_0x4b14a2=>{brushSize=parseFloat(_0x4b14a2['target']['value']),_0x2f8596['textContent']=brushSize['toFixed'](0x2),needsRedraw=!0x0,showBrushHUD();});const _0x36420e=document['getElementById']('eraseStrengthSlider'),_0x34bb87=document['getElementById']('eraseStrengthValue');_0x36420e['value']=eraseStrength,_0x34bb87['textContent']=eraseStrength['toFixed'](0x2),_0x36420e['addEventListener']('input',_0x31762a=>{eraseStrength=parseFloat(_0x31762a['target']['value']),_0x34bb87['textContent']=eraseStrength['toFixed'](0x2),needsRedraw=!0x0,showBrushHUD();});const _0x15b555=document['getElementById']('paintStrengthSlider'),_0x15dbfb=document['getElementById']('paintStrengthValue');_0x15b555['value']=paintStrength,_0x15dbfb['textContent']=paintStrength['toFixed'](0x2),_0x15b555['addEventListener']('input',_0xe46eed=>{paintStrength=parseFloat(_0xe46eed['target']['value']),_0x15dbfb['textContent']=paintStrength['toFixed'](0x2),needsRedraw=!0x0;});});let selectedLayerIndices=new Set();function rebuildLayersUI(){const _0x3f32de=document['getElementById']('layersList');if(!_0x3f32de)return;if(layers?.['length']?0x0===selectedLayerIndices['size']&&Number['isInteger'](activeLayerIndex)&&selectedLayerIndices['add'](activeLayerIndex):selectedLayerIndices['clear'](),!window['__mobileLayerTransformSetup']){const _0x25059b=canvasWrapper||document['getElementById']('canvasWrapper')||canvas?.['parentElement'];let _0x37beb8=null;function _0x24bb44(_0x3b4386){if(isMobile()&&(_0x37beb8&&(!_0x3b4386['touches']||_0x3b4386['touches']['length']<0x2)&&(_0x37beb8=null),transformTool&&'idle'===transformTool['mode'])){const _0x28c4be=getActiveLayer();_0x28c4be&&_0x28c4be['transformLocked']||(transformTool['mobileCombo']=!0x1);}}_0x25059b&&(_0x25059b['addEventListener']('touchstart',function(_0x3fcfe1){if(isMobile()&&transformTool&&transformTool['mobileCombo']&&0x2===_0x3fcfe1['touches']['length']){_0x3fcfe1['preventDefault'](),_0x3fcfe1['stopImmediatePropagation']();const _0x98edc5=_0x3fcfe1['touches'][0x0],_0x223650=_0x3fcfe1['touches'][0x1],_0xf9cf78=_0x223650['clientX']-_0x98edc5['clientX'],_0x3bda3e=_0x223650['clientY']-_0x98edc5['clientY'],_0x181e96=Math['hypot'](_0xf9cf78,_0x3bda3e),_0x38b15e=Math['atan2'](_0x3bda3e,_0xf9cf78),_0x3c8e79=getActiveLayer();if(!_0x3c8e79)return;_0x37beb8={'dist0':Math['max'](0.000001,_0x181e96),'ang0':_0x38b15e,'ref':{'scaleX':Number['isFinite'](_0x3c8e79['scaleX'])?_0x3c8e79['scaleX']:0x1,'scaleY':Number['isFinite'](_0x3c8e79['scaleY'])?_0x3c8e79['scaleY']:0x1,'rotation':Number['isFinite'](_0x3c8e79['rotation'])?_0x3c8e79['rotation']:0x0}};}},{'passive':!0x1,'capture':!0x0}),_0x25059b['addEventListener']('touchmove',function(_0x4bedd1){if(isMobile()&&transformTool&&transformTool['mobileCombo']&&0x2===_0x4bedd1['touches']['length']&&_0x37beb8){_0x4bedd1['preventDefault'](),_0x4bedd1['stopImmediatePropagation']();const _0x2ae5cb=_0x4bedd1['touches'][0x0],_0x4e712e=_0x4bedd1['touches'][0x1],_0x214d16=_0x4e712e['clientX']-_0x2ae5cb['clientX'],_0x5dee10=_0x4e712e['clientY']-_0x2ae5cb['clientY'],_0x25fb9b=Math['max'](0.000001,Math['hypot'](_0x214d16,_0x5dee10)),_0x598c28=Math['atan2'](_0x5dee10,_0x214d16),_0x1da3e1=getActiveLayer();if(!_0x1da3e1)return;const _0x1005d0=_0x25fb9b/_0x37beb8['dist0'];_0x1da3e1['scaleX']=_0x37beb8['ref']['scaleX']*_0x1005d0,_0x1da3e1['scaleY']=_0x37beb8['ref']['scaleY']*_0x1005d0;let _0x538c1d=_0x598c28-_0x37beb8['ang0'];return _0x538c1d>Math['PI']&&(_0x538c1d-=0x2*Math['PI']),_0x538c1d<-Math['PI']&&(_0x538c1d+=0x2*Math['PI']),_0x1da3e1['rotation']=_0x37beb8['ref']['rotation']+_0x538c1d,void(needsRedraw=!0x0);}},{'passive':!0x1,'capture':!0x0}),_0x25059b['addEventListener']('touchend',_0x24bb44,{'passive':!0x0,'capture':!0x0}),_0x25059b['addEventListener']('touchcancel',_0x24bb44,{'passive':!0x0,'capture':!0x0})),window['__mobileLayerTransformSetup']=!0x0;}_0x3f32de['innerHTML']='';const _0x2f4930=document['createElement']('div');_0x2f4930['className']='layers-header';const _0x4c0fc5=document['createElement']('button');_0x4c0fc5['type']='button',_0x4c0fc5['className']='bs-n',_0x4c0fc5['textContent']='Merge\x20Selected',_0x4c0fc5['disabled']=selectedLayerIndices['size']<0x2,_0x4c0fc5['addEventListener']('click',_0xbe6dda=>{_0xbe6dda['stopPropagation'](),selectedLayerIndices['size']>=0x2&&mergeSelectedLayers();});const _0x394322=document['createElement']('button');function _0x46d5a8(){_0x4c0fc5['disabled']=selectedLayerIndices['size']<0x2,_0x4c0fc5['textContent']=selectedLayerIndices['size']>0x1?'Merge\x20Selected\x20('+selectedLayerIndices['size']+')':'Merge\x20Selected',_0x394322['disabled']=!(layers&&layers['length']>=0x2);}function _0x2386db(_0x5214d7,_0x44c5f0){if(!_0x44c5f0)return selectedLayerIndices['clear'](),selectedLayerIndices['add'](_0x5214d7),void(activeLayerIndex=_0x5214d7);selectedLayerIndices['has'](_0x5214d7)?(selectedLayerIndices['delete'](_0x5214d7),0x0===selectedLayerIndices['size']&&selectedLayerIndices['add'](_0x5214d7)):(selectedLayerIndices['add'](_0x5214d7),activeLayerIndex=_0x5214d7);}_0x394322['type']='button',_0x394322['className']='bs-n',_0x394322['textContent']='Merge\x20All',_0x394322['disabled']=!(layers&&layers['length']>=0x2),_0x394322['addEventListener']('click',_0x244bd2=>{if(_0x244bd2['stopPropagation'](),layers&&layers['length']>=0x2){selectedLayerIndices['clear']();for(let _0x331ab5=0x0;_0x331ab5<layers['length'];_0x331ab5++)selectedLayerIndices['add'](_0x331ab5);mergeSelectedLayers(),selectedLayerIndices['clear'](),Number['isInteger'](activeLayerIndex)&&selectedLayerIndices['add'](activeLayerIndex),rebuildLayersUI();}}),_0x2f4930['appendChild'](_0x4c0fc5),_0x2f4930['appendChild'](_0x394322),_0x3f32de['appendChild'](_0x2f4930),(layers||[])['forEach']((_0x2cd718,_0x3f5755)=>{const _0x197513=document['createElement']('div'),_0x32b267=_0x3f5755===activeLayerIndex,_0x59116b=selectedLayerIndices['has'](_0x3f5755);_0x197513['className']='layer-item'+(_0x32b267?'\x20active':'')+(_0x59116b?'\x20is-selected':''),_0x197513['dataset']['index']=String(_0x3f5755);const _0x596f7e=document['createElement']('div');_0x596f7e['className']='layer-select';const _0xc49f80=document['createElement']('input');_0xc49f80['type']='checkbox',_0xc49f80['checked']=_0x59116b,_0xc49f80['title']='Select\x20for\x20merge',_0xc49f80['addEventListener']('click',_0x414c16=>{_0x414c16['stopPropagation'](),_0x2386db(_0x3f5755,!0x0),_0x46d5a8(),_0x197513['classList']['toggle']('is-selected',selectedLayerIndices['has'](_0x3f5755));}),_0x596f7e['appendChild'](_0xc49f80);const _0x1d12a4=document['createElement']('div');_0x1d12a4['className']='layer-vis';const _0x34c802=document['createElement']('button');_0x34c802['type']='button',_0x34c802['className']='bs\x20icon-btn',_0x34c802['title']=_0x2cd718['visible']?'Hide\x20layer':'Show\x20layer',_0x34c802['setAttribute']('aria-label',(_0x2cd718['visible']?'Hide':'Show')+'\x20'+_0x2cd718['name']);const _0x3f9629='/static/draw/images/icons/show.svg',_0x276391='/static/draw/images/icons/hide.svg',_0x200867=document['createElement']('img');function _0x230e60(){_0x200867['src']=_0x2cd718['visible']?_0x3f9629:_0x276391,_0x200867['alt']=_0x2cd718['visible']?'Visible':'Hidden',_0x34c802['title']=_0x2cd718['visible']?'Hide\x20layer':'Show\x20layer',_0x34c802['setAttribute']('aria-label',(_0x2cd718['visible']?'Hide':'Show')+'\x20'+_0x2cd718['name']);}_0x200867['alt']=_0x2cd718['visible']?'Visible':'Hidden',_0x200867['src']=_0x2cd718['visible']?_0x3f9629:_0x276391,_0x200867['style']['pointerEvents']='none',_0x34c802['appendChild'](_0x200867),_0x34c802['addEventListener']('click',_0x4d9867=>{_0x4d9867['stopPropagation'](),clearTransformLockAll(),_0x2cd718['visible']=!_0x2cd718['visible'],_0x230e60(),needsRedraw=!0x0;}),_0x1d12a4['appendChild'](_0x34c802);const _0x2099b0=document['createElement']('button');_0x2099b0['type']='button',_0x2099b0['className']='bs\x20icon-btn\x20transform-btn',_0x2099b0['title']='Transform\x20layer',_0x2099b0['setAttribute']('aria-label','Transform\x20'+_0x2cd718['name']),_0x2099b0['innerHTML']='<img\x20src=\x22/static/draw/images/icons/transform.svg\x22\x20alt=\x22Transform\x22>',isMobile()||(_0x2099b0['style']['display']='none'),isMobile()&&_0x2cd718['transformLocked']&&_0x32b267?_0x2099b0['classList']['add']('is-active'):_0x2099b0['classList']['remove']('is-active'),_0x2099b0['addEventListener']('click',_0x41de99=>{_0x41de99['stopPropagation'](),activeLayerIndex!==_0x3f5755&&(clearTransformLockAll(),activeLayerIndex=_0x3f5755,syncActiveAliases?.(),rebuildLayersUI());const _0x6123f7=!!_0x2cd718['transformLocked'];setLayerTransformLock(_0x3f5755,!_0x6123f7),_0x2099b0['classList']['toggle']('is-active',!_0x6123f7),showStatusMessage?.(_0x6123f7?'Transform\x20unlocked':'Transform\x20locked:\x20drag\x20to\x20move,\x20pinch\x20to\x20scale/rotate','info'),needsRedraw=!0x0;}),_0x1d12a4['appendChild'](_0x2099b0);const _0x4c5cfb=document['createElement']('div');_0x4c5cfb['className']='layer-name';const _0x1eaa70=document['createElement']('input');_0x1eaa70['value']=_0x2cd718['name'],_0x1eaa70['title']='Rename\x20layer',_0x1eaa70['setAttribute']('aria-label','Rename\x20'+_0x2cd718['name']),_0x1eaa70['addEventListener']('click',_0x5a9c65=>_0x5a9c65['stopPropagation']()),_0x1eaa70['addEventListener']('mousedown',()=>{activeLayerIndex=_0x3f5755;}),_0x1eaa70['addEventListener']('focus',()=>{activeLayerIndex=_0x3f5755;});const _0x3b3389=()=>{const _0x3ba8c2=_0x1eaa70['value'];_0x3ba8c2!==_0x2cd718['name']&&(_0x2cd718['name']=_0x3ba8c2,_0x230e60());};_0x1eaa70['addEventListener']('change',_0x3b3389),_0x1eaa70['addEventListener']('blur',_0x3b3389),_0x4c5cfb['appendChild'](_0x1eaa70);const _0x362dd7=document['createElement']('div');_0x362dd7['className']='layer-ops';const _0x1eb748=document['createElement']('button');_0x1eb748['type']='button',_0x1eb748['className']='bs\x20icon-btn',_0x1eb748['title']='Duplicate\x20layer',_0x1eb748['setAttribute']('aria-label','Duplicate\x20layer'),_0x1eb748['innerHTML']='<img\x20src=\x22/static/draw/images/icons/clone.svg\x22\x20alt=\x22\x22\x20style=\x22pointer-events:none\x22\x20width=\x2218\x22\x20height=\x2218\x22>',_0x1eb748['addEventListener']('click',_0x288b22=>{_0x288b22['stopPropagation'](),clearTransformLockAll(),duplicateLayer(_0x3f5755);});const _0x1fb0d5=document['createElement']('button');_0x1fb0d5['type']='button',_0x1fb0d5['className']='bs\x20icon-btn',_0x1fb0d5['title']='Move\x20up',_0x1fb0d5['setAttribute']('aria-label','Move\x20layer\x20up'),_0x1fb0d5['innerHTML']='<img\x20src=\x22/static/draw/images/icons/up-shevron.svg\x22\x20alt=\x22\x22\x20style=\x22pointer-events:none\x22\x20width=\x2218\x22\x20height=\x2218\x22>',_0x1fb0d5['addEventListener']('click',_0x3d5f16=>{_0x3d5f16['stopPropagation'](),clearTransformLockAll(),moveLayerUp(_0x3f5755);});const _0x1ef041=document['createElement']('button');_0x1ef041['type']='button',_0x1ef041['className']='bs\x20icon-btn',_0x1ef041['title']='Move\x20down',_0x1ef041['setAttribute']('aria-label','Move\x20layer\x20down'),_0x1ef041['innerHTML']='<img\x20src=\x22/static/draw/images/icons/down-shevron.svg\x22\x20alt=\x22\x22\x20style=\x22pointer-events:none\x22\x20width=\x2218\x22\x20height=\x2218\x22>',_0x1ef041['addEventListener']('click',_0x19dc60=>{_0x19dc60['stopPropagation'](),clearTransformLockAll(),moveLayerDown(_0x3f5755);}),_0x362dd7['appendChild'](_0x1eb748),_0x362dd7['appendChild'](_0x1fb0d5),_0x362dd7['appendChild'](_0x1ef041);const _0x4db40f=document['createElement']('div');_0x4db40f['className']='layer-opacity';const _0x101c38=document['createElement']('span');_0x101c38['textContent']='Opacity';const _0x5ad1dc=document['createElement']('input');_0x5ad1dc['type']='range',_0x5ad1dc['min']='0',_0x5ad1dc['max']='1',_0x5ad1dc['step']='0.01',_0x5ad1dc['value']=String(_0x2cd718['opacity']),['click','mousedown','touchstart','keydown']['forEach'](_0x4e0f54=>_0x5ad1dc['addEventListener'](_0x4e0f54,_0x582930=>_0x582930['stopPropagation']())),_0x5ad1dc['addEventListener']('input',()=>{clearTransformLockAll();const _0x776077=parseFloat(_0x5ad1dc['value']);Number['isNaN'](_0x776077)||_0x776077===_0x2cd718['opacity']||(_0x2cd718['opacity']=Math['max'](0x0,Math['min'](0x1,_0x776077)),needsRedraw=!0x0);}),_0x4db40f['appendChild'](_0x101c38),_0x4db40f['appendChild'](_0x5ad1dc),_0x197513['appendChild'](_0x596f7e),_0x197513['appendChild'](_0x1d12a4),_0x197513['appendChild'](_0x4c5cfb),_0x197513['appendChild'](_0x362dd7),_0x197513['appendChild'](_0x4db40f),_0x197513['addEventListener']('click',_0x57c78c=>{const _0x118370=!(!_0x57c78c['ctrlKey']&&!_0x57c78c['metaKey']),_0x4682eb=!!_0x57c78c['shiftKey'];if(clearTransformLockAll(),_0x4682eb)!function(_0x168f17){if(0x0===selectedLayerIndices['size'])return selectedLayerIndices['add'](_0x168f17),void(activeLayerIndex=_0x168f17);const _0x2133a1=activeLayerIndex??_0x168f17,_0x68e2a7=Math['min'](_0x2133a1,_0x168f17),_0x2cb72a=Math['max'](_0x2133a1,_0x168f17);selectedLayerIndices['clear']();for(let _0x59794b=_0x68e2a7;_0x59794b<=_0x2cb72a;_0x59794b++)selectedLayerIndices['add'](_0x59794b);activeLayerIndex=_0x168f17;}(_0x3f5755);else{if(!_0x118370)return void function(_0x305694,_0x544d6f){clearTransformLockAll(),activeLayerIndex=_0x305694,selectedLayerIndices['clear'](),selectedLayerIndices['add'](_0x305694),syncActiveAliases?.(),rebuildLayersUI(),showStatusMessage?.('Selected:\x20'+_0x544d6f['name'],'info'),needsRedraw=!0x0;}(_0x3f5755,_0x2cd718);_0x2386db(_0x3f5755,!0x0),activeLayerIndex=_0x3f5755;}document['querySelectorAll']('#layersList\x20.layer-item')['forEach'](_0xb149e0=>{const _0x28db32=Number(_0xb149e0['dataset']['index']);_0xb149e0['classList']['toggle']('is-selected',selectedLayerIndices['has'](_0x28db32)),_0xb149e0['classList']['toggle']('active',_0x28db32===activeLayerIndex);}),_0x46d5a8();}),_0x3f32de['insertBefore'](_0x197513,_0x3f32de['children'][0x1]||null);}),_0x46d5a8();}function clearActiveLayer(){const _0xd29604='function'==typeof getActiveLayer?getActiveLayer():layers?.[activeLayerIndex];if(!(gl&&_0xd29604&&_0xd29604['fbo']&&_0xd29604['texture']))return;const _0x310531=snapshotLayer(activeLayerIndex),_0x529792=0x0|fixedFBOWidth,_0x5c3996=0x0|fixedFBOHeight,_0x5b7f8a=gl['getParameter'](gl['FRAMEBUFFER_BINDING']),_0x45cf0a=gl['getParameter'](gl['VIEWPORT']);gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0xd29604['fbo']),gl['viewport'](0x0,0x0,_0x529792,_0x5c3996),gl['disable'](gl['BLEND']),gl['clearColor'](0x0,0x0,0x0,0x0),gl['clear'](gl['COLOR_BUFFER_BIT']),gl['bindTexture'](gl['TEXTURE_2D'],_0xd29604['texture']),(0x0|_0xd29604['texW'])===_0x529792&&(0x0|_0xd29604['texH'])===_0x5c3996||(gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],_0x529792,_0x5c3996,0x0,gl['RGBA'],gl['UNSIGNED_BYTE'],null),_0xd29604['texW']=_0x529792,_0xd29604['texH']=_0x5c3996,gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0xd29604['fbo']),gl['framebufferTexture2D'](gl['FRAMEBUFFER'],gl['COLOR_ATTACHMENT0'],gl['TEXTURE_2D'],_0xd29604['texture'],0x0)),gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x5b7f8a),_0x45cf0a&&gl['viewport'](_0x45cf0a[0x0],_0x45cf0a[0x1],_0x45cf0a[0x2],_0x45cf0a[0x3]);const _0x5d6482=snapshotLayer(activeLayerIndex);_0x310531&&_0x5d6482&&History['push']({'type':'clear_layer','index':activeLayerIndex,'before':_0x310531,'after':_0x5d6482}),needsRedraw=!0x0,requestDrawIfIdle?.(),showStatusMessage?.('Layer\x20cleared','info');}function removeActiveLayer(){if(layers['length']<=0x1)return void showStatusMessage('Need\x20at\x20least\x20one\x20layer','warning');const [_0x59258a]=layers['splice'](activeLayerIndex,0x1);gl['deleteTexture'](_0x59258a['texture']),gl['deleteFramebuffer'](_0x59258a['fbo']),activeLayerIndex=Math['max'](0x0,activeLayerIndex-0x1),syncActiveAliases(),rebuildLayersUI(),needsRedraw=!0x0;}function moveLayerUp(_0x48aab4){_0x48aab4>=layers['length']-0x1||([layers[_0x48aab4],layers[_0x48aab4+0x1]]=[layers[_0x48aab4+0x1],layers[_0x48aab4]],activeLayerIndex===_0x48aab4?activeLayerIndex=_0x48aab4+0x1:activeLayerIndex===_0x48aab4+0x1&&(activeLayerIndex=_0x48aab4),syncActiveAliases(),rebuildLayersUI(),needsRedraw=!0x0);}function moveLayerDown(_0x51e279){_0x51e279<=0x0||([layers[_0x51e279],layers[_0x51e279-0x1]]=[layers[_0x51e279-0x1],layers[_0x51e279]],activeLayerIndex===_0x51e279?activeLayerIndex=_0x51e279-0x1:activeLayerIndex===_0x51e279-0x1&&(activeLayerIndex=_0x51e279),syncActiveAliases(),rebuildLayersUI(),needsRedraw=!0x0);}function initFloodFillProgram(){floodFillProgram=createProgram(gl,'\x0a\x20\x20\x20\x20\x20\x20\x20\x20attribute\x20vec2\x20aPosition;\x0a\x20\x20\x20\x20\x20\x20\x20\x20varying\x20vec2\x20vTexCoord;\x0a\x20\x20\x20\x20\x20\x20\x20\x20void\x20main()\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20vTexCoord\x20=\x20(aPosition\x20+\x201.0)\x20*\x200.5;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20vec4(aPosition,\x200.0,\x201.0);\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20precision\x20mediump\x20float;\x0a\x20\x20\x20\x20\x20\x20\x20\x20varying\x20vec2\x20vTexCoord;\x0a\x20\x20\x20\x20\x20\x20\x20\x20uniform\x20sampler2D\x20uSource;\x0a\x20\x20\x20\x20\x20\x20\x20\x20uniform\x20vec4\x20uTargetColor;\x0a\x20\x20\x20\x20\x20\x20\x20\x20uniform\x20vec4\x20uFillColor;\x0a\x20\x20\x20\x20\x20\x20\x20\x20uniform\x20vec2\x20uTexelSize;\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20void\x20main()\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20vec4\x20current\x20=\x20texture2D(uSource,\x20vTexCoord);\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20float\x20threshold\x20=\x200.01;\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20bool\x20isTarget\x20=\x20distance(current,\x20uTargetColor)\x20<\x20threshold;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20bool\x20isFilled\x20=\x20distance(current,\x20uFillColor)\x20<\x20threshold;\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(isFilled)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20gl_FragColor\x20=\x20uFillColor;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20Check\x20neighbors:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20vec2\x20offsets[8];\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20offsets[0]\x20=\x20vec2(-uTexelSize.x,\x200.0);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20offsets[1]\x20=\x20vec2(uTexelSize.x,\x200.0);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20offsets[2]\x20=\x20vec2(0.0,\x20-uTexelSize.y);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20offsets[3]\x20=\x20vec2(0.0,\x20uTexelSize.y);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20offsets[4]\x20=\x20vec2(-uTexelSize.x,\x20-uTexelSize.y);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20offsets[5]\x20=\x20vec2(-uTexelSize.x,\x20uTexelSize.y);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20offsets[6]\x20=\x20vec2(uTexelSize.x,\x20-uTexelSize.y);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20offsets[7]\x20=\x20vec2(uTexelSize.x,\x20uTexelSize.y);\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20vec2\x20offsets[4];\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20offsets[0]\x20=\x20vec2(-uTexelSize.x,\x200.0);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20offsets[1]\x20=\x20vec2(uTexelSize.x,\x200.0);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20offsets[2]\x20=\x20vec2(0.0,\x20-uTexelSize.y);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20offsets[3]\x20=\x20vec2(0.0,\x20uTexelSize.y);\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20for\x20(int\x20i\x20=\x200;\x20i\x20<\x208;\x20i++)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20vec4\x20neighbor\x20=\x20texture2D(uSource,\x20vTexCoord\x20+\x20offsets[i]);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20bool\x20neighborFilled\x20=\x20distance(neighbor,\x20uFillColor)\x20<\x20threshold;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(neighborFilled\x20&&\x20isTarget)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20gl_FragColor\x20=\x20uFillColor;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20for\x20(int\x20i\x20=\x200;\x20i\x20<\x204;\x20i++)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20\x20\x20\x20\x20vec4\x20neighbor\x20=\x20texture2D(uSource,\x20vTexCoord\x20+\x20offsets[i]);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20\x20\x20\x20\x20bool\x20neighborFilled\x20=\x20distance(neighbor,\x20uFillColor)\x20<\x20threshold;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20\x20\x20\x20\x20if\x20(neighborFilled\x20&&\x20isTarget)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20\x20\x20\x20\x20\x20\x20\x20\x20gl_FragColor\x20=\x20uFillColor;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20\x20\x20\x20\x20\x20\x20\x20\x20return;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20gl_FragColor\x20=\x20current;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20');}function performFloodFill(_0xc1f40b,_0x58a239){const _0x291eed=getActiveLayer();if(!_0x291eed)return;const _0xeff1bf=snapshotLayer(activeLayerIndex),_0x37136c=Math['max'](0x0,Math['min'](fixedFBOWidth-0x1,Math['round'](_0xc1f40b))),_0x2d6959=Math['max'](0x0,Math['min'](fixedFBOHeight-0x1,Math['round'](_0x58a239))),_0x49f021=fixedFBOHeight-0x1-_0x2d6959,_0x73ad1d=new Uint8Array(0x4);gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x291eed['fbo']),gl['readPixels'](_0x37136c,_0x49f021,0x1,0x1,gl['RGBA'],gl['UNSIGNED_BYTE'],_0x73ad1d),gl['bindFramebuffer'](gl['FRAMEBUFFER'],null),runFloodFillShader(_0x291eed,[_0x73ad1d[0x0]/0xff,_0x73ad1d[0x1]/0xff,_0x73ad1d[0x2]/0xff,_0x73ad1d[0x3]/0xff],tintColor);const _0x12ba26=snapshotLayer(activeLayerIndex);History['push']({'type':'fill','before':_0xeff1bf,'after':_0x12ba26}),needsRedraw=!0x0;}function runFloodFillShader(_0x22675c,_0x435005,_0xd13c95){let _0x422777=fillFBO1,_0x2c1523=fillFBO2;gl['bindFramebuffer'](gl['READ_FRAMEBUFFER'],_0x22675c['fbo']),gl['bindFramebuffer'](gl['DRAW_FRAMEBUFFER'],_0x422777['fbo']),gl['viewport'](0x0,0x0,fixedFBOWidth,fixedFBOHeight),gl['blitFramebuffer'](0x0,0x0,fixedFBOWidth,fixedFBOHeight,0x0,0x0,fixedFBOWidth,fixedFBOHeight,gl['COLOR_BUFFER_BIT'],gl['NEAREST']);const _0x3ef3f0=new Float32Array([-0x1,-0x1,0x1,-0x1,-0x1,0x1,-0x1,0x1,0x1,-0x1,0x1,0x1]),_0xb8411c=gl['createBuffer']();gl['bindBuffer'](gl['ARRAY_BUFFER'],_0xb8411c),gl['bufferData'](gl['ARRAY_BUFFER'],_0x3ef3f0,gl['STATIC_DRAW']);const _0x564023=gl['getAttribLocation'](floodFillProgram,'aPosition');gl['enableVertexAttribArray'](_0x564023),gl['vertexAttribPointer'](_0x564023,0x2,gl['FLOAT'],!0x1,0x0,0x0);for(let _0x33dbc3=0x0;_0x33dbc3<0x32;_0x33dbc3++){gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x2c1523['fbo']),gl['viewport'](0x0,0x0,fixedFBOWidth,fixedFBOHeight),gl['useProgram'](floodFillProgram),gl['activeTexture'](gl['TEXTURE0']),gl['bindTexture'](gl['TEXTURE_2D'],_0x422777['texture']),gl['uniform1i'](gl['getUniformLocation'](floodFillProgram,'uSource'),0x0),gl['uniform4fv'](gl['getUniformLocation'](floodFillProgram,'uTargetColor'),_0x435005),gl['uniform4fv'](gl['getUniformLocation'](floodFillProgram,'uFillColor'),_0xd13c95),gl['uniform2f'](gl['getUniformLocation'](floodFillProgram,'uTexelSize'),0x1/fixedFBOWidth,0x1/fixedFBOHeight),gl['drawArrays'](gl['TRIANGLES'],0x0,0x6);let _0x226b67=_0x422777;_0x422777=_0x2c1523,_0x2c1523=_0x226b67;}gl['bindFramebuffer'](gl['READ_FRAMEBUFFER'],_0x422777['fbo']),gl['bindFramebuffer'](gl['DRAW_FRAMEBUFFER'],_0x22675c['fbo']),gl['viewport'](0x0,0x0,fixedFBOWidth,fixedFBOHeight),gl['blitFramebuffer'](0x0,0x0,fixedFBOWidth,fixedFBOHeight,0x0,0x0,fixedFBOWidth,fixedFBOHeight,gl['COLOR_BUFFER_BIT'],gl['NEAREST']),gl['disableVertexAttribArray'](_0x564023),gl['deleteBuffer'](_0xb8411c),gl['bindFramebuffer'](gl['FRAMEBUFFER'],null);}function createFBO(_0x1cc332,_0x5ec89b){const _0x5dbc1c=gl['createTexture']();gl['bindTexture'](gl['TEXTURE_2D'],_0x5dbc1c),gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],_0x1cc332,_0x5ec89b,0x0,gl['RGBA'],gl['UNSIGNED_BYTE'],null),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MIN_FILTER'],gl['NEAREST']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MAG_FILTER'],gl['NEAREST']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_S'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_T'],gl['CLAMP_TO_EDGE']);const _0x32b86f=gl['createFramebuffer']();return gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x32b86f),gl['framebufferTexture2D'](gl['FRAMEBUFFER'],gl['COLOR_ATTACHMENT0'],gl['TEXTURE_2D'],_0x5dbc1c,0x0),gl['bindFramebuffer'](gl['FRAMEBUFFER'],null),{'fbo':_0x32b86f,'texture':_0x5dbc1c};}!(function(){function _0x4fc104(_0x36a3da){if('function'==typeof isUserTyping&&isUserTyping())return;const _0x945598=_0x36a3da['key'];!('Delete'===_0x945598)&&!('Backspace'===_0x945598)||_0x36a3da['metaKey']||_0x36a3da['ctrlKey']||_0x36a3da['altKey']||(_0x36a3da['preventDefault'](),clearActiveLayer());}try{document['removeEventListener']('keydown',_0x4fc104,!0x0);}catch{}document['addEventListener']('keydown',_0x4fc104,!0x0);}()),document['getElementById']('addLayerBtn')['addEventListener']('click',()=>{addLayer('Layer\x20'+(layers['length']+0x1),activeLayerIndex);}),document['getElementById']('removeLayerBtn')['addEventListener']('click',()=>{removeActiveLayer();}),(function(){const _0x1147da=document['getElementById']('addLayerBtn');if(_0x1147da){try{document['removeEventListener']('keydown',_0x1b7360,!0x0);}catch{}document['addEventListener']('keydown',_0x1b7360,!0x0);}function _0x1b7360(_0x30457e){if('function'==typeof isUserTyping&&isUserTyping())return;if(_0x30457e['metaKey']||_0x30457e['ctrlKey']||_0x30457e['altKey'])return;const _0xd10998=_0x30457e['key']||'';'n'!==_0xd10998&&'N'!==_0xd10998||(_0x30457e['preventDefault'](),(function(){try{_0x1147da['click'](),console['log']('[Shortcut]\x20New\x20Layer\x20via\x20\x27n\x27\x20→\x20addBtn.click()');}catch(_0x57a8a8){try{const _0xfb70e2='Layer\x20'+(layers['length']+0x1),_0x2d2640='number'==typeof activeLayerIndex?activeLayerIndex:layers['length']-0x1;addLayer(_0xfb70e2,_0x2d2640),console['log']('[Shortcut]\x20New\x20Layer\x20fallback\x20→\x20addLayer()',{'name':_0xfb70e2,'insertBelowIndex':_0x2d2640});}catch(_0x16ba4b){console['warn']('[Shortcut]\x20New\x20Layer\x20failed',_0x16ba4b);}}}()));}}()),document['addEventListener']('keydown',_0x169273=>{if(isUserTyping())return;if(spacePanning||isDrawing)return;if(_0x169273['ctrlKey']||_0x169273['metaKey']||_0x169273['altKey'])return;if('x'===_0x169273['key']['toLowerCase']()||'Delete'===_0x169273['key']){if(_0x169273['preventDefault'](),_0x169273['stopImmediatePropagation'](),transformTool?.['mode']&&'idle'!==transformTool['mode']&&endTransform(!0x1),layers['length']<=0x1)return void showStatusMessage('Need\x20at\x20least\x20one\x20layer','warning');const _0x462094=layers[activeLayerIndex]?.['name']||'Layer';removeActiveLayer(),showStatusMessage('Deleted:\x20'+_0x462094,'success');}},{'capture':!0x0});let fillFBO1=null,fillFBO2=null;function initFloodFBOs(){fillFBO1&&(gl['deleteTexture'](fillFBO1['texture']),gl['deleteFramebuffer'](fillFBO1['fbo'])),fillFBO2&&(gl['deleteTexture'](fillFBO2['texture']),gl['deleteFramebuffer'](fillFBO2['fbo'])),fillFBO1=createFBO(fixedFBOWidth,fixedFBOHeight),fillFBO2=createFBO(fixedFBOWidth,fixedFBOHeight);}let strokeCount=0x0;const FLATTEN_THRESHOLD=isMobile()?0x32:0x96;function flattenStrokes(){const _0x1b2245=getActiveLayer?.();if(!(gl&&_0x1b2245&&_0x1b2245['texture']&&quadProgram))return;const _0x2eac4b=Math['max'](0x1,0x0|_0x1b2245['texW']),_0x4a2b6a=Math['max'](0x1,0x0|_0x1b2245['texH']),_0x135dc2=gl['getParameter'](gl['FRAMEBUFFER_BINDING']),_0xb7a896=gl['getParameter'](gl['CURRENT_PROGRAM']),_0x33ae7d=gl['getParameter'](gl['VIEWPORT']),_0x53821d=gl['createTexture']();gl['bindTexture'](gl['TEXTURE_2D'],_0x53821d),gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],_0x2eac4b,_0x4a2b6a,0x0,gl['RGBA'],gl['UNSIGNED_BYTE'],null),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MIN_FILTER'],gl['NEAREST']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MAG_FILTER'],gl['NEAREST']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_S'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_T'],gl['CLAMP_TO_EDGE']);const _0xc2f67a=gl['createFramebuffer']();gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0xc2f67a),gl['framebufferTexture2D'](gl['FRAMEBUFFER'],gl['COLOR_ATTACHMENT0'],gl['TEXTURE_2D'],_0x53821d,0x0),gl['viewport'](0x0,0x0,_0x2eac4b,_0x4a2b6a),gl['disable'](gl['BLEND']),gl['clearColor'](0x0,0x0,0x0,0x0),gl['clear'](gl['COLOR_BUFFER_BIT']),gl['useProgram'](quadProgram);const _0x2511a8=gl['getUniformLocation'](quadProgram,'u_flipY');_0x2511a8&&gl['uniform1f'](_0x2511a8,0x1);const _0x121954=gl['getUniformLocation'](quadProgram,'u_resolution');_0x121954&&gl['uniform2f'](_0x121954,_0x2eac4b,_0x4a2b6a);const _0x4b476d=gl['getUniformLocation'](quadProgram,'u_layerOpacity');_0x4b476d&&gl['uniform1f'](_0x4b476d,0x1);const _0x241cd6=gl['getUniformLocation'](quadProgram,'u_texture'),_0x2c51b6=new Float32Array([0x0,0x0,0x0,0x0,_0x2eac4b,0x0,0x1,0x0,0x0,_0x4a2b6a,0x0,0x1,0x0,_0x4a2b6a,0x0,0x1,_0x2eac4b,0x0,0x1,0x0,_0x2eac4b,_0x4a2b6a,0x1,0x1]),_0x5b7710=gl['createBuffer']();gl['bindBuffer'](gl['ARRAY_BUFFER'],_0x5b7710),gl['bufferData'](gl['ARRAY_BUFFER'],_0x2c51b6,gl['STREAM_DRAW']);const _0x56b6bf=gl['getAttribLocation'](quadProgram,'a_position'),_0x3235c3=gl['getAttribLocation'](quadProgram,'a_texCoord');gl['enableVertexAttribArray'](_0x56b6bf),gl['vertexAttribPointer'](_0x56b6bf,0x2,gl['FLOAT'],!0x1,0x10,0x0),gl['enableVertexAttribArray'](_0x3235c3),gl['vertexAttribPointer'](_0x3235c3,0x2,gl['FLOAT'],!0x1,0x10,0x8),gl['activeTexture'](gl['TEXTURE0']),gl['bindTexture'](gl['TEXTURE_2D'],_0x1b2245['texture']),_0x241cd6&&gl['uniform1i'](_0x241cd6,0x0),gl['drawArrays'](gl['TRIANGLES'],0x0,0x6),gl['disableVertexAttribArray'](_0x56b6bf),gl['disableVertexAttribArray'](_0x3235c3),gl['bindBuffer'](gl['ARRAY_BUFFER'],null),gl['deleteBuffer'](_0x5b7710);const _0x2b8e2d=_0x1b2245['texture'],_0x3678b9=_0x1b2245['fbo'];_0x1b2245['texture']=_0x53821d,_0x1b2245['fbo']=_0xc2f67a;try{_0x2b8e2d&&gl['deleteTexture'](_0x2b8e2d);}catch{}try{_0x3678b9&&gl['deleteFramebuffer'](_0x3678b9);}catch{}try{strokeCount=0x0;}catch{}gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x135dc2),gl['useProgram'](_0xb7a896),_0x33ae7d&&gl['viewport'](_0x33ae7d[0x0],_0x33ae7d[0x1],_0x33ae7d[0x2],_0x33ae7d[0x3]),needsRedraw=!0x0,requestDrawIfIdle?.();}let currentAngle=0x0,sharedBuffer=null;function createPaperImage(_0x49aa6e,_0x492ace){return new Promise((_0x5717ac,_0x4daff1)=>{try{const _0x582f14=document['createElement']('canvas');_0x582f14['width']=Math['max'](0x1,Math['floor'](_0x49aa6e)),_0x582f14['height']=Math['max'](0x1,Math['floor'](_0x492ace));const _0x432e4d=_0x582f14['getContext']('2d');_0x432e4d['fillStyle']='#f2efe4',_0x432e4d['fillRect'](0x0,0x0,_0x582f14['width'],_0x582f14['height']);const _0x49ac7c=document['createElement']('canvas');_0x49ac7c['width']=_0x582f14['width'],_0x49ac7c['height']=_0x582f14['height'];const _0x57a25e=_0x49ac7c['getContext']('2d'),_0x548491=_0x57a25e['createImageData'](_0x49ac7c['width'],_0x49ac7c['height']);for(let _0x140d5c=0x0;_0x140d5c<_0x548491['data']['length'];_0x140d5c+=0x4){const _0x30cbf8=0x32*Math['random']()-0x19;_0x548491['data'][_0x140d5c]=0xf0+_0x30cbf8,_0x548491['data'][_0x140d5c+0x1]=0xeb+_0x30cbf8,_0x548491['data'][_0x140d5c+0x2]=0xe1+_0x30cbf8,_0x548491['data'][_0x140d5c+0x3]=0xff;}_0x57a25e['putImageData'](_0x548491,0x0,0x0),_0x432e4d['globalAlpha']=0.2,_0x432e4d['drawImage'](_0x49ac7c,0x0,0x0),_0x432e4d['globalAlpha']=0x1;const _0x376d64=document['createElement']('canvas');_0x376d64['width']=_0x582f14['width'],_0x376d64['height']=_0x582f14['height'];const _0x541deb=_0x376d64['getContext']('2d'),_0x855820=_0x541deb['createImageData'](_0x376d64['width'],_0x376d64['height']);for(let _0x193af2=0x0;_0x193af2<_0x855820['data']['length'];_0x193af2+=0x4){const _0x403cdb=0xff*Math['random']();_0x855820['data'][_0x193af2]=_0x403cdb,_0x855820['data'][_0x193af2+0x1]=_0x403cdb,_0x855820['data'][_0x193af2+0x2]=_0x403cdb,_0x855820['data'][_0x193af2+0x3]=0x5a*Math['random']();}_0x541deb['putImageData'](_0x855820,0x0,0x0),_0x432e4d['globalAlpha']=0.08,_0x432e4d['drawImage'](_0x376d64,0x0,0x0),_0x432e4d['globalAlpha']=0x1;const _0x196537=_0x432e4d['createRadialGradient'](_0x582f14['width']/0x2,_0x582f14['height']/0x2,0.3*Math['min'](_0x582f14['width'],_0x582f14['height']),_0x582f14['width']/0x2,_0x582f14['height']/0x2,0.6*Math['max'](_0x582f14['width'],_0x582f14['height']));_0x196537['addColorStop'](0x0,'rgba(0,0,0,0)'),_0x196537['addColorStop'](0x1,'rgba(0,0,0,0.35)'),_0x432e4d['globalAlpha']=0.3,_0x432e4d['fillStyle']=_0x196537,_0x432e4d['fillRect'](0x0,0x0,_0x582f14['width'],_0x582f14['height']),_0x432e4d['globalAlpha']=0x1;const _0x3f1b10=new Image();_0x3f1b10['onload']=()=>_0x5717ac(_0x3f1b10),_0x3f1b10['onerror']=_0x4daff1,_0x3f1b10['src']=_0x582f14['toDataURL']('image/png');}catch(_0x19715a){_0x4daff1(_0x19715a);}});}async function resetToBasePaper(){const _0xea4198=Number(fixedFBOWidth)>0x0?fixedFBOWidth:window['innerWidth'],_0x5d70d0=Number(fixedFBOHeight)>0x0?fixedFBOHeight:window['innerHeight'],_0x40d3f6=await createPaperImage(_0xea4198,_0x5d70d0);currentImage=_0x40d3f6,fixedFBOWidth=_0x40d3f6['width'],fixedFBOHeight=_0x40d3f6['height'],initPaintLayerFixed(),initFloodFBOs?.(),updateCanvasSize(_0x40d3f6),createTextureFromImage(_0x40d3f6),canvas['offsetWidth'],canvasWrapper['offsetWidth'],zoomScale=0x1,panX=(canvasWrapper['clientWidth']-canvas['width'])/0x2,panY=(canvasWrapper['clientHeight']-canvas['height'])/0x2,viewRotation=0x0,updateCanvasTransform(),resetStrokeState?.(),rebuildLayersUI?.(),needsRedraw=!0x0,requestDrawIfIdle?.();}async function clearProject(){try{console['log']('[ClearProject]\x20begin');const _0xa92aec=History['_captureProject']?.();try{Array['isArray'](layers)&&layers['forEach'](_0x123b01=>{try{gl['deleteTexture'](_0x123b01['texture']);}catch{}try{gl['deleteFramebuffer'](_0x123b01['fbo']);}catch{}});}catch(_0x2b5cec){console['warn']('[ClearProject]\x20disposing\x20old\x20layers\x20warning:',_0x2b5cec);}await resetToBasePaper();const _0x565e07=History['_captureProject']?.();History['push']({'type':'clear_project','beforeAll':_0xa92aec,'afterAll':_0x565e07}),showStatusMessage?.('Project\x20cleared\x20to\x20base\x20paper','success'),console['log']('[ClearProject]\x20done');}catch(_0x25fb0f){console['error']('[ClearProject]\x20fatal\x20error:',_0x25fb0f),showStatusMessage?.('Clear\x20failed','error');}}((()=>{const _0x5c6bd1=document['getElementById']('cleanButton');_0x5c6bd1?_0x5c6bd1['addEventListener']('click',()=>{console['log']('[ClearProject]\x20click'),clearProject();try{saveAutosaveDebounced?.(0x190);}catch{}}):console['warn']('[ClearProject]\x20\x22#cleanButton\x22\x20not\x20found;\x20binding\x20skipped.');})());const UNDO_LIMIT=isMobile()?0x32:0xc8;function createTextureAndFBO(_0x3b576e,_0x3365c9,_0x5186e9=gl['NEAREST']){const _0x3e9e5c=gl['createTexture']();gl['bindTexture'](gl['TEXTURE_2D'],_0x3e9e5c),gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],_0x3b576e,_0x3365c9,0x0,gl['RGBA'],gl['UNSIGNED_BYTE'],null),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MIN_FILTER'],_0x5186e9),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MAG_FILTER'],_0x5186e9),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_S'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_T'],gl['CLAMP_TO_EDGE']);const _0x1b483d=gl['createFramebuffer']();return gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x1b483d),gl['framebufferTexture2D'](gl['FRAMEBUFFER'],gl['COLOR_ATTACHMENT0'],gl['TEXTURE_2D'],_0x3e9e5c,0x0),gl['bindFramebuffer'](gl['FRAMEBUFFER'],null),gl['bindTexture'](gl['TEXTURE_2D'],null),{'texture':_0x3e9e5c,'fbo':_0x1b483d};}function blitFBOtoFBO(_0x4cf023,_0x417264,_0x5a610c=fixedFBOWidth,_0x423aee=fixedFBOHeight){gl['bindFramebuffer'](gl['READ_FRAMEBUFFER'],_0x4cf023),gl['bindFramebuffer'](gl['DRAW_FRAMEBUFFER'],_0x417264),gl['blitFramebuffer'](0x0,0x0,_0x5a610c,_0x423aee,0x0,0x0,_0x5a610c,_0x423aee,gl['COLOR_BUFFER_BIT'],gl['NEAREST']),gl['bindFramebuffer'](gl['READ_FRAMEBUFFER'],null),gl['bindFramebuffer'](gl['DRAW_FRAMEBUFFER'],null);}function applySnapshotToLayer(_0x39d0b3,_0x31d076){const _0x1e9265=layers?.[_0x39d0b3];if(!gl||!_0x1e9265||!_0x31d076)return;const _0x4378af=0x0|_0x31d076['w'],_0x3b81c3=0x0|_0x31d076['h'];_0x1e9265['texture']?gl['bindTexture'](gl['TEXTURE_2D'],_0x1e9265['texture']):(_0x1e9265['texture']=gl['createTexture'](),gl['bindTexture'](gl['TEXTURE_2D'],_0x1e9265['texture']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MIN_FILTER'],gl['NEAREST']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MAG_FILTER'],gl['NEAREST']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_S'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_T'],gl['CLAMP_TO_EDGE'])),_0x1e9265['fbo']||(_0x1e9265['fbo']=gl['createFramebuffer']()),gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x1e9265['fbo']),gl['framebufferTexture2D'](gl['FRAMEBUFFER'],gl['COLOR_ATTACHMENT0'],gl['TEXTURE_2D'],_0x1e9265['texture'],0x0),void 0x0!==gl['UNPACK_FLIP_Y_WEBGL']&&gl['pixelStorei'](gl['UNPACK_FLIP_Y_WEBGL'],0x0),gl['pixelStorei'](gl['UNPACK_ALIGNMENT'],0x1),(0x0|_0x1e9265['texW'])!==_0x4378af||(0x0|_0x1e9265['texH'])!==_0x3b81c3?(gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],_0x4378af,_0x3b81c3,0x0,gl['RGBA'],gl['UNSIGNED_BYTE'],_0x31d076['pixels']),_0x1e9265['texW']=_0x4378af,_0x1e9265['texH']=_0x3b81c3):gl['texSubImage2D'](gl['TEXTURE_2D'],0x0,0x0,0x0,_0x4378af,_0x3b81c3,gl['RGBA'],gl['UNSIGNED_BYTE'],_0x31d076['pixels']),needsRedraw=!0x0,requestDrawIfIdle?.();}function snapshotLayer(_0x50cd7a){const _0x56543b=layers?.[_0x50cd7a];if(!gl||!_0x56543b||!_0x56543b['fbo'])return null;const _0x52e7d5=0x0|fixedFBOWidth,_0x27ea60=0x0|fixedFBOHeight,_0x1647f4=gl['getParameter'](gl['FRAMEBUFFER_BINDING']),_0x320a44=gl['getParameter'](gl['VIEWPORT']);gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x56543b['fbo']),gl['viewport'](0x0,0x0,_0x52e7d5,_0x27ea60);const _0x393c6a=new Uint8Array(_0x52e7d5*_0x27ea60*0x4);return gl['readPixels'](0x0,0x0,_0x52e7d5,_0x27ea60,gl['RGBA'],gl['UNSIGNED_BYTE'],_0x393c6a),gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x1647f4),_0x320a44&&gl['viewport'](_0x320a44[0x0],_0x320a44[0x1],_0x320a44[0x2],_0x320a44[0x3]),{'index':_0x50cd7a,'w':_0x52e7d5,'h':_0x27ea60,'pixels':_0x393c6a};}function applyLayerTransformState(_0x43623e,_0x48fe71){const _0x12669d=layers?.[_0x43623e];_0x12669d&&_0x48fe71&&(_0x12669d['x']=_0x48fe71['x'],_0x12669d['y']=_0x48fe71['y'],_0x12669d['scaleX']=_0x48fe71['scaleX'],_0x12669d['scaleY']=_0x48fe71['scaleY'],_0x12669d['rotation']=_0x48fe71['rotation'],_0x12669d['px']=_0x48fe71['px'],_0x12669d['py']=_0x48fe71['py'],_0x12669d['ox']=_0x48fe71['ox'],_0x12669d['oy']=_0x48fe71['oy'],_0x12669d['texW']=_0x48fe71['texW'],_0x12669d['texH']=_0x48fe71['texH'],'number'==typeof _0x48fe71['opacity']&&(_0x12669d['opacity']=_0x48fe71['opacity']),'boolean'==typeof _0x48fe71['visible']&&(_0x12669d['visible']=_0x48fe71['visible']),needsRedraw=!0x0,requestDrawIfIdle?.());}function endTransformHistory(_0x441078=activeLayerIndex){if(!__transformBefore)return;const _0x4da92f=getLayerTransformState(_0x441078),_0x4d8d22=__transformBefore;(_0x4d8d22['x']!==_0x4da92f['x']||_0x4d8d22['y']!==_0x4da92f['y']||_0x4d8d22['scaleX']!==_0x4da92f['scaleX']||_0x4d8d22['scaleY']!==_0x4da92f['scaleY']||_0x4d8d22['rotation']!==_0x4da92f['rotation']||_0x4d8d22['px']!==_0x4da92f['px']||_0x4d8d22['py']!==_0x4da92f['py']||_0x4d8d22['ox']!==_0x4da92f['ox']||_0x4d8d22['oy']!==_0x4da92f['oy']||_0x4d8d22['texW']!==_0x4da92f['texW']||_0x4d8d22['texH']!==_0x4da92f['texH']||_0x4d8d22['opacity']!==_0x4da92f['opacity']||_0x4d8d22['visible']!==_0x4da92f['visible'])&&History['push']({'type':'layer_transform','index':_0x441078,'before':_0x4d8d22,'after':_0x4da92f}),__transformBefore=null;}let __transformBefore=null;function beginTransformHistory(_0x193d42=activeLayerIndex){__transformBefore=getLayerTransformState(_0x193d42);}function getLayerTransformState(_0x189717){const _0x3650a8=layers?.[_0x189717];return _0x3650a8?{'x':_0x3650a8['x']||0x0,'y':_0x3650a8['y']||0x0,'scaleX':'number'==typeof _0x3650a8['scaleX']?_0x3650a8['scaleX']:0x1,'scaleY':'number'==typeof _0x3650a8['scaleY']?_0x3650a8['scaleY']:0x1,'rotation':_0x3650a8['rotation']||0x0,'px':'number'==typeof _0x3650a8['px']?_0x3650a8['px']:0.5*fixedFBOWidth,'py':'number'==typeof _0x3650a8['py']?_0x3650a8['py']:0.5*fixedFBOHeight,'ox':_0x3650a8['ox']||0x0,'oy':_0x3650a8['oy']||0x0,'texW':_0x3650a8['texW']||fixedFBOWidth,'texH':_0x3650a8['texH']||fixedFBOHeight,'opacity':'number'==typeof _0x3650a8['opacity']?_0x3650a8['opacity']:0x1,'visible':'boolean'!=typeof _0x3650a8['visible']||_0x3650a8['visible']}:null;}function restoreLayerSnapshot(_0xd92d8c){if(!_0xd92d8c)return;const _0x4c079b='number'==typeof _0xd92d8c['index']?_0xd92d8c['index']:activeLayerIndex;layers[_0x4c079b]&&applySnapshotToLayer(_0x4c079b,_0xd92d8c);}function disposeSnapshot(_0x24ae6c){try{_0x24ae6c?.['texture']&&gl['deleteTexture'](_0x24ae6c['texture']),_0x24ae6c?.['fbo']&&gl['deleteFramebuffer'](_0x24ae6c['fbo']);}catch(_0x5a80ea){console['warn']('disposeSnapshot',_0x5a80ea);}}const History={'stack':[],'redo':[],'limit':UNDO_LIMIT,'push'(_0xefb6f8){this['stack']['push'](_0xefb6f8),this['stack']['length']>this['limit']&&this['_dispose'](this['stack']['shift']()),this['redo']['length']=0x0,console['log']('[History]\x20push',_0xefb6f8['type']);},'undo'(){const _0x3bfc0d=this['stack']['pop']();if(_0x3bfc0d){this['_applyInverse'](_0x3bfc0d),this['redo']['push'](_0x3bfc0d);try{gl['flush']?.();}catch{}needsRedraw=!0x0,requestDrawIfIdle?.(),showStatusMessage?.('Undo','info'),console['log']('[History]\x20undo',_0x3bfc0d['type']);}},'redoDo'(){const _0x27e540=this['redo']['pop']();if(_0x27e540){this['_apply'](_0x27e540),this['stack']['push'](_0x27e540);try{gl['flush']?.();}catch{}needsRedraw=!0x0,requestDrawIfIdle?.(),showStatusMessage?.('Redo','info'),console['log']('[History]\x20redo',_0x27e540['type']);}},'_dispose'(_0x48ed03){if(!_0x48ed03)return;const _0x37e27b=_0x364824=>{_0x364824&&_0x364824['pixels']&&(_0x364824['pixels']=null);};if(_0x37e27b(_0x48ed03['before']),_0x37e27b(_0x48ed03['after']),_0x48ed03['removedLayer']&&_0x37e27b(_0x48ed03['removedLayer']['snapshot']),_0x48ed03['addedLayer']&&_0x37e27b(_0x48ed03['addedLayer']['snapshot']),'merge_layers'===_0x48ed03['type']&&(_0x48ed03['added']?.['data']&&_0x37e27b(_0x48ed03['added']['data']['snapshot']),Array['isArray'](_0x48ed03['removed']))){for(const _0x222db4 of _0x48ed03['removed'])_0x37e27b(_0x222db4?.['data']?.['snapshot']);}},'_apply'(_0xa4d2cc){switch(_0xa4d2cc['type']){case'stroke':case'fill':case'transform_bake':_0xa4d2cc['after']&&restoreLayerSnapshot(_0xa4d2cc['after']);break;case'layer_visibility':layers[_0xa4d2cc['index']]['visible']=_0xa4d2cc['next'];break;case'layer_opacity':layers[_0xa4d2cc['index']]['opacity']=_0xa4d2cc['next'];break;case'layer_rename':layers[_0xa4d2cc['index']]['name']=_0xa4d2cc['next'],rebuildLayersUI?.();break;case'layer_move':this['_moveLayer'](_0xa4d2cc['from'],_0xa4d2cc['to']);break;case'add_layer':this['_insertLayer'](_0xa4d2cc['index'],_0xa4d2cc['addedLayer']);break;case'remove_layer':this['_removeLayerAt'](_0xa4d2cc['index']);break;case'clear_project':this['_restoreProject'](_0xa4d2cc['afterAll']);break;case'merge_layers':{if(!Array['isArray'](_0xa4d2cc['removed'])||!_0xa4d2cc['added'])break;const _0x1a82f5=_0xa4d2cc['removed']['map'](_0x56f9bd=>_0x56f9bd['index'])['sort']((_0x93f479,_0x39527f)=>_0x39527f-_0x93f479);for(const _0x981ea9 of _0x1a82f5)this['_removeLayerAt'](_0x981ea9);this['_insertLayer'](_0xa4d2cc['added']['index'],_0xa4d2cc['added']['data']),activeLayerIndex=_0xa4d2cc['added']['index'],syncActiveAliases?.(),rebuildLayersUI?.();break;}case'layer_transform':applyLayerTransformState(_0xa4d2cc['index'],_0xa4d2cc['after']);}},'_applyInverse'(_0x2bd845){switch(_0x2bd845['type']){case'stroke':case'fill':case'transform_bake':_0x2bd845['before']&&restoreLayerSnapshot(_0x2bd845['before']);break;case'layer_visibility':layers[_0x2bd845['index']]['visible']=_0x2bd845['prev'];break;case'layer_opacity':layers[_0x2bd845['index']]['opacity']=_0x2bd845['prev'];break;case'layer_rename':layers[_0x2bd845['index']]['name']=_0x2bd845['prev'],rebuildLayersUI?.();break;case'layer_move':this['_moveLayer'](_0x2bd845['to'],_0x2bd845['from']);break;case'add_layer':this['_removeLayerAt'](_0x2bd845['index']);break;case'remove_layer':this['_insertLayer'](_0x2bd845['index'],_0x2bd845['removedLayer']);break;case'clear_project':this['_restoreProject'](_0x2bd845['beforeAll']);break;case'merge_layers':if(_0x2bd845['added']&&this['_removeLayerAt'](_0x2bd845['added']['index']),Array['isArray'](_0x2bd845['removed'])){const _0x364f4f=_0x2bd845['removed']['slice']()['sort']((_0x193961,_0x4362f3)=>_0x193961['index']-_0x4362f3['index']);for(const _0x637a7b of _0x364f4f)this['_insertLayer'](_0x637a7b['index'],_0x637a7b['data']);activeLayerIndex=_0x364f4f[_0x364f4f['length']-0x1]?.['index']??0x0,syncActiveAliases?.(),rebuildLayersUI?.();}break;case'layer_transform':applyLayerTransformState(_0x2bd845['index'],_0x2bd845['before']);}},'_moveLayer'(_0x48d9f2,_0x1c7da4){if(_0x48d9f2===_0x1c7da4)return;const _0x277cc8=layers['splice'](_0x48d9f2,0x1)[0x0];layers['splice'](_0x1c7da4,0x0,_0x277cc8),activeLayerIndex=_0x1c7da4,syncActiveAliases?.(),rebuildLayersUI?.();},'_removeLayerAt'(_0x1791d2){const _0x7dc42b=layers[_0x1791d2];if(_0x7dc42b){try{gl['deleteTexture'](_0x7dc42b['texture']);}catch{}try{gl['deleteFramebuffer'](_0x7dc42b['fbo']);}catch{}layers['splice'](_0x1791d2,0x1),activeLayerIndex=Math['max'](0x0,Math['min'](activeLayerIndex,layers['length']-0x1)),syncActiveAliases?.(),rebuildLayersUI?.();}},'_insertLayer'(_0x2338b1,_0x552b65){const _0x1eed66={'id':Date['now']()+Math['random'](),'name':_0x552b65?.['name']??'Layer','visible':_0x552b65?.['visible']??!0x0,'opacity':_0x552b65?.['opacity']??0x1,'ox':0x0,'oy':0x0,'texW':fixedFBOWidth,'texH':fixedFBOHeight,'x':0x0,'y':0x0,'scaleX':0x1,'scaleY':0x1,'rotation':0x0,'px':0.5*fixedFBOWidth,'py':0.5*fixedFBOHeight,'texture':null,'fbo':null},_0x54c3f7=createLayerFBO(fixedFBOWidth,fixedFBOHeight);_0x1eed66['texture']=_0x54c3f7['texture'],_0x1eed66['fbo']=_0x54c3f7['fbo'],layers['splice'](_0x2338b1,0x0,_0x1eed66),_0x552b65?.['snapshot']&&_0x552b65['snapshot']['pixels']?applySnapshotToLayer(_0x2338b1,_0x552b65['snapshot']):(gl['bindTexture'](gl['TEXTURE_2D'],_0x1eed66['texture']),gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],fixedFBOWidth,fixedFBOHeight,0x0,gl['RGBA'],gl['UNSIGNED_BYTE'],null),_0x1eed66['texW']=fixedFBOWidth,_0x1eed66['texH']=fixedFBOHeight),activeLayerIndex=_0x2338b1,syncActiveAliases?.(),rebuildLayersUI?.();},'_captureProject':()=>({'w':fixedFBOWidth,'h':fixedFBOHeight,'layers':layers['map']((_0x1ad5f1,_0xbc6200)=>({'index':_0xbc6200,'name':_0x1ad5f1['name'],'visible':_0x1ad5f1['visible'],'opacity':_0x1ad5f1['opacity'],'snapshot':snapshotLayer(_0xbc6200)})),'background':((()=>{try{if(!currentImage)return null;const _0x15ee40=document['createElement']('canvas');return _0x15ee40['width']=fixedFBOWidth,_0x15ee40['height']=fixedFBOHeight,(_0x15ee40['getContext']('2d')['drawImage'](currentImage,0x0,0x0,fixedFBOWidth,fixedFBOHeight),_0x15ee40['toDataURL']('image/png'));}catch{return null;}})())}),'_restoreProject'(_0x21fddf){if(_0x21fddf)try{for(const _0xae42b of layers){try{gl['deleteTexture'](_0xae42b['texture']);}catch{}try{gl['deleteFramebuffer'](_0xae42b['fbo']);}catch{}}if(layers=[],_0x21fddf['background']){const _0x47dc29=new Image();_0x47dc29['onload']=()=>{currentImage=_0x47dc29,updateCanvasSize(_0x47dc29),createTextureFromImage(_0x47dc29),needsRedraw=!0x0,requestDrawIfIdle?.();},_0x47dc29['src']=_0x21fddf['background'];}else currentImage=null,texture=null;for(const _0x37d0a4 of _0x21fddf['layers'])this['_insertLayer'](layers['length'],{'name':_0x37d0a4['name'],'visible':_0x37d0a4['visible'],'opacity':_0x37d0a4['opacity'],'snapshot':_0x37d0a4['snapshot']});activeLayerIndex=Math['max'](0x0,layers['length']-0x1),syncActiveAliases?.(),rebuildLayersUI?.(),needsRedraw=!0x0,requestDrawIfIdle?.();}catch(_0x388342){console['error']('[History]\x20_restoreProject\x20failed:',_0x388342);}}};let __strokeBeforeSnap=null,__strokeInProgress=!0x1;function beginStrokeHistory(){try{if(__strokeInProgress)return;const _0x5d7e90=getActiveLayer?.();if(!_0x5d7e90)return;__strokeInProgress=!0x0,__strokeBeforeSnap=snapshotLayer(activeLayerIndex),console['log']('[History]\x20begin\x20stroke\x20on\x20layer',activeLayerIndex);}catch(_0x5b7cfa){console['warn']('beginStrokeHistory',_0x5b7cfa),__strokeInProgress=!0x1,__strokeBeforeSnap=null;}}function endStrokeHistory(_0x6bd6df='stroke'){try{const _0xebfc2a=getActiveLayer?.();if(!_0xebfc2a||!__strokeInProgress||!__strokeBeforeSnap)return __strokeInProgress=!0x1,void(__strokeBeforeSnap=null);requestAnimationFrame(()=>{try{gl['flush']?.(),gl['finish']?.();const _0x4b4825=snapshotLayer(activeLayerIndex);!function(_0x3157dd,_0x5aea36){if(!_0x3157dd||!_0x5aea36)return!0x1;if(_0x3157dd['w']!==_0x5aea36['w']||_0x3157dd['h']!==_0x5aea36['h'])return!0x1;const _0x2a4449=_0x3157dd['pixels'],_0xde254f=_0x5aea36['pixels'];if(!_0x2a4449||!_0xde254f||_0x2a4449['length']!==_0xde254f['length'])return!0x1;const _0x44ee9f=_0x2a4449['length'];for(let _0x1a1d57=0x0;_0x1a1d57<_0x44ee9f;_0x1a1d57+=0x80)if(_0x2a4449[_0x1a1d57]!==_0xde254f[_0x1a1d57]||_0x2a4449[_0x1a1d57+0x1]!==_0xde254f[_0x1a1d57+0x1]||_0x2a4449[_0x1a1d57+0x2]!==_0xde254f[_0x1a1d57+0x2]||_0x2a4449[_0x1a1d57+0x3]!==_0xde254f[_0x1a1d57+0x3])return!0x1;const _0x156c56=_0x44ee9f-0x4;return _0x2a4449[_0x156c56]===_0xde254f[_0x156c56]&&_0x2a4449[_0x156c56+0x1]===_0xde254f[_0x156c56+0x1]&&_0x2a4449[_0x156c56+0x2]===_0xde254f[_0x156c56+0x2]&&_0x2a4449[_0x156c56+0x3]===_0xde254f[_0x156c56+0x3];}(__strokeBeforeSnap,_0x4b4825)?(History['push']({'type':_0x6bd6df,'before':__strokeBeforeSnap,'after':_0x4b4825}),console['log']('[History]\x20commit\x20stroke',{'type':_0x6bd6df,'layer':activeLayerIndex})):console['log']('[History]\x20skip\x20no-op\x20stroke',{'layer':activeLayerIndex});}catch(_0x1e08f4){console['warn']('endStrokeHistory/commit',_0x1e08f4);}finally{__strokeInProgress=!0x1,__strokeBeforeSnap=null,needsRedraw=!0x0,requestDrawIfIdle?.();}});}catch(_0x3e458a){console['warn']('endStrokeHistory',_0x3e458a),__strokeInProgress=!0x1,__strokeBeforeSnap=null;}}function undoStroke(){History['undo']();}function redoStroke(){History['redoDo']();}try{document['getElementById']('undoButton')['removeEventListener']?.('click',undoStroke),document['getElementById']('redoButton')['removeEventListener']?.('click',redoStroke);}catch{}function performFloodFill(_0x359dd0,_0xe77e04){const _0x399d7e=getActiveLayer();if(!_0x399d7e)return;const _0x4d7953=snapshotLayer(activeLayerIndex),_0x3c1260=Math['max'](0x0,Math['min'](fixedFBOWidth-0x1,Math['round'](_0x359dd0))),_0x277972=Math['max'](0x0,Math['min'](fixedFBOHeight-0x1,Math['round'](_0xe77e04))),_0x2bf1aa=fixedFBOHeight-0x1-_0x277972,_0x3263f4=new Uint8Array(0x4);gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x399d7e['fbo']),gl['readPixels'](_0x3c1260,_0x2bf1aa,0x1,0x1,gl['RGBA'],gl['UNSIGNED_BYTE'],_0x3263f4),gl['bindFramebuffer'](gl['FRAMEBUFFER'],null),runFloodFillShader(_0x399d7e,[_0x3263f4[0x0]/0xff,_0x3263f4[0x1]/0xff,_0x3263f4[0x2]/0xff,_0x3263f4[0x3]/0xff],tintColor);const _0x5f0d50=snapshotLayer(activeLayerIndex);History['push']({'type':'fill','before':_0x4d7953,'after':_0x5f0d50}),needsRedraw=!0x0;}function endTransform(_0x30f00c=!0x0){if(!(transformTool&&transformTool['mode']&&'idle'!==transformTool['mode'])){try{isTwoFingerGesture=!0x1,pinchStart=null;}catch{}return transformTool&&(transformTool['mode']='idle'),needsRedraw=!0x0,void requestDrawIfIdle?.();}try{stopRender?.('transform');}catch{}let _0x5685ba=!0x1,_0xf4044d=null,_0x84bcf0=null;try{promoteLayerForScale?.(1.25);}catch{}try{_0x30f00c&&activeLayerWouldClip()&&(_0x30f00c=!0x1,showStatusMessage?.('Skipped\x20bake\x20to\x20prevent\x20off-canvas\x20cropping','info'));}catch{}if(_0x30f00c)try{_0xf4044d=snapshotLayer?.(activeLayerIndex),applyActiveLayerTransform?.(),_0x84bcf0=snapshotLayer?.(activeLayerIndex),_0xf4044d&&_0x84bcf0&&History?.['push']&&History['push']({'type':'transform_bake','before':_0xf4044d,'after':_0x84bcf0}),_0x5685ba=!0x0;}catch(_0x25ef04){console['warn']('[endTransform]\x20Bake\x20failed:',_0x25ef04),_0x5685ba=!0x1;}try{transformTool['start']=null,transformTool['ref']=null,transformTool['shiftInvert']=!0x1,transformTool['pivotCanvas']=null;}catch{}transformTool&&(transformTool['mode']='idle');try{isTwoFingerGesture=!0x1,pinchStart=null;}catch{}const _0x34e2b7=getActiveLayer?.(),_0x4860aa=!(!_0x34e2b7||!_0x34e2b7['transformLocked']);transformTool&&(transformTool['mobileCombo']=_0x4860aa),_0x4860aa&&queueMicrotask?.(()=>startTransform?.('grab')),showStatusMessage?.(_0x5685ba?'Transform\x20applied':_0x30f00c?'Transform\x20failed':'Transform\x20cancelled',_0x5685ba?'success':_0x30f00c?'warning':'info'),needsRedraw=!0x0,requestDrawIfIdle?.();}function recordLayerVisibilityChange(_0x27d0dc,_0xbe466e,_0x14d1f8){History['push']({'type':'layer_visibility','index':_0x27d0dc,'prev':_0xbe466e,'next':_0x14d1f8});}function recordLayerOpacityChange(_0x2dc055,_0x2a1b5c,_0x2c30d0){History['push']({'type':'layer_opacity','index':_0x2dc055,'prev':_0x2a1b5c,'next':_0x2c30d0});}function recordLayerRename(_0x46ed60,_0x3dd713,_0xb4830d){History['push']({'type':'layer_rename','index':_0x46ed60,'prev':_0x3dd713,'next':_0xb4830d});}function recordLayerMove(_0x16d597,_0x113179){History['push']({'type':'layer_move','from':_0x16d597,'to':_0x113179});}function recordAddLayer(_0x166d64){const _0x1f60e0=snapshotLayer(_0x166d64);History['push']({'type':'add_layer','index':_0x166d64,'addedLayer':{'name':layers[_0x166d64]['name'],'visible':layers[_0x166d64]['visible'],'opacity':layers[_0x166d64]['opacity'],'snapshot':_0x1f60e0}});}function recordRemoveLayer(_0x4da561,_0x2fcd9b){History['push']({'type':'remove_layer','index':_0x4da561,'removedLayer':_0x2fcd9b});}function captureLayerDataForRemoval(_0x35767f){const _0x511a2e=layers[_0x35767f];return{'name':_0x511a2e['name'],'visible':_0x511a2e['visible'],'opacity':_0x511a2e['opacity'],'snapshot':snapshotLayer(_0x35767f)};}document['getElementById']('undoButton')['addEventListener']('click',undoStroke),document['getElementById']('redoButton')['addEventListener']('click',redoStroke),document['addEventListener']('keydown',_0x1c0f27=>{isUserTyping()||('z'===_0x1c0f27['key']&&(_0x1c0f27['ctrlKey']||_0x1c0f27['metaKey'])&&(_0x1c0f27['preventDefault'](),undoStroke()),'y'===_0x1c0f27['key']&&(_0x1c0f27['ctrlKey']||_0x1c0f27['metaKey'])&&(_0x1c0f27['preventDefault'](),redoStroke()));},{'capture':!0x0}),canvas['addEventListener']('pointerdown',()=>{beginStrokeHistory();},{'capture':!0x0}),canvas['addEventListener']('pointerup',()=>{endStrokeHistory('stroke');},{'capture':!0x0});const __moveLayerUp=moveLayerUp;moveLayerUp=function(_0x3a5ac){const _0x5e2306=Math['min'](layers['length']-0x1,_0x3a5ac+0x1);_0x3a5ac!==_0x5e2306&&(__moveLayerUp(_0x3a5ac),recordLayerMove(_0x3a5ac,_0x5e2306));};const __moveLayerDown=moveLayerDown;moveLayerDown=function(_0x19724e){const _0x3df607=Math['max'](0x0,_0x19724e-0x1);_0x19724e!==_0x3df607&&(__moveLayerDown(_0x19724e),recordLayerMove(_0x19724e,_0x3df607));};const __removeActiveLayer=removeActiveLayer;removeActiveLayer=function(){if(layers['length']<=0x1)return void __removeActiveLayer();const _0x4f9bfd=activeLayerIndex,_0x5dda51=captureLayerDataForRemoval(_0x4f9bfd);__removeActiveLayer(),recordRemoveLayer(_0x4f9bfd,_0x5dda51);};const __addLayer=addLayer;addLayer=function(_0x35fa07='Layer\x20'+(layers['length']+0x1),_0x2bdd90=activeLayerIndex){__addLayer(_0x35fa07,_0x2bdd90),recordAddLayer(activeLayerIndex);};const __rebuildLayersUI=rebuildLayersUI;function recordClearProject(_0x5a0933,_0x1dde96){History['push']({'type':'clear_project','beforeAll':_0x5a0933,'afterAll':_0x1dde96});}rebuildLayersUI=function(){__rebuildLayersUI();try{const _0x2d7c3c=document['getElementById']('layersList');if(!_0x2d7c3c)return;_0x2d7c3c['querySelectorAll']('.layer-item')['forEach'](_0xc67892=>{const _0x5260aa=Number(_0xc67892['getAttribute']('data-index')),_0x1dbeed=_0xc67892['querySelector']('.layer-vis\x20button.bs.icon-btn');if(_0x1dbeed&&!_0x1dbeed['__hp_vis_hist_patched']){_0x1dbeed['__hp_vis_hist_patched']=!0x0;const _0x565b72=_0x1dbeed['onclick'];_0x1dbeed['onclick']=_0xef6d68=>{const _0x390c59=layers[_0x5260aa]['visible'];_0x565b72?.(_0xef6d68);const _0x1b4dd9=layers[_0x5260aa]['visible'];_0x390c59!==_0x1b4dd9&&recordLayerVisibilityChange(_0x5260aa,_0x390c59,_0x1b4dd9);};}const _0x23abd9=_0xc67892['querySelector']('.layer-opacity\x20input[type=\x27range\x27]');if(_0x23abd9&&!_0x23abd9['__hp_op_hist_patched']){_0x23abd9['__hp_op_hist_patched']=!0x0;let _0x34632e=layers[_0x5260aa]['opacity'];_0x23abd9['addEventListener']('change',()=>{const _0x5b7c40=layers[_0x5260aa]['opacity'];_0x34632e!==_0x5b7c40&&(recordLayerOpacityChange(_0x5260aa,_0x34632e,_0x5b7c40),_0x34632e=_0x5b7c40);});}const _0x594b2b=_0xc67892['querySelector']('.layer-name\x20input');if(_0x594b2b&&!_0x594b2b['__hp_name_hist_patched']){_0x594b2b['__hp_name_hist_patched']=!0x0;let _0x2407a9=layers[_0x5260aa]['name'];_0x594b2b['addEventListener']('blur',()=>{const _0x5330d8=layers[_0x5260aa]['name'];_0x2407a9!==_0x5330d8&&(recordLayerRename(_0x5260aa,_0x2407a9,_0x5330d8),_0x2407a9=_0x5330d8);}),_0x594b2b['addEventListener']('change',()=>{const _0x20755d=layers[_0x5260aa]['name'];_0x2407a9!==_0x20755d&&(recordLayerRename(_0x5260aa,_0x2407a9,_0x20755d),_0x2407a9=_0x20755d);});}});}catch(_0x12884e){console['warn']('rebuildLayersUI\x20history\x20patch',_0x12884e);}};let isErasing=!0x1;function updateEraserSliderVisibility(){const _0x43a274=document['getElementById']('eraseStrengthSlider');_0x43a274&&(_0x43a274['style']['display']=isErasing?'block':'none');}function toggleEraser(){isErasing=!isErasing,updateEraserSliderVisibility(),updateEraserButton(),showStatusMessage(isErasing?'Mode:\x20Erase':'Mode:\x20Paint','info');}function updateEraserButton(){document['querySelector']('#eraserToggle')['innerHTML']=isErasing?'<img\x20src=\x22/static/draw/images/icons/eraser.svg\x22\x20alt=\x22Erase\x22>':'<img\x20src=\x22/static/draw/images/icons/brush.svg\x22\x20alt=\x22Brush\x22>',needsRedraw=!0x0;}document['addEventListener']('keydown',_0x3893b7=>{isUserTyping()||'e'===_0x3893b7['key']['toLowerCase']()&&toggleEraser();}),document['addEventListener']('DOMContentLoaded',()=>{const _0x22cd0a=document['querySelector']('#eraserToggle');_0x22cd0a&&(_0x22cd0a['addEventListener']('click',toggleEraser),updateEraserButton());}),document['addEventListener']('keydown',_0xa339b3=>{isUserTyping()||(','===_0xa339b3['key']?(eraseStrength=Math['max'](0x0,eraseStrength-0.01),updateEraserSliderUI()):'.'===_0xa339b3['key']&&(eraseStrength=Math['min'](0x1,eraseStrength+0.01),updateEraserSliderUI()));});let lineMode=!0x0,lineStepFactor=0.02,lastFx=null,lastFy=null;function drawSingleBrushStamp(_0x351bdb,_0x30a089,_0x22c04f=null,_0x2a2159=null){const _0x61d0df=getActiveLayer();if(!_0x61d0df||!gl)return;const _0xfa3621=0x0|fixedFBOWidth,_0x1fd978=0x0|fixedFBOHeight;let _0x119f1a=Math['max'](0x1,0x0|(Number(_0x61d0df['texW'])||_0xfa3621)),_0x450865=Math['max'](0x1,0x0|(Number(_0x61d0df['texH'])||_0x1fd978)),_0x2bb952=Number['isFinite'](_0x61d0df['ox'])?_0x61d0df['ox']:0x0,_0x33f98d=Number['isFinite'](_0x61d0df['oy'])?_0x61d0df['oy']:0x0,_0x3fe7f5=Number['isFinite'](_0x61d0df['px'])?_0x61d0df['px']:_0x2bb952+0.5*_0x119f1a,_0x40a2ed=Number['isFinite'](_0x61d0df['py'])?_0x61d0df['py']:_0x33f98d+0.5*_0x450865;const _0x93096=Number['isFinite'](_0x61d0df['x'])?_0x61d0df['x']:0x0,_0x5ece26=Number['isFinite'](_0x61d0df['y'])?_0x61d0df['y']:0x0,_0x361b72=Number['isFinite'](_0x61d0df['scaleX'])?_0x61d0df['scaleX']:0x1,_0x451b52=Number['isFinite'](_0x61d0df['scaleY'])?_0x61d0df['scaleY']:0x1,_0x390ef5=Number['isFinite'](_0x61d0df['rotation'])?_0x61d0df['rotation']:0x0,_0xfc9aa6=!Number['isFinite'](_0x61d0df['px'])||!Number['isFinite'](_0x61d0df['py']),_0x5590f1=_0x3fe7f5,_0x5b1b18=_0x40a2ed;let _0x398ce9=_0x351bdb-_0x93096,_0x231bdc=_0x30a089-_0x5ece26;_0x398ce9-=_0x3fe7f5,_0x231bdc-=_0x40a2ed;const _0x553f74=Math['cos'](-_0x390ef5),_0x505e39=Math['sin'](-_0x390ef5),_0x4a1051=_0x398ce9*_0x553f74-_0x231bdc*_0x505e39,_0x2de741=_0x398ce9*_0x505e39+_0x231bdc*_0x553f74;let _0xc46479=(0x0!==_0x361b72?_0x4a1051/_0x361b72:_0x4a1051)+_0x3fe7f5-_0x2bb952,_0x5e01d7=(0x0!==_0x451b52?_0x2de741/_0x451b52:_0x2de741)+_0x40a2ed-_0x33f98d;const _0x257fc5=(_0x22c04f??brushSize)*_0xfa3621,_0x304fe8=0.5*_0x257fc5,_0x575683=0.5*(_0x257fc5/brushAspect),_0x4cd70e=_0x2a2159??currentAngle,_0xa0155f=Math['cos'](_0x4cd70e),_0x244c7c=Math['sin'](_0x4cd70e),_0x37147d=(_0x169f36,_0x577965)=>({'x':_0x169f36*_0xa0155f-_0x577965*_0x244c7c,'y':_0x169f36*_0x244c7c+_0x577965*_0xa0155f});let _0xe25334=_0x37147d(-_0x304fe8,-_0x575683),_0x4d79c9=_0x37147d(_0x304fe8,-_0x575683),_0x575019=_0x37147d(-_0x304fe8,_0x575683),_0x4b12c4=_0x37147d(_0x304fe8,_0x575683),_0x47d1b9=_0xc46479+_0xe25334['x'],_0x59b81a=_0x5e01d7+_0xe25334['y'],_0x289ab0=_0xc46479+_0x4d79c9['x'],_0x5537fb=_0x5e01d7+_0x4d79c9['y'],_0x5919de=_0xc46479+_0x575019['x'],_0x7cf4fc=_0x5e01d7+_0x575019['y'],_0x10d880=_0xc46479+_0x4b12c4['x'],_0x237897=_0x5e01d7+_0x4b12c4['y'],_0x5a0b42=Math['min'](_0x47d1b9,_0x289ab0,_0x5919de,_0x10d880),_0x53be8d=Math['min'](_0x59b81a,_0x5537fb,_0x7cf4fc,_0x237897),_0x46becc=Math['max'](_0x47d1b9,_0x289ab0,_0x5919de,_0x10d880),_0x1d2cd6=Math['max'](_0x59b81a,_0x5537fb,_0x7cf4fc,_0x237897);const _0x5e555e=1.5,_0x4584fd=_0x5a0b42<0x0,_0x1fbb42=_0x53be8d<0x0,_0x4ef92b=_0x46becc>_0x119f1a,_0x56542a=_0x1d2cd6>_0x450865;if(_0x4584fd||_0x1fbb42||_0x4ef92b||_0x56542a){const _0x5835d4=_0x4584fd?Math['ceil'](-_0x5a0b42):0x0,_0x30bfe1=_0x1fbb42?Math['ceil'](-_0x53be8d):0x0,_0x48402a=_0x4ef92b?Math['ceil'](_0x46becc-_0x119f1a):0x0,_0x58a21d=_0x56542a?Math['ceil'](_0x1d2cd6-_0x450865):0x0,_0x3c8e99=_0x5835d4?Math['ceil']((_0x5835d4+0x4)*_0x5e555e):0x0,_0x5e94d0=_0x30bfe1?Math['ceil']((_0x30bfe1+0x4)*_0x5e555e):0x0,_0x49f1f5=_0x119f1a+_0x3c8e99+(_0x48402a?Math['ceil']((_0x48402a+0x4)*_0x5e555e):0x0),_0x4ed3fb=_0x450865+_0x5e94d0+(_0x58a21d?Math['ceil']((_0x58a21d+0x4)*_0x5e555e):0x0),_0x4515da=gl['createTexture']();gl['bindTexture'](gl['TEXTURE_2D'],_0x4515da),gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],_0x49f1f5,_0x4ed3fb,0x0,gl['RGBA'],gl['UNSIGNED_BYTE'],null),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MIN_FILTER'],gl['NEAREST']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MAG_FILTER'],gl['NEAREST']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_S'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_T'],gl['CLAMP_TO_EDGE']);const _0x5a3084=gl['createFramebuffer']();gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x5a3084),gl['framebufferTexture2D'](gl['FRAMEBUFFER'],gl['COLOR_ATTACHMENT0'],gl['TEXTURE_2D'],_0x4515da,0x0),gl['viewport'](0x0,0x0,_0x49f1f5,_0x4ed3fb),gl['disable'](gl['BLEND']),gl['clearColor'](0x0,0x0,0x0,0x0),gl['clear'](gl['COLOR_BUFFER_BIT']),gl['useProgram'](quadProgram);const _0x530c76=gl['getUniformLocation'](quadProgram,'u_texture')||gl['getUniformLocation'](quadProgram,'u_image'),_0x5d69ca=gl['getUniformLocation'](quadProgram,'u_flipY'),_0x6b6042=gl['getUniformLocation'](quadProgram,'u_resolution'),_0x3a71e5=gl['getUniformLocation'](quadProgram,'u_layerOpacity');_0x5d69ca&&gl['uniform1f'](_0x5d69ca,0x1),_0x6b6042&&gl['uniform2f'](_0x6b6042,_0x49f1f5,_0x4ed3fb),_0x3a71e5&&gl['uniform1f'](_0x3a71e5,0x1);const _0x10a194=new Float32Array([_0x3c8e99,_0x5e94d0,0x0,0x0,_0x3c8e99+_0x119f1a,_0x5e94d0,0x1,0x0,_0x3c8e99,_0x5e94d0+_0x450865,0x0,0x1,_0x3c8e99,_0x5e94d0+_0x450865,0x0,0x1,_0x3c8e99+_0x119f1a,_0x5e94d0,0x1,0x0,_0x3c8e99+_0x119f1a,_0x5e94d0+_0x450865,0x1,0x1]),_0x38b451=gl['createBuffer']();gl['bindBuffer'](gl['ARRAY_BUFFER'],_0x38b451),gl['bufferData'](gl['ARRAY_BUFFER'],_0x10a194,gl['STREAM_DRAW']);const _0x3145a4=gl['getAttribLocation'](quadProgram,'a_position'),_0x52eac1=gl['getAttribLocation'](quadProgram,'a_texCoord');gl['enableVertexAttribArray'](_0x3145a4),gl['vertexAttribPointer'](_0x3145a4,0x2,gl['FLOAT'],!0x1,0x10,0x0),gl['enableVertexAttribArray'](_0x52eac1),gl['vertexAttribPointer'](_0x52eac1,0x2,gl['FLOAT'],!0x1,0x10,0x8),gl['activeTexture'](gl['TEXTURE0']),gl['bindTexture'](gl['TEXTURE_2D'],_0x61d0df['texture']),_0x530c76&&gl['uniform1i'](_0x530c76,0x0),gl['drawArrays'](gl['TRIANGLES'],0x0,0x6),gl['disableVertexAttribArray'](_0x3145a4),gl['disableVertexAttribArray'](_0x52eac1),gl['bindBuffer'](gl['ARRAY_BUFFER'],null),gl['deleteBuffer'](_0x38b451);const _0x1373a2=_0x61d0df['texture'],_0x15f95e=_0x61d0df['fbo'];_0x61d0df['texture']=_0x4515da,_0x61d0df['fbo']=_0x5a3084,_0x61d0df['texW']=_0x119f1a=_0x49f1f5,_0x61d0df['texH']=_0x450865=_0x4ed3fb,_0x61d0df['ox']=_0x2bb952-=_0x3c8e99,_0x61d0df['oy']=_0x33f98d-=_0x5e94d0,_0xfc9aa6&&(_0x61d0df['px']=_0x5590f1,_0x61d0df['py']=_0x5b1b18,_0x3fe7f5=_0x61d0df['px'],_0x40a2ed=_0x61d0df['py']),_0xc46479+=_0x3c8e99,_0x5e01d7+=_0x5e94d0,_0x47d1b9+=_0x3c8e99,_0x289ab0+=_0x3c8e99,_0x5919de+=_0x3c8e99,_0x10d880+=_0x3c8e99,_0x59b81a+=_0x5e94d0,_0x5537fb+=_0x5e94d0,_0x7cf4fc+=_0x5e94d0,_0x237897+=_0x5e94d0,gl['deleteFramebuffer'](_0x15f95e),gl['deleteTexture'](_0x1373a2);}gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x61d0df['fbo']),gl['viewport'](0x0,0x0,_0x119f1a,_0x450865),gl['disable'](gl['SCISSOR_TEST']),gl['disable'](gl['DEPTH_TEST']),gl['disable'](gl['CULL_FACE']),gl['useProgram'](paintProgram),gl['enable'](gl['BLEND']),isErasing?gl['blendFuncSeparate'](gl['ZERO'],gl['ONE'],gl['ZERO'],gl['ONE_MINUS_SRC_ALPHA']):gl['blendFunc'](gl['SRC_ALPHA'],gl['ONE_MINUS_SRC_ALPHA']);const _0x751d03=gl['getUniformLocation'](paintProgram,'u_flipY');_0x751d03&&gl['uniform1f'](_0x751d03,0x1);const _0x484942=gl['getUniformLocation'](paintProgram,'u_resolution');_0x484942&&gl['uniform2f'](_0x484942,_0x119f1a,_0x450865);const _0x224e65=gl['getUniformLocation'](paintProgram,'u_erase');_0x224e65&&gl['uniform1i'](_0x224e65,isErasing?0x1:0x0);const _0x563527=gl['getUniformLocation'](paintProgram,'u_eraseStrength');_0x563527&&gl['uniform1f'](_0x563527,eraseStrength);const _0x1aa691=gl['getUniformLocation'](paintProgram,'u_paintStrength');_0x1aa691&&gl['uniform1f'](_0x1aa691,paintStrength);const _0x55dcd0=gl['getUniformLocation'](paintProgram,'u_tint');_0x55dcd0&&gl['uniform4fv'](_0x55dcd0,tintColor),gl['activeTexture'](gl['TEXTURE0']),gl['bindTexture'](gl['TEXTURE_2D'],overlayTexture);const _0x5a83d4=gl['getUniformLocation'](paintProgram,'u_brushTex'),_0x4763ac=gl['getUniformLocation'](paintProgram,'u_brush');_0x5a83d4&&gl['uniform1i'](_0x5a83d4,0x0),_0x4763ac&&gl['uniform1i'](_0x4763ac,0x0);const _0x562f42=new Float32Array([_0x47d1b9,_0x59b81a,0x0,0x0,_0x289ab0,_0x5537fb,0x1,0x0,_0x5919de,_0x7cf4fc,0x0,0x1,_0x5919de,_0x7cf4fc,0x0,0x1,_0x289ab0,_0x5537fb,0x1,0x0,_0x10d880,_0x237897,0x1,0x1]),_0x1176c9=gl['createBuffer']();gl['bindBuffer'](gl['ARRAY_BUFFER'],_0x1176c9),gl['bufferData'](gl['ARRAY_BUFFER'],_0x562f42,gl['STREAM_DRAW']);const _0x1ea3eb=gl['getAttribLocation'](paintProgram,'a_position'),_0x1cc5fe=gl['getAttribLocation'](paintProgram,'a_texCoord');gl['enableVertexAttribArray'](_0x1ea3eb),gl['vertexAttribPointer'](_0x1ea3eb,0x2,gl['FLOAT'],!0x1,0x10,0x0),gl['enableVertexAttribArray'](_0x1cc5fe),gl['vertexAttribPointer'](_0x1cc5fe,0x2,gl['FLOAT'],!0x1,0x10,0x8),gl['drawArrays'](gl['TRIANGLES'],0x0,0x6),gl['disableVertexAttribArray'](_0x1ea3eb),gl['disableVertexAttribArray'](_0x1cc5fe),gl['bindBuffer'](gl['ARRAY_BUFFER'],null),gl['deleteBuffer'](_0x1176c9),gl['bindFramebuffer'](gl['FRAMEBUFFER'],null),needsRedraw=!0x0,requestDrawIfIdle?.();}function drawBrushStrokeToPaintLayer(_0x11f2df,_0x5213a6){if(!canPaint())return;if(!(gl&&layers['length']&&overlayTexture&&getActiveLayer()))return;if(!Number['isFinite'](_0x11f2df)||!Number['isFinite'](_0x5213a6))return;if(_0x11f2df<0x0||_0x5213a6<0x0||_0x11f2df>canvas['width']||_0x5213a6>canvas['height'])return;const _0x5053e6=_0x11f2df*(fixedFBOWidth/canvas['width']),_0x11d54e=_0x5213a6*(fixedFBOHeight/canvas['height']),_0x224ee4=getActiveLayer();let _0x3e82c3=0x1;if(void 0x0!==dynamicModeEnabled&&dynamicModeEnabled&&(_0x3e82c3=void 0x0!==intuitiveMode&&intuitiveMode?0.8+0.8*Math['random']():1.5-Math['random']()),void 0x0===window['__stampCarry']&&(window['__stampCarry']=0x0),void 0x0===window['__angleEMA']&&(window['__angleEMA']=null),_0x224ee4['__lastDoc']||(_0x224ee4['__lastDoc']=null),!_0x224ee4['__lastDoc']){let _0x39c049=currentAngle;return void 0x0!==reverseModeEnabled&&reverseModeEnabled&&(_0x39c049+=Math['PI']),drawSingleBrushStamp(_0x5053e6,_0x11d54e,brushSize*_0x3e82c3,_0x39c049),_0x224ee4['__lastDoc']={'x':_0x5053e6,'y':_0x11d54e},lastFx=_0x5053e6,lastFy=_0x11d54e,lastX=_0x11f2df,lastY=_0x5213a6,needsRedraw=!0x0,strokeCount++,void(void 0x0!==FLATTEN_THRESHOLD&&strokeCount>=FLATTEN_THRESHOLD&&flattenStrokes?.());}const _0x879d45=_0x5053e6-_0x224ee4['__lastDoc']['x'],_0x4fb35c=_0x11d54e-_0x224ee4['__lastDoc']['y'],_0x2f3422=Math['hypot'](_0x879d45,_0x4fb35c);let _0xd09a73=Math['atan2'](_0x4fb35c,_0x879d45);if(null==window['__angleEMA'])window['__angleEMA']=_0xd09a73;else{const _0xed592f=0.35;let _0x5d5969=window['__angleEMA'],_0x572e40=_0xd09a73;for(;_0x572e40-_0x5d5969>Math['PI'];)_0x572e40-=0x2*Math['PI'];for(;_0x572e40-_0x5d5969<-Math['PI'];)_0x572e40+=0x2*Math['PI'];window['__angleEMA']=_0x5d5969+(_0x572e40-_0x5d5969)*_0xed592f,_0xd09a73=window['__angleEMA'];}void 0x0!==reverseModeEnabled&&reverseModeEnabled&&(_0xd09a73+=Math['PI']);const _0x5a1084=Math['max'](0x1,brushSize*fixedFBOWidth),_0x3d69ec=Math['max'](0.000001,0.3*_0x5a1084),_0x3c4235=Math['min'](2.5,_0x2f3422/_0x3d69ec),_0x4090c5=brushSize*_0x3c4235*_0x3e82c3;let _0x5c77b4=_0x5a1084*(void 0x0!==lineStepFactor?lineStepFactor:0.3)*_0x3c4235*_0x3e82c3;_0x5c77b4=Math['max'](0.5,_0x5c77b4);let _0x212ff7=Math['max'](0x0,_0x5c77b4-window['__stampCarry']);if(lineMode){for(;_0x212ff7<=_0x2f3422;){const _0x37479e=_0x212ff7/_0x2f3422;drawSingleBrushStamp(_0x224ee4['__lastDoc']['x']+_0x879d45*_0x37479e,_0x224ee4['__lastDoc']['y']+_0x4fb35c*_0x37479e,_0x4090c5,_0xd09a73),_0x212ff7+=_0x5c77b4;}window['__stampCarry']=_0x212ff7-_0x2f3422;}else drawSingleBrushStamp(_0x5053e6,_0x11d54e,_0x4090c5,_0xd09a73),window['__stampCarry']=(_0x5c77b4-_0x2f3422%_0x5c77b4)%_0x5c77b4;_0x224ee4['__lastDoc']={'x':_0x5053e6,'y':_0x11d54e},lastFx=_0x5053e6,lastFy=_0x11d54e,lastX=_0x11f2df,lastY=_0x5213a6,strokeCount++,void 0x0!==FLATTEN_THRESHOLD&&strokeCount>=FLATTEN_THRESHOLD&&flattenStrokes?.(),needsRedraw=!0x0;}function drawBrushStrokeToPaintLayer(_0x23d087,_0x4bd587){if(!canPaint())return;if(!(gl&&layers['length']&&overlayTexture&&getActiveLayer()))return;if(!Number['isFinite'](_0x23d087)||!Number['isFinite'](_0x4bd587))return;if(_0x23d087<0x0||_0x4bd587<0x0||_0x23d087>canvas['width']||_0x4bd587>canvas['height'])return;const _0x597618=_0x23d087*(fixedFBOWidth/canvas['width']),_0x23a8f7=_0x4bd587*(fixedFBOHeight/canvas['height']);if(void 0x0===window['__stampCarry']&&(window['__stampCarry']=0x0),void 0x0===window['__angleEMA']&&(window['__angleEMA']=null),null===lastFx||null===lastFy){let _0x36bf0f=0x1;dynamicModeEnabled&&(_0x36bf0f=intuitiveMode?0.8+0.8*Math['random']():1.5-Math['random']());let _0x55d825=currentAngle;return reverseModeEnabled&&(_0x55d825+=Math['PI']),drawSingleBrushStamp(_0x597618,_0x23a8f7,brushSize*_0x36bf0f,_0x55d825),lastFx=_0x597618,lastFy=_0x23a8f7,lastX=_0x23d087,lastY=_0x4bd587,needsRedraw=!0x0,strokeCount++,void(strokeCount>=FLATTEN_THRESHOLD&&flattenStrokes());}const _0xfd2c2c=_0x597618-lastFx,_0x182e8c=_0x23a8f7-lastFy,_0x4c19aa=Math['hypot'](_0xfd2c2c,_0x182e8c);if(_0x4c19aa<=0.000001)return;const _0x2d47b3=Math['atan2'](_0x182e8c,_0xfd2c2c);if(null===window['__angleEMA'])window['__angleEMA']=_0x2d47b3;else{const _0x455154=window['__angleEMA'],_0x578587=Math['cos'](_0x455154),_0x777a27=Math['sin'](_0x455154),_0x33743f=0.25,_0x3cd16d=(0x1-_0x33743f)*_0x578587+_0x33743f*Math['cos'](_0x2d47b3),_0x264136=(0x1-_0x33743f)*_0x777a27+_0x33743f*Math['sin'](_0x2d47b3);window['__angleEMA']=Math['atan2'](_0x264136,_0x3cd16d);}let _0x281458=window['__angleEMA'];reverseModeEnabled&&(_0x281458+=Math['PI']);let _0x4ca8ac=0x1;dynamicModeEnabled&&(_0x4ca8ac=intuitiveMode?0.8+0.8*Math['random']():1.5-Math['random']());const _0x2a3e66=Math['max'](0x1,brushSize*fixedFBOWidth),_0x1e8593=Math['max'](0.000001,0.3*_0x2a3e66),_0xd65bbf=Math['min'](2.5,_0x4c19aa/_0x1e8593),_0x5c7308=brushSize*_0xd65bbf*_0x4ca8ac;let _0x4b6bfa=_0x2a3e66*lineStepFactor*_0xd65bbf*_0x4ca8ac;_0x4b6bfa=Math['max'](0.5,_0x4b6bfa);let _0x2ebeb8=Math['max'](0x0,_0x4b6bfa-window['__stampCarry']);if(lineMode){for(;_0x2ebeb8<=_0x4c19aa;){const _0x5f18bf=_0x2ebeb8/_0x4c19aa;drawSingleBrushStamp(lastFx+_0xfd2c2c*_0x5f18bf,lastFy+_0x182e8c*_0x5f18bf,_0x5c7308,_0x281458),_0x2ebeb8+=_0x4b6bfa;}window['__stampCarry']=_0x2ebeb8-_0x4c19aa;}else drawSingleBrushStamp(_0x597618,_0x23a8f7,_0x5c7308,_0x281458),window['__stampCarry']=(_0x4b6bfa-_0x4c19aa%_0x4b6bfa)%_0x4b6bfa;lastFx=_0x597618,lastFy=_0x23a8f7,lastX=_0x23d087,lastY=_0x4bd587,strokeCount++,strokeCount>=FLATTEN_THRESHOLD&&flattenStrokes(),needsRedraw=!0x0;}function drawBrushOverlay(){gl['enable'](gl['BLEND']),gl['blendFunc'](gl['SRC_ALPHA'],gl['ONE_MINUS_SRC_ALPHA']),gl['useProgram'](overlayProgram);let _0x59ac9e=gl['getUniformLocation'](overlayProgram,'u_flipY');gl['uniform1f'](_0x59ac9e,-0x1);let _0x34bbb2=gl['getUniformLocation'](overlayProgram,'u_resolution');gl['uniform2f'](_0x34bbb2,canvas['width'],canvas['height']);let _0x3abb2d=gl['getUniformLocation'](overlayProgram,'u_tint');gl['uniform4fv'](_0x3abb2d,tintColor);const _0x23f071=overlayPosition[0x0]*canvas['width'],_0x4cea7c=overlayPosition[0x1]*canvas['height'],_0x2e9cca=brushSize*canvas['width'],_0x4413a5=_0x2e9cca/0x2,_0xba203c=_0x2e9cca/brushAspect/0x2,_0x14024f=[{'x':-_0x4413a5,'y':-_0xba203c},{'x':_0x4413a5,'y':-_0xba203c},{'x':-_0x4413a5,'y':_0xba203c},{'x':_0x4413a5,'y':_0xba203c}],_0x234520=Math['cos'](currentAngle),_0x3fb8ef=Math['sin'](currentAngle),_0x2c2fec=_0x14024f['map'](function(_0x16318d){return{'x':_0x16318d['x']*_0x234520-_0x16318d['y']*_0x3fb8ef,'y':_0x16318d['x']*_0x3fb8ef+_0x16318d['y']*_0x234520};}),_0x3ff22d={'x':_0x23f071+_0x2c2fec[0x0]['x'],'y':_0x4cea7c+_0x2c2fec[0x0]['y']},_0x39a923={'x':_0x23f071+_0x2c2fec[0x1]['x'],'y':_0x4cea7c+_0x2c2fec[0x1]['y']},_0x4f308b={'x':_0x23f071+_0x2c2fec[0x2]['x'],'y':_0x4cea7c+_0x2c2fec[0x2]['y']},_0x244233={'x':_0x23f071+_0x2c2fec[0x3]['x'],'y':_0x4cea7c+_0x2c2fec[0x3]['y']},_0x2d0a06=new Float32Array([_0x3ff22d['x'],_0x3ff22d['y'],0x0,0x0,_0x39a923['x'],_0x39a923['y'],0x1,0x0,_0x4f308b['x'],_0x4f308b['y'],0x0,0x1,_0x4f308b['x'],_0x4f308b['y'],0x0,0x1,_0x39a923['x'],_0x39a923['y'],0x1,0x0,_0x244233['x'],_0x244233['y'],0x1,0x1]),_0x317150=gl['createBuffer']();gl['bindBuffer'](gl['ARRAY_BUFFER'],_0x317150),gl['bufferData'](gl['ARRAY_BUFFER'],_0x2d0a06,gl['STREAM_DRAW']);let _0x32ecbe=gl['getAttribLocation'](overlayProgram,'a_position');gl['enableVertexAttribArray'](_0x32ecbe),gl['vertexAttribPointer'](_0x32ecbe,0x2,gl['FLOAT'],!0x1,0x10,0x0);let _0xdc4f9c=gl['getAttribLocation'](overlayProgram,'a_texCoord');gl['enableVertexAttribArray'](_0xdc4f9c),gl['vertexAttribPointer'](_0xdc4f9c,0x2,gl['FLOAT'],!0x1,0x10,0x8),gl['activeTexture'](gl['TEXTURE0']),gl['bindTexture'](gl['TEXTURE_2D'],overlayTexture);const _0x1db32b=gl['getUniformLocation'](overlayProgram,'u_brush');gl['uniform1i'](_0x1db32b,0x0),gl['drawArrays'](gl['TRIANGLES'],0x0,0x6),gl['deleteBuffer'](_0x317150),gl['disableVertexAttribArray'](_0x32ecbe),gl['disableVertexAttribArray'](_0xdc4f9c);}function activeLayerWouldClip(){const _0xc20882=getActiveLayer?.();if(!_0xc20882)return!0x1;const _0x44c42d=0x0|fixedFBOWidth,_0x46e70f=0x0|fixedFBOHeight,_0x156fe4=Number['isFinite'](_0xc20882['ox'])?_0xc20882['ox']:0x0,_0x2cb83f=Number['isFinite'](_0xc20882['oy'])?_0xc20882['oy']:0x0,_0x28bf23=Math['max'](0x1,Number['isFinite'](_0xc20882['texW'])?_0xc20882['texW']:_0x44c42d),_0x58f7f5=Math['max'](0x1,Number['isFinite'](_0xc20882['texH'])?_0xc20882['texH']:_0x46e70f),_0x2bd5d8=Number['isFinite'](_0xc20882['scaleX'])?_0xc20882['scaleX']:0x1,_0x40ac57=Number['isFinite'](_0xc20882['scaleY'])?_0xc20882['scaleY']:0x1,_0x1f58b1=Number['isFinite'](_0xc20882['rotation'])?_0xc20882['rotation']:0x0,_0x1df9dc=Number['isFinite'](_0xc20882['x'])?_0xc20882['x']:0x0,_0x2e2b3c=Number['isFinite'](_0xc20882['y'])?_0xc20882['y']:0x0,_0x3d42f7=Number['isFinite'](_0xc20882['px'])?_0xc20882['px']:0.5*_0x44c42d,_0xaa6b6=Number['isFinite'](_0xc20882['py'])?_0xc20882['py']:0.5*_0x46e70f,_0x5322df=Math['cos'](_0x1f58b1),_0x46f439=Math['sin'](_0x1f58b1);function _0x27cf9e(_0x4b18c0,_0x4b6bde){const _0x13c02f=(_0x4b18c0-_0x3d42f7)*_0x2bd5d8,_0x15b028=(_0x4b6bde-_0xaa6b6)*_0x40ac57;return{'x':_0x3d42f7+_0x13c02f*_0x5322df-_0x15b028*_0x46f439+_0x1df9dc,'y':_0xaa6b6+_0x13c02f*_0x46f439+_0x15b028*_0x5322df+_0x2e2b3c};}const _0x1582b5=_0x27cf9e(_0x156fe4,_0x2cb83f),_0x5432cc=_0x27cf9e(_0x156fe4+_0x28bf23,_0x2cb83f),_0x15881d=_0x27cf9e(_0x156fe4,_0x2cb83f+_0x58f7f5),_0x4f9479=_0x27cf9e(_0x156fe4+_0x28bf23,_0x2cb83f+_0x58f7f5);return _0x1582b5['x']<0x0||_0x1582b5['y']<0x0||_0x1582b5['x']>_0x44c42d||_0x1582b5['y']>_0x46e70f||_0x5432cc['x']<0x0||_0x5432cc['y']<0x0||_0x5432cc['x']>_0x44c42d||_0x5432cc['y']>_0x46e70f||_0x15881d['x']<0x0||_0x15881d['y']<0x0||_0x15881d['x']>_0x44c42d||_0x15881d['y']>_0x46e70f||_0x4f9479['x']<0x0||_0x4f9479['y']<0x0||_0x4f9479['x']>_0x44c42d||_0x4f9479['y']>_0x46e70f;}function applyActiveLayerTransform(){const _0x1f2f2f=getActiveLayer?.();if(!(gl&&_0x1f2f2f&&_0x1f2f2f['texture']&&quadProgram))return;const _0x1b4a15=0x0|fixedFBOWidth,_0x4f2c2a=0x0|fixedFBOHeight,_0x5ef873=gl['getParameter'](gl['FRAMEBUFFER_BINDING']),_0x358fee=gl['getParameter'](gl['CURRENT_PROGRAM']),_0x5997b2=gl['getParameter'](gl['VIEWPORT']),_0x53241e=gl['createTexture']();gl['bindTexture'](gl['TEXTURE_2D'],_0x53241e),gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],_0x1b4a15,_0x4f2c2a,0x0,gl['RGBA'],gl['UNSIGNED_BYTE'],null),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MIN_FILTER'],gl['NEAREST']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MAG_FILTER'],gl['NEAREST']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_S'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_T'],gl['CLAMP_TO_EDGE']);const _0x5eb40f=gl['createFramebuffer']();gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x5eb40f),gl['framebufferTexture2D'](gl['FRAMEBUFFER'],gl['COLOR_ATTACHMENT0'],gl['TEXTURE_2D'],_0x53241e,0x0),gl['viewport'](0x0,0x0,_0x1b4a15,_0x4f2c2a),gl['disable'](gl['BLEND']),gl['clearColor'](0x0,0x0,0x0,0x0),gl['clear'](gl['COLOR_BUFFER_BIT']);const _0x203b03=Number['isFinite'](_0x1f2f2f['ox'])?_0x1f2f2f['ox']:0x0,_0x22a7bf=Number['isFinite'](_0x1f2f2f['oy'])?_0x1f2f2f['oy']:0x0,_0x5102bd=Math['max'](0x1,Number['isFinite'](_0x1f2f2f['texW'])?_0x1f2f2f['texW']:_0x1b4a15),_0x24dc60=Math['max'](0x1,Number['isFinite'](_0x1f2f2f['texH'])?_0x1f2f2f['texH']:_0x4f2c2a),_0x3fb311=Number['isFinite'](_0x1f2f2f['scaleX'])?_0x1f2f2f['scaleX']:0x1,_0x43f49a=Number['isFinite'](_0x1f2f2f['scaleY'])?_0x1f2f2f['scaleY']:0x1,_0x112f4b=Number['isFinite'](_0x1f2f2f['rotation'])?_0x1f2f2f['rotation']:0x0,_0x2018e5=Number['isFinite'](_0x1f2f2f['x'])?_0x1f2f2f['x']:0x0,_0x3f0cdd=Number['isFinite'](_0x1f2f2f['y'])?_0x1f2f2f['y']:0x0,_0x3220ec=Number['isFinite'](_0x1f2f2f['px'])?_0x1f2f2f['px']:0.5*_0x1b4a15,_0x45a2f7=Number['isFinite'](_0x1f2f2f['py'])?_0x1f2f2f['py']:0.5*_0x4f2c2a,_0x249b1b=Math['cos'](_0x112f4b),_0x2bedc1=Math['sin'](_0x112f4b);function _0x27a68a(_0x448e99,_0x17706a){let _0x1ccb9c=(_0x448e99-_0x3220ec)*_0x3fb311,_0x4ada02=(_0x17706a-_0x45a2f7)*_0x43f49a;return{'x':_0x3220ec+(_0x1ccb9c*_0x249b1b-_0x4ada02*_0x2bedc1)+_0x2018e5,'y':_0x45a2f7+(_0x1ccb9c*_0x2bedc1+_0x4ada02*_0x249b1b)+_0x3f0cdd};}const _0x3b2632=_0x27a68a(_0x203b03,_0x22a7bf),_0x796f6b=_0x27a68a(_0x203b03+_0x5102bd,_0x22a7bf),_0x4ea26c=_0x27a68a(_0x203b03,_0x22a7bf+_0x24dc60),_0x5a5e61=_0x27a68a(_0x203b03+_0x5102bd,_0x22a7bf+_0x24dc60);gl['useProgram'](quadProgram);const _0x1699da=gl['getUniformLocation'](quadProgram,'u_texture'),_0x262b05=gl['getUniformLocation'](quadProgram,'u_resolution'),_0x43f80f=gl['getUniformLocation'](quadProgram,'u_flipY'),_0x4eb3fd=gl['getUniformLocation'](quadProgram,'u_layerOpacity');_0x262b05&&gl['uniform2f'](_0x262b05,_0x1b4a15,_0x4f2c2a),_0x43f80f&&gl['uniform1f'](_0x43f80f,0x1),_0x4eb3fd&&gl['uniform1f'](_0x4eb3fd,Math['max'](0x0,Math['min'](0x1,_0x1f2f2f['opacity']??0x1)));const _0x554103=new Float32Array([_0x3b2632['x'],_0x3b2632['y'],0x0,0x0,_0x796f6b['x'],_0x796f6b['y'],0x1,0x0,_0x4ea26c['x'],_0x4ea26c['y'],0x0,0x1,_0x4ea26c['x'],_0x4ea26c['y'],0x0,0x1,_0x796f6b['x'],_0x796f6b['y'],0x1,0x0,_0x5a5e61['x'],_0x5a5e61['y'],0x1,0x1]),_0x37d26b=gl['createBuffer']();gl['bindBuffer'](gl['ARRAY_BUFFER'],_0x37d26b),gl['bufferData'](gl['ARRAY_BUFFER'],_0x554103,gl['STREAM_DRAW']);const _0x21fcd7=gl['getAttribLocation'](quadProgram,'a_position'),_0x4670f8=gl['getAttribLocation'](quadProgram,'a_texCoord');gl['enableVertexAttribArray'](_0x21fcd7),gl['vertexAttribPointer'](_0x21fcd7,0x2,gl['FLOAT'],!0x1,0x10,0x0),gl['enableVertexAttribArray'](_0x4670f8),gl['vertexAttribPointer'](_0x4670f8,0x2,gl['FLOAT'],!0x1,0x10,0x8),gl['activeTexture'](gl['TEXTURE0']),gl['bindTexture'](gl['TEXTURE_2D'],_0x1f2f2f['texture']),_0x1699da&&gl['uniform1i'](_0x1699da,0x0),gl['drawArrays'](gl['TRIANGLES'],0x0,0x6),gl['disableVertexAttribArray'](_0x21fcd7),gl['disableVertexAttribArray'](_0x4670f8),gl['bindBuffer'](gl['ARRAY_BUFFER'],null),gl['deleteBuffer'](_0x37d26b),gl['bindTexture'](gl['TEXTURE_2D'],_0x1f2f2f['texture']),((0x0|_0x1f2f2f['texW'])!==_0x1b4a15||(0x0|_0x1f2f2f['texH'])!==_0x4f2c2a)&&(gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],_0x1b4a15,_0x4f2c2a,0x0,gl['RGBA'],gl['UNSIGNED_BYTE'],null),_0x1f2f2f['fbo']||(_0x1f2f2f['fbo']=gl['createFramebuffer']()),gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x1f2f2f['fbo']),gl['framebufferTexture2D'](gl['FRAMEBUFFER'],gl['COLOR_ATTACHMENT0'],gl['TEXTURE_2D'],_0x1f2f2f['texture'],0x0));const _0x44d60f=new Uint8Array(_0x1b4a15*_0x4f2c2a*0x4);gl['readPixels'](0x0,0x0,_0x1b4a15,_0x4f2c2a,gl['RGBA'],gl['UNSIGNED_BYTE'],_0x44d60f),gl['bindTexture'](gl['TEXTURE_2D'],_0x1f2f2f['texture']),gl['texSubImage2D'](gl['TEXTURE_2D'],0x0,0x0,0x0,_0x1b4a15,_0x4f2c2a,gl['RGBA'],gl['UNSIGNED_BYTE'],_0x44d60f),_0x1f2f2f['ox']=0x0,_0x1f2f2f['oy']=0x0,_0x1f2f2f['texW']=_0x1b4a15,_0x1f2f2f['texH']=_0x4f2c2a,_0x1f2f2f['x']=0x0,_0x1f2f2f['y']=0x0,_0x1f2f2f['scaleX']=0x1,_0x1f2f2f['scaleY']=0x1,_0x1f2f2f['rotation']=0x0,_0x1f2f2f['px']=0.5*_0x1b4a15,_0x1f2f2f['py']=0.5*_0x4f2c2a,gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x5ef873),gl['useProgram'](_0x358fee),_0x5997b2&&gl['viewport'](_0x5997b2[0x0],_0x5997b2[0x1],_0x5997b2[0x2],_0x5997b2[0x3]);try{gl['deleteFramebuffer'](_0x5eb40f);}catch{}try{gl['deleteTexture'](_0x53241e);}catch{}needsRedraw=!0x0,'function'==typeof requestDrawIfIdle&&requestDrawIfIdle();}function drawScene(){if(!gl||!quadProgram||!canvas)return;const _0x42d634='undefined'!=typeof navigator&&navigator['maxTouchPoints']>0x0||'undefined'!=typeof window&&'ontouchstart'in window;if(gl['bindFramebuffer'](gl['FRAMEBUFFER'],null),gl['viewport'](0x0,0x0,canvas['width'],canvas['height']),gl['disable'](gl['DEPTH_TEST']),gl['disable'](gl['CULL_FACE']),gl['disable'](gl['SCISSOR_TEST']),gl['clearColor'](0x0,0x0,0x0,0x0),gl['clear'](gl['COLOR_BUFFER_BIT']),texture&&gl['isTexture'](texture)){const _0x4d2adc=new Float32Array([0x0,0x0,0x0,0x0,canvas['width'],0x0,0x1,0x0,0x0,canvas['height'],0x0,0x1,0x0,canvas['height'],0x0,0x1,canvas['width'],0x0,0x1,0x0,canvas['width'],canvas['height'],0x1,0x1]);gl['disable'](gl['BLEND']),function(_0xbc6684,_0x43826c,_0x5d72e9,_0x26cfad){if(!_0xbc6684||!_0x43826c||!gl['isTexture'](_0x43826c))return;gl['useProgram'](_0xbc6684);const _0xc69666=gl['getUniformLocation'](_0xbc6684,'u_flipY');_0xc69666&&gl['uniform1f'](_0xc69666,-0x1);const _0x8fd1d5=gl['getUniformLocation'](_0xbc6684,'u_resolution');_0x8fd1d5&&gl['uniform2f'](_0x8fd1d5,canvas['width'],canvas['height']);const _0x2584ba=gl['getUniformLocation'](_0xbc6684,'u_layerOpacity');_0x2584ba&&gl['uniform1f'](_0x2584ba,null!=_0x26cfad?_0x26cfad:0x1);const _0x313218=gl['createBuffer']();gl['bindBuffer'](gl['ARRAY_BUFFER'],_0x313218),gl['bufferData'](gl['ARRAY_BUFFER'],_0x5d72e9,gl['STREAM_DRAW']);const _0x302f9=gl['getAttribLocation'](_0xbc6684,'a_position'),_0x535fd1=gl['getAttribLocation'](_0xbc6684,'a_texCoord');_0x302f9>=0x0&&(gl['enableVertexAttribArray'](_0x302f9),gl['vertexAttribPointer'](_0x302f9,0x2,gl['FLOAT'],!0x1,0x10,0x0)),_0x535fd1>=0x0&&(gl['enableVertexAttribArray'](_0x535fd1),gl['vertexAttribPointer'](_0x535fd1,0x2,gl['FLOAT'],!0x1,0x10,0x8)),gl['activeTexture'](gl['TEXTURE0']),gl['bindTexture'](gl['TEXTURE_2D'],_0x43826c);const _0x5858ad=gl['getUniformLocation'](_0xbc6684,'u_texture')??gl['getUniformLocation'](_0xbc6684,'u_brush');_0x5858ad&&gl['uniform1i'](_0x5858ad,0x0),gl['drawArrays'](gl['TRIANGLES'],0x0,0x6),_0x302f9>=0x0&&gl['disableVertexAttribArray'](_0x302f9),_0x535fd1>=0x0&&gl['disableVertexAttribArray'](_0x535fd1),gl['bindBuffer'](gl['ARRAY_BUFFER'],null),gl['deleteBuffer'](_0x313218);}(quadProgram,texture,_0x4d2adc,0x1);}if(gl['enable'](gl['BLEND']),gl['blendFunc'](gl['SRC_ALPHA'],gl['ONE_MINUS_SRC_ALPHA']),Array['isArray'](layers))for(let _0x114401=0x0;_0x114401<layers['length'];_0x114401++){const _0x527279=layers[_0x114401];!_0x527279||!_0x527279['visible']||_0x527279['opacity']<=0x0||_0x527279['texture']&&gl['isTexture'](_0x527279['texture'])&&drawLayerWithTransform(quadProgram,_0x527279);}gl['disable'](gl['BLEND']);const _0x4f17b1=!(!transformTool||'idle'===transformTool['mode']),_0x556be7=_0x4f17b1&&!_0x42d634;if((isDrawing||_0x4f17b1||brushHUD['visible'])&&overlayProgram&&overlayTexture&&gl['isTexture'](overlayTexture)&&'function'==typeof drawBrushOverlay){gl['useProgram'](overlayProgram);const _0x5da45a=gl['getUniformLocation'](overlayProgram,'u_flipY');_0x5da45a&&gl['uniform1f'](_0x5da45a,-0x1);const _0x2060e1=gl['getUniformLocation'](overlayProgram,'u_resolution');if(_0x2060e1&&gl['uniform2f'](_0x2060e1,canvas['width'],canvas['height']),drawBrushOverlay(),_0x556be7){const _0x5de70e=overlayPosition[0x0]*canvas['width'],_0x543aad=overlayPosition[0x1]*canvas['height'],_0x793a3a=brushSize*canvas['width'],_0x134f6d=1.5*_0x793a3a,_0x2fbc72=Math['max'](0x1,0.06*_0x793a3a);'function'==typeof drawRingOverlay&&drawRingOverlay(_0x5de70e,_0x543aad,_0x134f6d,_0x2fbc72,[0x1,0x0,0x0,0.95]),'function'==typeof drawDashedLine&&drawDashedLine(lastPointer?.['cx']??_0x5de70e,lastPointer?.['cy']??_0x543aad,_0x5de70e,_0x543aad,1.5,0xa,0x6,[0x1,0x0,0x0,0.95]);}}if(_0x4f17b1&&'object'==typeof touchViz&&touchViz?.['visible']&&Array['isArray'](touchViz['pts'])&&touchViz['pts']['length']&&'function'==typeof drawRingOverlay){if(overlayProgram){gl['useProgram'](overlayProgram);const _0x557985=gl['getUniformLocation'](overlayProgram,'u_flipY');_0x557985&&gl['uniform1f'](_0x557985,-0x1);const _0x4245c8=gl['getUniformLocation'](overlayProgram,'u_resolution');_0x4245c8&&gl['uniform2f'](_0x4245c8,canvas['width'],canvas['height']);}const _0x325358=[0x0,0x1,0x0,0.95],_0x38cad7=0x14*(window['devicePixelRatio']||0x1),_0x1553e8=0x2*(window['devicePixelRatio']||0x1),_0xf50c7=0x2,_0x39d946=0xa,_0xd652d=0x6;for(const _0x56299a of touchViz['pts'])drawRingOverlay(_0x56299a['x'],_0x56299a['y'],_0x38cad7,_0x1553e8,_0x325358);if(0x2===touchViz['pts']['length']&&'function'==typeof drawDashedLine){const _0x6dc49=touchViz['pts'][0x0],_0x27a556=touchViz['pts'][0x1];drawDashedLine(_0x6dc49['x'],_0x6dc49['y'],_0x27a556['x'],_0x27a556['y'],_0xf50c7,_0x39d946,_0xd652d,_0x325358);}}gl['bindBuffer'](gl['ARRAY_BUFFER'],null),gl['bindTexture'](gl['TEXTURE_2D'],null),gl['useProgram'](null),maybeAutoHideBrushHUD();}document['addEventListener']('keydown',_0x398769=>{if('function'==typeof isUserTyping&&isUserTyping())return;if(void 0x0!==spacePanning&&spacePanning)return;if(void 0x0!==isDrawing&&isDrawing)return;if(_0x398769['ctrlKey']||_0x398769['metaKey']||_0x398769['altKey'])return;const _0x1354bc=_0x398769['key'],_0x24a963=_0x1354bc['toLowerCase'](),_0x21582a='ArrowUp'===_0x1354bc||'ArrowDown'===_0x1354bc||'ArrowLeft'===_0x1354bc||'ArrowRight'===_0x1354bc,_0x38d598=Math['PI']/0xb4;if(_0x398769['shiftKey']&&'d'===_0x24a963){_0x398769['preventDefault'](),_0x398769['stopImmediatePropagation']();const _0x55b299=Array['isArray'](layers)?layers['length']:0x0;try{'function'==typeof duplicateLayer&&duplicateLayer('number'==typeof activeLayerIndex?activeLayerIndex:void 0x0);}catch{}if((Array['isArray'](layers)?layers['length']:0x0)>_0x55b299){try{const _0x1a9436='function'==typeof getActiveLayer?getActiveLayer():layers&&layers[activeLayerIndex]?layers[activeLayerIndex]:null;_0x1a9436&&(_0x1a9436['x']=(Number['isFinite'](_0x1a9436['x'])?_0x1a9436['x']:0x0)+0xa,_0x1a9436['y']=(Number['isFinite'](_0x1a9436['y'])?_0x1a9436['y']:0x0)+0xa,'function'==typeof startTransform&&startTransform('grab'));}catch{}try{rebuildLayersUI?.();}catch{}try{showStatusMessage?.('Layer\x20duplicated\x20(Shift+D)','success');}catch{}needsRedraw=!0x0,'function'==typeof requestDrawIfIdle&&requestDrawIfIdle();}return;}if('function'==typeof isMobile&&!isMobile()&&'idle'!==transformTool?.['mode']&&_0x21582a){_0x398769['preventDefault'](),_0x398769['stopImmediatePropagation']();const _0x51ec49='function'==typeof getActiveLayer?getActiveLayer():null;if(!_0x51ec49)return;Number['isFinite'](_0x51ec49['x'])||(_0x51ec49['x']=0x0),Number['isFinite'](_0x51ec49['y'])||(_0x51ec49['y']=0x0),Number['isFinite'](_0x51ec49['scaleX'])||(_0x51ec49['scaleX']=0x1),Number['isFinite'](_0x51ec49['scaleY'])||(_0x51ec49['scaleY']=0x1),Number['isFinite'](_0x51ec49['rotation'])||(_0x51ec49['rotation']=0x0);const _0x48e8b6=transformTool['mode'];if('grab'===_0x48e8b6){const _0x547445=_0x398769['shiftKey']?0xa:0x1;'ArrowLeft'===_0x1354bc&&(_0x51ec49['x']-=_0x547445),'ArrowRight'===_0x1354bc&&(_0x51ec49['x']+=_0x547445),'ArrowUp'===_0x1354bc&&(_0x51ec49['y']-=_0x547445),'ArrowDown'===_0x1354bc&&(_0x51ec49['y']+=_0x547445);}else{if('scale'===_0x48e8b6){const _0x5e5335=_0x398769['shiftKey']?0.1:0.01,_0xab4ff3=_0x36aa3d=>Math['max'](0.001,_0x36aa3d);if(_0x398769['shiftKey']){const _0x4d37ed='ArrowRight'===_0x1354bc||'ArrowUp'===_0x1354bc?0x1:'ArrowLeft'===_0x1354bc||'ArrowDown'===_0x1354bc?-0x1:0x0;if(0x0!==_0x4d37ed){const _0x171eb8=0x1+_0x4d37ed*_0x5e5335;_0x51ec49['scaleX']=_0xab4ff3(_0x51ec49['scaleX']*_0x171eb8),_0x51ec49['scaleY']=_0xab4ff3(_0x51ec49['scaleY']*_0x171eb8);}}else'ArrowLeft'===_0x1354bc?_0x51ec49['scaleX']=_0xab4ff3(_0x51ec49['scaleX']*(0x1-_0x5e5335)):'ArrowRight'===_0x1354bc?_0x51ec49['scaleX']=_0xab4ff3(_0x51ec49['scaleX']*(0x1+_0x5e5335)):'ArrowUp'===_0x1354bc?_0x51ec49['scaleY']=_0xab4ff3(_0x51ec49['scaleY']*(0x1+_0x5e5335)):'ArrowDown'===_0x1354bc&&(_0x51ec49['scaleY']=_0xab4ff3(_0x51ec49['scaleY']*(0x1-_0x5e5335)));}else{if('rotate'===_0x48e8b6){const _0x2cec68=_0x398769['shiftKey']?0x5:0x1,_0x241f77='ArrowRight'===_0x1354bc||'ArrowDown'===_0x1354bc?0x1:'ArrowLeft'===_0x1354bc||'ArrowUp'===_0x1354bc?-0x1:0x0;_0x51ec49['rotation']+=_0x241f77*_0x2cec68*_0x38d598;}else{const _0x11722a=_0x398769['shiftKey']?0xa:0x1;'ArrowLeft'===_0x1354bc&&(_0x51ec49['x']-=_0x11722a),'ArrowRight'===_0x1354bc&&(_0x51ec49['x']+=_0x11722a),'ArrowUp'===_0x1354bc&&(_0x51ec49['y']-=_0x11722a),'ArrowDown'===_0x1354bc&&(_0x51ec49['y']+=_0x11722a);}}}try{startRender?.('transform');}catch{}return needsRedraw=!0x0,void('function'==typeof requestDrawIfIdle&&requestDrawIfIdle());}if('function'==typeof isMobile&&!isMobile()&&'idle'===transformTool?.['mode']&&_0x398769['shiftKey']&&('ArrowUp'===_0x1354bc||'ArrowDown'===_0x1354bc)){if(_0x398769['preventDefault'](),_0x398769['stopImmediatePropagation'](),!layers||!layers['length'])return;const _0x447378=Number['isInteger'](activeLayerIndex)?activeLayerIndex:0x0,_0x5c39d='ArrowUp'===_0x1354bc?0x1:-0x1,_0x2287e7=Math['max'](0x0,Math['min'](layers['length']-0x1,_0x447378+_0x5c39d));if(_0x2287e7===_0x447378)return;const _0x55f4b2=layers[_0x447378]?.['name']??'';!function(_0x4cc071,_0x2d268f){if(!Array['isArray'](layers)||0x0===layers['length'])return;if((_0x4cc071=Math['max'](0x0,Math['min'](layers['length']-0x1,0x0|_0x4cc071)))===(_0x2d268f=Math['max'](0x0,Math['min'](layers['length']-0x1,0x0|_0x2d268f))))return;const _0x18a2ab=layers['splice'](_0x4cc071,0x1)[0x0];layers['splice'](_0x2d268f,0x0,_0x18a2ab);const _0x1d33f5=Number['isInteger'](activeLayerIndex)?activeLayerIndex:0x0;_0x1d33f5===_0x4cc071?activeLayerIndex=_0x2d268f:_0x4cc071<_0x1d33f5&&_0x1d33f5<=_0x2d268f?activeLayerIndex=_0x1d33f5-0x1:_0x2d268f<=_0x1d33f5&&_0x1d33f5<_0x4cc071&&(activeLayerIndex=_0x1d33f5+0x1);try{recordLayerReorder?.(_0x4cc071,_0x2d268f);}catch{}try{rebuildLayersUI?.();}catch{}try{syncActiveAliases?.();}catch{}needsRedraw=!0x0,'function'==typeof requestDrawIfIdle&&requestDrawIfIdle();}(_0x447378,_0x2287e7);try{showStatusMessage?.('Moved\x20'+(_0x55f4b2||'layer')+'\x20'+(_0x5c39d>0x0?'up':'down'),'info');}catch{}return;}if(!('function'!=typeof isMobile||isMobile()||'idle'!==transformTool?.['mode']||_0x398769['shiftKey']||'ArrowUp'!==_0x1354bc&&'ArrowDown'!==_0x1354bc)){if(_0x398769['preventDefault'](),_0x398769['stopImmediatePropagation'](),!layers||!layers['length'])return;try{'idle'!==transformTool?.['mode']&&endTransform(!0x1);}catch{}try{clearTransformLockAll?.();}catch{}const _0x2050e5='ArrowUp'===_0x1354bc?0x1:-0x1,_0x3a6d8d=Math['max'](0x0,Math['min'](layers['length']-0x1,activeLayerIndex+_0x2050e5));if(_0x3a6d8d!==activeLayerIndex){activeLayerIndex=_0x3a6d8d;try{syncActiveAliases?.();}catch{}try{rebuildLayersUI?.();}catch{}try{showStatusMessage?.('Selected:\x20'+layers[activeLayerIndex]['name'],'info');}catch{}needsRedraw=!0x0,'function'==typeof requestDrawIfIdle&&requestDrawIfIdle();}return;}if('h'===_0x24a963){_0x398769['preventDefault'](),_0x398769['stopImmediatePropagation']();const _0x1cf1f4=activeLayerIndex,_0x9cd0df=layers?.[_0x1cf1f4];if(!_0x9cd0df)return;const _0x5eb909=!!_0x9cd0df['visible'],_0x2239df=!_0x5eb909;_0x9cd0df['visible']=_0x2239df;try{recordLayerVisibilityChange?.(_0x1cf1f4,_0x5eb909,_0x2239df);}catch{}try{rebuildLayersUI?.();}catch{}try{showStatusMessage?.(_0x2239df?'Layer\x20visible':'Layer\x20hidden','info');}catch{}return needsRedraw=!0x0,void('function'==typeof requestDrawIfIdle&&requestDrawIfIdle());}if('g'===_0x24a963)return _0x398769['preventDefault'](),_0x398769['stopImmediatePropagation'](),void('function'==typeof startTransform&&startTransform('grab'));if('s'===_0x24a963)return _0x398769['preventDefault'](),_0x398769['stopImmediatePropagation'](),void('function'==typeof startTransform&&startTransform('scale',_0x398769['shiftKey']));if('r'===_0x24a963)return _0x398769['preventDefault'](),_0x398769['stopImmediatePropagation'](),void('function'==typeof startTransform&&startTransform('rotate',_0x398769['shiftKey']));if('Escape'===_0x1354bc&&'idle'!==transformTool?.['mode']){const _0x426531='function'==typeof getActiveLayer?getActiveLayer():null;return _0x426531&&transformTool['ref']&&(_0x426531['x']=transformTool['ref']['x'],_0x426531['y']=transformTool['ref']['y'],_0x426531['scaleX']=transformTool['ref']['scaleX'],_0x426531['scaleY']=transformTool['ref']['scaleY'],_0x426531['rotation']=transformTool['ref']['rotation']),'function'==typeof endTransform&&endTransform(!0x1),needsRedraw=!0x0,_0x398769['preventDefault'](),void _0x398769['stopImmediatePropagation']();}if(('Enter'===_0x1354bc||'Return'===_0x1354bc)&&'idle'!==transformTool?.['mode'])return'function'==typeof endTransform&&endTransform(),needsRedraw=!0x0,_0x398769['preventDefault'](),void _0x398769['stopImmediatePropagation']();if('t'===_0x24a963){_0x398769['preventDefault'](),_0x398769['stopImmediatePropagation']();const _0x1454a0='function'==typeof getActiveLayer?getActiveLayer():null;if(!_0x1454a0)return;_0x1454a0['x']=0x0,_0x1454a0['y']=0x0,_0x1454a0['scaleX']=0x1,_0x1454a0['scaleY']=0x1,_0x1454a0['rotation']=0x0;try{showStatusMessage?.('Layer\x20transform\x20reset','info');}catch{}return needsRedraw=!0x0,void('function'==typeof requestDrawIfIdle&&requestDrawIfIdle());}},{'capture':!0x0});let dynamicModeEnabled=!0x1,reverseModeEnabled=!0x1,intuitiveMode=!0x0;function showStatusMessage(_0x4a84a2,_0x3686a1='info'){console['log']('showStatusMessage',_0x4a84a2);const _0x5f5c7d=document['createElement']('div');_0x5f5c7d['classList']['add']('status-message',_0x3686a1),_0x5f5c7d['innerText']=_0x4a84a2,document['body']['appendChild'](_0x5f5c7d),setTimeout(()=>{_0x5f5c7d['classList']['add']('fade-out'),setTimeout(()=>_0x5f5c7d['remove'](),0x2bc);},0x2bc);}function downscaleImage(_0x13c575,_0x27066c,_0x864e88){const _0x391ef2=Math['min'](_0x27066c/_0x13c575['width'],_0x864e88/_0x13c575['height'],0x1);if(_0x391ef2<0x1){const _0xeb2ba6=document['createElement']('canvas');return _0xeb2ba6['width']=Math['floor'](_0x13c575['width']*_0x391ef2),_0xeb2ba6['height']=Math['floor'](_0x13c575['height']*_0x391ef2),(_0xeb2ba6['getContext']('2d')['drawImage'](_0x13c575,0x0,0x0,_0xeb2ba6['width'],_0xeb2ba6['height']),_0xeb2ba6['toDataURL']('image/jpeg',0.7));}return null;}function downscaleImageToWindow(_0x128b47){const _0x3df2f0=window['innerWidth'],_0x2f716c=window['innerHeight'],_0x4206fd=Math['min'](_0x3df2f0/_0x128b47['width'],_0x2f716c/_0x128b47['height'],0x1);if(_0x4206fd<0x1){const _0x1cf745=document['createElement']('canvas');return _0x1cf745['width']=Math['floor'](_0x128b47['width']*_0x4206fd),_0x1cf745['height']=Math['floor'](_0x128b47['height']*_0x4206fd),(_0x1cf745['getContext']('2d')['drawImage'](_0x128b47,0x0,0x0,_0x1cf745['width'],_0x1cf745['height']),_0x1cf745['toDataURL']('image/jpeg',0.7));}return null;}document['addEventListener']('keydown',_0x21ec3c=>{isUserTyping()||(_0x21ec3c['shiftKey']&&'e'===_0x21ec3c['key']['toLowerCase']()&&(isErasing=!isErasing,showStatusMessage(isErasing?'Mode:\x20Erase':'Mode:\x20Paint','info'),needsRedraw=!0x0),_0x21ec3c['shiftKey']&&'g'===_0x21ec3c['key']['toLowerCase']()&&(lineMode=!lineMode,showStatusMessage('Line\x20Mode:\x20'+(lineMode?'ON':'OFF'),'info'),needsRedraw=!0x0));}),imageLoader['addEventListener']('change',_0x44e964=>{console['log']('[DEBUG]\x20imageLoader\x20change\x20event\x20fired:',_0x44e964);const _0xf905f4=_0x44e964['target']['files'][0x0];if(_0xf905f4){console['log']('[DEBUG]\x20Selected\x20file:',_0xf905f4['name'],_0xf905f4['type'],_0xf905f4['size']);const _0x256e4f=new FileReader();_0x256e4f['onerror']=_0x175705=>{console['error']('[DEBUG]\x20FileReader\x20error:',_0x175705);},_0x256e4f['onload']=_0x224295=>{console['log']('[DEBUG]\x20FileReader\x20onload\x20triggered.\x20Data\x20length:',_0x224295['target']['result']['length']);const _0x18a05b=new Image();_0x18a05b['onerror']=_0x5f1fec=>{console['error']('[DEBUG]\x20Image\x20load\x20error:',_0x5f1fec);},_0x18a05b['onload']=()=>{console['log']('[DEBUG]\x20Image\x20loaded\x20successfully.\x20Dimensions:',_0x18a05b['width'],_0x18a05b['height']);const _0x961138=downscaleImageToWindow(_0x18a05b);_0x961138?(console['log']('[DEBUG]\x20Downscaled\x20image\x20to\x20window\x20dimensions.'),_0x18a05b['src']=_0x961138,_0x18a05b['onload']=()=>{console['log']('[DEBUG]\x20Downscaled\x20image\x20loaded.\x20Dimensions:',_0x18a05b['width'],_0x18a05b['height']),currentImage=_0x18a05b,fixedFBOWidth=_0x18a05b['width'],fixedFBOHeight=_0x18a05b['height'],console['log']('[DEBUG]\x20Calling\x20initPaintLayerFixed()'),initPaintLayerFixed(),initFloodFillProgram(),console['log']('[DEBUG]\x20Calling\x20updateCanvasSize(currentImage)'),updateCanvasSize(currentImage),console['log']('[DEBUG]\x20Calling\x20createTextureFromImage(currentImage)'),createTextureFromImage(currentImage),canvas['offsetWidth'],canvasWrapper['offsetWidth'],zoomScale=0x1,panX=(canvasWrapper['clientWidth']-canvas['width'])/0x2,panY=(canvasWrapper['clientHeight']-canvas['height'])/0x2,updateCanvasTransform(),resetStrokeState(),needsRedraw=!0x0;}):(console['log']('[DEBUG]\x20No\x20downscaling\x20needed.'),currentImage=_0x18a05b,fixedFBOWidth=_0x18a05b['width'],fixedFBOHeight=_0x18a05b['height'],console['log']('[DEBUG]\x20Calling\x20initPaintLayerFixed()'),initPaintLayerFixed(),initFloodFillProgram(),console['log']('[DEBUG]\x20Calling\x20updateCanvasSize(currentImage)'),updateCanvasSize(currentImage),console['log']('[DEBUG]\x20Calling\x20createTextureFromImage(currentImage)'),createTextureFromImage(currentImage),canvas['offsetWidth'],canvasWrapper['offsetWidth'],zoomScale=0x1,panX=(canvasWrapper['clientWidth']-canvas['width'])/0x2,panY=(canvasWrapper['clientHeight']-canvas['height'])/0x2,updateCanvasTransform(),resetStrokeState(),needsRedraw=!0x0);},console['log']('[DEBUG]\x20Setting\x20image\x20src\x20to\x20FileReader\x20result'),_0x18a05b['src']=_0x224295['target']['result'];};try{_0x256e4f['readAsDataURL'](_0xf905f4),console['log']('[DEBUG]\x20FileReader\x20readAsDataURL\x20called\x20successfully');}catch(_0x40aca0){console['error']('[DEBUG]\x20Exception\x20while\x20reading\x20file:',_0x40aca0);}}else console['warn']('[DEBUG]\x20No\x20file\x20selected.');});const imageLoaderButton=document['getElementById']('imageLoaderButton');async function clearCanvas(_0x31f835=!0x0){const _0x240f27=History['_captureProject']?History['_captureProject']():null;try{console['log']('[Clear]\x20start');try{Array['isArray'](layers)&&layers['forEach'](_0x3c9248=>{try{gl['deleteTexture'](_0x3c9248['texture']);}catch{}try{gl['deleteFramebuffer'](_0x3c9248['fbo']);}catch{}});}catch(_0x33f760){console['warn']('[Clear]\x20warning\x20disposing\x20old\x20layers:',_0x33f760);}const _0xef0862=Math['max'](0x1,0x0|window['visualViewport']?.['width']||0x0|window['innerWidth']),_0x2e6813=Math['max'](0x1,0x0|window['visualViewport']?.['height']||0x0|window['innerHeight']);let _0x275e5e=null;if('function'==typeof createPaperImage)try{_0x275e5e=await createPaperImage(_0xef0862,_0x2e6813);}catch(_0x4f1a55){console['warn']('[Clear]\x20createPaperImage\x20failed,\x20falling\x20back\x20to\x20flat\x20paper:',_0x4f1a55);}if(!_0x275e5e){const _0x353df4=document['createElement']('canvas');_0x353df4['width']=_0xef0862,_0x353df4['height']=_0x2e6813;const _0x260602=_0x353df4['getContext']('2d');_0x260602['fillStyle']='#f2efe4',_0x260602['fillRect'](0x0,0x0,_0xef0862,_0x2e6813),_0x275e5e=await new Promise((_0x23cea9,_0x502b6b)=>{const _0x1d618a=new Image();_0x1d618a['onload']=()=>_0x23cea9(_0x1d618a),_0x1d618a['onerror']=_0x502b6b,_0x1d618a['src']=_0x353df4['toDataURL']('image/png');});}currentImage=_0x275e5e,fixedFBOWidth=_0x275e5e['width'],fixedFBOHeight=_0x275e5e['height'],'function'==typeof setDocumentSize?setDocumentSize(_0x275e5e['width'],_0x275e5e['height']):(canvas['width']=_0x275e5e['width'],canvas['height']=_0x275e5e['height'],gl['viewport'](0x0,0x0,_0x275e5e['width'],_0x275e5e['height']));try{initFloodFBOs?.();}catch{}initPaintLayerFixed();try{if(texture)try{gl['deleteTexture'](texture);}catch{}createTextureFromImage(_0x275e5e);}catch(_0xae859d){console['error']('[Clear]\x20createTextureFromImage\x20failed:',_0xae859d);}try{updateCanvasSize(_0x275e5e);}catch{}zoomScale=0x1,panX=panY=0x0;try{centerCanvasInWrapper?.();}catch{}viewRotation=0x0;try{updateCanvasTransform?.();}catch{}try{resetStrokeState?.();}catch{}try{syncActiveAliases?.();}catch{}try{rebuildLayersUI?.();}catch{}try{showStatusMessage?.('New\x20project\x20created\x20to\x20match\x20current\x20window.','success');}catch{}needsRedraw=!0x0;try{requestDrawIfIdle?.();}catch{}console['log']('[Clear]\x20done',{'w':_0x275e5e['width'],'h':_0x275e5e['height']});}catch(_0x26173e){console['error']('[Clear]\x20fatal\x20error:',_0x26173e);try{showStatusMessage?.('Clear\x20failed.','error');}catch{}}if(_0x31f835&&History['_captureProject']){const _0x165b43=History['_captureProject']();try{recordClearProject?.(_0x240f27,_0x165b43);}catch(_0x2ae2f0){console['warn']('[Clear]\x20recordClearProject\x20failed;\x20pushing\x20generic\x20history\x20entry:',_0x2ae2f0);try{History['push']?.({'type':'clear_project','beforeAll':_0x240f27,'afterAll':_0x165b43});}catch{}}}}function resetPageZoomFromInputs(){const _0x403da6=document['querySelector']('meta[name=\x22viewport\x22]');if(!_0x403da6)return;const _0x501b96=_0x403da6['getAttribute']('content')||'width=device-width,\x20initial-scale=1',_0x214c97=_0x501b96['replace'](/,\s*maximum-scale=[^,]+/i,'');_0x403da6['setAttribute']('content',_0x214c97+',\x20maximum-scale=1'),setTimeout(()=>_0x403da6['setAttribute']('content',_0x501b96),0x50);}function blurActiveElement(){document['activeElement']&&'function'==typeof document['activeElement']['blur']&&document['activeElement']['blur']();}function resetToCurrentWindow(){const _0x133c46=0x0|(window['visualViewport']?.['width']||window['innerWidth']),_0x129d8f=0x0|(window['visualViewport']?.['height']||window['innerHeight']),_0x1f28a1=document['createElement']('canvas');_0x1f28a1['width']=_0x133c46,_0x1f28a1['height']=_0x129d8f;const _0x22c05d=_0x1f28a1['getContext']('2d');_0x22c05d['fillStyle']='#f2efe4',_0x22c05d['fillRect'](0x0,0x0,_0x133c46,_0x129d8f);const _0x5164cd=_0x22c05d['createImageData'](_0x133c46,_0x129d8f);for(let _0x2776fe=0x0;_0x2776fe<_0x5164cd['data']['length'];_0x2776fe+=0x4){const _0xd9a7ef=0x28*Math['random']()|0x0;_0x5164cd['data'][_0x2776fe+0x0]=0xe6+_0xd9a7ef,_0x5164cd['data'][_0x2776fe+0x1]=0xe2+_0xd9a7ef,_0x5164cd['data'][_0x2776fe+0x2]=0xda+_0xd9a7ef,_0x5164cd['data'][_0x2776fe+0x3]=0xff;}_0x22c05d['globalAlpha']=0.15,_0x22c05d['putImageData'](_0x5164cd,0x0,0x0),_0x22c05d['globalAlpha']=0x1;const _0x23f7d5=new Image();_0x23f7d5['onload']=()=>{currentImage=_0x23f7d5,fixedFBOWidth=_0x23f7d5['width'],fixedFBOHeight=_0x23f7d5['height'],initFloodFBOs(),initPaintLayerFixed(),updateCanvasSize(_0x23f7d5),createTextureFromImage(_0x23f7d5),zoomScale=0x1,panX=panY=0x0,centerCanvasInWrapper?.(),resetStrokeState(),needsRedraw=!0x0,showStatusMessage('New\x20document\x20sized\x20to\x20window','success');},_0x23f7d5['src']=_0x1f28a1['toDataURL']('image/png');}imageLoaderButton['addEventListener']('click',()=>{console['log']('[DEBUG]\x20imageLoaderButton\x20clicked.'),document['getElementById']('imageLoader')['click']();}),imageLoaderButton['addEventListener']('touchend',()=>{console['log']('[DEBUG]\x20imageLoaderButton\x20touchend\x20triggered.'),document['getElementById']('imageLoader')['click']();}),/iPad|iPhone|iPod/['test'](navigator['userAgent'])&&!window['MSStream']&&(console['log']('[DEBUG]\x20Detected\x20iOS\x20device\x20–\x20removing\x20capture\x20attribute'),imageLoader['removeAttribute']('capture')),document['addEventListener']('DOMContentLoaded',async()=>{const _0x3df77c='artworks';let _0x1d9529;async function _0x1cd33d(){return _0x1d9529||new Promise((_0x90ce4d,_0x3fff9b)=>{const _0x4f19bf=indexedDB['open']('DrawingAppDB',0x1);_0x4f19bf['onupgradeneeded']=_0xa0094b=>{let _0xa886c5=_0xa0094b['target']['result'];_0xa886c5['objectStoreNames']['contains'](_0x3df77c)||_0xa886c5['createObjectStore'](_0x3df77c,{'keyPath':'id'});},_0x4f19bf['onsuccess']=()=>_0x90ce4d(_0x1d9529=_0x4f19bf['result']),_0x4f19bf['onerror']=()=>_0x3fff9b('IndexedDB\x20failed\x20to\x20open');});}async function _0x7a5bfd(_0x5a8400,_0x34ef5c=!0x1,_0x2cdec6=null,_0x5b81a3=!0x1){try{const _0x33fd2e=await _0x1cd33d(),_0x43a9c5=_0x193ca4(!0x0),_0x4d03a0=await _0x15e239(_0x43a9c5,'image/png',0.92),_0xc95ed9=0x140,_0x5d966c=Math['min'](_0xc95ed9/_0x43a9c5['width'],_0xc95ed9/_0x43a9c5['height'],0x1),_0x1942ff=document['createElement']('canvas');_0x1942ff['width']=Math['round'](_0x43a9c5['width']*_0x5d966c),_0x1942ff['height']=Math['round'](_0x43a9c5['height']*_0x5d966c),_0x1942ff['getContext']('2d')['drawImage'](_0x43a9c5,0x0,0x0,_0x1942ff['width'],_0x1942ff['height']);const _0x36c180=await _0x15e239(_0x1942ff,'image/webp',0.7),_0x34a22c=await new Promise(_0x8db373=>{const _0x4e821c=new FileReader();_0x4e821c['onloadend']=()=>_0x8db373(_0x4e821c['result']),_0x4e821c['readAsDataURL'](_0x36c180);}),_0x23961c=fixedFBOWidth,_0x483945=fixedFBOHeight;let _0x5d4605=null;if(currentImage){const _0x2ed634=document['createElement']('canvas');_0x2ed634['width']=_0x23961c,_0x2ed634['height']=_0x483945,(_0x2ed634['getContext']('2d')['drawImage'](currentImage,0x0,0x0,_0x23961c,_0x483945),_0x5d4605=await _0x15e239(_0x2ed634,'image/png',0.92));}async function _0x4f558a(_0x2a3537,_0x555efc,_0x3b8018){const _0x1516b1=new Uint8Array(_0x555efc*_0x3b8018*0x4);gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x2a3537),gl['readPixels'](0x0,0x0,_0x555efc,_0x3b8018,gl['RGBA'],gl['UNSIGNED_BYTE'],_0x1516b1),gl['bindFramebuffer'](gl['FRAMEBUFFER'],null);const _0x335a8f=document['createElement']('canvas');_0x335a8f['width']=_0x555efc,_0x335a8f['height']=_0x3b8018;const _0x3c44ed=_0x335a8f['getContext']('2d'),_0x74cd5b=new ImageData(new Uint8ClampedArray(_0x1516b1),_0x555efc,_0x3b8018);_0x3c44ed['putImageData'](_0x74cd5b,0x0,0x0);const _0x9b0526=document['createElement']('canvas');_0x9b0526['width']=_0x555efc,_0x9b0526['height']=_0x3b8018;const _0x287388=_0x9b0526['getContext']('2d');return _0x287388['save'](),_0x287388['translate'](_0x555efc/0x2,_0x3b8018/0x2),_0x287388['scale'](-0x1,-0x1),_0x287388['rotate'](Math['PI']),_0x287388['drawImage'](_0x335a8f,-_0x555efc/0x2,-_0x3b8018/0x2),_0x287388['restore'](),_0x15e239(_0x9b0526,'image/png',0.92);}const _0x4c1a5c=[];for(let _0x409dbe=0x0;_0x409dbe<layers['length'];_0x409dbe++){const _0x399ae6=layers[_0x409dbe],_0x5d5f5f=Math['max'](0x1,0x0|(Number(_0x399ae6['texW'])||_0x23961c)),_0x42e82d=Math['max'](0x1,0x0|(Number(_0x399ae6['texH'])||_0x483945)),_0x488046=await _0x4f558a(_0x399ae6['fbo'],_0x5d5f5f,_0x42e82d);_0x4c1a5c['push']({'name':_0x399ae6['name'],'visible':!!_0x399ae6['visible'],'opacity':Number(_0x399ae6['opacity'])||0x1,'x':Number(_0x399ae6['x'])||0x0,'y':Number(_0x399ae6['y'])||0x0,'scaleX':Number['isFinite'](_0x399ae6['scaleX'])?_0x399ae6['scaleX']:0x1,'scaleY':Number['isFinite'](_0x399ae6['scaleY'])?_0x399ae6['scaleY']:0x1,'rotation':Number(_0x399ae6['rotation'])||0x0,'px':Number['isFinite'](_0x399ae6['px'])?_0x399ae6['px']:0.5*_0x23961c,'py':Number['isFinite'](_0x399ae6['py'])?_0x399ae6['py']:0.5*_0x483945,'texW':_0x5d5f5f,'texH':_0x42e82d,'ox':Number(_0x399ae6['ox'])||0x0,'oy':Number(_0x399ae6['oy'])||0x0,'blob':_0x488046});}const _0x635f9b=document['getElementById']('existingArtworkId'),_0x34b026=_0x635f9b?_0x635f9b['value']:null,_0x439b17=_0x34ef5c?_0x2cdec6??currentArtworkId??_0x34b026??Date['now']():Date['now'](),_0x38e961={'id':_0x439b17,'name':_0x5a8400||'Untitled\x20'+_0x439b17,'date':new Date()['toISOString'](),'username':'User','appName':'Web\x20Paint','image':_0x4d03a0,'thumbnail':_0x34a22c,'project':{'v':0x2,'width':_0x23961c,'height':_0x483945,'backgroundBlob':_0x5d4605,'layers':_0x4c1a5c}},_0x403a78=_0x33fd2e['transaction'](_0x3df77c,'readwrite');_0x403a78['objectStore'](_0x3df77c)['put'](_0x38e961),_0x403a78['oncomplete']=()=>{if(_0x5b81a3||_0xc77734(_0x34ef5c?'Artwork\x20overwritten!':'Artwork\x20saved!','success'),_0x635f9b&&(_0x635f9b['value']=_0x439b17),currentArtworkId=_0x439b17,!_0x5b81a3&&_0x287caf&&_0x287caf['readyState']===WebSocket['OPEN']){const _0x2b2531=JSON['parse'](localStorage['getItem']('userProfile'))||{},_0x45af50={'type':'image','clientId':_0x214697,'nickname':_0x2b2531['nickname']?.['trim']()||'','profileImage':_0x2b2531['image']||'','imageData':_0x38e961['thumbnail'],'imageName':_0x38e961['name'],'timestamp':Date['now']()};_0x287caf['send'](JSON['stringify'](_0x45af50));}},_0x403a78['onerror']=_0x45c352=>{console['error']('[saveArtwork]\x20IndexedDB\x20ERROR:',_0x45c352),_0x5b81a3||_0xc77734('Error\x20saving\x20artwork.','error');};}catch(_0x45b22e){console['error']('[saveArtwork]\x20ERROR:',_0x45b22e),_0x5b81a3||_0xc77734('Error\x20saving\x20artwork.','error');}}const _0x1faeb3='__autosave__';let _0x3cf0db=null;async function _0x44a6dc(){await _0x1cd33d();const _0x420b1a=document['getElementById']('artworkName'),_0x1dc45c=_0x420b1a?_0x420b1a['value']:'';await _0x7a5bfd(_0x1dc45c||'Autosave',!0x0,_0x1faeb3,{'quiet':!0x0});}async function _0x5b16b0(_0x5a9540){if(_0x5a9540){if(currentArtworkId=_0x5a9540['id'],_0x5a9540['project']&&_0x5a9540['project']['layers']&&_0x5a9540['project']['layers']['length']){const _0x50d3ee=0x0|_0x5a9540['project']['width'],_0x56c391=0x0|_0x5a9540['project']['height'];if(fixedFBOWidth=_0x50d3ee,fixedFBOHeight=_0x56c391,initFloodFBOs(),initPaintLayerFixed(),_0x5a9540['project']['backgroundBlob']){const _0x4803c3=URL['createObjectURL'](_0x5a9540['project']['backgroundBlob']),_0x54cd34=new Image();await new Promise(_0x2fe744=>{_0x54cd34['onload']=()=>{currentImage=_0x54cd34,updateCanvasSize(_0x54cd34),createTextureFromImage(_0x54cd34),canvas['offsetWidth'],canvasWrapper['offsetWidth'],zoomScale=0x1,panX=(canvasWrapper['clientWidth']-canvas['width'])/0x2,panY=(canvasWrapper['clientHeight']-canvas['height'])/0x2,updateCanvasTransform(),resetStrokeState(),needsRedraw=!0x0,URL['revokeObjectURL'](_0x4803c3),_0x2fe744();},_0x54cd34['src']=_0x4803c3;});}else currentImage=null,texture=null,updateCanvasSize({'width':_0x50d3ee,'height':_0x56c391});function _0x4a43c2(_0x253630,_0x287fb6,_0x17d309,_0x2ef274){const _0x2945d7=document['createElement']('canvas');_0x2945d7['width']=_0x17d309,_0x2945d7['height']=_0x2ef274;const _0x27f76a=_0x2945d7['getContext']('2d');_0x27f76a['clearRect'](0x0,0x0,_0x17d309,_0x2ef274),_0x27f76a['drawImage'](_0x253630,0x0,0x0,_0x17d309,_0x2ef274);const _0x43e156=gl['createTexture']();gl['bindTexture'](gl['TEXTURE_2D'],_0x43e156),gl['pixelStorei'](gl['UNPACK_FLIP_Y_WEBGL'],!0x1),gl['pixelStorei'](gl['UNPACK_PREMULTIPLY_ALPHA_WEBGL'],!0x1),gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],gl['RGBA'],gl['UNSIGNED_BYTE'],_0x2945d7),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MIN_FILTER'],gl['LINEAR']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MAG_FILTER'],gl['LINEAR']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_S'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_T'],gl['CLAMP_TO_EDGE']),gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x287fb6),gl['viewport'](0x0,0x0,_0x17d309,_0x2ef274),gl['disable'](gl['DEPTH_TEST']),gl['disable'](gl['CULL_FACE']),gl['disable'](gl['SCISSOR_TEST']),gl['disable'](gl['BLEND']),gl['clearColor'](0x0,0x0,0x0,0x0),gl['clear'](gl['COLOR_BUFFER_BIT']),gl['useProgram'](quadProgram);const _0x5eef00=gl['getUniformLocation'](quadProgram,'u_flipY'),_0x2d373b=gl['getUniformLocation'](quadProgram,'u_resolution'),_0x451f75=gl['getUniformLocation'](quadProgram,'u_layerOpacity'),_0x5e60ff=gl['getUniformLocation'](quadProgram,'u_texture')||gl['getUniformLocation'](quadProgram,'u_image');_0x5eef00&&gl['uniform1f'](_0x5eef00,0x1),_0x2d373b&&gl['uniform2f'](_0x2d373b,_0x17d309,_0x2ef274),_0x451f75&&gl['uniform1f'](_0x451f75,0x1),gl['activeTexture'](gl['TEXTURE0']),gl['bindTexture'](gl['TEXTURE_2D'],_0x43e156),_0x5e60ff&&gl['uniform1i'](_0x5e60ff,0x0),__bindAndDrawTexturedQuad(quadProgram,_0x17d309,_0x2ef274),gl['bindFramebuffer'](gl['FRAMEBUFFER'],null),gl['deleteTexture'](_0x43e156);}layers['forEach'](_0x14cd7a=>{gl['deleteTexture'](_0x14cd7a['texture']),gl['deleteFramebuffer'](_0x14cd7a['fbo']);}),layers=[];for(const _0x4c46f2 of _0x5a9540['project']['layers']){const _0x3d5d64=Math['max'](0x1,0x0|(Number(_0x4c46f2['texW'])||_0x50d3ee)),_0x33f7ce=Math['max'](0x1,0x0|(Number(_0x4c46f2['texH'])||_0x56c391)),_0x523501=Number(_0x4c46f2['ox'])||0x0,_0x38a31f=Number(_0x4c46f2['oy'])||0x0,{texture:_0x10b627,fbo:_0x292601}=createLayerFBO(_0x3d5d64,_0x33f7ce);if(_0x4c46f2['blob']){const _0x1aaa30=URL['createObjectURL'](_0x4c46f2['blob']),_0x3b9f26=new Image();await new Promise(_0x48f48c=>{_0x3b9f26['onload']=()=>{_0x4a43c2(_0x3b9f26,_0x292601,_0x3d5d64,_0x33f7ce),URL['revokeObjectURL'](_0x1aaa30),_0x48f48c();},_0x3b9f26['src']=_0x1aaa30;});}else gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x292601),gl['clearColor'](0x0,0x0,0x0,0x0),gl['clear'](gl['COLOR_BUFFER_BIT']),gl['bindFramebuffer'](gl['FRAMEBUFFER'],null);const _0x473328={'id':Date['now']()+Math['random'](),'name':_0x4c46f2['name']||'Layer\x20'+(layers['length']+0x1),'fbo':_0x292601,'texture':_0x10b627,'visible':!0x1!==_0x4c46f2['visible'],'opacity':Number(_0x4c46f2['opacity'])||0x1,'x':Number(_0x4c46f2['x'])||0x0,'y':Number(_0x4c46f2['y'])||0x0,'scaleX':Number['isFinite'](_0x4c46f2['scaleX'])?_0x4c46f2['scaleX']:0x1,'scaleY':Number['isFinite'](_0x4c46f2['scaleY'])?_0x4c46f2['scaleY']:0x1,'rotation':Number(_0x4c46f2['rotation'])||0x0,'px':Number['isFinite'](_0x4c46f2['px'])?_0x4c46f2['px']:0.5*_0x50d3ee,'py':Number['isFinite'](_0x4c46f2['py'])?_0x4c46f2['py']:0.5*_0x56c391,'texW':_0x3d5d64,'texH':_0x33f7ce,'ox':_0x523501,'oy':_0x38a31f,'history':[],'redo':[]};layers['push'](_0x473328);}return activeLayerIndex=Math['max'](0x0,layers['length']-0x1),syncActiveAliases?.(),rebuildLayersUI?.(),needsRedraw=!0x0,void requestDrawIfIdle?.();}if(_0x5a9540['image']){const _0xf5ccd7=URL['createObjectURL'](_0x5a9540['image']),_0x102a20=new Image();_0x102a20['onload']=()=>{currentImage=_0x102a20,updateCanvasSize(_0x102a20),createTextureFromImage(_0x102a20),zoomScale=0x1,panX=(canvasWrapper['clientWidth']-canvas['width'])/0x2,panY=(canvasWrapper['clientHeight']-canvas['height'])/0x2,updateCanvasTransform(),resetStrokeState(),needsRedraw=!0x0,URL['revokeObjectURL'](_0xf5ccd7);},_0x102a20['src']=_0xf5ccd7;}}}!(function(){const _0x54f6b8=()=>function(_0x30402e=0x320){_0x3cf0db&&clearTimeout(_0x3cf0db),_0x3cf0db=setTimeout(()=>{_0x44a6dc()['catch'](console['error']);},_0x30402e);}(0x1f4),_0x33c6be=()=>{try{_0x44a6dc();}catch(_0x208d8c){}},_0x54c72e=document['getElementById']('glCanvas');_0x54c72e&&['pointerup','mouseup','touchend']['forEach'](_0x28ea8d=>_0x54c72e['addEventListener'](_0x28ea8d,_0x54f6b8,{'passive':!0x0})),document['addEventListener']('keyup',_0x54f6b8,{'passive':!0x0}),document['addEventListener']('visibilitychange',()=>{document['hidden']&&_0x33c6be();}),window['addEventListener']('beforeunload',_0x33c6be),setInterval(()=>{try{isDrawing||_0x54f6b8();}catch(_0x2117c1){}},0x3a98),window['addEventListener']('load',()=>{requestAnimationFrame(()=>{!(async function(){const _0x2590c2=(await _0x1cd33d())['transaction'](_0x3df77c,'readonly')['objectStore'](_0x3df77c)['get'](_0x1faeb3);_0x2590c2['onsuccess']=async()=>{const _0x1de1b9=_0x2590c2['result'];_0x1de1b9&&(await _0x5b16b0(_0x1de1b9),_0xc77734('Autosave\x20restored','success'));},_0x2590c2['onerror']=()=>{console['warn']('Autosave\x20lookup\x20failed.');};}());});});}()),document['addEventListener']('keydown',_0x42deca=>{if(!isUserTyping()){if(_0x42deca['metaKey']&&'s'===_0x42deca['key']['toLowerCase']()){console['log']('kd:\x20s'),_0x42deca['preventDefault'](),_0x42deca['stopPropagation']();const _0x34ee68=document['getElementById']('artworkName')['value'],_0x372960=document['getElementById']('existingArtworkId');_0x372960&&_0x372960['value']?(_0x7a5bfd(_0x34ee68,!0x0,_0x372960['value']),_0xc77734('Artwork\x20overwritten!','success')):console['warn']('No\x20artwork\x20selected\x20for\x20overwrite.');}else{if(_0x42deca['shiftKey']&&'s'===_0x42deca['key']['toLowerCase']()){_0x42deca['preventDefault'](),_0x42deca['stopPropagation']();const _0x2182c1=document['getElementById']('saveModal');_0x2bd5f7(_0x2182c1);}}}}),document['getElementById']('saveNewButton')['addEventListener']('click',()=>{_0x7a5bfd(document['getElementById']('artworkName')['value'],!0x1),_0x2a6ca4(_0x3483d9);}),document['getElementById']('overwriteButton')['addEventListener']('click',()=>{const _0xbb4483=document['getElementById']('artworkName')['value'],_0x5df439=document['getElementById']('existingArtworkId'),_0x56190f=_0x5df439?_0x5df439['value']:null;_0x56190f&&_0xbb4483?_0x7a5bfd(_0xbb4483,!0x0,_0x56190f,{'quiet':!0x0}):console['error']('No\x20existing\x20artwork\x20ID\x20or\x20name\x20found.\x20Cannot\x20overwrite.'),_0x2a6ca4(_0x3483d9);}),document['getElementById']('exportProjectBtn')['addEventListener']('click',()=>{!async function({includeBackground:_0x39ef46=!0x0}={}){if(!window['JSZip'])return console['error']('JSZip\x20not\x20loaded'),void _0xc77734('Export\x20failed:\x20JSZip\x20not\x20loaded.','error');const _0x51d94d=fixedFBOWidth,_0x1ab337=fixedFBOHeight,_0x32d029=new JSZip(),_0x4b7cac={'version':0x2,'width':_0x51d94d,'height':_0x1ab337,'app':'Helena\x20Paint','date':new Date()['toISOString'](),'hasBackground':!!currentImage&&_0x39ef46,'layers':layers['map']((_0x15fc75,_0x1ea467)=>({'index':_0x1ea467,'name':_0x15fc75['name'],'visible':!!_0x15fc75['visible'],'opacity':Number(_0x15fc75['opacity'])||0x1,'x':Number(_0x15fc75['x'])||0x0,'y':Number(_0x15fc75['y'])||0x0,'scaleX':Number(_0x15fc75['scaleX'])||0x1,'scaleY':Number(_0x15fc75['scaleY'])||0x1,'rotation':Number(_0x15fc75['rotation'])||0x0,'px':Number['isFinite'](_0x15fc75['px'])?_0x15fc75['px']:0.5*_0x51d94d,'py':Number['isFinite'](_0x15fc75['py'])?_0x15fc75['py']:0.5*_0x1ab337,'ox':Number['isFinite'](_0x15fc75['ox'])?_0x15fc75['ox']:0x0,'oy':Number['isFinite'](_0x15fc75['oy'])?_0x15fc75['oy']:0x0,'texW':Number['isFinite'](_0x15fc75['texW'])?_0x15fc75['texW']:_0x51d94d,'texH':Number['isFinite'](_0x15fc75['texH'])?_0x15fc75['texH']:_0x1ab337}))};if(_0x32d029['file']('manifest.json',JSON['stringify'](_0x4b7cac,null,0x2),{'compression':'DEFLATE'}),_0x4b7cac['hasBackground']){const _0x3a6e2f=document['createElement']('canvas');_0x3a6e2f['width']=_0x51d94d,_0x3a6e2f['height']=_0x1ab337,_0x3a6e2f['getContext']('2d')['drawImage'](currentImage,0x0,0x0,_0x51d94d,_0x1ab337);const _0x15b4b3=await new Promise(_0x125f3c=>_0x3a6e2f['toBlob'](_0x125f3c,'image/png',0.92));_0x32d029['file']('background.png',_0x15b4b3,{'compression':'DEFLATE'});}for(let _0x58ac75=0x0;_0x58ac75<layers['length'];_0x58ac75++){const _0x4092a5=layers[_0x58ac75],_0x2c95ff=Number['isFinite'](_0x4092a5['texW'])?_0x4092a5['texW']:_0x51d94d,_0x454d29=Number['isFinite'](_0x4092a5['texH'])?_0x4092a5['texH']:_0x1ab337,_0x5e26e5=_0x4fd430(_0x4092a5['fbo'],_0x2c95ff,_0x454d29),_0x74e4a=await _0x4c2cb4(_0x5e26e5),_0x3b6ad0=(_0x4092a5['name']||'Layer')['replace'](/[^\w\-]+/g,'_'),_0x31f697='layers/'+String(_0x58ac75)['padStart'](0x3,'0')+'_'+_0x3b6ad0+'_'+_0x2c95ff+'x'+_0x454d29+'.png';_0x32d029['file'](_0x31f697,_0x74e4a,{'compression':'DEFLATE'});}const _0x45831d=await _0x32d029['generateAsync']({'type':'blob','compression':'DEFLATE','compressionOptions':{'level':0x6}}),_0x1e44b1='helena_project_'+Date['now']()+'.hpaint',_0x140944=document['createElement']('a');_0x140944['href']=URL['createObjectURL'](_0x45831d),_0x140944['download']=_0x1e44b1,document['body']['appendChild'](_0x140944),_0x140944['click'](),_0x140944['remove'](),_0xc77734('Project\x20exported!','success');}({'includeBackground':!0x0});});const _0x3066a7=document['getElementById']('importProjectInput');document['getElementById']('importProjectBtn')['addEventListener']('click',()=>_0x3066a7['click']()),_0x3066a7['addEventListener']('change',_0x5a734b=>{const _0x239909=_0x5a734b['target']['files']?.[0x0];_0x239909&&async function(_0x2d8153){if(!window['JSZip'])return console['error']('JSZip\x20not\x20loaded'),void _0xc77734('Import\x20failed:\x20JSZip\x20not\x20loaded.','error');try{const _0x526c4d=await JSZip['loadAsync'](_0x2d8153),_0x1c6959=await _0x526c4d['file']('manifest.json')['async']('string'),_0x7f0b=JSON['parse'](_0x1c6959),_0x2e5ce0=Number(_0x7f0b['version'])||0x1,_0x1c375c=Number(_0x7f0b['width'])||fixedFBOWidth,_0x4d7c06=Number(_0x7f0b['height'])||fixedFBOHeight;if('function'==typeof setFixedFBODimensions?setFixedFBODimensions(_0x1c375c,_0x4d7c06):(window['fixedFBOWidth']=_0x1c375c,window['fixedFBOHeight']=_0x4d7c06),initPaintLayerFixed?.(),_0x7f0b['hasBackground']&&_0x526c4d['file']('background.png')){const _0x1f89d6=await _0x526c4d['file']('background.png')['async']('blob'),_0x10d776=await createImageBitmap(_0x1f89d6);'function'==typeof setDocumentBackgroundImageBitmap?await setDocumentBackgroundImageBitmap(_0x10d776):window['currentImage']=_0x10d776;}function _0x52a2c7(_0x5a4f5e,_0x22e613,_0x553b07,_0x55abd1){const _0x3d486=Math['max'](0x1,0x0|_0x553b07['texW']),_0x141798=Math['max'](0x1,0x0|_0x553b07['texH']),_0x4f9c6d=gl['createTexture']();gl['bindTexture'](gl['TEXTURE_2D'],_0x4f9c6d),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MIN_FILTER'],gl['LINEAR']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MAG_FILTER'],gl['LINEAR']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_S'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_T'],gl['CLAMP_TO_EDGE']),gl['pixelStorei'](gl['UNPACK_FLIP_Y_WEBGL'],!0x0),gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],_0x3d486,_0x141798,0x0,gl['RGBA'],gl['UNSIGNED_BYTE'],null),_0x22e613&&gl['texSubImage2D'](gl['TEXTURE_2D'],0x0,0x0,0x0,gl['RGBA'],gl['UNSIGNED_BYTE'],_0x22e613);const _0x9f562e=gl['createFramebuffer']();gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x9f562e),gl['framebufferTexture2D'](gl['FRAMEBUFFER'],gl['COLOR_ATTACHMENT0'],gl['TEXTURE_2D'],_0x4f9c6d,0x0),gl['bindFramebuffer'](gl['FRAMEBUFFER'],null);const _0x205f89={'id':Date['now']()+Math['random'](),'name':_0x5a4f5e,'texture':_0x4f9c6d,'fbo':_0x9f562e,'visible':!!_0x55abd1['visible'],'opacity':Number['isFinite'](_0x55abd1['opacity'])?_0x55abd1['opacity']:0x1,'ox':0x0|_0x553b07['ox'],'oy':0x0|_0x553b07['oy'],'texW':_0x3d486,'texH':_0x141798,'x':Number['isFinite'](_0x55abd1['x'])?_0x55abd1['x']:0x0,'y':Number['isFinite'](_0x55abd1['y'])?_0x55abd1['y']:0x0,'scaleX':Number['isFinite'](_0x55abd1['scaleX'])?_0x55abd1['scaleX']:0x1,'scaleY':Number['isFinite'](_0x55abd1['scaleY'])?_0x55abd1['scaleY']:0x1,'rotation':Number['isFinite'](_0x55abd1['rotation'])?_0x55abd1['rotation']:0x0,'px':Number['isFinite'](_0x55abd1['px'])?_0x55abd1['px']:0.5*_0x1c375c,'py':Number['isFinite'](_0x55abd1['py'])?_0x55abd1['py']:0.5*_0x4d7c06,'history':[],'redo':[]};layers['push'](_0x205f89);}const _0x38eb09=(_0x7f0b['layers']||[])['slice']()['sort']((_0x2ed8ad,_0x70a22e)=>_0x2ed8ad['index']-_0x70a22e['index']);for(let _0x5251fd=0x0;_0x5251fd<_0x38eb09['length'];_0x5251fd++){const _0x375641=_0x38eb09[_0x5251fd],_0x4be0dc=String(_0x375641['index'])['padStart'](0x3,'0')+'_',_0x5a1ffa=Object['keys'](_0x526c4d['files'])['filter'](_0x32d64a=>_0x32d64a['startsWith']('layers/')),_0x4a8809=_0x5a1ffa['find'](_0x7e162c=>_0x7e162c['split']('/')['pop']()['startsWith'](_0x4be0dc))||_0x5a1ffa[_0x375641['index']];let _0x2a3cc8=null;if(_0x4a8809){const _0x16ccb2=await _0x526c4d['file'](_0x4a8809)['async']('blob');_0x2a3cc8=await createImageBitmap(_0x16ccb2);}else console['warn']('Missing\x20layer\x20image\x20in\x20zip\x20for\x20index',_0x375641['index']);const _0x56d054=_0x2e5ce0>=0x2?{'ox':Number['isFinite'](_0x375641['ox'])?_0x375641['ox']:0x0,'oy':Number['isFinite'](_0x375641['oy'])?_0x375641['oy']:0x0,'texW':Number['isFinite'](_0x375641['texW'])?_0x375641['texW']:_0x1c375c,'texH':Number['isFinite'](_0x375641['texH'])?_0x375641['texH']:_0x4d7c06}:{'ox':0x0,'oy':0x0,'texW':_0x1c375c,'texH':_0x4d7c06};_0x52a2c7(_0x375641['name']||'Layer\x20'+(_0x5251fd+0x1),_0x2a3cc8,_0x56d054,{'visible':!!_0x375641['visible'],'opacity':Number(_0x375641['opacity'])||0x1,'x':_0x375641['x'],'y':_0x375641['y'],'scaleX':_0x375641['scaleX'],'scaleY':_0x375641['scaleY'],'rotation':_0x375641['rotation'],'px':_0x375641['px'],'py':_0x375641['py']});}activeLayerIndex=Math['max'](0x0,layers['length']-0x1),syncActiveAliases?.(),rebuildLayersUI?.(),needsRedraw=!0x0,requestDrawIfIdle?.(),_0xc77734?.('Project\x20imported','success');}catch(_0x1c8f50){console['error'](_0x1c8f50),_0xc77734('Import\x20failed.','error');}}(_0x239909);});function _0x4fd430(_0x4d5317,_0x84bad6,_0x475a3b){const _0x15bac1=new Uint8Array(_0x84bad6*_0x475a3b*0x4);return gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x4d5317),gl['readPixels'](0x0,0x0,_0x84bad6,_0x475a3b,gl['RGBA'],gl['UNSIGNED_BYTE'],_0x15bac1),gl['bindFramebuffer'](gl['FRAMEBUFFER'],null),new ImageData(new Uint8ClampedArray(_0x15bac1),_0x84bad6,_0x475a3b);}function _0x4c2cb4(_0x5df2d8){const _0x549fe6=document['createElement']('canvas');return _0x549fe6['width']=_0x5df2d8['width'],_0x549fe6['height']=_0x5df2d8['height'],_0x549fe6['getContext']('2d')['putImageData'](_0x5df2d8,0x0,0x0),new Promise(_0x14d0c8=>_0x549fe6['toBlob'](_0x14d0c8,'image/png',0.92));}var _0x3bb670=document['getElementById']('layerToBrushBtn');_0x3bb670&&_0x3bb670['addEventListener']('click',function(){(function(){var _0x27aa47='function'==typeof getActiveLayer?getActiveLayer():null;if(!(gl&&quadProgram&&_0x27aa47&&_0x27aa47['texture']))return null;var _0x4fe2c1=Math['max'](0x1,0x0|_0x27aa47['texW']||fixedFBOWidth||canvas['width']),_0x17f7c1=Math['max'](0x1,0x0|_0x27aa47['texH']||fixedFBOHeight||canvas['height']),_0x27b607=gl['getParameter'](gl['FRAMEBUFFER_BINDING']),_0xb58149=gl['getParameter'](gl['CURRENT_PROGRAM']),_0x16b76e=gl['getParameter'](gl['VIEWPORT']),_0x48100d=gl['createTexture']();gl['bindTexture'](gl['TEXTURE_2D'],_0x48100d),gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],_0x4fe2c1,_0x17f7c1,0x0,gl['RGBA'],gl['UNSIGNED_BYTE'],null),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MIN_FILTER'],gl['LINEAR']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MAG_FILTER'],gl['LINEAR']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_S'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_T'],gl['CLAMP_TO_EDGE']);var _0x149218=gl['createFramebuffer']();gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x149218),gl['framebufferTexture2D'](gl['FRAMEBUFFER'],gl['COLOR_ATTACHMENT0'],gl['TEXTURE_2D'],_0x48100d,0x0),gl['viewport'](0x0,0x0,_0x4fe2c1,_0x17f7c1),gl['disable'](gl['BLEND']),gl['clearColor'](0x0,0x0,0x0,0x0),gl['clear'](gl['COLOR_BUFFER_BIT']),gl['useProgram'](quadProgram);var _0x40a54f=gl['getUniformLocation'](quadProgram,'u_flipY'),_0x36e918=gl['getUniformLocation'](quadProgram,'u_resolution'),_0x3f829e=gl['getUniformLocation'](quadProgram,'u_layerOpacity'),_0x1f56e9=gl['getUniformLocation'](quadProgram,'u_texture');_0x40a54f&&gl['uniform1f'](_0x40a54f,0x1),_0x36e918&&gl['uniform2f'](_0x36e918,_0x4fe2c1,_0x17f7c1),_0x3f829e&&gl['uniform1f'](_0x3f829e,0x1),_0x1f56e9&&gl['uniform1i'](_0x1f56e9,0x0);var _0x4fb34d=new Float32Array([0x0,0x0,0x0,0x0,_0x4fe2c1,0x0,0x1,0x0,0x0,_0x17f7c1,0x0,0x1,0x0,_0x17f7c1,0x0,0x1,_0x4fe2c1,0x0,0x1,0x0,_0x4fe2c1,_0x17f7c1,0x1,0x1]),_0x4b9c13=gl['createBuffer']();gl['bindBuffer'](gl['ARRAY_BUFFER'],_0x4b9c13),gl['bufferData'](gl['ARRAY_BUFFER'],_0x4fb34d,gl['STREAM_DRAW']);var _0x1c06ae=gl['getAttribLocation'](quadProgram,'a_position'),_0x4bbd6a=gl['getAttribLocation'](quadProgram,'a_texCoord');_0x1c06ae>=0x0&&(gl['enableVertexAttribArray'](_0x1c06ae),gl['vertexAttribPointer'](_0x1c06ae,0x2,gl['FLOAT'],!0x1,0x10,0x0)),_0x4bbd6a>=0x0&&(gl['enableVertexAttribArray'](_0x4bbd6a),gl['vertexAttribPointer'](_0x4bbd6a,0x2,gl['FLOAT'],!0x1,0x10,0x8)),gl['activeTexture'](gl['TEXTURE0']),gl['bindTexture'](gl['TEXTURE_2D'],_0x27aa47['texture']),gl['drawArrays'](gl['TRIANGLES'],0x0,0x6),_0x1c06ae>=0x0&&gl['disableVertexAttribArray'](_0x1c06ae),_0x4bbd6a>=0x0&&gl['disableVertexAttribArray'](_0x4bbd6a),gl['bindBuffer'](gl['ARRAY_BUFFER'],null),gl['deleteBuffer'](_0x4b9c13),gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x27b607);try{gl['deleteFramebuffer'](_0x149218);}catch(_0x125c51){}return gl['useProgram'](_0xb58149),_0x16b76e&&gl['viewport'](_0x16b76e[0x0],_0x16b76e[0x1],_0x16b76e[0x2],_0x16b76e[0x3]),overlayTexture=_0x48100d,brushAspect=_0x4fe2c1/_0x17f7c1,currentBrush={'name':_0x27aa47['name']?_0x27aa47['name']+'\x20→\x20Brush':'Layer\x20Brush','type':'bitmap','texture':_0x48100d,'defaultSize':currentBrush&&currentBrush['defaultSize']?currentBrush['defaultSize']:0.05,'aspect':brushAspect,'spacing':0.14,'angleFromDirection':!0x0,'opacity':0x1},currentTool='draw',lastPointer&&'function'==typeof showBrushHUD&&showBrushHUD(0x5dc),needsRedraw=!0x0,'function'==typeof requestDrawIfIdle&&requestDrawIfIdle(),currentBrush;}())?(_0xc77734('Brush\x20created\x20from\x20layer','success'),'function'==typeof requestDrawIfIdle&&requestDrawIfIdle()):_0xc77734('No\x20active\x20layer\x20to\x20convert','warning');});const _0x317be0=document['getElementById']('importLayerButton'),_0xeafb7b=document['getElementById']('importLayerInput'),_0x11d646=document['getElementById']('exportLayerButton');function _0x5d9d61(){document['getElementById']('exportOptionsModal')['style']['display']='none';}function _0x40c229(_0x11ea84){const _0x289016=0x0|fixedFBOWidth,_0x2551dc=0x0|fixedFBOHeight,_0x867df8=gl['createTexture']();gl['bindTexture'](gl['TEXTURE_2D'],_0x867df8),gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],_0x289016,_0x2551dc,0x0,gl['RGBA'],gl['UNSIGNED_BYTE'],null),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MIN_FILTER'],gl['NEAREST']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MAG_FILTER'],gl['NEAREST']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_S'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_T'],gl['CLAMP_TO_EDGE']);const _0x351811=gl['createFramebuffer']();if(gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x351811),gl['framebufferTexture2D'](gl['FRAMEBUFFER'],gl['COLOR_ATTACHMENT0'],gl['TEXTURE_2D'],_0x867df8,0x0),gl['checkFramebufferStatus'](gl['FRAMEBUFFER'])!==gl['FRAMEBUFFER_COMPLETE'])return gl['bindFramebuffer'](gl['FRAMEBUFFER'],null),gl['deleteFramebuffer'](_0x351811),gl['deleteTexture'](_0x867df8),void _0xc77734?.('Export\x20failed\x20(FBO\x20incomplete).','error');gl['viewport'](0x0,0x0,_0x289016,_0x2551dc),gl['disable'](gl['DEPTH_TEST']),gl['disable'](gl['CULL_FACE']),gl['disable'](gl['SCISSOR_TEST']),gl['enable'](gl['BLEND']),gl['blendFuncSeparate'](gl['SRC_ALPHA'],gl['ONE_MINUS_SRC_ALPHA'],gl['ONE'],gl['ONE_MINUS_SRC_ALPHA']),gl['clearColor'](0x0,0x0,0x0,0x0),gl['clear'](gl['COLOR_BUFFER_BIT']),gl['useProgram'](quadProgram);const _0x478298=gl['getUniformLocation'](quadProgram,'u_flipY'),_0x441b22=gl['getUniformLocation'](quadProgram,'u_resolution'),_0x1996d8=gl['getUniformLocation'](quadProgram,'u_layerOpacity'),_0x730527=gl['getUniformLocation'](quadProgram,'u_texture')||gl['getUniformLocation'](quadProgram,'u_image');_0x478298&&gl['uniform1f'](_0x478298,-0x1),_0x441b22&&gl['uniform2f'](_0x441b22,_0x289016,_0x2551dc);const _0x1293fd=gl['createBuffer']();gl['bindBuffer'](gl['ARRAY_BUFFER'],_0x1293fd);const _0x2f5b01=gl['getAttribLocation'](quadProgram,'a_position'),_0x38ccff=gl['getAttribLocation'](quadProgram,'a_texCoord');function _0x346cdb(_0x226866,_0x4a2593,_0x4662ac,_0x16cdf7,_0x45da09,_0x5d481d){const _0x1a6739=new Float32Array([_0x4a2593['x'],_0x4a2593['y'],0x0,0x0,_0x4662ac['x'],_0x4662ac['y'],0x1,0x0,_0x16cdf7['x'],_0x16cdf7['y'],0x0,0x1,_0x16cdf7['x'],_0x16cdf7['y'],0x0,0x1,_0x4662ac['x'],_0x4662ac['y'],0x1,0x0,_0x45da09['x'],_0x45da09['y'],0x1,0x1]);gl['bufferData'](gl['ARRAY_BUFFER'],_0x1a6739,gl['STREAM_DRAW']),_0x1996d8&&gl['uniform1f'](_0x1996d8,Math['max'](0x0,Math['min'](0x1,_0x5d481d))),gl['activeTexture'](gl['TEXTURE0']),gl['bindTexture'](gl['TEXTURE_2D'],_0x226866),_0x730527&&gl['uniform1i'](_0x730527,0x0),gl['drawArrays'](gl['TRIANGLES'],0x0,0x6);}gl['enableVertexAttribArray'](_0x2f5b01),gl['vertexAttribPointer'](_0x2f5b01,0x2,gl['FLOAT'],!0x1,0x10,0x0),gl['enableVertexAttribArray'](_0x38ccff),gl['vertexAttribPointer'](_0x38ccff,0x2,gl['FLOAT'],!0x1,0x10,0x8);let _0x4d299b=null;_0x11ea84&&currentImage&&(_0x4d299b=gl['createTexture'](),gl['bindTexture'](gl['TEXTURE_2D'],_0x4d299b),gl['pixelStorei'](gl['UNPACK_FLIP_Y_WEBGL'],!0x1),gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],gl['RGBA'],gl['UNSIGNED_BYTE'],currentImage),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MIN_FILTER'],gl['LINEAR']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MAG_FILTER'],gl['LINEAR']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_S'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_T'],gl['CLAMP_TO_EDGE']),_0x346cdb(_0x4d299b,{'x':0x0,'y':0x0},{'x':_0x289016,'y':0x0},{'x':0x0,'y':_0x2551dc},{'x':_0x289016,'y':_0x2551dc},0x1));for(let _0x1650bc=0x0;_0x1650bc<layers['length'];_0x1650bc++){const _0x2f66e2=layers[_0x1650bc];if(!_0x2f66e2||!0x1===_0x2f66e2['visible'])continue;if(null!=_0x2f66e2['opacity']&&_0x2f66e2['opacity']<=0x0)continue;if(!_0x2f66e2['texture'])continue;const _0x3818e4=Number['isFinite'](_0x2f66e2['ox'])?_0x2f66e2['ox']:0x0,_0x23e5dd=Number['isFinite'](_0x2f66e2['oy'])?_0x2f66e2['oy']:0x0,_0x1e6733=Math['max'](0x1,0x0|(Number(_0x2f66e2['texW'])||_0x289016)),_0x15d55c=Math['max'](0x1,0x0|(Number(_0x2f66e2['texH'])||_0x2551dc)),_0x35706e=Number['isFinite'](_0x2f66e2['px'])?_0x2f66e2['px']:0.5*_0x289016,_0x551eaa=Number['isFinite'](_0x2f66e2['py'])?_0x2f66e2['py']:0.5*_0x2551dc,_0x5cd3e8=Number['isFinite'](_0x2f66e2['x'])?_0x2f66e2['x']:0x0,_0x270fdd=Number['isFinite'](_0x2f66e2['y'])?_0x2f66e2['y']:0x0,_0x8850b1=Number['isFinite'](_0x2f66e2['scaleX'])?_0x2f66e2['scaleX']:0x1,_0xe5f48c=Number['isFinite'](_0x2f66e2['scaleY'])?_0x2f66e2['scaleY']:0x1,_0xdea9d0=Number['isFinite'](_0x2f66e2['rotation'])?_0x2f66e2['rotation']:0x0,_0x19542f=Math['cos'](_0xdea9d0),_0x4e54b9=Math['sin'](_0xdea9d0);function _0x12fecc(_0x59c6de,_0x86af71){let _0x42d402=_0x59c6de-_0x35706e,_0x4bed23=_0x86af71-_0x551eaa;return _0x42d402*=_0x8850b1,_0x4bed23*=_0xe5f48c,{'x':_0x35706e+(_0x42d402*_0x19542f-_0x4bed23*_0x4e54b9)+_0x5cd3e8,'y':_0x551eaa+(_0x42d402*_0x4e54b9+_0x4bed23*_0x19542f)+_0x270fdd};}const _0x59355a=_0x12fecc(_0x3818e4,_0x23e5dd),_0x3dd529=_0x12fecc(_0x3818e4+_0x1e6733,_0x23e5dd),_0x235f65=_0x12fecc(_0x3818e4,_0x23e5dd+_0x15d55c),_0x35f873=_0x12fecc(_0x3818e4+_0x1e6733,_0x23e5dd+_0x15d55c);_0x346cdb(_0x2f66e2['texture'],_0x59355a,_0x3dd529,_0x235f65,_0x35f873,Number(_0x2f66e2['opacity'])||0x1);}const _0x2bd233=new Uint8Array(_0x289016*_0x2551dc*0x4);gl['readPixels'](0x0,0x0,_0x289016,_0x2551dc,gl['RGBA'],gl['UNSIGNED_BYTE'],_0x2bd233);const _0x20bdce=new Uint8ClampedArray(_0x289016*_0x2551dc*0x4),_0xa4a31a=0x4*_0x289016;for(let _0x18c27c=0x0;_0x18c27c<_0x2551dc;_0x18c27c++){const _0xa0b290=_0x18c27c*_0xa4a31a,_0x14b138=(_0x2551dc-0x1-_0x18c27c)*_0xa4a31a;_0x20bdce['set'](_0x2bd233['subarray'](_0xa0b290,_0xa0b290+_0xa4a31a),_0x14b138);}const _0x12259d=document['createElement']('canvas');_0x12259d['width']=_0x289016,_0x12259d['height']=_0x2551dc,_0x12259d['getContext']('2d')['putImageData'](new ImageData(_0x20bdce,_0x289016,_0x2551dc),0x0,0x0);const _0x29a348=_0x11ea84?'_with_background':'_transparent',_0x2e615e='canvas_'+Date['now']()+_0x29a348+'.png';_0x12259d['toBlob'](_0x561762=>{if(!_0x561762)return void _0xc77734?.('Export\x20failed.','error');const _0x3f9e3d=document['createElement']('a');_0x3f9e3d['download']=_0x2e615e,_0x3f9e3d['href']=URL['createObjectURL'](_0x561762),document['body']['appendChild'](_0x3f9e3d),_0x3f9e3d['click'](),URL['revokeObjectURL'](_0x3f9e3d['href']),_0x3f9e3d['remove']();},'image/png',0.92),gl['bindFramebuffer'](gl['FRAMEBUFFER'],null),gl['disableVertexAttribArray'](_0x2f5b01),gl['disableVertexAttribArray'](_0x38ccff),gl['bindBuffer'](gl['ARRAY_BUFFER'],null),gl['deleteBuffer'](_0x1293fd),_0x4d299b&&gl['deleteTexture'](_0x4d299b),gl['deleteFramebuffer'](_0x351811),gl['deleteTexture'](_0x867df8);}function _0x588ef6(){document['getElementById']('shareOptionsModal')['style']['display']='none';}function _0x259044(_0x1cde5f){_0x193ca4(_0x1cde5f)['toBlob'](async _0x100666=>{if(!_0x100666)return void _0xc77734('Error\x20generating\x20artwork.','error');const _0x2ad96f=new File([_0x100666],'artwork'+(_0x1cde5f?'_with_background':'_transparent')+'.png',{'type':'image/png'});if(navigator['canShare']&&navigator['canShare']({'files':[_0x2ad96f]}))try{await navigator['share']({'title':'Artwork','text':'Check\x20out\x20my\x20artwork!','files':[_0x2ad96f]});}catch{_0xc77734('Error\x20sharing\x20artwork.','error');}else _0xc77734('Sharing\x20not\x20supported\x20on\x20this\x20device.','error');},'image/png');}/iPad|iPhone|iPod/['test'](navigator['userAgent'])&&_0xeafb7b?.['removeAttribute']('capture'),_0x317be0?.['addEventListener']('click',()=>_0xeafb7b?.['click']()),_0xeafb7b?.['addEventListener']('change',async _0x5bcffa=>{const _0x381cad=_0x5bcffa['target']['files']?.[0x0];if(!_0x381cad)return;const _0x4661f1=new Image();_0x4661f1['onload']=async()=>{fixedFBOWidth&&fixedFBOHeight||(fixedFBOWidth=_0x4661f1['width'],fixedFBOHeight=_0x4661f1['height'],initPaintLayerFixed?.(),updateCanvasSize({'width':_0x4661f1['width'],'height':_0x4661f1['height']}),needsRedraw=!0x0);const {texture:_0x2dd13f,fbo:_0x406ae5}=createLayerFBO(fixedFBOWidth,fixedFBOHeight),_0x2c7b81={'id':Date['now']()+Math['random'](),'name':(_0x381cad['name']||'Imported')['replace'](/\.[^.]+$/,''),'fbo':_0x406ae5,'texture':_0x2dd13f,'visible':!0x0,'opacity':0x1,'x':0x0,'y':0x0,'scaleX':0x1,'scaleY':0x1,'rotation':0x0,'px':0.5*fixedFBOWidth,'py':0.5*fixedFBOHeight,'history':[],'redo':[]},_0x3d48ec=Math['max'](0x0,Math['min'](activeLayerIndex,layers['length']));layers['splice'](_0x3d48ec,0x0,_0x2c7b81),activeLayerIndex=_0x3d48ec,await async function(_0x228c40,_0x45d063){const _0x1e5779=fixedFBOWidth,_0x21f292=fixedFBOHeight,_0x779bf4=_0x1e5779/_0x228c40['width'],_0x58075f=_0x21f292/_0x228c40['height'],_0x490428=Math['min'](_0x779bf4,_0x58075f,0x1),_0x17183d=Math['round'](_0x228c40['width']*_0x490428),_0x58c537=Math['round'](_0x228c40['height']*_0x490428),_0x2edc67=Math['floor']((_0x1e5779-_0x17183d)/0x2),_0x5db4f0=Math['floor']((_0x21f292-_0x58c537)/0x2),_0x57c5f1=document['createElement']('canvas');_0x57c5f1['width']=_0x1e5779,_0x57c5f1['height']=_0x21f292;const _0x409b28=_0x57c5f1['getContext']('2d');_0x409b28['clearRect'](0x0,0x0,_0x1e5779,_0x21f292),_0x409b28['imageSmoothingEnabled']=!0x0,_0x409b28['imageSmoothingQuality']='high',_0x409b28['drawImage'](_0x228c40,0x0,0x0,_0x228c40['width'],_0x228c40['height'],_0x2edc67,_0x5db4f0,_0x17183d,_0x58c537);const _0x5af683=gl['createTexture']();gl['bindTexture'](gl['TEXTURE_2D'],_0x5af683),gl['pixelStorei'](gl['UNPACK_FLIP_Y_WEBGL'],!0x1),gl['pixelStorei'](gl['UNPACK_PREMULTIPLY_ALPHA_WEBGL'],!0x1),gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],gl['RGBA'],gl['UNSIGNED_BYTE'],_0x57c5f1),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MIN_FILTER'],gl['LINEAR']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MAG_FILTER'],gl['LINEAR']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_S'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_T'],gl['CLAMP_TO_EDGE']),gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x45d063),gl['viewport'](0x0,0x0,_0x1e5779,_0x21f292),gl['disable'](gl['BLEND']),gl['clearColor'](0x0,0x0,0x0,0x0),gl['clear'](gl['COLOR_BUFFER_BIT']),gl['useProgram'](quadProgram);const _0x5dc37e=gl['getUniformLocation'](quadProgram,'u_flipY');_0x5dc37e&&gl['uniform1f'](_0x5dc37e,0x1);const _0x2c71c0=gl['getUniformLocation'](quadProgram,'u_resolution');_0x2c71c0&&gl['uniform2f'](_0x2c71c0,_0x1e5779,_0x21f292);const _0x436842=gl['getUniformLocation'](quadProgram,'u_layerOpacity');_0x436842&&gl['uniform1f'](_0x436842,0x1);const _0x5f3190=new Float32Array([0x0,0x0,0x0,0x0,_0x1e5779,0x0,0x1,0x0,0x0,_0x21f292,0x0,0x1,0x0,_0x21f292,0x0,0x1,_0x1e5779,0x0,0x1,0x0,_0x1e5779,_0x21f292,0x1,0x1]),_0x3ef210=gl['createBuffer']();gl['bindBuffer'](gl['ARRAY_BUFFER'],_0x3ef210),gl['bufferData'](gl['ARRAY_BUFFER'],_0x5f3190,gl['STATIC_DRAW']);const _0x12361a=gl['getAttribLocation'](quadProgram,'a_position'),_0xfb7b1e=gl['getAttribLocation'](quadProgram,'a_texCoord');gl['enableVertexAttribArray'](_0x12361a),gl['vertexAttribPointer'](_0x12361a,0x2,gl['FLOAT'],!0x1,0x10,0x0),gl['enableVertexAttribArray'](_0xfb7b1e),gl['vertexAttribPointer'](_0xfb7b1e,0x2,gl['FLOAT'],!0x1,0x10,0x8),gl['activeTexture'](gl['TEXTURE0']),gl['bindTexture'](gl['TEXTURE_2D'],_0x5af683);const _0x3f64da=gl['getUniformLocation'](quadProgram,'u_texture');_0x3f64da&&gl['uniform1i'](_0x3f64da,0x0),gl['drawArrays'](gl['TRIANGLES'],0x0,0x6),gl['disableVertexAttribArray'](_0x12361a),gl['disableVertexAttribArray'](_0xfb7b1e),gl['bindBuffer'](gl['ARRAY_BUFFER'],null),gl['deleteBuffer'](_0x3ef210),gl['bindFramebuffer'](gl['FRAMEBUFFER'],null),gl['bindTexture'](gl['TEXTURE_2D'],null),gl['deleteTexture'](_0x5af683),needsRedraw=!0x0;}(_0x4661f1,_0x406ae5),syncActiveAliases?.(),rebuildLayersUI?.(),needsRedraw=!0x0,_0xc77734?.('Imported\x20image\x20as\x20new\x20layer.','success');},_0x4661f1['src']=URL['createObjectURL'](_0x381cad),_0x5bcffa['target']['value']='';}),_0x11d646?.['addEventListener']('click',()=>{const _0x436e4d=layers?.[activeLayerIndex];if(!_0x436e4d)return void _0xc77734?.('No\x20active\x20layer\x20to\x20export.','error');const _0x22ccee=fixedFBOWidth,_0x2bc178=fixedFBOHeight,_0x57c71b=document['createElement']('canvas');_0x57c71b['width']=_0x22ccee,_0x57c71b['height']=_0x2bc178,_0x57c71b['getContext']('2d')['putImageData'](_0x4fd430(_0x436e4d['fbo'],_0x22ccee,_0x2bc178),0x0,0x0);const _0x4e55f7=document['createElement']('canvas');_0x4e55f7['width']=_0x22ccee,_0x4e55f7['height']=_0x2bc178;const _0x496fc6=_0x4e55f7['getContext']('2d');_0x496fc6['save'](),_0x496fc6['translate'](_0x22ccee/0x2,_0x2bc178/0x2),_0x496fc6['scale'](-0x1,-0x1),_0x496fc6['rotate'](Math['PI']),_0x496fc6['drawImage'](_0x57c71b,-_0x22ccee/0x2,-_0x2bc178/0x2),_0x496fc6['restore']();const _0x445758=document['createElement']('a');_0x445758['download']=(_0x436e4d['name']||'Layer')['replace'](/\s+/g,'_')+'.png',_0x445758['href']=_0x4e55f7['toDataURL']('image/png'),document['body']['appendChild'](_0x445758),_0x445758['click'](),_0x445758['remove'](),_0xc77734?.('Active\x20layer\x20exported.','success');}),document['getElementById']('saveCanvasAsIcoButton')['addEventListener']('click',function(){const _0x49e569=_0x193ca4(!0x0),_0x48fbdd=document['createElement']('canvas');_0x48fbdd['width']=0x40,_0x48fbdd['height']=0x40,_0x48fbdd['getContext']('2d')['drawImage'](_0x49e569,0x0,0x0,0x40,0x40),_0x48fbdd['toBlob'](_0xb97261=>{if(!_0xb97261)return void _0xc77734('ICO\x20export\x20failed.','error');const _0x3b55a0=new FileReader();_0x3b55a0['onloadend']=()=>{const _0x335a34=function(_0x3e6a45,_0x550e18){const _0x103a01=new Uint8Array([0x0,0x0,0x1,0x0,0x1,0x0]),_0x4a06e8=new Uint8Array(0x10);_0x4a06e8['set']([_0x550e18,_0x550e18,0x0,0x0,0x1,0x0,0x20,0x0]);const _0x16842c=_0x3e6a45['byteLength'],_0x3c2841=_0x103a01['length']+_0x4a06e8['length'],_0x56302a=new DataView(_0x4a06e8['buffer']);_0x56302a['setUint32'](0x8,_0x16842c,!0x0),_0x56302a['setUint32'](0xc,_0x3c2841,!0x0);const _0x62534b=_0x103a01['length']+_0x4a06e8['length']+_0x16842c,_0x1cce22=new Uint8Array(_0x62534b);return _0x1cce22['set'](_0x103a01,0x0),_0x1cce22['set'](_0x4a06e8,_0x103a01['length']),_0x1cce22['set'](new Uint8Array(_0x3e6a45),_0x3c2841),_0x1cce22['buffer'];}(_0x3b55a0['result'],0x40),_0x212dc7=new Blob([_0x335a34],{'type':'image/x-icon'}),_0x48677d=document['createElement']('a');_0x48677d['href']=URL['createObjectURL'](_0x212dc7),_0x48677d['download']='favicon.ico',document['body']['appendChild'](_0x48677d),_0x48677d['click'](),document['body']['removeChild'](_0x48677d);},_0x3b55a0['readAsArrayBuffer'](_0xb97261);},'image/png');}),document['getElementById']('exportModalClose')['addEventListener']('click',_0x5d9d61),document['getElementById']('exportWithBackgroundBtn')['addEventListener']('click',function(){_0x5d9d61(),_0x40c229(!0x0);}),document['getElementById']('exportTransparentBtn')['addEventListener']('click',function(){_0x5d9d61(),_0x40c229(!0x1);}),document['getElementById']('saveCanvasButton')['addEventListener']('click',function(){document['getElementById']('exportOptionsModal')['style']['display']='flex';}),document['getElementById']('shareButton')['addEventListener']('click',function(){document['getElementById']('shareOptionsModal')['style']['display']='flex';}),document['getElementById']('shareModalClose')['addEventListener']('click',_0x588ef6),document['getElementById']('shareWithBackgroundBtn')['addEventListener']('click',function(){_0x588ef6(),_0x259044(!0x0);}),document['getElementById']('shareTransparentBtn')['addEventListener']('click',function(){_0x588ef6(),_0x259044(!0x1);});let _0xd1616f=!0x1,_0x3af3c3=null;function _0x193ca4(_0x418294=!0x0){if(!gl||!quadProgram)return null;const _0x598d73=0x0|fixedFBOWidth,_0x4f692a=0x0|fixedFBOHeight,_0x5c3ed8=gl['getParameter'](gl['FRAMEBUFFER_BINDING']),_0x10470e=gl['getParameter'](gl['CURRENT_PROGRAM']),_0xd61702=gl['getParameter'](gl['VIEWPORT']),_0x53d17b=gl['isEnabled'](gl['BLEND']),_0x4fc0c8=gl['createTexture']();gl['bindTexture'](gl['TEXTURE_2D'],_0x4fc0c8),gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],_0x598d73,_0x4f692a,0x0,gl['RGBA'],gl['UNSIGNED_BYTE'],null),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MIN_FILTER'],gl['NEAREST']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MAG_FILTER'],gl['NEAREST']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_S'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_T'],gl['CLAMP_TO_EDGE']);const _0x19191f=gl['createFramebuffer']();gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x19191f),gl['framebufferTexture2D'](gl['FRAMEBUFFER'],gl['COLOR_ATTACHMENT0'],gl['TEXTURE_2D'],_0x4fc0c8,0x0),gl['viewport'](0x0,0x0,_0x598d73,_0x4f692a),gl['disable'](gl['DEPTH_TEST']),gl['enable'](gl['BLEND']),gl['blendFuncSeparate'](gl['SRC_ALPHA'],gl['ONE_MINUS_SRC_ALPHA'],gl['ONE'],gl['ONE_MINUS_SRC_ALPHA']),gl['clearColor'](0x0,0x0,0x0,0x0),gl['clear'](gl['COLOR_BUFFER_BIT']),gl['useProgram'](quadProgram);const _0x4feb0b=gl['getUniformLocation'](quadProgram,'u_flipY'),_0x2dd948=gl['getUniformLocation'](quadProgram,'u_resolution'),_0x5c9e42=gl['getUniformLocation'](quadProgram,'u_layerOpacity'),_0x25a8d0=gl['getUniformLocation'](quadProgram,'u_texture'),_0x1e0447=gl['getAttribLocation'](quadProgram,'a_position'),_0x78268=gl['getAttribLocation'](quadProgram,'a_texCoord');_0x4feb0b&&gl['uniform1f'](_0x4feb0b,-0x1),_0x2dd948&&gl['uniform2f'](_0x2dd948,_0x598d73,_0x4f692a);const _0x2d903e=gl['createBuffer']();gl['bindBuffer'](gl['ARRAY_BUFFER'],_0x2d903e),gl['enableVertexAttribArray'](_0x1e0447),gl['enableVertexAttribArray'](_0x78268),gl['vertexAttribPointer'](_0x1e0447,0x2,gl['FLOAT'],!0x1,0x10,0x0),gl['vertexAttribPointer'](_0x78268,0x2,gl['FLOAT'],!0x1,0x10,0x8);let _0x2c57d7=null;if(_0x418294&&currentImage){_0x2c57d7=gl['createTexture'](),gl['bindTexture'](gl['TEXTURE_2D'],_0x2c57d7),gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],gl['RGBA'],gl['UNSIGNED_BYTE'],currentImage),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MIN_FILTER'],gl['LINEAR']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MAG_FILTER'],gl['LINEAR']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_S'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_T'],gl['CLAMP_TO_EDGE']),_0x5c9e42&&gl['uniform1f'](_0x5c9e42,0x1),gl['activeTexture'](gl['TEXTURE0']),gl['bindTexture'](gl['TEXTURE_2D'],_0x2c57d7),_0x25a8d0&&gl['uniform1i'](_0x25a8d0,0x0);const _0x3b519a=new Float32Array([0x0,0x0,0x0,0x0,_0x598d73,0x0,0x1,0x0,0x0,_0x4f692a,0x0,0x1,0x0,_0x4f692a,0x0,0x1,_0x598d73,0x0,0x1,0x0,_0x598d73,_0x4f692a,0x1,0x1]);gl['bufferData'](gl['ARRAY_BUFFER'],_0x3b519a,gl['STREAM_DRAW']),gl['drawArrays'](gl['TRIANGLES'],0x0,0x6);}for(let _0x12bd25=0x0;_0x12bd25<layers['length'];_0x12bd25++){const _0x5f0e64=layers[_0x12bd25];if(!_0x5f0e64||!_0x5f0e64['visible']||!_0x5f0e64['texture'])continue;const _0xd6024f=Number['isFinite'](_0x5f0e64['ox'])?_0x5f0e64['ox']:0x0,_0x8fc3f5=Number['isFinite'](_0x5f0e64['oy'])?_0x5f0e64['oy']:0x0,_0x342af7=Math['max'](0x1,Number['isFinite'](_0x5f0e64['texW'])?_0x5f0e64['texW']:_0x598d73),_0x48928e=Math['max'](0x1,Number['isFinite'](_0x5f0e64['texH'])?_0x5f0e64['texH']:_0x4f692a),_0x56251c=Number['isFinite'](_0x5f0e64['scaleX'])?_0x5f0e64['scaleX']:0x1,_0x117e16=Number['isFinite'](_0x5f0e64['scaleY'])?_0x5f0e64['scaleY']:0x1,_0x131917=Number['isFinite'](_0x5f0e64['rotation'])?_0x5f0e64['rotation']:0x0,_0x39b831=Number['isFinite'](_0x5f0e64['x'])?_0x5f0e64['x']:0x0,_0x145302=Number['isFinite'](_0x5f0e64['y'])?_0x5f0e64['y']:0x0,_0x4f8d82=Number['isFinite'](_0x5f0e64['px'])?_0x5f0e64['px']:0.5*_0x598d73,_0x1d905c=Number['isFinite'](_0x5f0e64['py'])?_0x5f0e64['py']:0.5*_0x4f692a,_0x53ac9b=Math['max'](0x0,Math['min'](0x1,_0x5f0e64['opacity']??0x1)),_0x46a24f=Math['cos'](_0x131917),_0x3fc06f=Math['sin'](_0x131917),_0x404739=(_0x126c89,_0x23110c)=>{let _0x34e56b=(_0x126c89-_0x4f8d82)*_0x56251c,_0x41ebc7=(_0x23110c-_0x1d905c)*_0x117e16;return{'x':_0x4f8d82+(_0x34e56b*_0x46a24f-_0x41ebc7*_0x3fc06f)+_0x39b831,'y':_0x1d905c+(_0x34e56b*_0x3fc06f+_0x41ebc7*_0x46a24f)+_0x145302};},_0x24fb60=_0x404739(_0xd6024f,_0x8fc3f5),_0x317063=_0x404739(_0xd6024f+_0x342af7,_0x8fc3f5),_0x16f2aa=_0x404739(_0xd6024f,_0x8fc3f5+_0x48928e),_0xa3026f=_0x404739(_0xd6024f+_0x342af7,_0x8fc3f5+_0x48928e),_0x2b8fa7=new Float32Array([_0x24fb60['x'],_0x24fb60['y'],0x0,0x0,_0x317063['x'],_0x317063['y'],0x1,0x0,_0x16f2aa['x'],_0x16f2aa['y'],0x0,0x1,_0x16f2aa['x'],_0x16f2aa['y'],0x0,0x1,_0x317063['x'],_0x317063['y'],0x1,0x0,_0xa3026f['x'],_0xa3026f['y'],0x1,0x1]);_0x5c9e42&&gl['uniform1f'](_0x5c9e42,_0x53ac9b),gl['activeTexture'](gl['TEXTURE0']),gl['bindTexture'](gl['TEXTURE_2D'],_0x5f0e64['texture']),_0x25a8d0&&gl['uniform1i'](_0x25a8d0,0x0),gl['bufferData'](gl['ARRAY_BUFFER'],_0x2b8fa7,gl['STREAM_DRAW']),gl['drawArrays'](gl['TRIANGLES'],0x0,0x6);}const _0x4a1dd9=new Uint8Array(_0x598d73*_0x4f692a*0x4);gl['readPixels'](0x0,0x0,_0x598d73,_0x4f692a,gl['RGBA'],gl['UNSIGNED_BYTE'],_0x4a1dd9);const _0x45de3a=new Uint8ClampedArray(_0x598d73*_0x4f692a*0x4);for(let _0x340a2b=0x0;_0x340a2b<_0x4f692a;_0x340a2b++){const _0x29c9bc=_0x340a2b*_0x598d73*0x4,_0x2af21a=(_0x4f692a-0x1-_0x340a2b)*_0x598d73*0x4;_0x45de3a['set'](_0x4a1dd9['subarray'](_0x29c9bc,_0x29c9bc+0x4*_0x598d73),_0x2af21a);}const _0x2d0750=document['createElement']('canvas');return _0x2d0750['width']=_0x598d73,_0x2d0750['height']=_0x4f692a,(_0x2d0750['getContext']('2d')['putImageData'](new ImageData(_0x45de3a,_0x598d73,_0x4f692a),0x0,0x0),_0x53d17b?gl['enable'](gl['BLEND']):gl['disable'](gl['BLEND']),_0xd61702&&gl['viewport'](_0xd61702[0x0],_0xd61702[0x1],_0xd61702[0x2],_0xd61702[0x3]),gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x5c3ed8),gl['useProgram'](_0x10470e),gl['disableVertexAttribArray'](_0x1e0447),gl['disableVertexAttribArray'](_0x78268),gl['bindBuffer'](gl['ARRAY_BUFFER'],null),gl['deleteBuffer'](_0x2d903e),_0x2c57d7&&gl['deleteTexture'](_0x2c57d7),gl['deleteFramebuffer'](_0x19191f),gl['deleteTexture'](_0x4fc0c8),_0x2d0750);}function _0x15e239(_0x16077a,_0x2dc5da='image/webp',_0x1005da=0.75){return new Promise(_0x19c432=>{_0x16077a['toBlob'](_0x4f7b13=>_0x19c432(_0x4f7b13),_0x2dc5da,_0x1005da);});}async function _0x870d8b(){const _0x5608d8=(await _0x1cd33d())['transaction'](_0x3df77c,'readonly')['objectStore'](_0x3df77c)['getAll']();_0x5608d8['onsuccess']=()=>{const _0x2b81da=_0x5608d8['result'];_0x2b81da['sort']((_0x2ba485,_0x246c62)=>new Date(_0x246c62['date'])-new Date(_0x2ba485['date']));const _0x1ad403=document['getElementById']('gallery');_0x1ad403['innerHTML']=_0x2b81da['length']?'':'<p>No\x20saved\x20artworks</p>',_0x2b81da['forEach'](_0x59eb1a=>{const _0x25018e=document['createElement']('div');_0x25018e['classList']['add']('gallery-item');const _0x448866=document['createElement']('img');_0x448866['src']=_0x59eb1a['thumbnail']||'',_0x448866['alt']=_0x59eb1a['name'],_0x25018e['appendChild'](_0x448866);const _0x4eb40c=document['createElement']('p');_0x4eb40c['textContent']=_0x59eb1a['name'],_0x25018e['appendChild'](_0x4eb40c);const _0x3d54c2=document['createElement']('button');_0x3d54c2['classList']['add']('delete-button'),_0x3d54c2['style']['display']=_0xd1616f?'block':'none',_0x3d54c2['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20width=\x22100%\x22\x20height=\x22100%\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20stroke-width=\x221.5\x22\x20fill=\x22none\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20stroke=\x22currentColor\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20d=\x22M19\x2011v9.4a.6.6\x200\x200\x201-.6.6H5.6a.6.6\x200\x200\x201-.6-.6V11M10\x2017v-6M14\x2017v-6M21\x207h-5M3\x207h5m0\x200V3.6a.6.6\x200\x200\x201\x20.6-.6h6.8a.6.6\x200\x200\x201\x20.6.6V7M8\x207h8\x22\x20/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x3d54c2['addEventListener']('click',_0x334f50=>{_0x334f50['stopPropagation'](),_0x3af3c3=_0x59eb1a['id'],document['getElementById']('deleteConfirmModal')['style']['display']='flex';}),_0x25018e['appendChild'](_0x3d54c2),_0x25018e['addEventListener']('click',()=>{_0xd1616f||async function(_0x410631){const _0x269012=(await _0x1cd33d())['transaction'](_0x3df77c,'readonly')['objectStore'](_0x3df77c)['get'](_0x410631);_0x269012['onsuccess']=async()=>{const _0x5968b7=_0x269012['result'];_0x5968b7?await _0x5b16b0(_0x5968b7):_0xc77734('Artwork\x20not\x20found.','error');},_0x269012['onerror']=()=>{console['error']('Failed\x20to\x20load\x20artwork\x20from\x20IndexedDB.'),_0xc77734('Failed\x20to\x20load\x20artwork.','error');};}(_0x59eb1a['id']);}),_0x1ad403['appendChild'](_0x25018e);});},_0x5608d8['onerror']=()=>console['error']('Failed\x20to\x20load\x20gallery.');}document['getElementById']('galleryEditButton')['addEventListener']('click',()=>{_0xd1616f=!_0xd1616f,document['querySelectorAll']('.gallery-item\x20.delete-button')['forEach'](_0x4ce664=>{_0x4ce664['style']['display']=_0xd1616f?'block':'none';}),document['getElementById']('galleryEditButton')['textContent']=_0xd1616f?'Done':'Edit';}),document['getElementById']('confirmDeleteButton')['addEventListener']('click',async()=>{if(null!==_0x3af3c3){const _0x5ec82a=(await _0x1cd33d())['transaction'](_0x3df77c,'readwrite');_0x5ec82a['objectStore'](_0x3df77c)['delete'](_0x3af3c3),_0x5ec82a['oncomplete']=()=>{_0xc77734('Artwork\x20deleted!','success'),_0x3af3c3=null,document['getElementById']('deleteConfirmModal')['style']['display']='none',_0x870d8b();},_0x5ec82a['onerror']=()=>{console['error']('Failed\x20to\x20delete\x20artwork.'),_0xc77734('Error\x20deleting\x20artwork.','error');};}}),document['getElementById']('cancelDeleteButton')['addEventListener']('click',()=>{_0x3af3c3=null,document['getElementById']('deleteConfirmModal')['style']['display']='none';});const _0xcfdbf9=document['getElementById']('profileModal'),_0x5b1577=document['getElementById']('profileIconButton'),_0x504661=document['getElementById']('saveProfileButton'),_0x3e1039=document['getElementById']('profileImageInput'),_0x56b02a=document['getElementById']('profileImagePreview'),_0xa6c586=document['getElementById']('drawProfileButton');function _0x28234c(){const _0x2711c0=JSON['parse'](localStorage['getItem']('userProfile'))||{};if(_0x2711c0['image']){_0x56b02a['style']['backgroundImage']='url(\x27'+_0x2711c0['image']+'\x27)';const _0x4b39bd=document['querySelector']('#profileIconButton\x20img');_0x4b39bd&&(_0x4b39bd['src']=_0x2711c0['image']);}else{_0x56b02a['style']['backgroundImage']='url(\x27/static/draw/images/icons/cat.svg\x27)';const _0x4126a7=document['querySelector']('#profileIconButton\x20img');_0x4126a7&&(_0x4126a7['src']='/static/draw/images/icons/cat.svg');}document['getElementById']('profileNickname')['value']=_0x2711c0['nickname']||'',document['getElementById']('profileEmail')['value']=_0x2711c0['email']||'',document['getElementById']('profileBio')['value']=_0x2711c0['bio']||'';}function _0x2bd5f7(_0x5f1264){_0x5f1264['style']['display']='flex';const _0x4b94da=_0x5f1264['querySelector']('.close');_0x4b94da&&!_0x4b94da['dataset']['listenerAdded']&&(_0x4b94da['addEventListener']('click',()=>_0x2a6ca4(_0x5f1264)),_0x4b94da['dataset']['listenerAdded']='true');}function _0x2a6ca4(_0x149abf){_0x149abf['style']['display']='none';}_0x28234c(),_0x5b1577['addEventListener']('click',()=>{_0x28234c(),_0x2bd5f7(_0xcfdbf9);}),_0x504661['addEventListener']('click',function(){const _0x3c60ee=_0x56b02a['style']['backgroundImage']['match'](/url\(["']?(.*?)["']?\)/),_0x5977a1={'image':_0x3c60ee?_0x3c60ee[0x1]:null,'nickname':document['getElementById']('profileNickname')['value'],'email':document['getElementById']('profileEmail')['value'],'bio':document['getElementById']('profileBio')['value']};localStorage['setItem']('userProfile',JSON['stringify'](_0x5977a1)),_0x2a0f32=_0x5977a1['nickname']?.['trim']()||'',_0xc4a858(),_0xc77734('Profile\x20saved!','success'),_0x2a6ca4(_0xcfdbf9);}),_0x56b02a['addEventListener']('click',()=>{_0x3e1039['click']();}),_0x3e1039['addEventListener']('change',_0x278f52=>{const _0x21d29b=_0x278f52['target']['files'][0x0];if(_0x21d29b){const _0x31bc42=new FileReader();_0x31bc42['onload']=()=>{const _0x8f7e00=_0x31bc42['result'];_0x56b02a['style']['backgroundImage']='url(\x27'+_0x8f7e00+'\x27)';const _0xf055c8={'image':_0x8f7e00,'nickname':document['getElementById']('profileNickname')['value'],'email':document['getElementById']('profileEmail')['value'],'bio':document['getElementById']('profileBio')['value']};localStorage['setItem']('userProfile',JSON['stringify'](_0xf055c8));const _0x134ae0=document['querySelector']('#profileIconButton\x20img');_0x134ae0&&(_0x134ae0['src']=_0x8f7e00),fetch(_0x8f7e00)['then'](_0x306751=>_0x306751['blob']())['then'](_0x2495fc=>{const _0x1f7aef={'id':Date['now'](),'name':'Profile','date':new Date()['toISOString'](),'username':'User','appName':'Web\x20Paint','image':_0x2495fc,'thumbnail':_0x8f7e00};_0x1cd33d()['then'](_0xac1e68=>{_0xac1e68['transaction'](_0x3df77c,'readwrite')['objectStore'](_0x3df77c)['put'](_0x1f7aef),_0xc77734('Profile\x20image\x20saved\x20to\x20gallery!','success');});});},_0x31bc42['readAsDataURL'](_0x21d29b);}}),_0xa6c586['addEventListener']('click',()=>{try{const _0xef1871=_0x193ca4(!0x0);if(!_0xef1871)return void _0xc77734?.('Profile\x20export\x20unavailable.','error');const _0x28e485=_0xef1871['width'],_0xf7dafc=_0xef1871['height'],_0x2d8e9e=Math['min'](_0x28e485,_0xf7dafc),_0x27f686=(_0x28e485-_0x2d8e9e)/0x2|0x0,_0x4cbeaa=(_0xf7dafc-_0x2d8e9e)/0x2|0x0,_0x3907d6=document['createElement']('canvas');_0x3907d6['width']=_0x2d8e9e,_0x3907d6['height']=_0x2d8e9e,_0x3907d6['getContext']('2d')['drawImage'](_0xef1871,_0x27f686,_0x4cbeaa,_0x2d8e9e,_0x2d8e9e,0x0,0x0,_0x2d8e9e,_0x2d8e9e);const _0x4dc7e7=_0x3907d6['toDataURL']('image/png');_0x56b02a['style']['backgroundImage']='url(\x27'+_0x4dc7e7+'\x27)';const _0xd0bf7f=document['querySelector']('#profileIconButton\x20img');_0xd0bf7f&&(_0xd0bf7f['src']=_0x4dc7e7);const _0x4b5dfe={'image':_0x4dc7e7,'nickname':document['getElementById']('profileNickname')['value'],'email':document['getElementById']('profileEmail')['value'],'bio':document['getElementById']('profileBio')['value']};try{localStorage['setItem']('userProfile',JSON['stringify'](_0x4b5dfe));}catch{}_0x3907d6['toBlob'](_0x138384=>{if(!_0x138384)return void _0xc77734?.('Profile\x20save\x20failed.','error');const _0x71b16e={'id':Date['now'](),'name':'Profile','date':new Date()['toISOString'](),'username':'User','appName':'Web\x20Paint','image':_0x138384,'thumbnail':_0x4dc7e7};_0x1cd33d()['then'](_0x31047c=>{_0x31047c['transaction'](_0x3df77c,'readwrite')['objectStore'](_0x3df77c)['put'](_0x71b16e),_0xc77734?.('Profile\x20image\x20saved.','success');})['catch'](_0x4feaff=>{console['error']('[Profile]\x20gallery\x20save\x20error',_0x4feaff),_0xc77734?.('Saved\x20preview;\x20gallery\x20write\x20failed.','warning');});},'image/png');}catch(_0x515185){console['error']('[Profile]\x20compose/save\x20failed',_0x515185),_0xc77734?.('Profile\x20export\x20failed.','error');}});const _0x5b37eb=document['getElementById']('chatToggleBtn'),_0x23e9b3=document['getElementById']('chatOverlay'),_0x4689a2=document['getElementById']('chatCloseBtn'),_0x362c1b=document['getElementById']('chatSendBtn'),_0x15ca89=document['getElementById']('chatInput'),_0x47d254=document['getElementById']('chatMessages');_0x5b37eb['addEventListener']('click',()=>{_0x23e9b3['classList']['remove']('hidden');}),_0x4689a2['addEventListener']('click',()=>{_0x23e9b3['classList']['add']('hidden');});let _0x287caf=null,_0x214697=null,_0x503624=null,_0x3dcaef=JSON['parse'](localStorage['getItem']('userProfile'))||{},_0x2a0f32=_0x3dcaef['nickname']?.['trim']()||'',_0x365d71=_0x3dcaef['image']||'';const _0x2676e4=new Map();function _0x39e6a3(_0x2b23d0){_0x5b37eb['style']['borderColor']=_0x2b23d0?'limegreen':'red';}let _0x45c3b5=null,_0x12bf3f=0x0;function _0xc4a858(){_0x287caf&&_0x287caf['readyState']===WebSocket['OPEN']&&(_0x3dcaef=JSON['parse'](localStorage['getItem']('userProfile'))||{},_0x2a0f32=_0x3dcaef['nickname']?.['trim']()||'',_0x365d71=_0x3dcaef['image']||'',_0x287caf['send'](JSON['stringify']({'type':'set-nickname','nickname':_0x2a0f32,'profileImage':_0x365d71})));}function _0x40b6be(){const _0x45246b=document['getElementById']('chatUsers'),_0x3706dd=document['getElementById']('chatUserBadge');_0x45246b['innerHTML']='',_0x2676e4['forEach']((_0x9d00cc,_0x1455ec)=>{const _0x23059f=document['createElement']('div');_0x23059f['className']='chat-user-item';const _0x57a43a=document['createElement']('img');_0x57a43a['className']='chat-user-avatar',_0x9d00cc['profileImage']&&_0x9d00cc['profileImage']['startsWith']('data:')||_0x9d00cc['profileImage']&&''!==_0x9d00cc['profileImage']?_0x57a43a['src']=_0x9d00cc['profileImage']:_0x57a43a['src']='/static/draw/images/icons/cat.svg';const _0x53c87b=document['createElement']('span');_0x53c87b['className']='chat-user-name',_0x53c87b['textContent']=_0x9d00cc['nickname']||'Unknown',_0x23059f['appendChild'](_0x57a43a),_0x23059f['appendChild'](_0x53c87b),_0x45246b['appendChild'](_0x23059f);});const _0x520eb5=_0x2676e4['size'];_0x3706dd&&(_0x3706dd['textContent']=_0x520eb5,_0x3706dd['style']['display']=_0x520eb5>0x0?'flex':'none');}function _0x41029d(){const _0x548331=_0x15ca89['value']['trim']();if(_0x548331&&_0x287caf&&_0x287caf['readyState']===WebSocket['OPEN']){const _0x48828b={'type':'text','clientId':_0x214697,'message':_0x548331,'timestamp':Date['now']()};_0x287caf['send'](JSON['stringify'](_0x48828b)),_0x15ca89['value']='',_0x5c78dd(_0x48828b,'sent');}}function _0x5c78dd(_0x4a0335,_0x1b3644){const _0x25f509=_0x2676e4['get'](_0x4a0335['clientId'])||{},_0x47ad57=_0x25f509['nickname']||'Unknown',_0x11770c=_0x25f509['profileImage']?'<img\x20src=\x22'+_0x25f509['profileImage']+'\x22\x20class=\x22chat-avatar\x22>':'',_0x6c6ce0=_0xefd68b(_0x4a0335['clientId']),_0x467024=new Date(_0x4a0335['timestamp']||Date['now']()),_0x3aa710=String(_0x467024['getHours']())['padStart'](0x2,'0')+':'+String(_0x467024['getMinutes']())['padStart'](0x2,'0')+':'+String(_0x467024['getSeconds']())['padStart'](0x2,'0'),_0x246934=document['createElement']('div');if('system'===_0x1b3644)_0x246934['textContent']='***\x20'+_0x4a0335['message']+'\x20***',_0x246934['className']='chat-message\x20system';else{_0x246934['className']='chat-message\x20'+_0x1b3644,_0x246934['style']['backgroundColor']='received'===_0x1b3644?_0x6c6ce0:'';const _0x3efa08=marked['parse'](_0x4a0335['message']),_0x446041=DOMPurify['sanitize'](_0x3efa08,{'ADD_TAGS':['pre','code'],'ADD_ATTR':['class']});_0x246934['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-timestamp\x22>'+_0x3aa710+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-message-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x11770c+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22chat-sender-name\x22>'+_0x47ad57+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-message-body\x22>'+_0x446041+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x246934['querySelectorAll']('pre\x20code')['forEach'](_0xa7f5fc=>{hljs['highlightElement'](_0xa7f5fc);});}_0x47d254['prepend'](_0x246934);}function _0xefd68b(_0x213602){let _0x20db95=0x0;for(let _0x35680f=0x0;_0x35680f<_0x213602['length'];_0x35680f++)_0x20db95=_0x213602['charCodeAt'](_0x35680f)+((_0x20db95<<0x5)-_0x20db95);return'hsl('+_0x20db95%0x168+',\x2070%,\x2080%)';}!function _0x25281d(){_0x287caf&&(_0x287caf['onopen']=_0x287caf['onmessage']=_0x287caf['onerror']=_0x287caf['onclose']=null,_0x287caf=null);let _0x15c323='';if('localhost'===location['hostname']||'127.0.0.1'===location['hostname']||location['hostname']['startsWith']('172.')||location['hostname']['startsWith']('192.168.')){const _0x21abae=0xbb9;_0x15c323=('https:'===location['protocol']?'wss':'ws')+'://'+location['hostname']+':'+_0x21abae;}else _0x15c323=('https:'===location['protocol']?'wss':'ws')+'://'+location['host']+'/chat-ws/';_0x287caf=new WebSocket(_0x15c323),_0x287caf['onopen']=()=>{_0x39e6a3(!0x0),_0x503624&&(clearTimeout(_0x503624),_0x503624=null),_0x12bf3f=Date['now'](),_0x45c3b5&&clearInterval(_0x45c3b5),_0x45c3b5=setInterval(()=>{_0x287caf['readyState']===WebSocket['OPEN']&&(_0x287caf['send'](JSON['stringify']({'type':'ping','timestamp':Date['now']()})),Date['now']()-_0x12bf3f>0x2710&&(console['warn']('[WebSocket]\x20Pong\x20timeout\x20—\x20force\x20reconnect'),_0x287caf['close']()));},0xbb8),_0xc4a858();},_0x287caf['onmessage']=_0xf28b08=>{try{let _0x41b8d1=_0xf28b08['data'];_0x41b8d1['startsWith']('[User]\x20')&&(_0x41b8d1=_0x41b8d1['substring'](0x7));const _0xdc0942=JSON['parse'](_0x41b8d1);if('welcome'===_0xdc0942['type'])return _0x214697=_0xdc0942['clientId'],void _0x40b6be();if('profile-update'===_0xdc0942['type'])return _0x2676e4['set'](_0xdc0942['clientId'],{'nickname':_0xdc0942['nickname'],'profileImage':_0xdc0942['profileImage']}),void _0x40b6be();if('user-list'===_0xdc0942['type'])return _0x2676e4['clear'](),_0xdc0942['users']['forEach'](_0x2fa1cb=>{_0x2676e4['set'](_0x2fa1cb['clientId'],{'nickname':_0x2fa1cb['nickname'],'profileImage':_0x2fa1cb['profileImage']});}),void _0x40b6be();if('pong'===_0xdc0942['type'])return void(_0x12bf3f=Date['now']());if('text'===_0xdc0942['type']){const _0x2bf175=_0xdc0942['clientId']===_0x214697;return void _0x5c78dd(_0xdc0942,_0x2bf175?'sent':'received');}if('image'===_0xdc0942['type']){const _0x2112fb=_0x2676e4['get'](_0xdc0942['clientId'])||{},_0x5dc039=_0x2112fb['nickname']||'Unknown',_0xf2e4ff=_0x2112fb['profileImage']?'<img\x20src=\x22'+_0x2112fb['profileImage']+'\x22\x20class=\x22chat-avatar\x22>':'',_0x4d4205=_0xefd68b(_0xdc0942['clientId']),_0x41ad66=document['createElement']('div');return _0x41ad66['className']='chat-message\x20received',_0x41ad66['style']['backgroundColor']=_0x4d4205,_0x41ad66['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0xf2e4ff+'\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-text\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>['+_0x5dc039+']:\x20posted\x20artwork</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22'+_0xdc0942['imageData']+'\x22\x20alt=\x22'+_0xdc0942['imageName']+'\x22\x20style=\x22max-width:\x20220px;\x20max-height:\x20320px;\x20margin-top:\x205px;\x20border-radius:\x208px;\x20box-shadow:\x200\x202px\x208px\x20rgba(0,0,0,0.2);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',void _0x47d254['prepend'](_0x41ad66);}if('system'===_0xdc0942['type'])return void _0x5c78dd({'clientId':'','message':_0xdc0942['message'],'timestamp':_0xdc0942['timestamp']},'system');}catch(_0x1e1a41){console['error']('[WebSocket]\x20Invalid\x20message\x20format',_0xf28b08['data']);}},_0x287caf['onclose']=()=>{_0x39e6a3(!0x1),_0x45c3b5&&(clearInterval(_0x45c3b5),_0x45c3b5=null),_0x503624&&clearTimeout(_0x503624),_0x503624=setTimeout(_0x25281d,0xbb8);},_0x287caf['onerror']=_0xf9a3dc=>{console['error']('[WebSocket]\x20Error:',_0xf9a3dc);};}(),_0x362c1b['addEventListener']('click',_0x41029d),_0x15ca89['addEventListener']('keypress',_0x2a31ae=>{'Enter'===_0x2a31ae['key']&&(_0x2a31ae['preventDefault'](),_0x41029d());}),marked['setOptions']({'breaks':!0x0,'gfm':!0x0,'headerIds':!0x1,'mangle':!0x1,'sanitize':!0x1}),document['getElementById']('sendToChatButton')['addEventListener']('click',()=>{!async function(_0x3b1844='Untitled',_0x28d754={}){const _0x271ef5=/Android|iPhone|iPad|iPod|Mobile/i['test'](navigator['userAgent'])||navigator['maxTouchPoints']>0x1,{includeBackground:_0x31963c=!0x0,startLongest:_0x59705e=_0x271ef5?0x2d0:0x400,jsonBudgetBytes:_0x3ceb47=_0x271ef5?0x493e0:0x186a0,startQuality:_0x8913=0.8,minQuality:_0x131ecd=0.4,downscaleStep:_0x36b07c=0.85,maxAttempts:_0x24ae46=0x10}=_0x28d754;if(!_0x287caf||_0x287caf['readyState']!==WebSocket['OPEN'])return void _0xc77734?.('Chat\x20not\x20connected.','warning');const _0x288dfe=_0x193ca4(_0x31963c);if(!_0x288dfe)return void _0xc77734?.('Compose\x20failed.','error');const _0x2d1103=new TextEncoder(),_0x4b760a=_0x10e0b2=>_0x2d1103['encode'](JSON['stringify'](_0x10e0b2))['length'],_0x4b1ab7=(_0x1665d7,_0xd7c658,_0x16c3c4)=>new Promise(_0x58680a=>_0x1665d7['toBlob'](_0x502edd=>_0x58680a(_0x502edd),_0xd7c658,_0x16c3c4)),_0x23cc41=_0x2aff2d=>new Promise(_0x222c8b=>{const _0x33bf6c=new FileReader();_0x33bf6c['onloadend']=()=>_0x222c8b(_0x33bf6c['result']),_0x33bf6c['readAsDataURL'](_0x2aff2d);}),_0x4729d6=Math['max'](_0x288dfe['width'],_0x288dfe['height']),_0x4d217d=Math['min'](0x1,(0x1===_0x59705e?_0x4729d6:_0x59705e)/_0x4729d6);let _0x2d523d=Math['max'](0x1,Math['round'](_0x288dfe['width']*_0x4d217d)),_0x354f31=Math['max'](0x1,Math['round'](_0x288dfe['height']*_0x4d217d)),_0x5ec160=document['createElement']('canvas');_0x5ec160['width']=_0x2d523d,_0x5ec160['height']=_0x354f31;let _0x4abc73=_0x5ec160['getContext']('2d');_0x4abc73['imageSmoothingEnabled']=!0x0,_0x4abc73['imageSmoothingQuality']='high',_0x4abc73['drawImage'](_0x288dfe,0x0,0x0,_0x2d523d,_0x354f31);let _0x42c357='image/webp',_0x201dd6=_0x8913;const _0x55902c=(JSON['parse'](localStorage['getItem']('userProfile')||'{}')['nickname']||'')['trim']();console['log']('[ChatSend]\x20start',{'device':_0x271ef5?'mobile':'desktop','doc':_0x288dfe['width']+'x'+_0x288dfe['height'],'start':_0x2d523d+'x'+_0x354f31,'budget':_0x3ceb47});const _0x390791=_0x42b718=>{_0x2d523d=Math['max'](0x1,Math['round'](_0x2d523d*_0x42b718)),_0x354f31=Math['max'](0x1,Math['round'](_0x354f31*_0x42b718));const _0x5dfada=document['createElement']('canvas');_0x5dfada['width']=_0x2d523d,_0x5dfada['height']=_0x354f31;const _0x4c2061=_0x5dfada['getContext']('2d');_0x4c2061['imageSmoothingEnabled']=!0x0,_0x4c2061['imageSmoothingQuality']='high',_0x4c2061['drawImage'](_0x5ec160,0x0,0x0,_0x2d523d,_0x354f31),_0x5ec160=_0x5dfada,_0x4abc73=_0x4c2061;};let _0x4205a8=0x0,_0x3484ca=!0x1,_0x24488e=null;for(;_0x4205a8<_0x24ae46;){_0x4205a8++;let _0x5b6340=await _0x4b1ab7(_0x5ec160,_0x42c357,_0x201dd6);if(_0x5b6340||'image/webp'!==_0x42c357||(_0x42c357='image/jpeg',_0x201dd6=_0x8913,_0x5b6340=await _0x4b1ab7(_0x5ec160,_0x42c357,_0x201dd6)),_0x5b6340||'image/jpeg'!==_0x42c357||(_0x42c357='image/png',_0x5b6340=await _0x4b1ab7(_0x5ec160,_0x42c357)),!_0x5b6340)break;const _0x3a9860=await _0x23cc41(_0x5b6340),_0x44d9aa={'type':'image','clientId':_0x214697,'nickname':_0x55902c,'imageName':_0x3b1844,'width':_0x2d523d,'height':_0x354f31,'mime':_0x42c357,'imageData':_0x3a9860,'timestamp':Date['now']()},_0x2aa1d5=_0x4b760a(_0x44d9aa);if(_0x24488e={'attempt':_0x4205a8,'dims':_0x2d523d+'x'+_0x354f31,'fmt':_0x42c357,'q':_0x201dd6??'n/a','blob':_0x5b6340['size'],'json':_0x2aa1d5},console['log']('[ChatSend]\x20try',_0x24488e),_0x2aa1d5<=_0x3ceb47){_0x287caf['send'](JSON['stringify'](_0x44d9aa)),_0xc77734?.('Sent\x20image\x20to\x20chat','info'),console['log']('[ChatSend]\x20sent',_0x24488e),_0x3484ca=!0x0;break;}('image/webp'===_0x42c357||'image/jpeg'===_0x42c357)&&_0x201dd6>_0x131ecd+0.001?_0x201dd6=Math['max'](_0x131ecd,_0x201dd6-0.15):'image/png'!==_0x42c357?(_0x390791(_0x36b07c),_0x201dd6=_0x8913):(_0x42c357='image/jpeg',_0x201dd6=_0x8913);}if(!_0x3484ca){_0x42c357='image/jpeg',_0x201dd6=0.55;let _0x3afc39=0xa;for(;_0x3afc39-->0x0;){const _0x35e2d7=await _0x4b1ab7(_0x5ec160,_0x42c357,_0x201dd6);if(!_0x35e2d7)break;const _0x4b02a9=await _0x23cc41(_0x35e2d7),_0x5a415d={'type':'image','clientId':_0x214697,'nickname':_0x55902c,'imageName':_0x3b1844,'width':_0x2d523d,'height':_0x354f31,'mime':_0x42c357,'imageData':_0x4b02a9,'timestamp':Date['now']()},_0xfdb430=_0x4b760a(_0x5a415d);if(console['log']('[ChatSend]\x20emergency',{'dims':_0x2d523d+'x'+_0x354f31,'q':_0x201dd6,'blob':_0x35e2d7['size'],'json':_0xfdb430}),_0xfdb430<=_0x3ceb47)return _0x287caf['send'](JSON['stringify'](_0x5a415d)),void _0xc77734?.('Sent\x20image\x20to\x20chat','info');if(_0x2d523d<=0xf0||_0x354f31<=0xf0)break;_0x390791(0.8);}console['warn']('[ChatSend]\x20failed\x20to\x20meet\x20budget',{'budget':_0x3ceb47,'last':_0x24488e}),_0xc77734?.('Image\x20too\x20large\x20for\x20chat\x20after\x20compression.','warning');}}('Quick\x20Share');});const _0xa43b48=document['getElementById']('brushSizeToggle'),_0x10325c=document['getElementById']('brushSizeSliderContainer');let _0x121b43='true'===localStorage['getItem']('brushSizeToggleMinimized');function _0x9b3c2(){if(_0x10325c['dataset']['minimized']=_0x121b43?'true':'false',_0x10325c['classList']['remove']('brush-panel-visible','brush-panel-hidden'),_0x121b43){_0x10325c['classList']['add']('brush-panel-hidden'),_0xa43b48['innerHTML']='<img\x20class=\x22show-icon\x22\x20src=\x22/static/draw/images/icons/hide.svg\x22\x20alt=\x22Show\x22>';const _0x2a5a5e=_0x10325c['getBoundingClientRect'](),_0x8c8fc3=window['innerWidth'],_0xb9c048=window['innerHeight'];(_0x2a5a5e['left']<0x0||_0x2a5a5e['top']<0x0||_0x2a5a5e['left']>_0x8c8fc3-0x28||_0x2a5a5e['top']>_0xb9c048-0x28)&&(_0x10325c['style']['left']='10px',_0x10325c['style']['top']='10px');}else _0x10325c['classList']['add']('brush-panel-visible'),_0xa43b48['innerHTML']='<img\x20class=\x22show-icon\x22\x20src=\x22/static/draw/images/icons/show.svg\x22\x20alt=\x22Hide\x22>';}_0x9b3c2(),_0xa43b48['addEventListener']('click',()=>{_0x121b43=!_0x121b43,localStorage['setItem']('brushSizeToggleMinimized',_0x121b43),_0x9b3c2();}),_0x9b3c2();const _0x4eeb28=document['getElementById']('brushContainerToggle'),_0x3a4723=document['getElementById']('brushContainer');let _0x18e9ba='true'===localStorage['getItem']('brushContainerMinimized');function _0x11f34b(){_0x3a4723['querySelectorAll']('.brush-thumbnail')['forEach'](_0x2888ce=>{_0x2888ce['style']['display']=_0x18e9ba?'none':'inline-block';}),_0x4eeb28['innerHTML']=_0x18e9ba?'<img\x20class=\x22show-icon\x22\x20src=\x22/static/draw/images/icons/hide.svg\x22\x20alt=\x22Show\x22>':'<img\x20class=\x22show-icon\x22\x20src=\x22/static/draw/images/icons/show.svg\x22\x20alt=\x22Hide\x22>';}_0x4eeb28['addEventListener']('click',()=>{_0x18e9ba=!_0x18e9ba,localStorage['setItem']('brushContainerMinimized',_0x18e9ba),_0x11f34b();}),_0x11f34b();const _0xc932ee=document['getElementById']('brushSizeSliderContainer'),_0x41f3aa=document['getElementById']('brushSizeDragBar');let _0x2e0321=0x0,_0x3b0b95=0x0,_0x1df3ea=!0x1;_0x41f3aa['addEventListener']('pointerdown',_0x568af1=>{_0x1df3ea=!0x0,_0x2e0321=_0x568af1['clientX']-_0xc932ee['offsetLeft'],_0x3b0b95=_0x568af1['clientY']-_0xc932ee['offsetTop'];try{_0x41f3aa['setPointerCapture'](_0x568af1['pointerId']);}catch{}_0x41f3aa['style']['cursor']='grabbing';}),_0x41f3aa['addEventListener']('pointermove',_0x2a76c1=>{if(!_0x1df3ea)return;const _0x1a41c8=_0x2a76c1['clientX']-_0x2e0321,_0x33e3f3=_0x2a76c1['clientY']-_0x3b0b95,_0xccf09e=window['visualViewport']&&window['visualViewport']['width']||window['innerWidth'],_0x255f14=window['visualViewport']&&window['visualViewport']['height']||window['innerHeight'],_0x3380fe=_0xc932ee['getBoundingClientRect'](),_0x24fbbc=Math['min'](Math['max'](_0x1a41c8,0x0),_0xccf09e-_0x3380fe['width']),_0xfc614f=Math['min'](Math['max'](_0x33e3f3,0x0),_0x255f14-_0x3380fe['height']);_0xc932ee['style']['left']=_0x24fbbc+'px',_0xc932ee['style']['top']=_0xfc614f+'px',_0xc932ee['style']['bottom']='auto';}),_0x41f3aa['addEventListener']('pointerup',_0x53be1e=>{_0x1df3ea=!0x1;try{_0x41f3aa['releasePointerCapture'](_0x53be1e['pointerId']);}catch{}_0x41f3aa['style']['cursor']='grab';const _0x4fd673=window['visualViewport']&&window['visualViewport']['width']||window['innerWidth'],_0x4450f6=window['visualViewport']&&window['visualViewport']['height']||window['innerHeight'],_0x2c9fa9=_0xc932ee['getBoundingClientRect'](),_0x267f0c=Math['min'](Math['max'](_0xc932ee['offsetLeft'],0x0),_0x4fd673-_0x2c9fa9['width']),_0x1daafd=Math['min'](Math['max'](_0xc932ee['offsetTop'],0x0),_0x4450f6-_0x2c9fa9['height']);_0xc932ee['style']['left']=_0x267f0c+'px',_0xc932ee['style']['top']=_0x1daafd+'px';}),_0x41f3aa['addEventListener']('pointercancel',()=>{_0x1df3ea=!0x1,_0x41f3aa['style']['cursor']='grab';});const _0x7cbce7=document['getElementById']('brushContainerWrapper'),_0x277301=document['getElementById']('brushContainerDragBar');let _0x584b65=0x0,_0xcfb98f=0x0,_0x54b1fb=!0x1;function _0x2e4f35(){if(!document['getElementById']('__uiHideStyle')){const _0x47944f=document['createElement']('style');_0x47944f['id']='__uiHideStyle',_0x47944f['textContent']='\x0a\x20\x20\x20\x20\x20\x20/*\x20hide\x20any\x20element\x20that\x20is\x20neither\x20a\x20canvas\x20nor\x20an\x20ancestor\x20of\x20a\x20canvas,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20and\x20keep\x20the\x20toggle\x20button\x20and\x20its\x20children\x20visible\x20*/\x0a\x20\x20\x20\x20\x20\x20body.__ui_off\x20:not(canvas):not(#hideAllButton):not(#hideAllButton\x20*):not(:has(canvas))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20visibility:\x20hidden\x20!important;\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20/*\x20canvases\x20must\x20remain\x20interactive\x20while\x20UI\x20is\x20hidden\x20*/\x0a\x20\x20\x20\x20\x20\x20body.__ui_off\x20canvas\x20{\x20pointer-events:\x20auto\x20!important;\x20}\x0a\x20\x20\x20\x20\x20\x20/*\x20ensure\x20the\x20toggle\x20stays\x20clickable\x20above\x20everything\x20*/\x0a\x20\x20\x20\x20\x20\x20#hideAllButton\x20{\x20z-index:\x20999999;\x20}\x0a\x20\x20\x20\x20',document['head']['appendChild'](_0x47944f);}const _0x4eb21b=document['body']['classList']['toggle']('__ui_off'),_0x26093b=document['getElementById']('hideAllButton');_0x26093b&&(_0x26093b['title']=_0x4eb21b?'Show\x20UI':'Hide\x20UI');}_0x277301['addEventListener']('pointerdown',_0x4b300c=>{_0x54b1fb=!0x0,_0x584b65=_0x4b300c['clientX']-_0x7cbce7['offsetLeft'],_0xcfb98f=_0x4b300c['clientY']-_0x7cbce7['offsetTop'];try{_0x277301['setPointerCapture'](_0x4b300c['pointerId']);}catch{}_0x277301['style']['cursor']='grabbing';}),_0x277301['addEventListener']('pointermove',_0x1ed0c5=>{if(!_0x54b1fb)return;const _0x5219c3=_0x1ed0c5['clientX']-_0x584b65,_0x51b607=_0x1ed0c5['clientY']-_0xcfb98f,_0x46c495=window['visualViewport']&&window['visualViewport']['width']||window['innerWidth'],_0xacdbb9=window['visualViewport']&&window['visualViewport']['height']||window['innerHeight'],_0x52c6b2=_0x7cbce7['getBoundingClientRect'](),_0x2642b2=Math['min'](Math['max'](_0x5219c3,0x0),_0x46c495-_0x52c6b2['width']),_0xc97650=Math['min'](Math['max'](_0x51b607,0x0),_0xacdbb9-_0x52c6b2['height']);_0x7cbce7['style']['left']=_0x2642b2+'px',_0x7cbce7['style']['top']=_0xc97650+'px';}),_0x277301['addEventListener']('pointerup',_0x29c4f7=>{_0x54b1fb=!0x1;try{_0x277301['releasePointerCapture'](_0x29c4f7['pointerId']);}catch{}_0x277301['style']['cursor']='grab';const _0x45413b=window['visualViewport']&&window['visualViewport']['width']||window['innerWidth'],_0x391a18=window['visualViewport']&&window['visualViewport']['height']||window['innerHeight'],_0x25cf71=_0x7cbce7['getBoundingClientRect'](),_0x51c5f4=Math['min'](Math['max'](_0x7cbce7['offsetLeft'],0x0),_0x45413b-_0x25cf71['width']),_0x1e609a=Math['min'](Math['max'](_0x7cbce7['offsetTop'],0x0),_0x391a18-_0x25cf71['height']);_0x7cbce7['style']['left']=_0x51c5f4+'px',_0x7cbce7['style']['top']=_0x1e609a+'px';}),_0x277301['addEventListener']('pointercancel',()=>{_0x54b1fb=!0x1,_0x277301['style']['cursor']='grab';}),document['getElementById']('hideAllButton')?.['addEventListener']('click',_0x2e4f35),document['addEventListener']('keydown',_0x2268d4=>{if(_0x2268d4['altKey']||_0x2268d4['ctrlKey']||_0x2268d4['metaKey']||_0x2268d4['shiftKey'])return;('Escape'===_0x2268d4['key']||'Esc'===_0x2268d4['key']||0x1b===_0x2268d4['keyCode'])&&(_0x2268d4['preventDefault'](),_0x2e4f35());},{'capture':!0x0});const _0x4c8d75=document['getElementById']('menuButton'),_0x4c2d8b=document['querySelector']('#saveGalleryButtons\x20.menuButtons');function _0xc77734(_0x5a74fd,_0x2998ec='info'){console['log']('showStatusMessage',_0x5a74fd);const _0x570fa2=document['createElement']('div');_0x570fa2['classList']['add']('status-message',_0x2998ec),_0x570fa2['innerText']=_0x5a74fd,document['body']['appendChild'](_0x570fa2),setTimeout(()=>{_0x570fa2['classList']['add']('fade-out'),setTimeout(()=>_0x570fa2['remove'](),0x2bc);},0x2bc);}function _0x2bd5f7(_0x474bff){_0x474bff['style']['display']='flex',setTimeout(()=>{const _0x187ecf=_0x474bff['querySelector']('.close');_0x187ecf&&!_0x187ecf['dataset']['listenerAdded']&&(_0x187ecf['addEventListener']('click',()=>_0x2a6ca4(_0x474bff)),_0x187ecf['dataset']['listenerAdded']='true');},0x0);}function _0x2a6ca4(_0x170907){_0x170907['style']['display']='none';}_0x4c2d8b['style']['display']='none',_0x4c8d75['addEventListener']('click',()=>{'none'===_0x4c2d8b['style']['display']?_0x4c2d8b['style']['display']='flex':_0x4c2d8b['style']['display']='none';});const _0x3483d9=document['getElementById']('saveModal'),_0x5054d5=document['getElementById']('galleryModal'),_0x2c12d4=document['getElementById']('saveButton'),_0x51ab46=document['getElementById']('galleryButton'),_0x3f87aa=document['getElementById']('confirmSave');function _0x317912({fit:_0x4091e8=!0x0}={}){const _0x1c4380=canvasWrapper['getBoundingClientRect'](),_0x4b53e4=canvas['width'],_0x151f7d=canvas['height'],_0x284bee=Math['min'](_0x1c4380['width']/_0x4b53e4,_0x1c4380['height']/_0x151f7d,zoomMax),_0x5460ea=_0x4091e8?Math['max'](zoomMin,_0x284bee):0x1,_0x50f0f9=canvas['style']['transition'];canvas['style']['transition']='transform\x20140ms\x20ease-out',zoomScale=_0x5460ea,centerCanvasInWrapper(),setTimeout(()=>{canvas['style']['transition']=_0x50f0f9;},0xa0),resetStrokeState(),needsRedraw=!0x0;}_0x2c12d4&&_0x2c12d4['addEventListener']('click',()=>_0x2bd5f7(_0x3483d9)),_0x51ab46&&_0x51ab46['addEventListener']('click',()=>{_0x2bd5f7(_0x5054d5),_0x870d8b();}),_0x3f87aa&&_0x3f87aa['addEventListener']('click',()=>{const _0x3e8647=document['getElementById']('artworkName');_0x7a5bfd(_0x3e8647?_0x3e8647['value']:''),_0x2a6ca4(_0x3483d9);}),(document['getElementById']('resetViewBtn')['addEventListener']('click',()=>{_0x317912({'fit':!0x0}),document['activeElement']&&'function'==typeof document['activeElement']['blur']&&document['activeElement']['blur']();const _0x4a72c0=document['querySelector']('meta[name=\x22viewport\x22]');if(_0x4a72c0){const _0x257fc4=_0x4a72c0['getAttribute']('content')||'width=device-width,\x20initial-scale=1',_0x214c26=_0x257fc4['replace'](/,\s*maximum-scale=[^,]+/i,'');_0x4a72c0['setAttribute']('content',_0x214c26+',\x20maximum-scale=1'),setTimeout(()=>_0x4a72c0['setAttribute']('content',_0x257fc4),0x50);}}),document['addEventListener']('keydown',_0x508525=>{isUserTyping()||'0'===_0x508525['key']&&_0x317912({'fit':!0x0});}));}),document['getElementById']('cleanButton')['addEventListener']('click',()=>clearCanvas(!0x0)),document['getElementById']('artworkName')['addEventListener']('keydown',function(_0x3cf8ea){'Enter'===_0x3cf8ea['key']&&(_0x3cf8ea['preventDefault'](),document['getElementById']('saveNewButton')['click']());});const uiElements=[{'id':'brushContainerWrapper','display':'flex'},{'id':'brushSizeSliderContainer','display':'flex'},{'id':'redoUndoButtons','display':'flex'},{'id':'colorsContainer','display':'block'},{'id':'saveGalleryButtons','display':'block'},{'id':'profileSection','display':'block'},{'id':'chatToggleBtn','display':'flex'},{'id':'layersPanel','display':'block'}],fadeOutUI=()=>{uiElements['forEach'](_0x2ace2b=>{const _0xfbb7c7=document['getElementById'](_0x2ace2b['id']);_0xfbb7c7&&(_0xfbb7c7['style']['opacity']='0',setTimeout(()=>{_0xfbb7c7['style']['display']='none';},0xfa));});},fadeInUI=()=>{uiElements['forEach'](_0x29fad1=>{const _0x28d31e=document['getElementById'](_0x29fad1['id']);_0x28d31e&&(_0x28d31e['style']['display']=_0x29fad1['display'],setTimeout(()=>{_0x28d31e['style']['opacity']='1';},0xa));});};let uiTimeout=null;const uiTimeoutInterval=0x1f4,resetUITimeout=()=>{uiTimeout&&clearTimeout(uiTimeout),uiTimeout=setTimeout(fadeInUI,0x1f4);};let uiHidden=!0x1,hideStart=null;const HIDE_MOVE_THRESHOLD=0x6;function getCanvasPosFromEvent(_0x5778e4){const _0x4b5fe8=canvas['getBoundingClientRect'](),_0x55632c='touches'in _0x5778e4?_0x5778e4['touches'][0x0]:_0x5778e4;return{'x':(_0x55632c['clientX']-_0x4b5fe8['left'])*(canvas['width']/_0x4b5fe8['width']),'y':(_0x55632c['clientY']-_0x4b5fe8['top'])*(canvas['height']/_0x4b5fe8['height'])};}function maybeHideUIOnMove(_0x7ee951){if(!isDrawing||uiHidden||!hideStart)return;const _0x3ed40d=getCanvasPosFromEvent('touches'in _0x7ee951?_0x7ee951['touches'][0x0]:_0x7ee951),_0x5be3a0=_0x3ed40d['x']-hideStart['x'],_0x42b6cb=_0x3ed40d['y']-hideStart['y'];Math['hypot'](_0x5be3a0,_0x42b6cb)>=0x6&&(fadeOutUI(),uiTimeout&&clearTimeout(uiTimeout),uiHidden=!0x0);}function endStrokeUIReset(){uiHidden&&resetUITimeout(),hideStart=null,uiHidden=!0x1;}canvas['addEventListener']('mousedown',_0x2e66c8=>{'fill'!==currentTool&&(hideStart=getCanvasPosFromEvent(_0x2e66c8),uiHidden=!0x1);}),canvas['addEventListener']('touchstart',_0xb157cd=>{isTwoFingerGesture||'fill'!==currentTool&&(hideStart=getCanvasPosFromEvent(_0xb157cd),uiHidden=!0x1);},{'passive':!0x1}),canvas['addEventListener']('mousemove',maybeHideUIOnMove,{'passive':!0x0}),canvas['addEventListener']('touchmove',_0xf234d2=>{isTwoFingerGesture||maybeHideUIOnMove(_0xf234d2);},{'passive':!0x1}),canvas['addEventListener']('mouseup',endStrokeUIReset),canvas['addEventListener']('touchend',endStrokeUIReset),canvas['addEventListener']('mouseleave',endStrokeUIReset),window['addEventListener']('blur',resetUITimeout),window['addEventListener']('focus',fadeInUI),document['getElementById']('footer')['innerHTML']=document['title'];const panels=[{'id':'brushSizeSliderContainer','dragBarId':'brushSizeDragBar'},{'id':'brushContainerWrapper','dragBarId':'brushContainerDragBar'}];function exportCanvasToImage(){const _0x37afbc=document['getElementById']('glCanvas');return _0x37afbc?_0x37afbc['toDataURL']('image/png'):(alert('Canvas\x20not\x20found!'),null);}function sendCanvasToFlaskForAI(){const _0x1f9524=exportCanvasToImage();_0x1f9524&&fetch('/run_ai_inference',{'method':'POST','headers':{'Content-Type':'application/json'},'body':JSON['stringify']({'image_data':_0x1f9524})})['then'](_0x34176f=>_0x34176f['blob']())['then'](_0x1bbd78=>{const _0x4238fd=URL['createObjectURL'](_0x1bbd78),_0x1f6099=document['createElement']('img');_0x1f6099['src']=_0x4238fd,_0x1f6099['style']['position']='fixed',_0x1f6099['style']['bottom']='10px',_0x1f6099['style']['right']='10px',_0x1f6099['style']['border']='2px\x20solid\x20#ccc',_0x1f6099['style']['maxWidth']='200px',_0x1f6099['style']['zIndex']=0x270f,document['body']['appendChild'](_0x1f6099);})['catch'](_0x2338fe=>{console['error']('Error\x20during\x20AI\x20request:',_0x2338fe),alert('AI\x20request\x20failed.');});}async function pasteImageFromClipboard(_0x488939){console['log']('[Clipboard]\x20pasteImageFromClipboard\x20start');try{let _0x3ae971=null;if(_0x488939&&_0x488939['clipboardData']&&_0x488939['clipboardData']['items']&&_0x488939['clipboardData']['items']['length'])for(let _0x3ad94b=0x0;_0x3ad94b<_0x488939['clipboardData']['items']['length'];_0x3ad94b++){const _0x50d13b=_0x488939['clipboardData']['items'][_0x3ad94b];if(_0x50d13b&&_0x50d13b['type']&&_0x50d13b['type']['startsWith']('image/')){_0x3ae971=_0x50d13b['getAsFile']?_0x50d13b['getAsFile']():null;break;}}if(!_0x3ae971&&navigator['clipboard']&&navigator['clipboard']['read'])try{const _0x1d5d61=await navigator['clipboard']['read']();for(const _0x100ab1 of _0x1d5d61){for(const _0x25e30d of _0x100ab1['types'])if(_0x25e30d['startsWith']('image/')){_0x3ae971=await _0x100ab1['getType'](_0x25e30d);break;}if(_0x3ae971)break;}}catch(_0x38fb59){console['warn']('[Clipboard]\x20navigator.clipboard.read\x20not\x20permitted',_0x38fb59);}if(!_0x3ae971)return void showStatusMessage?.('Clipboard\x20has\x20no\x20image\x20data.','error');const _0x7e7c12=await new Promise((_0x2b71a9,_0x2c8f76)=>{const _0x34f625=URL['createObjectURL'](_0x3ae971),_0x5c3e1d=new Image();_0x5c3e1d['onload']=()=>{URL['revokeObjectURL'](_0x34f625),_0x2b71a9(_0x5c3e1d);},_0x5c3e1d['onerror']=_0x564022=>{URL['revokeObjectURL'](_0x34f625),_0x2c8f76(_0x564022);},_0x5c3e1d['src']=_0x34f625;});fixedFBOWidth&&fixedFBOHeight||(fixedFBOWidth=_0x7e7c12['width'],fixedFBOHeight=_0x7e7c12['height'],'function'==typeof initPaintLayerFixed&&initPaintLayerFixed(),'function'==typeof updateCanvasSize&&updateCanvasSize({'width':_0x7e7c12['width'],'height':_0x7e7c12['height']}),needsRedraw=!0x0);const _0x476074=layers&&Number['isInteger'](activeLayerIndex)?layers[activeLayerIndex]:null;if(!_0x476074||!_0x476074['fbo'])return void showStatusMessage?.('No\x20active\x20layer\x20to\x20paste\x20into.','error');const _0x3939d9=fixedFBOWidth,_0x364258=fixedFBOHeight;!function(_0x2c55be,_0x2c70c6,_0x4047a9,_0x1156a1){const _0x36f117=_0x4047a9/_0x2c55be['width'],_0x4dc9e1=_0x1156a1/_0x2c55be['height'],_0x3af782=Math['min'](_0x36f117,_0x4dc9e1,0x1),_0x4e6e85=Math['max'](0x1,Math['round'](_0x2c55be['width']*_0x3af782)),_0x3b2d9b=Math['max'](0x1,Math['round'](_0x2c55be['height']*_0x3af782)),_0x53e55a=Math['floor']((_0x4047a9-_0x4e6e85)/0x2),_0x528b48=Math['floor']((_0x1156a1-_0x3b2d9b)/0x2),_0x49cc97=document['createElement']('canvas');_0x49cc97['width']=_0x4047a9,_0x49cc97['height']=_0x1156a1;const _0x5b2dc6=_0x49cc97['getContext']('2d');_0x5b2dc6['clearRect'](0x0,0x0,_0x4047a9,_0x1156a1),_0x5b2dc6['imageSmoothingEnabled']=!0x0,_0x5b2dc6['imageSmoothingQuality']='high',_0x5b2dc6['drawImage'](_0x2c55be,0x0,0x0,_0x2c55be['width'],_0x2c55be['height'],_0x53e55a,_0x528b48,_0x4e6e85,_0x3b2d9b);const _0x4d58f2=gl['createTexture']();gl['bindTexture'](gl['TEXTURE_2D'],_0x4d58f2),gl['pixelStorei'](gl['UNPACK_FLIP_Y_WEBGL'],!0x1),gl['pixelStorei'](gl['UNPACK_PREMULTIPLY_ALPHA_WEBGL'],!0x1),gl['texImage2D'](gl['TEXTURE_2D'],0x0,gl['RGBA'],gl['RGBA'],gl['UNSIGNED_BYTE'],_0x49cc97),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MIN_FILTER'],gl['LINEAR']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_MAG_FILTER'],gl['LINEAR']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_S'],gl['CLAMP_TO_EDGE']),gl['texParameteri'](gl['TEXTURE_2D'],gl['TEXTURE_WRAP_T'],gl['CLAMP_TO_EDGE']),gl['bindFramebuffer'](gl['FRAMEBUFFER'],_0x2c70c6);const _0x23528f=gl['checkFramebufferStatus'](gl['FRAMEBUFFER']);if(_0x23528f!==gl['FRAMEBUFFER_COMPLETE'])return console['warn']('[Clipboard]\x20FBO\x20incomplete:',_0x23528f),gl['bindFramebuffer'](gl['FRAMEBUFFER'],null),gl['bindTexture'](gl['TEXTURE_2D'],null),void gl['deleteTexture'](_0x4d58f2);gl['viewport'](0x0,0x0,_0x4047a9,_0x1156a1),gl['disable'](gl['BLEND']),gl['clearColor'](0x0,0x0,0x0,0x0),gl['clear'](gl['COLOR_BUFFER_BIT']),gl['useProgram'](quadProgram);const _0x3d8e8f=gl['getUniformLocation'](quadProgram,'u_flipY');null!==_0x3d8e8f&&gl['uniform1f'](_0x3d8e8f,0x1);const _0x207496=gl['getUniformLocation'](quadProgram,'u_resolution');null!==_0x207496&&gl['uniform2f'](_0x207496,_0x4047a9,_0x1156a1);const _0x8a755f=gl['getUniformLocation'](quadProgram,'u_layerOpacity');null!==_0x8a755f&&gl['uniform1f'](_0x8a755f,0x1);const _0x14d8c0=new Float32Array([0x0,0x0,0x0,0x0,_0x4047a9,0x0,0x1,0x0,0x0,_0x1156a1,0x0,0x1,0x0,_0x1156a1,0x0,0x1,_0x4047a9,0x0,0x1,0x0,_0x4047a9,_0x1156a1,0x1,0x1]),_0x7cbe98=gl['createBuffer']();gl['bindBuffer'](gl['ARRAY_BUFFER'],_0x7cbe98),gl['bufferData'](gl['ARRAY_BUFFER'],_0x14d8c0,gl['STATIC_DRAW']);const _0x50f4ad=gl['getAttribLocation'](quadProgram,'a_position'),_0x50b7c6=gl['getAttribLocation'](quadProgram,'a_texCoord');gl['enableVertexAttribArray'](_0x50f4ad),gl['vertexAttribPointer'](_0x50f4ad,0x2,gl['FLOAT'],!0x1,0x10,0x0),gl['enableVertexAttribArray'](_0x50b7c6),gl['vertexAttribPointer'](_0x50b7c6,0x2,gl['FLOAT'],!0x1,0x10,0x8),gl['activeTexture'](gl['TEXTURE0']),gl['bindTexture'](gl['TEXTURE_2D'],_0x4d58f2);const _0x2caa5b=gl['getUniformLocation'](quadProgram,'u_texture');null!==_0x2caa5b&&gl['uniform1i'](_0x2caa5b,0x0),gl['drawArrays'](gl['TRIANGLES'],0x0,0x6),gl['disableVertexAttribArray'](_0x50f4ad),gl['disableVertexAttribArray'](_0x50b7c6),gl['bindBuffer'](gl['ARRAY_BUFFER'],null),gl['deleteBuffer'](_0x7cbe98),gl['bindFramebuffer'](gl['FRAMEBUFFER'],null),gl['bindTexture'](gl['TEXTURE_2D'],null),gl['deleteTexture'](_0x4d58f2);}(_0x7e7c12,_0x476074['fbo'],_0x3939d9,_0x364258),syncActiveAliases?.(),rebuildLayersUI?.(),needsRedraw=!0x0,showStatusMessage?.('Pasted\x20image\x20into\x20active\x20layer.','success'),console['log']('[Clipboard]\x20Paste\x20complete');}catch(_0x3499ee){console['error']('pasteImageFromClipboard\x20error',_0x3499ee),showStatusMessage?.('Paste\x20failed.','error');}}async function copyActiveLayerToClipboard(){console['log']('[Clipboard]\x20copyActiveLayerToClipboard\x20start');try{if(!(navigator['clipboard']&&navigator['clipboard']['write']&&window['ClipboardItem']))return void showStatusMessage?.('Clipboard\x20copy\x20not\x20supported.','error');const _0xcc6642=layers&&Number['isInteger'](activeLayerIndex)?layers[activeLayerIndex]:null;if(!_0xcc6642||!_0xcc6642['fbo'])return void showStatusMessage?.('No\x20active\x20layer\x20to\x20copy.','error');const _0x30543f=fixedFBOWidth,_0x138126=fixedFBOHeight,_0x896b39=document['createElement']('canvas');_0x896b39['width']=_0x30543f,_0x896b39['height']=_0x138126,_0x896b39['getContext']('2d')['putImageData'](readFBOToImageData(_0xcc6642['fbo'],_0x30543f,_0x138126),0x0,0x0);const _0x344274=document['createElement']('canvas');_0x344274['width']=_0x30543f,_0x344274['height']=_0x138126;const _0x45283d=_0x344274['getContext']('2d');_0x45283d['save'](),_0x45283d['translate'](_0x30543f/0x2,_0x138126/0x2),_0x45283d['scale'](-0x1,-0x1),_0x45283d['rotate'](Math['PI']),_0x45283d['drawImage'](_0x896b39,-_0x30543f/0x2,-_0x138126/0x2),_0x45283d['restore']();const _0x5b4072=await new Promise(_0x450428=>_0x344274['toBlob'](_0x450428,'image/png'));if(!_0x5b4072)return void showStatusMessage?.('Copy\x20failed\x20(no\x20data).','error');await navigator['clipboard']['write']([new ClipboardItem({[_0x5b4072['type']]:_0x5b4072})]),showStatusMessage?.('Active\x20layer\x20copied\x20to\x20clipboard.','success'),console['log']('[Clipboard]\x20Copy\x20complete');}catch(_0xb17c75){console['error']('copyActiveLayerToClipboard\x20error',_0xb17c75),showStatusMessage?.('Copy\x20to\x20clipboard\x20failed.','error');}}async function _readClipboardImage(_0x9bf1c9){if(_0x9bf1c9&&_0x9bf1c9['clipboardData']&&_0x9bf1c9['clipboardData']['items']&&_0x9bf1c9['clipboardData']['items']['length'])for(let _0x32d3c5=0x0;_0x32d3c5<_0x9bf1c9['clipboardData']['items']['length'];_0x32d3c5++){const _0x5c2367=_0x9bf1c9['clipboardData']['items'][_0x32d3c5];if(_0x5c2367&&_0x5c2367['type']&&_0x5c2367['type']['startsWith']('image/')){const _0x5011d9=_0x5c2367['getAsFile']?_0x5c2367['getAsFile']():null;if(_0x5011d9)return _0x5011d9;}}if(navigator['clipboard']&&navigator['clipboard']['read'])try{const _0xc4c6cb=await navigator['clipboard']['read']();for(const _0x5edb30 of _0xc4c6cb)for(const _0x42b01f of _0x5edb30['types'])if(_0x42b01f['startsWith']('image/')){const _0x432354=await _0x5edb30['getType'](_0x42b01f);if(_0x432354)return _0x432354;}}catch(_0x25a877){console['warn']('[Clipboard]\x20navigator.clipboard.read\x20not\x20permitted',_0x25a877);}return null;}function _blobToImage(_0x5b5ccd){return new Promise((_0x115442,_0x1bfa21)=>{const _0x4b3934=URL['createObjectURL'](_0x5b5ccd),_0x597363=new Image();_0x597363['onload']=()=>{URL['revokeObjectURL'](_0x4b3934),_0x115442(_0x597363);},_0x597363['onerror']=_0x3c6a92=>{URL['revokeObjectURL'](_0x4b3934),_0x1bfa21(_0x3c6a92);},_0x597363['src']=_0x4b3934;});}function renderLoop(){needsRedraw&&(drawScene(),console['log']('renderLoop'),needsRedraw=!0x1),requestAnimationFrame(renderLoop);}panels['forEach'](({id:_0x35fb8b,dragBarId:_0x11e234})=>{const _0x275fdb=document['getElementById'](_0x35fb8b),_0x1be7ad=document['getElementById'](_0x11e234);if(!_0x275fdb||!_0x1be7ad)return;let _0x12b96f=0x0,_0x2cf2e1=0x0,_0x1543ef=!0x1;const _0x201503=localStorage['getItem'](_0x35fb8b+'-x'),_0x29149e=localStorage['getItem'](_0x35fb8b+'-y');null!==_0x201503&&null!==_0x29149e&&(_0x275fdb['style']['left']=_0x201503+'px',_0x275fdb['style']['top']=_0x29149e+'px',_0x275fdb['style']['bottom']='auto'),_0x1be7ad['addEventListener']('pointerdown',_0x56ed02=>{_0x1543ef=!0x0,_0x12b96f=_0x56ed02['clientX']-_0x275fdb['offsetLeft'],_0x2cf2e1=_0x56ed02['clientY']-_0x275fdb['offsetTop'],_0x1be7ad['setPointerCapture'](_0x56ed02['pointerId']),_0x1be7ad['style']['cursor']='grabbing';}),_0x1be7ad['addEventListener']('pointermove',_0x448ae6=>{if(!_0x1543ef)return;const _0x402fdd=_0x448ae6['clientX']-_0x12b96f,_0x441e53=_0x448ae6['clientY']-_0x2cf2e1;_0x275fdb['style']['left']=_0x402fdd+'px',_0x275fdb['style']['top']=_0x441e53+'px',_0x275fdb['style']['bottom']='auto';}),_0x1be7ad['addEventListener']('pointerup',_0x148813=>{_0x1543ef=!0x1,_0x1be7ad['releasePointerCapture'](_0x148813['pointerId']),_0x1be7ad['style']['cursor']='grab',localStorage['setItem'](_0x35fb8b+'-x',_0x275fdb['offsetLeft']),localStorage['setItem'](_0x35fb8b+'-y',_0x275fdb['offsetTop']);}),_0x1be7ad['addEventListener']('pointercancel',()=>{_0x1543ef=!0x1,_0x1be7ad['style']['cursor']='grab';});}),document['addEventListener']('paste',_0x1e19ee=>{!!(_0x1e19ee&&_0x1e19ee['clipboardData']&&[..._0x1e19ee['clipboardData']['items']]['some'](_0x17c42e=>_0x17c42e['type']['startsWith']('image/')))&&(_0x1e19ee['preventDefault'](),pasteImageFromClipboard(_0x1e19ee));}),document['addEventListener']('copy',_0x108423=>{(navigator['platform']['toUpperCase']()['includes']('MAC')?_0x108423['metaKey']:_0x108423['ctrlKey'])&&!0x0===_0x108423['shiftKey']&&(_0x108423['preventDefault'](),copyActiveLayerToClipboard());}),document['addEventListener']('keydown',_0x3525bc=>{(navigator['platform']['toUpperCase']()['includes']('MAC')?_0x3525bc['metaKey']:_0x3525bc['ctrlKey'])&&'v'===_0x3525bc['key']['toLowerCase']()&&setTimeout(async()=>{if(navigator['clipboard']&&navigator['clipboard']['read'])try{const _0xbb2601=await navigator['clipboard']['read']();_0xbb2601['some'](_0x4cb55a=>_0x4cb55a['types']['some'](_0x474440=>_0x474440['startsWith']('image/')))&&pasteImageFromClipboard(null);}catch(_0x185020){}},0x0);}),(function(){const _0x512cba=document['getElementById']('layersPanel'),_0x16dcd4=document['getElementById']('layersPanelDragBar'),_0x18c5db=document['getElementById']('layersList'),_0x27786c=document['getElementById']('layersActions'),_0x4c6377=document['getElementById']('layersPanelToggle');if(!_0x512cba||!_0x16dcd4)return;const _0x5a4b7a='layersPanel:minimized',_0x2b818d='layersPanel:x',_0x16d137='layersPanel:y',_0x734f79=localStorage['getItem'](_0x2b818d),_0x2812d8=localStorage['getItem'](_0x16d137);null!==_0x734f79&&null!==_0x2812d8&&(_0x512cba['style']['left']=+_0x734f79+'px',_0x512cba['style']['top']=+_0x2812d8+'px',_0x512cba['style']['bottom']='auto');let _0x329687='true'===localStorage['getItem'](_0x5a4b7a);function _0x40ec83(){_0x18c5db&&(_0x18c5db['style']['display']=_0x329687?'none':'flex'),_0x27786c&&(_0x27786c['style']['display']=_0x329687?'none':'flex'),_0x4c6377&&(_0x4c6377['innerHTML']=_0x329687?'<img\x20class=\x22show-icon-invert\x22\x20src=\x22/static/draw/images/icons/hide.svg\x22\x20alt=\x22Show\x22>':'<img\x20class=\x22show-icon-invert\x22\x20src=\x22/static/draw/images/icons/show.svg\x22\x20alt=\x22Hide\x22>');}_0x40ec83(),_0x4c6377&&_0x4c6377['addEventListener']('click',_0xa7a224=>{_0xa7a224['stopPropagation'](),_0x329687=!_0x329687,localStorage['setItem'](_0x5a4b7a,_0x329687),_0x40ec83();});let _0x3eec1e=!0x1,_0x527b42=0x0,_0x3221d0=0x0;function _0x2f5c2c(_0x42e03e,_0x557393,_0x558cd3){return Math['max'](_0x557393,Math['min'](_0x558cd3,_0x42e03e));}function _0xaf51bb(_0x105247){if(_0x3eec1e){_0x3eec1e=!0x1;try{_0x16dcd4['releasePointerCapture'](_0x105247['pointerId']);}catch{}_0x16dcd4['style']['cursor']='grab',localStorage['setItem'](_0x2b818d,_0x512cba['offsetLeft']),localStorage['setItem'](_0x16d137,_0x512cba['offsetTop']);}}_0x16dcd4['style']['cursor']='grab',_0x16dcd4['addEventListener']('pointerdown',function(_0x224487){const _0x145fcf=_0x224487['target'];if(!_0x145fcf['closest']||!_0x145fcf['closest']('.icon-btn')){_0x3eec1e=!0x0,_0x527b42=_0x224487['clientX']-_0x512cba['offsetLeft'],_0x3221d0=_0x224487['clientY']-_0x512cba['offsetTop'];try{_0x16dcd4['setPointerCapture'](_0x224487['pointerId']);}catch{}_0x16dcd4['style']['cursor']='grabbing',_0x224487['preventDefault']();}}),_0x16dcd4['addEventListener']('pointermove',function(_0x4828e6){if(!_0x3eec1e)return;const _0x113346=window['innerWidth'],_0x12a272=window['innerHeight'],_0x5df8bc=_0x2f5c2c(_0x4828e6['clientX']-_0x527b42,0x0,_0x113346-_0x512cba['offsetWidth']),_0x2ebd2b=_0x2f5c2c(_0x4828e6['clientY']-_0x3221d0,0x0,_0x12a272-_0x512cba['offsetHeight']);_0x512cba['style']['left']=_0x5df8bc+'px',_0x512cba['style']['top']=_0x2ebd2b+'px',_0x512cba['style']['bottom']='auto';}),_0x16dcd4['addEventListener']('pointerup',_0xaf51bb),_0x16dcd4['addEventListener']('pointercancel',_0xaf51bb);try{_0x18c5db&&'block'===getComputedStyle(_0x18c5db)['display']&&(_0x18c5db['style']['display']='flex');}catch{}try{rebuildLayersUI?.();}catch{}}()),initGL(),loadDefaultImage(),loadBrushes(),createBrushThumbnails(),renderLoop(),window['addEventListener']('keydown',_0x459477=>{const _0x2fb7e5=/Mac|iPhone|iPad/['test'](navigator['platform']);'F1'===_0x459477['key']&&(_0x459477['preventDefault'](),openHelpModal()),('?'===_0x459477['key']||'/'===_0x459477['key']&&_0x459477['shiftKey'])&&(_0x459477['preventDefault'](),openQuickHelpOverlay()),(_0x2fb7e5?_0x459477['metaKey']:_0x459477['ctrlKey'])&&'/'===_0x459477['key']&&(_0x459477['preventDefault'](),openQuickHelpOverlay());});